if (self.CavalryLogger) { CavalryLogger.start_js(["s9PVw"]); }

__d("NotificationConstants",[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();f.exports={PayloadSourceType:{UNKNOWN:0,USER_ACTION:1,LIVE_SEND:2,ENDPOINT:3,INITIAL_LOAD:4,OTHER_APPLICATION:5,SYNC:6,CLIENT:7}};}),null);
__d('NotificationStore',['BizSiteIdentifier.brands','BusinessUserConf','KeyedCallbackManager','NotificationConstants','NotificationUpdates','RangedCallbackManager','MercuryServerDispatcher'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=function m(n){this.notifications=new (c('KeyedCallbackManager'))();var o=function p(q){var r=this.notifications.getResource(q);return r.creation_time;};this.order=new (c('RangedCallbackManager'))(o.bind(this),function(p,q){return q-p;});this.graphQLPageInfo={};},i=c('BizSiteIdentifier.brands').isBizSite()?c('BizSiteIdentifier.brands').getBusinessID():null;c('NotificationUpdates').subscribe('update-notifications',function(m,n){var o=n.endpoint||k;if(n.page_info)j[o].graphQLPageInfo=n.page_info;if(n.nodes===undefined)return;var p,q=[],r={},s=n.nodes||[],t;s.forEach(function(u){p=u.alert_id;t=j[o].notifications.getResource(p);if(!t||t.creation_time<u.creation_time){q.push(p);r[p]=u;}});j[o].notifications.addResourcesAndExecute(r);j[o].order.addResources(q);c('NotificationUpdates').didUpdateNotifications(q);});var j={},k='/ajax/notifications/client/get.php',l={getNotifications:function m(n,o){var p=arguments.length<=2||arguments[2]===undefined?k:arguments[2],q=j[p].order.executeOrEnqueue(0,n,function(x){var y=j[p].notifications.executeOrEnqueue(x,o);}),r=j[p].order.getUnavailableResources(q);if(r.length){j[p].order.unsubscribe(q);if(!l.canFetchMore(p)){j[p].notifications.executeOrEnqueue(j[p].order.getAllResources(),o);return;}var s=j[p].graphQLPageInfo,t=s&&s.end_cursor||null,u;if(t){var v=Math.max.apply(null,r),w=j[p].order.getCurrentArraySize();u=v-w+1;}else u=n;c('MercuryServerDispatcher').trySend(p,{businessID:i,businessUserID:c('BusinessUserConf').biz_user_id,cursor:t,length:u});}},getAll:function m(n){var o=arguments.length<=1||arguments[1]===undefined?k:arguments[1];l.getNotifications(l.getCount(o),n,o);},getCount:function m(){var n=arguments.length<=0||arguments[0]===undefined?k:arguments[0];return j[n].order.getAllResources().length;},canFetchMore:function m(){var n=arguments.length<=0||arguments[0]===undefined?k:arguments[0],o=j[n].graphQLPageInfo;return (!o||!o.hasOwnProperty('has_next_page')||o.has_next_page);},registerEndpoint:function m(n){if(n&&!(n in j)){j[n]=new h(n);var o={};o[n]={mode:c('MercuryServerDispatcher').IMMEDIATE,handler:function p(q){q.endpoint=n;c('NotificationUpdates').handleUpdate(c('NotificationConstants').PayloadSourceType.ENDPOINT,q);}};c('MercuryServerDispatcher').registerEndpoints(o);}},setBusinessID:function m(n){i=n;}};l.registerEndpoint(k);f.exports=l;}),null);
__d('NotificationTokens',['CurrentUser'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={tokenizeIDs:function i(j){return j.map(function(k){return c('CurrentUser').getID()+':'+k;});},untokenizeIDs:function i(j){return j.map(function(k){return k.split(':')[1];});}};f.exports=h;}),null);
__d('NotificationUpdates',['Arbiter','BizSiteIdentifier.brands','BusinessUserConf','ChannelConstants','JSLogger','NotificationConstants','NotificationTokens','LiveTimer','createObjectFrom','NotificationStore'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={},i={},j={},k={},l=[],m=0,n=void 0,o=c('JSLogger').create('notification_updates');function p(){if(m)return;var u=h,v=i,w=j,x=k;h={};i={};j={};k={};r('notifications-updated',u);if(Object.keys(v).length)r('seen-state-updated',v);if(Object.keys(w).length)r('read-state-updated',w);if(Object.keys(x).length)r('hidden-state-updated',x);l.pop();}function q(){if(l.length)return l[l.length-1];return c('NotificationConstants').PayloadSourceType.UNKNOWN;}function r(event,u){t.inform(event,{updates:u,source:q()});}var s=null,t=Object.assign(new (c('Arbiter'))(),{getserverTime:function u(){return s;},setEndPoint:function u(v){n=v;},handleUpdate:function u(v,w){var x=c('BizSiteIdentifier.brands').isBizSite()&&!!c('BusinessUserConf').biz_user_id;if(w.nodes&&Array.isArray(w.nodes)){w.nodes=this._filterNodesBasedOnBusinessUser(w.nodes,c('BusinessUserConf').biz_user_id);if(!x&&!c('BusinessUserConf').ignore_legacy_code)w.nodes=this._filterNodesBasedOnBusinessID(w.nodes);}if(w.servertime){s=w.servertime;c('LiveTimer').restart(w.servertime);}if(n&&w.nodes&&Array.isArray(w.nodes)&&v===c('NotificationConstants').PayloadSourceType.LIVE_SEND){var y=c('NotificationStore');y.getNotifications(w.nodes.length,function(z){w.nodes=this._filterNodesBasedOnEndPoint(z,w.nodes);this._updateWithPayload(v,w);}.bind(this),n);}else this._updateWithPayload(v,w);},_updateWithPayload:function u(v,w){if(Object.keys(w).length)this.synchronizeInforms(function(){l.push(v);var x=babelHelpers['extends']({payloadsource:q()},w);this.inform('update-notifications',x);this.inform('update-seen',x);this.inform('update-read',x);this.inform('update-hidden',x);}.bind(this));},didUpdateNotifications:function u(v){Object.assign(h,c('createObjectFrom')(v));p();},didUpdateSeenState:function u(v){Object.assign(i,c('createObjectFrom')(v));p();},didUpdateReadState:function u(v){Object.assign(j,c('createObjectFrom')(v));p();},didUpdateHiddenState:function u(v){Object.assign(k,c('createObjectFrom')(v));p();},synchronizeInforms:function u(v){m++;try{v();}catch(w){throw w;}finally{m--;p();}},_filterNodesBasedOnEndPoint:function u(v,w){return w.filter(function(x){return !!v[x.alert_id];});},_filterNodesBasedOnBusinessID:function u(v){return v.filter(function(w){return w.business_ids&&Object.keys(w.business_ids).length>0?!!('business_ids_user_pref' in w?w.business_ids_user_pref[c('BizSiteIdentifier.brands').getBusinessID()]:w.business_ids[c('BizSiteIdentifier.brands').getBusinessID()]):!c('BizSiteIdentifier.brands').isBizSite();});},_filterNodesBasedOnBusinessUser:function u(v,w){return v.filter(function(x){return w==x.biz_user_id;});}});c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('notification_json'),function(u,v){var w=Date.now(),x=v.obj.nodes;if(x){x.forEach(function(y){y.receivedTime=w;});o.debug('notifications_received',x);t.handleUpdate(c('NotificationConstants').PayloadSourceType.LIVE_SEND,v.obj);}});c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('notifications_seen'),function(u,v){var w=c('NotificationTokens').tokenizeIDs(v.obj.alert_ids);t.handleUpdate(c('NotificationConstants').PayloadSourceType.LIVE_SEND,{seenState:c('createObjectFrom')(w)});});c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('notifications_read'),function(u,v){var w=c('NotificationTokens').tokenizeIDs(v.obj.alert_ids);t.handleUpdate(c('NotificationConstants').PayloadSourceType.LIVE_SEND,{readState:c('createObjectFrom')(w)});});c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('notification_hidden'),function(u,v){var w=c('NotificationTokens').tokenizeIDs([v.obj.notif_id+'']);t.handleUpdate(c('NotificationConstants').PayloadSourceType.LIVE_SEND,{HiddenState:c('createObjectFrom')(w)});});f.exports=t;}),null);
__d("XNotificationsOptionsController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/notifications\/feedback\/option\/",{notif_id:{type:"Int",required:true},undo:{type:"Bool",defaultValue:false},server_action:{type:"String",required:true},biz_user_id:{type:"Int"}});}),null);
__d('NotificationUserActions',['AsyncRequest','BusinessUserConf','NotificationConstants','NotificationStore','NotificationTokens','NotificationUpdates','URI','XNotificationsOptionsController','createObjectFrom','emptyFunction'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('NotificationConstants').PayloadSourceType.USER_ACTION,i='mark_spam',j='turn_off',k='undo',l='original_subscription_level',m=false;function n(t){t.biz_user_id=c('BusinessUserConf').biz_user_id;new (c('AsyncRequest'))('/ajax/notifications/mark_read.php').setData(t).send();}function o(t){var u={};t.forEach(function(v,w){u['alert_ids['+w+']']=v;});return u;}function p(t,u,v,w,x){var y=c('NotificationTokens').untokenizeIDs([t])[0],z={notification_id:y,client_rendered:true,request_type:u};Object.assign(z,v);new (c('AsyncRequest'))('/ajax/notifications/negative_req.php').setData(z).setHandler(w||c('emptyFunction')).setErrorHandler(x||c('emptyFunction')).send();}function q(t,u,v,w,x){var y=c('XNotificationsOptionsController').getURIBuilder().setInt('notif_id',c('NotificationTokens').untokenizeIDs([t])[0]).setInt('biz_user_id',c('BusinessUserConf').biz_user_id).setBool('undo',w).setString('server_action',x).getURI(),z=function aa(ba){if(!ba.payload)throw new Error('No response from notif option!');c('NotificationUpdates').handleUpdate(h,{hiddenState:c('createObjectFrom')([t],!ba.payload.visible)});u(ba.payload);};new (c('AsyncRequest'))(y).setHandler(z||c('emptyFunction')).setErrorHandler(v||c('emptyFunction')).send();}function r(t,u,v,w,x){var y=x?k:j;c('NotificationStore').getAll(function(z){var aa=Object.keys(z).filter(function(ba){var ca=z[ba];return !!(ca.application&&ca.application.id&&ca.application.id==u);});p(t,y,null,function(ba){v(ba);c('NotificationUpdates').handleUpdate(h,{hiddenState:c('createObjectFrom')(aa,!x)});},w);});}var s={markNotificationsAsSeen:function t(u){var v=document.getElementById('notificationsCountValue'),w=null;if(v)w=v.innerText;c('NotificationUpdates').handleUpdate(h,{seenState:c('createObjectFrom')(u)});var x=c('NotificationTokens').untokenizeIDs(u),y=o(x);y.seen=true;if(w)y.badgeCount=w;n(y);},setNextIsFromReadButton:function t(u){m=u;},markNotificationsAsRead:function t(u){c('NotificationUpdates').handleUpdate(h,{readState:c('createObjectFrom')(u)});var v=c('NotificationTokens').untokenizeIDs(u),w=o(v);if(m){w.from_read_button=true;m=false;}n(w);},sendNotifOption:function t(u,v,w,x){q(u,v,w,false,x);},undoNotifOption:function t(u,v,w,x){q(u,v,w,true,x);},markNotificationAsHidden:function t(u,v,w){c('NotificationUpdates').handleUpdate(h,{hiddenState:c('createObjectFrom')([u])});p(u,j,null,v,w);},markNotificationAsVisible:function t(u,v,w,x){c('NotificationUpdates').handleUpdate(h,{hiddenState:c('createObjectFrom')([u],false)});var y=null;if(v!==null){y={};y[l]=v;}p(u,k,y,w,x);},markNotificationAsSpam:function t(u,v,w){c('NotificationUpdates').handleUpdate(h,{hiddenState:c('createObjectFrom')([u],true)});p(u,i,null,v,w);},markAppAsHidden:function t(u,v,w,x){var y=false;r(u,v,w,x,y);},markAppAsVisible:function t(u,v,w,x){var y=true;r(u,v,w,x,y);}};f.exports=s;}),null);
__d('NotificationJewelReminderLoader',['JSResource'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();f.exports={init:function h(i){c('JSResource')('NotificationJewelReminder').__setRef('NotificationJewelReminderLoader').load().done(function(j){new j(i);});}};}),null);