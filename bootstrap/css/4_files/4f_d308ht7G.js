if (self.CavalryLogger) { CavalryLogger.start_js(["4fpFR"]); }

__d('GroupChatMessageBlockAlert',['fbt','DialogX','GenderConst','MercuryParticipants','React','XUIDialogBody.react','XUIDialogButton.react','XUIDialogFooter.react','XUIDialogTitle.react'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={show:function j(k,l,m){var n=new (c('DialogX'))({width:445},c('React').createElement('div',null,c('React').createElement(c('XUIDialogTitle.react'),null,h._("See Conversations?")),c('React').createElement(c('XUIDialogBody.react'),null,this.dialogBodyText(k)),c('React').createElement(c('XUIDialogFooter.react'),null,c('React').createElement(c('XUIDialogButton.react'),{action:'cancel',label:this.leaveGroupButton(),onClick:function o(){return m();}}),c('React').createElement(c('XUIDialogButton.react'),{use:'confirm',action:'cancel',label:this.openChatButton(),onClick:function o(){return l();}}))));n.show();},openChatButton:function j(){return h._("Voir la conversation");},leaveGroupButton:function j(){return h._("Quitter le groupe");},dialogBodyText:function j(k){if(k.length!==1){return h._("Des personnes bloqu\u00e9es participent \u00e0 cette conversation. Si vous la voyez, vous recevrez leurs messages dans le groupe.");}else{var l='';c('MercuryParticipants').get(k.pop(),function(m){switch(m.gender){case c('GenderConst').FEMALE_SINGULAR:l=h._("{name} est dans cette discussion de groupe, mais vous l\u2019avez bloqu\u00e9e. Si vous voyez cette conversation, vous verrez ses messages au groupe et elle verra les v\u00f4tres.",[h.param('name',m.short_name)]);break;case c('GenderConst').MALE_SINGULAR:l=h._("{name} est dans cette discussion de groupe, mais vous l\u2019avez bloqu\u00e9. Si vous voyez cette conversation, vous verrez ses messages au groupe et il verra les v\u00f4tres.",[h.param('name',m.short_name)]);break;default:l=h._("{name} est dans cette discussion de groupe, mais vous l\u2019avez bloqu\u00e9. Si vous voyez cette conversation, vous verrez ses messages au groupe et il verra les v\u00f4tres.",[h.param('name',m.short_name)]);}});return l;}}};f.exports=i;}),null);
__d("MercuryAttachmentConstants",[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={SIDE_LENGTH:9};f.exports=h;}),null);
__d('MercuryAttachmentError.react',['fbt','XUINotice.react','XUIText.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){return (c('React').createElement(c('XUINotice.react'),{use:'warn'},c('React').createElement(c('XUIText.react'),{size:'small'},h._("Cette pi\u00e8ce jointe ne peut \u00eatre charg\u00e9e."))));};function k(){i.apply(this,arguments);}f.exports=k;}),null);
__d('MercuryAttachmentFile.react',['ix','cx','fbt','Image.react','LeftRight.react','Link.react','MercuryAttachment','React','joinClasses'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes;k=babelHelpers.inherits(n,c('React').PureComponent);l=k&&k.prototype;n.prototype.componentDidMount=function(){this.props.onAttachmentLoad&&this.props.onAttachmentLoad();};n.prototype.$MercuryAttachmentFile1=function(){if(this.props.open_url)return (c('React').createElement('div',{className:"_59gs"},c('React').createElement(c('Link.react'),{target:'_blank',href:this.props.open_url},j._("ouvrir")),' ','\u00B7',' ',c('React').createElement(c('Link.react'),{href:this.props.url},j._("t\u00e9l\u00e9charger"))));return c('React').createElement('div',null);};n.prototype.render=function(){var o=c('joinClasses')(c('MercuryAttachment').getAttachIconClass(this.props.type),"_59go _59gq");if(this.props.url)return (c('React').createElement(c('LeftRight.react'),{className:o},c('React').createElement(c('Link.react'),{href:this.props.url},c('React').createElement(c('LeftRight.react'),null,c('React').createElement(c('Image.react'),{src:h('/images/messaging/docs/generic.png')}),c('React').createElement('span',{className:"_59gp"},this.props.name))),this.$MercuryAttachmentFile1()));return (c('React').createElement(c('LeftRight.react'),{className:o},c('React').createElement(c('Image.react'),{src:h('/images/messaging/docs/generic.png')}),c('React').createElement('span',{className:"_59gp"},this.props.name)));};function n(){k.apply(this,arguments);}n.propTypes={name:m.string.isRequired,onAttachmentLoad:m.func,open_url:m.string,rel:m.string,type:m.string.isRequired,url:m.string};f.exports=n;}),null);
__d('MercuryAttachmentMalicious.react',['fbt','XUINotice.react','XUIText.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){return (c('React').createElement(c('XUINotice.react'),{use:'warn'},c('React').createElement(c('XUIText.react'),{size:'small'},h._("Cette pi\u00e8ce jointe a \u00e9t\u00e9 marqu\u00e9e comme malveillante."))));};function k(){i.apply(this,arguments);}f.exports=k;}),null);
__d('ChatImageArrowDirection',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('keyMirror')({BOTH:null,LEFT:null,RIGHT:null});f.exports=h;}),null);
__d('ChatImageWithArrow.react',['cx','ChatImageArrowDirection','Link.react','MercuryAttachmentConstants','React','XUISpinner.react','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=30,m=15;i=babelHelpers.inherits(n,c('React').Component);j=i&&i.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=j.constructor).call.apply(o,[this].concat(r)),this.$ChatImageWithArrow3=function(){return Math.max(this.props.width,m);}.bind(this),this.$ChatImageWithArrow6=function(){return Math.max(this.props.height,l);}.bind(this),this.$ChatImageWithArrow5=function(t){if(this.props.onClick)return (c('React').createElement(c('Link.react'),{onClick:this.props.onClick},t));return t;}.bind(this),this.$ChatImageWithArrow7=function(t,u,v,w){if(u===c('ChatImageArrowDirection').LEFT){return 'translate('+v+'px, '+w+'px)'+'rotate(45deg)';}else return 'translate('+(t-v)+'px, '+w+'px)'+'rotate(45deg)';},this.$ChatImageWithArrow8=function(t,u,v,w){if(u===c('ChatImageArrowDirection').LEFT){return 'rotate(-45deg)'+'translate(-'+(this.$ChatImageWithArrow1+v)+'px,'+'-'+w+'px)';}else return 'rotate(-45deg)'+'translate(-'+(t-v)+'px, -'+w+'px)';}.bind(this),this.$ChatImageWithArrow4=function(){var t={width:this.props.sideLength,height:this.props.sideLength};if(this.props.source)t.backgroundImage='url('+this.props.source+')';var u={width:this.props.sideLength,height:this.props.sideLength};if(this.props.source)u.opacity=0;var v={width:this.$ChatImageWithArrow3(),height:this.$ChatImageWithArrow6()};if(this.props.source){v.backgroundImage='url('+this.props.source+')';v.backgroundSize='cover';}return (c('React').createElement('div',{className:"_4yp6"},c('React').createElement('div',{className:"_4ypb _3_om",style:v},c('React').createElement(c('XUISpinner.react'),{size:'small'}))));}.bind(this),p;}n.prototype.render=function(){this.$ChatImageWithArrow1=Math.floor(this.props.sideLength/Math.sqrt(2));this.$ChatImageWithArrow2=Math.ceil(this.$ChatImageWithArrow3()+this.$ChatImageWithArrow1);if(this.props.isLoading)return this.$ChatImageWithArrow4();var o=c('joinClasses')("_4yp6"+(this.props.round?' '+"_3lk2":''),this.props.rootClassName);return this.$ChatImageWithArrow5(c('React').createElement('div',{className:o},c('React').createElement('div',{className:"_52kr"+(this.props.round?' '+"_3_om":''),style:{width:this.$ChatImageWithArrow3(),height:this.$ChatImageWithArrow6()}},c('React').createElement('div',{className:"_4yp9",style:{backgroundImage:'url('+this.props.source+')',width:this.$ChatImageWithArrow3(),height:this.$ChatImageWithArrow6()}}))));};n.propTypes={arrowDirection:k.oneOf(Object.keys(c('ChatImageArrowDirection'))),onClick:k.func,height:k.number.isRequired,isLoading:k.bool,round:k.bool,rootClassName:k.string,sideLength:k.number,source:k.string,width:k.number.isRequired};n.defaultProps={sideLength:c('MercuryAttachmentConstants').SIDE_LENGTH,isLoading:false,round:false};f.exports=n;}),null);
__d('MercuryAttachmentPhoto.react',['ChatImageArrowDirection','ChatImageWithArrow.react','MercuryAttachmentViewer','MercuryConfig','MercuryIDs','MercuryMessageInfo','MessagesViewerSetID','React','SpotlightMercurySharedMediaViewer.react','URI','getPageIDFromThreadID'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes;h=babelHelpers.inherits(k,c('React').Component);i=h&&h.prototype;function k(){var l,m;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return m=(l=i.constructor).call.apply(l,[this].concat(o)),this.state={newSharedPhotosView:false},this.$MercuryAttachmentPhoto1=function(q){var r=this.props.image,s=true;if(!this.props.hasAttribution&&this.props.count)s=this.props.count===1;var t=this.props.message,u=t.thread_fbid?t.thread_fbid:c('MercuryIDs').getThreadFBIDFromThreadID(t.thread_id),v=new (c('URI'))('/ajax/messaging/attachments/sharedphotos.php').setQueryData({thread_id:u,image_id:r.metadata.fbid}),w=c('MessagesViewerSetID').MESSAGES_VIEW_ALL_IN_THREAD;c('MercuryAttachmentViewer').bootstrapWithConfig({dimensions:r.metadata.dimensions,disablePaging:s,endpoint:v,fbid:r.metadata.fbid,setID:w,src:r.preview_url},null);}.bind(this),this.$MercuryAttachmentPhoto2=function(){var q=this.props.image;if(q&&q.metadata)this.setState({newSharedPhotosView:q.metadata.fbid});}.bind(this),this.$MercuryAttachmentPhoto3=function(){this.setState({newSharedPhotosView:null});}.bind(this),m;}k.prototype.componentDidMount=function(){c('MercuryAttachmentViewer').preload();this.props.onAttachmentLoad&&this.props.onAttachmentLoad(this.props.height);};k.prototype.$MercuryAttachmentPhoto4=function(){var l=this.props.message.thread_fbid||this.props.message.thread_id&&c('MercuryIDs').getThreadFBIDFromThreadID(this.props.message.thread_id);if(c('MercuryConfig').SharedPhotoNewViewV1)return (c('React').createElement(c('SpotlightMercurySharedMediaViewer.react'),{onClosePhotoView:this.$MercuryAttachmentPhoto3,photoID:String(this.state.newSharedPhotosView),rootClassName:'',threadID:l,disableForward:false}));return null;};k.prototype.render=function(){var l=c('MercuryMessageInfo').isInbound(this.props.message),m=!!c('getPageIDFromThreadID')(this.props.message.thread_id),n=c('MercuryConfig').SharedPhotoNewViewV1&&!this.props.hasAttribution&&!m?this.$MercuryAttachmentPhoto2:this.$MercuryAttachmentPhoto1,o=this.state.newSharedPhotosView?this.$MercuryAttachmentPhoto4():null;return (c('React').createElement('div',null,o,c('React').createElement(c('ChatImageWithArrow.react'),{arrowDirection:l?c('ChatImageArrowDirection').LEFT:c('ChatImageArrowDirection').RIGHT,source:this.props.image.preview_url,height:this.props.height,width:this.props.width,onClick:n,round:!!this.props.round,isLoading:!!this.props.image.preview_uploading})));};k.propTypes={hasAttribution:j.bool,height:j.number,image:j.object.isRequired,message:j.object.isRequired,onAttachmentLoad:j.func,round:j.bool,width:j.number};f.exports=k;}),null);
__d('ChatGridImage.react',['cx','Link.react','MercuryConfig','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=j.constructor).call.apply(m,[this].concat(p)),this.$ChatGridImage1=function(){c('MercuryConfig').SharedPhotoNewViewV1&&this.props.metadata?this.props.onClick(String(this.props.metadata.fbid)):this.props.onClick();}.bind(this),n;}l.prototype.render=function(){if(this.props.isLoading)return c('React').createElement('div',{className:"_4ypb",style:{width:this.props.size,height:this.props.size}});return c('React').createElement(c('Link.react'),{onClick:this.$ChatGridImage1},c('React').createElement('div',{className:"_332l",style:{backgroundImage:'url('+this.props.source+')',width:this.props.size,height:this.props.size}}));};l.propTypes={isLoading:k.bool,metadata:k.object,onClick:k.func,size:k.number.isRequired,source:k.string};f.exports=l;}),null);
__d('MercuryAttachmentPhotoGrid.react',['cx','ChatGridImage.react','Grid.react','MercuryAttachmentType','MercuryAttachmentViewer','MercuryConfig','MercuryIDs','MessagesViewerSetID','React','SpotlightMercurySharedMediaViewer.react','URI','getPageIDFromThreadID'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('Grid.react').GridItem,l=c('React').PropTypes;i=babelHelpers.inherits(m,c('React').Component);j=i&&i.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.state={newSharedPhotosView:null},this.$MercuryAttachmentPhotoGrid1=function(s,t){var u=this.props.count,v=this.props.message,w=v.thread_fbid?v.thread_fbid:c('MercuryIDs').getThreadFBIDFromThreadID(v.thread_id),x=new (c('URI'))('/ajax/messaging/attachments/sharedphotos.php').setQueryData({thread_id:w,image_id:s.metadata&&s.metadata.fbid}),y=c('MessagesViewerSetID').MESSAGES_VIEW_ALL_IN_THREAD;return (function(z){c('MercuryAttachmentViewer').bootstrapWithConfig({dimensions:s.metadata.dimensions,disablePaging:t||u===1,endpoint:x,fbid:s.metadata.fbid,setID:y,src:s.preview_url},null);});}.bind(this),this.$MercuryAttachmentPhotoGrid2=function(s){if(s)this.setState({newSharedPhotosView:s});}.bind(this),this.$MercuryAttachmentPhotoGrid3=function(){this.setState({newSharedPhotosView:null});}.bind(this),o;}m.prototype.componentDidMount=function(){c('MercuryAttachmentViewer').preload();};m.prototype.$MercuryAttachmentPhotoGrid4=function(){var n=this.props.message.thread_fbid||this.props.message.thread_id&&c('MercuryIDs').getThreadFBIDFromThreadID(this.props.message.thread_id);if(c('MercuryConfig').SharedPhotoNewViewV1)return (c('React').createElement(c('SpotlightMercurySharedMediaViewer.react'),{onClosePhotoView:this.$MercuryAttachmentPhotoGrid3,photoID:String(this.state.newSharedPhotosView),rootClassName:'',threadID:n,disableForward:false}));};m.prototype.render=function(){var n=this.props.images,o=n.length,p=o==2||o==4?2:3,q=Math.floor(this.props.size/p),r=[],s=n.some(function(x){return x.attach_type===c('MercuryAttachmentType').ANIMATED_IMAGE;}),t=c('MercuryConfig').SharedPhotoNewViewV1&&this.state.newSharedPhotosView?this.$MercuryAttachmentPhotoGrid4():null,u=!!c('getPageIDFromThreadID')(this.props.message.thread_id);for(var v=0;v<n.length;v++){var w=c('MercuryConfig').SharedPhotoNewViewV1&&!u?this.$MercuryAttachmentPhotoGrid2:this.$MercuryAttachmentPhotoGrid1(n[v],s);r.push(c('React').createElement(k,{key:v},c('React').createElement(c('ChatGridImage.react'),{isLoading:!!n[v].preview_uploading,onClick:w,metadata:n[v].metadata,size:q,source:n[v].preview_url})));}return (c('React').createElement('div',null,t,c('React').createElement(c('Grid.react'),{cols:p,className:"_5b2w",spacing:"_5b2x",alignh:'right'},r)));};m.propTypes={images:l.arrayOf(l.object).isRequired,size:l.number.isRequired,message:l.object.isRequired};f.exports=m;}),null);
__d('ChatAttachmentAttribution.react',['cx','ImmutableObject','MercuryAttachmentAttribution.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;l.prototype.componentDidMount=function(){this.props.onAttachmentLoad&&this.props.onAttachmentLoad();};l.prototype.render=function(){return (c('React').createElement(c('MercuryAttachmentAttribution.react'),{attachment:this.props.attachment,className:"_1ekr _4i_6"}));};function l(){i.apply(this,arguments);}l.propTypes={attachment:k.instanceOf(c('ImmutableObject')),onAttachmentLoad:k.func};f.exports=l;}),null);
__d('MercuryAttachmentVideo.react',['cx','ix','ChatAttachmentAttribution.react','ChatImageWithArrow.react','ChatSpeakingSticker.react','CenteredContainer.react','FBOverlayBase.react','FBOverlayContainer.react','FBOverlayElement.react','Image.react','ImmutableObject','MercuryAttachment','MercuryAttachmentViewer','MercuryConfig','MessengerVideoPlayer.react','React','SpotlightMercurySharedMediaViewer.react','Vector','getPageIDFromThreadID','joinClasses'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;function m(){var n,o;'use strict';for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=k.constructor).call.apply(n,[this].concat(q)),this.state={newSharedPhotosView:null},this.$MercuryAttachmentVideo1=function(){var s=this.props.duration,t=Math.floor(s/60),u=s%60;if(u<10)return t+':0'+u;return t+':'+u;}.bind(this),this.openViewer=function(){var s=this.props,t=s.pageID,u=s.videoID,v=s.videoSize,w=s.videoURI;v=new (c('Vector'))(v.width,v.height);c('MercuryAttachmentViewer').renderVideo({pageID:t,videoID:u,videoSize:v,videoURI:w});}.bind(this),this.$MercuryAttachmentVideo2=function(){if(this.props.videoID)this.setState({newSharedPhotosView:this.props.videoID});}.bind(this),this.$MercuryAttachmentVideo3=function(){this.setState({newSharedPhotosView:null});}.bind(this),this.$MercuryAttachmentVideo4=function(){var s=this.props.threadFBID;if(s&&c('MercuryConfig').SharedPhotoNewViewV1)return (c('React').createElement(c('SpotlightMercurySharedMediaViewer.react'),{onClosePhotoView:this.$MercuryAttachmentVideo3,photoID:this.state.newSharedPhotosView,rootClassName:'',threadID:s,disableForward:false}));return null;}.bind(this),this.$MercuryAttachmentVideo5=function(){if(this.props.isChat){return (c('React').createElement('div',null,c('React').createElement(c('ChatImageWithArrow.react'),{height:this.props.thumbSize.height,key:'previewImage',round:true,source:this.props.thumbnail,width:this.props.thumbSize.width}),c('React').createElement(c('ChatAttachmentAttribution.react'),{attachment:this.props.attachment,key:'chatAttribution'})));}else return (c('React').createElement(c('Image.react'),{height:this.props.thumbSize.height,width:this.props.thumbSize.width,src:this.props.thumbnail}));}.bind(this),this.$MercuryAttachmentVideo6=function(){if(this.props.isChat)return {};return this.props.thumbSize;}.bind(this),o;}m.prototype.componentDidMount=function(){'use strict';this.props.onAttachmentLoad&&this.props.onAttachmentLoad();c('MercuryAttachmentViewer').preload();};m.prototype.$MercuryAttachmentVideo7=function(n,o){'use strict';if(!n.legacy_attachment_id)return null;return (c('React').createElement(c('MessengerVideoPlayer.react'),{attachment:this.props.attachment,videoData:n,isInThread:true,isVisible:this.props.isVisible,onClick:o,className:c('joinClasses')(this.props.className,"_n4o"+(' '+"_3_om")+(' '+"_1wno"))}));};m.prototype.$MercuryAttachmentVideo8=function(n){'use strict';var o=this.props.thumbSize,p={x:o.width,y:o.height};return {legacy_attachment_id:this.props.videoID,original_dimensions:p,start_muted:true,no_autoplay:true,hide_controls_on_finish:true,url:this.props.videoURI};};m.prototype.render=function(){'use strict';if(this.props.attachment.metadata&&this.props.attachment.metadata.render_as_sticker&&this.props.isChat)return (c('React').createElement(c('ChatSpeakingSticker.react'),{videoURI:this.props.videoURI,videoSize:this.props.videoSize}));var n=!!c('getPageIDFromThreadID')(this.props.threadID),o=c('MercuryConfig').SharedPhotoNewViewV1&&!n?this.$MercuryAttachmentVideo2:this.openViewer,p=this.state.newSharedPhotosView?this.$MercuryAttachmentVideo4():null,q=c('MercuryAttachment').hasAttribution(this.props.attachment),r="clearfix"+(' '+"_zow")+(' '+"_59go")+(q?' '+"_4yjw":'')+(this.props.isChat?' '+"_3ds5":''),s=null;if(c('MercuryConfig').MessengerVideoAutoplayControl.enable_chat){var t=this.$MercuryAttachmentVideo8(this.props.attachment);s=this.$MercuryAttachmentVideo7(t,o);}var u=s?s:c('React').createElement(c('FBOverlayContainer.react'),{className:r,key:'overlayContainer',onClick:o,style:this.$MercuryAttachmentVideo6()},c('React').createElement(c('FBOverlayBase.react'),null,this.$MercuryAttachmentVideo5()),c('React').createElement(c('FBOverlayElement.react'),null,c('React').createElement('div',{className:(!this.props.isChat?"_zox":'')+(q?' '+"_jt3":'')},c('React').createElement('span',{className:"_zoz"},this.$MercuryAttachmentVideo1()))),c('React').createElement(c('FBOverlayElement.react'),null,c('React').createElement(c('CenteredContainer.react'),{className:q?"_jt3":'',vertical:true},c('React').createElement(c('Image.react'),{src:i('/images/chat/chat_play_icon.png')}))));if(this.props.isChat)return (c('React').createElement('div',null,p,u));return (c('React').createElement('div',null,p,u,c('React').createElement(c('ChatAttachmentAttribution.react'),{attachment:this.props.attachment,key:'inboxAttribution'})));};m.propTypes={attachment:l.instanceOf(c('ImmutableObject')),duration:l.number.isRequired,isChat:l.bool,isVisible:l.bool,threadID:l.string,threadFBID:l.string,name:l.string.isRequired,onAttachmentLoad:l.func,pageID:l.number,thumbSize:l.shape({height:l.number,width:l.number}).isRequired,thumbnail:l.string.isRequired,videoSize:l.shape({height:l.number,width:l.number}).isRequired,videoID:l.string.isRequired,videoURI:l.string.isRequired};f.exports=m;}),null);
__d('updatePhotoProgressBar',[],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,event){if(event.carousel_uploading){if(event.skip_upload){i.setPosition(50);i.setTarget(100,1000);}else{var j=event.loaded/event.total*100;i.setPosition(j);}}else if(event.loaded!=event.total){i.setPosition(50*event.loaded/event.total);}else{i.setPosition(50);i.setTarget(100,2000);}}f.exports=h;}),null);
__d('PhotosMultiUploadInput',['csx','cx','fbt','Animation','Arbiter','AsyncUploadRequest','Bootloader','ComposerWaterfallEvent','ComposerXController','ComposerXDragDropUtils','ComposerXMarauderLogger','ComposerXMediaUploadHandler','CSS','Dialog','DOM','DragDropTarget','Event','JpegResizer','OptimisticVideoPostUtils','Parent','PhotosMimeType','PhotosUploadID','PhotosUploadWaterfallXMixin','ProgressBar','PUWApplications','PUWMethods','PUWSteps','ReactComposerMediaUtils','Tooltip','VideoUploadFile','WaterfallIDGenerator','XComposerPhotoUploader','$','mixin','performanceNow','updatePhotoProgressBar','Fbtrace'],(function a(b,c,d,e,f,g,h,i,j){var k,l;if(c.__markCompiled)c.__markCompiled();var m=1366052;c("Fbtrace");function n(t,u,v,w){'use strict';this._grid=q.getInstance(w.gridID);this._grid.setProgressBarMarkup(t).setVideoIconMarkup(u).setConfig(w);v.getInput().multiple=w.maxselect!=1&&c('AsyncUploadRequest').isSupported();v.subscribe('change',function(x,event){if(event.getTarget().value)this._grid.doFileUpload(v);}.bind(this));if(!this._grid.sessionStarted){this._grid.sessionStarted=true;this._grid.logStep(c('PUWSteps').CLIENT_FLOW_BEGIN,{custom_tags:{high_quality:w.initWithHighQuality}});}this._grid.logStep(c('PUWSteps').CLIENT_SELECT_BEGIN);c('Arbiter').inform('PhotosMultiUploadInput/loaded/'+w.gridID,null,c('Arbiter').BEHAVIOR_PERSISTENT);}n.prototype.getGrid=function(){'use strict';return this._grid;};n.prototype.onQualitySettingChanged=function(t){'use strict';this._grid.setQuality(t);};Object.assign(n,{imageUploadDone:function t(u,v,w,x,y){o[u].imageUploadDone(v,w,x,y);},addCameraImage:function t(u,v,w){o[u].addCameraImage(v,w);},initDragDrop:function t(u,v){c('Arbiter').inform('PhotosMultiUploadInput/initDragDrop/'+u,{dragDropArea:v},c('Arbiter').BEHAVIOR_PERSISTENT);},imageUploadFail:function t(u,v){o[u].removeLoadingIndicator(v.getFile().uploadID);},doFileUpload:function t(u,v){o[u].doFileUpload(v);},onFilesDrop:function t(u,v){o[u].onFilesDrop(v);},onVaultImagesAdded:function t(u,v){o[u].onVaultImagesAdded(v);},getWaterfallID:function t(u){return q.getInstance(u).getWaterfallID();},clearSession:function t(u){o[u].clearSession();},getConfig:function t(u){return o[u].getConfig();}});var o={},p=0;k=babelHelpers.inherits(q,c('mixin')(c('PhotosUploadWaterfallXMixin')));l=k&&k.prototype;function q(t){'use strict';l.constructor.call(this);this._loadingIndicators={};this._numRemainingFiles=0;this._progressBarMarkup=null;this._videoIconMarkup=null;this._gridID=t;this._dragDropTarget=null;this._submitListener=null;this._fileInputInstances=[];this._uploadTimers={};this._videoEncodeTimers={};this._sessionsStarted=false;this._waterfallID=null;this._resizer=null;this._numUploadsSucceeded=0;this._numUploadsFailed=0;this._uploadIDToFileUpload={};this._failedUploadIDs={};this._uploadIDToChildIndex={};this._uploadParams=[];c('Arbiter').subscribe('multi-upload/video-removed/'+this._gridID,function(){c('DOM').remove(this._videoIconMarkup);this._submitListener&&this._submitListener.remove();this._submitListener=null;this._fileInputInstances.forEach(function(u){u.clear();});}.bind(this));c('Arbiter').subscribe('multi-upload/image-removed/'+this._gridID,function(){this._logComposerWaterfallEvent(c('ComposerWaterfallEvent').PHOTO_REMOVE);}.bind(this));c('Arbiter').subscribe('PhotosMultiUploadInput/initDragDrop/'+this._gridID,function(u,v){this.initDragDrop(v.dragDropArea);}.bind(this));c('Arbiter').subscribe('AttachmentsPhotoEditor/logPhotoEditorLaunched'+this._gridID,function(u,v){this.logStep(c('PUWSteps').CLIENT_PHOTO_EDIT_BEGIN);}.bind(this));c('Arbiter').subscribe('AttachmentsPhotoEditor/newImage'+this._gridID,this._onEditedImage.bind(this));}q.prototype.getWaterfallID=function(){'use strict';if(!this._waterfallID)this._waterfallID=c('WaterfallIDGenerator').generate();return this._waterfallID;};q.prototype.getWaterfallAppName=function(){'use strict';return c('PUWApplications').WEB_COMPOSER;};q.prototype.getWaterfallSource=function(){'use strict';return this._config.ref;};q.prototype.getLoadingIndicator=function(t){'use strict';var u=this._loadingIndicators[t];return u;};q.prototype.initDragDrop=function(t){'use strict';this._dragDropTarget&&this._dragDropTarget.disable();this._dragDropTarget=new (c('DragDropTarget'))(t).setOnFilesDropCallback(function(u){this.onFilesDrop(u,c('PUWMethods').DRAGDROP);}.bind(this)).setFileFilter(c('ComposerXDragDropUtils').filterImages).enable();};q.prototype.setConfig=function(t){'use strict';this._config=t;this._isHighQuality=t.hasOwnProperty('initWithHighQuality')?t.initWithHighQuality:true;if(!c('JpegResizer').isSupported()){this.logStep(c('PUWSteps').CLIENT_PROCESS_UNAVAILABLE);}else if(this._config.useResizer){this._resizer=new (c('JpegResizer'))(this._config.maxselect===1?1:c('JpegResizer').DEFAULT_POOL_SIZE);this._resizer.setHighQuality(this._isHighQuality);}if(!this._waterfallID)this._waterfallID=t.waterfallID;this._concurrentLimit=t.concurrentLimit;return this;};q.prototype.setProgressBarMarkup=function(t){'use strict';this._progressBarMarkup=t;return this;};q.prototype.setVideoIconMarkup=function(t){'use strict';this._videoIconMarkup=t;var u=c('DOM').find(t,"._3ev");c('Event').listen(u,'click',this._onVideoRemoved.bind(this));return this;};q.prototype.setQuality=function(t){'use strict';this._isHighQuality=t;this._resizer&&this._resizer.setHighQuality(t);this.logStep(c('PUWSteps').CLIENT_QUALITY_SWITCH,{custom_tags:{high_quality:this._isHighQuality}});};q.prototype.imageUploadDone=function(t,u,v,w){'use strict';this._numUploadsSucceeded++;var x=this.getLoadingIndicator(u);if(!x)return;if(c('DOM').contains(document.body,x.getRoot()))c('DOM').replace(x.getRoot(),t);var y={};y[u]=v;if(this._config.isVideoCarouselPost){this._markUploadAsFinished();var z={};z.image_fbid=v;this._uploadParams[this._uploadIDToChildIndex[u]]=z;if(this._isUploadFinished())this._informUploadFinished();}else{this._informImagesAdded(y,w);this._markUploadAsFinished();}this._loadingIndicators[u]=null;};q.prototype.addCameraImage=function(t,u){'use strict';this.insertIntoGrid(t);this._informImagesAdded({'0':u},{});this.logStep(c('PUWSteps').CLIENT_ATTACH_PHOTO,{method:c('PUWMethods').CAMERA,fbid:u});};q.prototype._informImagesAdded=function(t,u){'use strict';c('Arbiter').inform(['multi-upload/images-added/'+this._gridID,'multi-upload/images-added'],{fbids:t,tagInfo:{exifLocation:u}});c('Arbiter').inform('composer/updateViewerLocationEstimate',u);};q.prototype._informUploadFinished=function(){'use strict';c('Arbiter').inform(['multi-upload/medias-added/'+this._gridID],{params:this._uploadParams});};q.prototype._generateLoadingIndicatorForPhoto=function(t){'use strict';this._generateLoadingIndicator(t.uploadID);this._uploadIDToChildIndex[t.uploadID]=this._uploadParams.length;this._uploadParams[this._uploadParams.length]={};};q.prototype._generateLoadingIndicator=function(t){'use strict';this._numRemainingFiles++;var u=this._progressBarMarkup.cloneNode(true);c('Event').listen(u,'click',this._clickHandler.bind(this,t));this.insertIntoGrid(u);this._loadingIndicators[t]=new (c('ProgressBar'))(u);};q.prototype._generateUploadIDsAndLoadingIndicators=function(t){'use strict';for(var u=0;u<t.length;u++){if(!t[u].uploadID)t[u].uploadID=c('PhotosUploadID').getNewID();this._generateLoadingIndicator(t[u].uploadID);}};q.prototype._clickHandler=function(t,u){'use strict';var v=u.target,w="_639";if(c('Parent').byClass(v,w))if(this._failedUploadIDs[t]){this.removeLoadingIndicator(t);}else this.fileUploadCanceled(t,this._uploadIDToFileUpload[t]);var x="_2zo7";if(c('Parent').byClass(v,x)){c('CSS').hide(c('DOM').find(this.getLoadingIndicator(t).getRoot(),"._2zo5"));this._retryFileUpload(this._uploadIDToFileUpload[t].getFile());this._failedUploadIDs[t]=false;}var y="_2zo8";if(c('Parent').byClass(v,y))this.removeLoadingIndicator(t);};q.prototype.fileUploadFailure=function(t,u,v){'use strict';this._numUploadsFailed++;this._failedUploadIDs[t]=true;var w=Date.now()-this._uploadTimers[t],x=0;if(u.upload)x=u.upload.getRetryCount?u.upload.getRetryCount():0;var y=u.response.getErrorDescription(),z=u.response.getError();if(z===m)y=JSON.stringify(v);this.logStep(c('PUWSteps').CLIENT_TRANSFER_FAIL,{dt:w,error_code:z,error_info:y,bytes:u.upload.getFile().size,auto_retry_count:x,custom_tags:{high_quality:this._isHighQuality,manual_retry:!!u.upload.getFile().manuallyRetried}});if(this._config.useNewErrorUI){var aa=u.response.isTransient()||u.response.getError()==1004||u.response.getError()==1006,ba=aa&&this._uploadIDToFileUpload[t];this._showNewUploadFailedMessage(t,u.upload.getFile().name||u.upload.getFile().filename||'',u.response.getErrorSummary(),u.response.getErrorDescription(),ba,u.upload.getFile());this._markUploadAsFinished();}else{this._showUploadFailedMessage(t);this._fadeOutFileUpload(t);}};q.prototype._fadeOutFileUpload=function(t){'use strict';new (c('Animation'))(this.getLoadingIndicator(t).getRoot()).duration(2000).checkpoint().from('opacity',1).to('opacity',0).duration(1000).ondone(this.removeFileUpload.bind(this,t)).go();};q.prototype._showUploadFailedMessage=function(t){'use strict';c('CSS').hide(c('DOM').find(this.getLoadingIndicator(t).getRoot(),"._5l83"));c('CSS').show(c('DOM').find(this.getLoadingIndicator(t).getRoot(),"._5l82"));};q.prototype._showNewUploadFailedMessage=function(t,u,v,w,x,y){'use strict';var z=this.getLoadingIndicator(t).getRoot();c('CSS').hide(c('DOM').find(z,"._5l83"));c('CSS').show(c('DOM').find(z,"._2zo5"));var aa=c('DOM').find(z,"._2zo6");c('DOM').setContent(aa,u);var ba=c('DOM').find(z,"._2zo5");c('Tooltip').set(ba,v+': '+w);if(x){var ca=c('DOM').find(z,"._2zo7");c('CSS').show(ca);}else{var da=c('DOM').find(z,"._2zo8");c('CSS').show(da);}};q.prototype._finishUploadBatch=function(){'use strict';c('Arbiter').inform('multi-upload/images-upload-completed/'+this._gridID);if(this._numUploadsFailed>0){this.logStep(c('PUWSteps').CLIENT_TRANSFER_BATCH_FAIL,{volume:this._numUploadsFailed,batch_size:this._numUploadsSucceeded+this._numUploadsFailed});}else this.logStep(c('PUWSteps').CLIENT_TRANSFER_BATCH_SUCCESS,{volume:this._numUploadsSucceeded});this._numUploadsSucceeded=0;this._numUploadsFailed=0;};q.prototype.fileUploadCanceled=function(t,u){'use strict';u&&u.abort();var v={latency:Date.now()-this._uploadTimers[t]};if(u&&u.getFile())v.bytes=u.getFile().size;this.logStep(c('PUWSteps').CLIENT_TRANSFER_CANCEL,v);this.removeFileUpload(t);};q.prototype.removeFileUpload=function(t){'use strict';this.removeLoadingIndicator(t);this._markUploadAsFinished();};q.prototype._markUploadAsFinished=function(){'use strict';this._numRemainingFiles=Math.max(0,this._numRemainingFiles-1);if(this._numRemainingFiles===0)this._finishUploadBatch();};q.prototype.getVideoOrPhotoUploadCallback=function(t,u){'use strict';var v=this;return function(w){if(w){for(var x=0;x<t.input.files.length;x++){var y=c('ReactComposerMediaUtils').getVideoUploader(v._config.composerID),z=t.input.files[x];if(!z.uploadID)z.uploadID=c('PhotosUploadID').getNewID();var aa=c('VideoUploadFile').fromFile(z);y.subscribe('upload-started',v._onVideoUploadStart.bind(v,z));y.subscribe('upload-progressed',v._onVideoUploadProgress.bind(v,z));y.subscribe('upload-finished',v._onVideoUploadFinished.bind(v,y,z));y.upload(aa);}}else if(u){v._photosSelected(t);}else new (c('Dialog'))().setBody(j._("D\u00e9sol\u00e9, vous ne pouvez s\u00e9lectionner que des fichiers vid\u00e9o.")).setTitle(j._("Fichier non pris en charge")).setModal(true).setButtons(c('Dialog').OK).show();};};q.prototype.doFileUpload=function(t){'use strict';var u=false,v=false;switch(this._config.supportedFileTypes){case 'photos':v=true;break;case 'videos':u=true;break;case 'both':u=v=true;break;}this._submitListener&&this._submitListener.remove();var w=this.getVideoOrPhotoUploadCallback(t,v);if(u){c('ComposerXMediaUploadHandler').isVideoOrAnimatedGifAsync(t,w);}else w(false);};q.prototype.getConfig=function(){'use strict';return this._config;};q.prototype._resizeUpload=function(t,u){'use strict';var v=t.getFile();if(!v||!c('PhotosMimeType').isJpeg(v.type))return u(t);var w=c('performanceNow')();this.logStep(c('PUWSteps').CLIENT_PROCESS_BEGIN,{bytes:v.size,custom_tags:{high_quality:this._isHighQuality}});this._resizer.resizeBlob(v,function(x,y,z){y=y||v;if(x){this.logStep(c('PUWSteps').CLIENT_PROCESS_FAIL,{dt:c('performanceNow')()-w,bytes:y.size,error_code:x.code,error_info:x.message,custom_tags:{high_quality:this._isHighQuality}});return u(t);}y.uploadID=v.uploadID;y.filename=v.name;t.setFile(y);this.logStep(c('PUWSteps').CLIENT_PROCESS_SUCCESS,{dt:c('performanceNow')()-w,media_data_size:v.size,bytes:y.size,custom_tags:{high_quality:this._isHighQuality,skipped_resizing:z}});u(t);}.bind(this),this._onResizeProgress.bind(this,v.uploadID));};q.prototype._onResizeStart=function(t){'use strict';this.logStep(c('PUWSteps').CLIENT_PROCESS_BEGIN,{bytes:t.size,custom_tags:{high_quality:this._isHighQuality}});};q.prototype._onResizeFail=function(t,u,v,w){'use strict';this.logStep(c('PUWSteps').CLIENT_PROCESS_FAIL,{dt:w,bytes:u.size,error_code:v.code,error_info:v.message,custom_tags:{high_quality:this._isHighQuality}});};q.prototype._onResizeSuccess=function(t,u,v,w){'use strict';this.logStep(c('PUWSteps').CLIENT_PROCESS_SUCCESS,{dt:w,media_data_size:t.size,bytes:u.size,custom_tags:{high_quality:this._isHighQuality,skipped_resizing:v}});};q.prototype._isExceedMaxSelect=function(t){'use strict';return this._config.maxselect>1&&t>this._config.maxselect;};q.prototype._showTooManyPhotosDialog=function(t){'use strict';var u=t-this._config.maxselect;new (c('Dialog'))().setTitle(j._("Trop de photos")).setBody(u>1?j._({"*":{"*":{"*":"Vous ne pouvez ajouter que {maxselect} photos max. \u00e0 une publication, mais vous en avez s\u00e9lectionn\u00e9 {photosattached}. Veuillez en d\u00e9s\u00e9lectionner au moins {unselect}."}}},[j.param('maxselect',this._config.maxselect,[0]),j.param('photosattached',t,[0]),j.param('unselect',u,[0])]):j._({"*":{"*":"Vous ne pouvez ajouter que {maxselect} photos max. \u00e0 une publication, mais vous en avez s\u00e9lectionn\u00e9 {photosattached}. Veuillez en d\u00e9s\u00e9lectionner au moins une."}},[j.param('maxselect',this._config.maxselect,[0]),j.param('photosattached',t,[0])])).setButtons(c('Dialog').OK).setModal(true).show();};q.prototype._photosSelected=function(t){'use strict';var u=t.getInput(),v=r(u);if(this._isExceedMaxSelect(v)){this._showTooManyPhotosDialog(v);return;}this._onBeforeAddUploadedImages();this._upload(t,v);};q.prototype._upload=function(t,u){'use strict';var v=t.getInput(),w=this._config.uploadData;if(this._config.waterfallID)w.qn=this._config.waterfallID;var x=function(){c('Arbiter').inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:u});}.bind(this),y=new (c('XComposerPhotoUploader'))({uploadEndpoint:this._config.photoEndpoint,uploadData:w,retryLimit:this._config.retryLimit,concurrentLimit:this._config.concurrentLimit,resizer:this._resizer,onUploadEnqueued:this._generateLoadingIndicatorForPhoto.bind(this),onUploadsEnqueued:x,onUploadSent:function z(){return t.clear();},onResizeStart:this._onResizeStart.bind(this),onResizeProgress:this._onResizeProgress.bind(this),onResizeSuccess:this._onResizeSuccess.bind(this),onResizeFailure:this._onResizeFail.bind(this),onUploadStart:this._onFileUploadStart.bind(this),onUploadProgress:this._onUploadProgress.bind(this),onUploadSuccess:this._onFileUploadSuccess.bind(this),onUploadFailure:this.fileUploadFailure.bind(this)});y.upload(v);this.logStep(c('PUWSteps').CLIENT_SELECT_SUCCESS,{times_selected:p++,volume:u,method:'file_selector'});};q.prototype._onVideoRemoved=function(){'use strict';this._dragDropTarget&&this._dragDropTarget.enable();c('Arbiter').inform('multi-upload/video-removed/'+this._gridID);};q.prototype.removeLoadingIndicator=function(t){'use strict';var u=this.getLoadingIndicator(t);u&&c('DOM').remove(u.getRoot());delete this._loadingIndicators[t];c('Arbiter').inform('multi-upload/loading-indicator-removed/'+this._gridID);};q.prototype._isUploadFinished=function(){'use strict';return this._numRemainingFiles===0;};q.prototype._informUploadStatus=function(t){'use strict';c('Bootloader').loadModules(["ReactComposerAttachmentActions"],function(u){u.changeUploadStatus(this._config.composerID,t);}.bind(this),'PhotosMultiUploadInput');};q.prototype._onEncodeFinished=function(t){'use strict';this.stopInactivityTimer(t);this._markUploadAsFinished();if(this._isUploadFinished())this._informUploadFinished();};q.prototype._onEncodeProgress=function(t){'use strict';this._videoEncodeTimers[t]=this.startInactivityTimer(t);};q.prototype.startInactivityTimer=function(t){'use strict';this._videoEncodeTimers[t]=setTimeout(c('OptimisticVideoPostUtils').checkVideoStatus.bind(this,t,this._onEncodeFinished.bind(this),this._onEncodeProgress.bind(this),this._onEncodeProgress.bind(this)),100);};q.prototype.stopInactivityTimer=function(t){'use strict';clearTimeout(this._videoEncodeTimers[t]);};q.prototype._onFileUploadStart=function(t,u){'use strict';this._uploadIDToFileUpload[t]=u.upload;var v=c('DOM').find(this.getLoadingIndicator(t).getRoot(),"._639");c('CSS').show(v);this._uploadTimers[t]=Date.now();var w={custom_tags:{high_quality:this._isHighQuality}};if(u.upload&&u.upload.getFile())w.size=u.upload.getFile().size;this.logStep(c('PUWSteps').CLIENT_TRANSFER_BEGIN,w);this._logComposerWaterfallEvent(c('ComposerWaterfallEvent').PHOTO_ADD);};q.prototype._onVideoUploadStart=function(t){'use strict';this._generateLoadingIndicatorForPhoto(t);this._informUploadStatus(true);};q.prototype._onVideoUploadProgress=function(t,u,v){'use strict';var w=this.getLoadingIndicator(t.uploadID);if(!w)return;var x=Math.min(v.start_offset+v.sent_bytes,v.file_size),y=Math.floor(x/v.file_size*100)+'%';this._showProgressBar(w);this._showProgressPosition(w,y);var z={carousel_uploading:true,loaded:x,total:v.file_size,skip_upload:v.skip_upload};c('updatePhotoProgressBar')(w,z);};q.prototype._onVideoUploadFinished=function(t,u,v,w){'use strict';if(this._config.isVideoCarouselPost)t.post({draft:true});var x={};x.video_id=w.video_id;this._uploadParams[this._uploadIDToChildIndex[u.uploadID]]=x;this.startInactivityTimer(w.video_id,u.uploadID);this._numUploadsSucceeded++;var y=this.getLoadingIndicator(u.uploadID);if(!y)return;var z=this.getLoadingIndicator(u.uploadID),aa=j._("encoding...");this._showProgressPosition(z,aa);this._loadingIndicators[u.uploadID]=null;};q.prototype._onUploadProgress=function(t,u){'use strict';var v=this.getLoadingIndicator(t);if(!v||this._failedUploadIDs[t])return;this._showProgressBar(v);c('CSS').removeClass(v.getRoot(),"_5v_0");c('updatePhotoProgressBar')(v,u.event);};q.prototype._onResizeProgress=function(t,event){'use strict';var u=this.getLoadingIndicator(t);if(!u)return;this._showProgressBar(u);c('CSS').addClass(u.getRoot(),"_5v_0");u.setPosition(100*event.written/event.total);};q.prototype._showProgressBar=function(t){'use strict';c('CSS').hide(c('DOM').find(t.getRoot(),"._2om"));c('CSS').show(c('DOM').find(t.getRoot(),"._5e4h"));};q.prototype._showProgressPosition=function(t,u){'use strict';var v=c('DOM').find(t.getRoot(),"._318m");c('DOM').setContent(v,u);c('CSS').show(c('DOM').find(t.getRoot(),"._318n"));};q.prototype._onFileUploadSuccess=function(t,u){'use strict';var v=Date.now()-this._uploadTimers[t],w={dt:v};if(u.upload){w.bytes=u.upload.getFile().size;w.auto_retry_count=u.upload.getRetryCount?u.upload.getRetryCount():0;w.custom_tags={high_quality:this._isHighQuality,manual_retry:!!u.upload.getFile().manuallyRetried};}this.logStep(c('PUWSteps').CLIENT_TRANSFER_SUCCESS,w);this._logComposerWaterfallEvent(c('ComposerWaterfallEvent').PHOTO_ADD_SUCCESS);};q.prototype._logComposerWaterfallEvent=function(event){'use strict';if(!c('Parent').bySelector(c('$')(this._gridID),"._119"))return;c('ComposerXMarauderLogger').logEvent(event,this._getComposerID());};q.prototype._getComposerID=function(){'use strict';return c('ComposerXController').getComposerID(this._gridID);};q.prototype._getAsyncUploadRequest=function(t){'use strict';var u=new (c('XComposerPhotoUploader'))({uploadEndpoint:this._config.photoEndpoint,uploadData:this._config.uploadData,concurrentLimit:this._config.concurrentLimit,onUploadStart:this._onFileUploadStart.bind(this),onUploadProgress:this._onUploadProgress.bind(this),onUploadSuccess:this._onFileUploadSuccess.bind(this),onUploadFail:this.fileUploadFailure.bind(this)});return u.getAsyncUploadRequest(t);};q.prototype._onEditedImage=function(t,u){'use strict';this._onBeforeAddUploadedImages();this.logStep(c('PUWSteps').CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators([u.blob]);var v=this._getGridItemElementByFBID(u.fbid);if(v){var w=this._loadingIndicators[u.blob.uploadID].getRoot();c('DOM').insertBefore(v,w);}c('Arbiter').inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:1,method:c('PUWMethods').EDITOR});var x=this._getAsyncUploadRequest([u.blob]);x.setData(Object.assign({},this._config.uploadData,{original_fbid:u.fbid,xy_tags:u.xyTags,stickers:u.stickers,text_overlays:u.textOverlays,has_crop:u.hasCrop,has_filter:u.hasFilter}));x.send();this.logStep(c('PUWSteps').CLIENT_SELECT_SUCCESS,{volume:1,method:c('PUWMethods').EDITOR});this.logStep(c('PUWSteps').CLIENT_PHOTO_EDIT_SUCCESS);};q.prototype._getGridItemElementByFBID=function(t){'use strict';var u=c('DOM').scry(c('$')(this._gridID),".fbVaultGridItem");for(var v=0;v<u.length;v++)if(u[v].dataset.originalfbid==t)return u[v];return null;};q.prototype.onVaultImagesAdded=function(t){'use strict';var u=[];for(var v=0;v<t.length;v++)u.push({imageID:t[v]});this._generateUploadIDsAndLoadingIndicators(u);new (c('AsyncUploadRequest'))('/ajax/composerx/attachment/media/multi_upload_vault_images/').setData(Object.assign({},{vault_images:u,grid_id:this._gridID})).setAllowCrossOrigin(true).send();};q.prototype.onFilesDrop=function(t,u){'use strict';if(this._isExceedMaxSelect(t.length)){this._showTooManyPhotosDialog(t.length);return;}this._onBeforeAddUploadedImages();this.logStep(c('PUWSteps').CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators(t);c('Arbiter').inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:t.length,method:u||c('PUWMethods').DRAGDROP});var v=this._getAsyncUploadRequest(t);if(this._resizer)v.setPreprocessHandler(this._resizeUpload.bind(this));v.send();this.logStep(c('PUWSteps').CLIENT_SELECT_SUCCESS,{volume:t.length,method:u||c('PUWMethods').DRAGDROP});};q.prototype._retryFileUpload=function(t){'use strict';this._numRemainingFiles++;c('Arbiter').inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:1});this.logStep(c('PUWSteps').CLIENT_TRANSFER_MANUAL_RETRY);t.manuallyRetried=true;var u=this._getAsyncUploadRequest([t]);u.send();};q.prototype._onBeforeAddUploadedImages=function(){'use strict';if(!this.sessionStarted)this.logStep(c('PUWSteps').CLIENT_FLOW_BEGIN);if(this._config.maxselect==1)c('Arbiter').inform('multi-upload/composer-reset/'+this._gridID);this.sessionStarted=true;};q.prototype.clearSession=function(){'use strict';this.sessionStarted=false;};q.prototype.insertIntoGrid=function(t){'use strict';var u=c('DOM').scry(c('$')(this._gridID),"._577")[0];if(u){c('DOM').insertBefore(u,t);}else c('DOM').prependContent(c('$')(this._gridID),t);};q.prototype._getUploadID=function(t,u){'use strict';if(t.upload){return t.upload.getFile().uploadID;}else return u.uploadID;};q.getInstance=function(t){'use strict';o[t]=o[t]||new q(t);return o[t];};function r(t){if(!s(t))return 1;return t.files.length;}function s(t){return !!t.files&&c('AsyncUploadRequest').isSupported();}f.exports=n;}),null);
__d('StickersTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:StickersLoggerConfig',this.$StickersTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:StickersLoggerConfig',this.$StickersTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$StickersTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$StickersTypedLogger1=babelHelpers['extends']({},this.$StickersTypedLogger1,j);return this;};h.prototype.setEvent=function(j){this.$StickersTypedLogger1.event=j;return this;};h.prototype.setNumsearchresults=function(j){this.$StickersTypedLogger1.numsearchresults=j;return this;};h.prototype.setPackid=function(j){this.$StickersTypedLogger1.packid=j;return this;};h.prototype.setPackids=function(j){this.$StickersTypedLogger1.packids=c('GeneratedLoggerUtils').serializeVector(j);return this;};h.prototype.setSearchtoken=function(j){this.$StickersTypedLogger1.searchtoken=j;return this;};h.prototype.setStickerid=function(j){this.$StickersTypedLogger1.stickerid=j;return this;};h.prototype.setTagid=function(j){this.$StickersTypedLogger1.tagid=j;return this;};h.prototype.setTriggeredword=function(j){this.$StickersTypedLogger1.triggeredword=j;return this;};h.prototype.setTriggerused=function(j){this.$StickersTypedLogger1.triggerused=j;return this;};var i={event:true,numsearchresults:true,packid:true,packids:true,searchtoken:true,stickerid:true,tagid:true,triggeredword:true,triggerused:true};f.exports=h;}),null);
__d('VaultEditableGrid',['csx','Event','Arbiter','AsyncRequest','CSS','DOM','Scroll','$','ge','removeFromArray'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={};function j(k,l,m,n){i[k.id]=this;this._grid=k;this._gridID=k.id;this._dialogEndpoint=l;this._collapseWhenEmpty=m;this._attachmentCount=n;this._selectedVaultImageIDs=[];c('Arbiter').subscribe('multi-upload/image-removed/'+this._gridID,function(o,p){c('removeFromArray')(this._selectedVaultImageIDs,p);this.updateAttachmentCount(this._attachmentCount-1);}.bind(this));c('Arbiter').subscribe('multi-upload/composer-reset/'+this._gridID,function(o,p){this.removeImages();}.bind(this));c('Arbiter').subscribe(['multi-upload/images-upload-start/'+this._gridID,'multi-upload/video-added/'+this._gridID],function(){this.updateAttachmentCount(this._attachmentCount+1);}.bind(this));c('Arbiter').inform('fbVaultEditableGrid/created/'+k.id,this,c('Arbiter').BEHAVIOR_PERSISTENT);c('Arbiter').subscribe('multi-upload/images-upload-start/'+this._gridID,this._scrollToRight.bind(this));this.updateAttachmentCount(this._attachmentCount);}Object.assign(j,{VAULT_IMAGE:'vault_image',getInstance:function k(l){return i[l];},registerDialogWithGrid:function k(l,m,n){c('Arbiter').subscribe(['multi-upload/images-upload-start/'+l,'multi-upload/video-added/'+l],n.hide.bind(n));c('Arbiter').subscribe('fbVaultEditableGrid/created/'+l,function(o,p){p._registerDialogWithGrid(m,n);});},onImagesSelected:function k(l,m,n){i[l]._onImagesSelected(m,n);}});Object.assign(j.prototype,{getRoot:function k(){var l=c('ge')(this._gridID);if(l){return l;}else return this._grid;},_registerDialogWithGrid:function k(l,m){this._dialog=m;var n=this.getMoreLink();n&&c('Event').listen(n,'click',function(){m.show();return false;});m.subscribe('aftershow',function(){var o=[];c('DOM').scry(c('$')(this._gridID),'input[type="hidden"]').forEach(function(q){if(q.name.match('composer_vault_images')||q.name.match('composer_unpublished_photo'))o.push(q.value);});var p=l.getGrid();p.bulkChange(function(){var q=p.getSelectionSet();q.clear();q.addAll(o);});}.bind(this));},updateAttachmentCount:function k(l){this._attachmentCount=l;if(this._collapseWhenEmpty)c('CSS').conditionShow(this._grid,this._attachmentCount>0);},getID:function k(){return this._gridID;},_onImagesSelected:function k(l,m){var n=c('DOM').find(this.getRoot(),"._577");this.removeImages();this._selectedVaultImageIDs=m;l.forEach(function(o){c('DOM').insertBefore(n,o);});c('Arbiter').inform('multi-upload/images-added/'+this._gridID,{fbids:m});this._scrollToRight();},removeImages:function k(){c('DOM').scry(this.getRoot(),'.fbVaultGridItem').forEach(function(l){if(!c('CSS').hasClass(l,'fbVaultEditableGridMoreLink'))c('DOM').remove(l);});this._selectedVaultImageIDs=[];c('Arbiter').inform('multi-upload/all-images-removed/'+this._gridID);this.updateAttachmentCount(0);},_scrollToRight:function k(){var l=this.getRoot(),m=c('DOM').find(l,'.fbScrollableAreaWrap');c('Scroll').setLeft(m,Math.max(0,c('DOM').find(l,'.fbScrollableAreaBody').offsetWidth-m.offsetWidth));},showDialog:function k(l,m){if(this._dialog){this._dialog.show();}else c('AsyncRequest').bootstrap(this._dialogEndpoint,l);},getMoreLink:function k(){return c('DOM').scry(this.getRoot(),'.fbVaultEditableGridMoreLink')[0];}});f.exports=j;}),null);
__d('BasePhotoUploader',['Arbiter','ArbiterMixin','CSS','DOM','PhotosMultiUploadInput','VaultEditableGrid','TimelineMapScrollableArea','mixin','getObjectValues'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(k,l){'use strict';i.constructor.call(this);new (c('TimelineMapScrollableArea'))(k,{verticalscroll:true});this.$BasePhotoUploader1=k;this.$BasePhotoUploader2=this.$BasePhotoUploader3();this.$BasePhotoUploader4=false;this.$BasePhotoUploader5=null;l.addSubscriptions(c('Arbiter').subscribe('multi-upload/images-added/'+this.$BasePhotoUploader1.id,function(m,n){var o=Object.assign({},n.fbids);Object.assign(this.$BasePhotoUploader2,o);this.$BasePhotoUploader6();this.inform('upload-completed',{fbids:c('getObjectValues')(o)});}.bind(this)),c('Arbiter').subscribe('multi-upload/image-removed/'+this.$BasePhotoUploader1.id,function(m,n){for(var o in this.$BasePhotoUploader2)if(this.$BasePhotoUploader2[o]===n){delete this.$BasePhotoUploader2[o];break;}this.$BasePhotoUploader6();}.bind(this)),c('Arbiter').subscribe('multi-upload/images-upload-start/'+this.$BasePhotoUploader1.id,function(m,n){c('CSS').show(this.$BasePhotoUploader1);this.$BasePhotoUploader4=true;this.inform('dom-updated');this.inform('upload-started',n);}.bind(this)),c('Arbiter').subscribe('multi-upload/composer-reset/'+this.$BasePhotoUploader1.id,this.clear.bind(this)),c('Arbiter').subscribe('multi-upload/all-images-removed/'+this.$BasePhotoUploader1.id,this.$BasePhotoUploader7.bind(this)),c('Arbiter').subscribe('multi-upload/images-upload-completed/'+this.$BasePhotoUploader1.id,function(m){this.$BasePhotoUploader4=false;this.inform('all-uploads-completed');this.$BasePhotoUploader6();}.bind(this)));c('CSS').conditionShow(this.$BasePhotoUploader1,Object.keys(this.$BasePhotoUploader2).length);}j.prototype.getSelectedFBIDs=function(){'use strict';var k=Object.keys(this.$BasePhotoUploader2).sort();return k.map(function(l){return this.$BasePhotoUploader2[l];}.bind(this));};j.prototype.isUploading=function(){'use strict';return this.$BasePhotoUploader4;};j.prototype.clear=function(){'use strict';var k=c('VaultEditableGrid').getInstance(this.$BasePhotoUploader1.id);k&&k.removeImages();};j.prototype.getWaterfallID=function(){'use strict';return c('PhotosMultiUploadInput').getWaterfallID(this.$BasePhotoUploader1.id);};j.prototype.$BasePhotoUploader7=function(){'use strict';this.$BasePhotoUploader2={};this.$BasePhotoUploader4=false;c('CSS').hide(this.$BasePhotoUploader1);this.inform('all-uploads-completed');this.inform('dom-updated');};j.prototype.$BasePhotoUploader3=function(){'use strict';var k={},l=-10000;c('DOM').scry(this.$BasePhotoUploader1,'input[type="hidden"]').forEach(function(m){if(m.name.match('composer_vault_images')){k[l]=m.value;l--;}});return k;};j.prototype.$BasePhotoUploader6=function(){'use strict';c('CSS').conditionShow(this.$BasePhotoUploader1,Object.keys(this.$BasePhotoUploader2).length>0);this.inform('dom-updated');};j.prototype.setCurrentMethod=function(k){'use strict';this.$BasePhotoUploader5=k;};j.prototype.getCurrentMethod=function(){'use strict';return this.$BasePhotoUploader5;};f.exports=j;}),null);
__d('MercuryPhotoUploader',['csx','cx','Arbiter','AsyncRequest','BasePhotoUploader','DOM','Event','FileInput','Focus','Parent','PhotosMultiUploadInput','PUWMethods','VaultEditableGrid'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();j=babelHelpers.inherits(l,c('BasePhotoUploader'));k=j&&j.prototype;function l(m,n,o,p){'use strict';k.constructor.call(this,m,o);this.$MercuryPhotoUploader1=m.id;this.$MercuryPhotoUploader2=false;c('Arbiter').subscribe('PhotosMultiUploadInput/loaded/'+m.id,function(){this.$MercuryPhotoUploader2=true;}.bind(this));c('Arbiter').subscribe('MercuryPhotoUploader/initUploadButton/'+m.id,function(){var q=c('DOM').scry(n,'input[type="file"]')[0];if(!q)q=c('DOM').create('input',{accept:'image/*',type:'file',className:"_n",name:'composer_unpublished_photo[]',multiple:1});var r=c('Parent').bySelector(n,"._9_h"),s=new (c('FileInput'))(r,c('DOM').find(r,"._214"),q);s.subscribe('change',c('PhotosMultiUploadInput').doFileUpload.bind(null,m.id,s));});c('Arbiter').subscribe('MercuryPhotoUploader/registerPhotoMenu/'+m.id,function(q,r){var s=r.menu.getRoot();r.menu.setContext(n);var t=c('DOM').scry(s,"._d2p"),u=t&&t[0];u&&c('Event').listen(u,'click',function(){c('VaultEditableGrid').getInstance(m.id).showDialog(u,c('VaultEditableGrid').VAULT_IMAGE);this.setCurrentMethod(c('PUWMethods').VAULT);this.inform('selection-start',{method:c('PUWMethods').VAULT});}.bind(this));c('Event').listen(n,'click',function(){if(!this.$MercuryPhotoUploader2)return;if(!r.menu.isShown()){var w=c('DOM').scry(r.menu.getContentRoot(),'li');this.inform('menu-show');r.menu.show();if(w)c('Focus').setWithoutOutline(w[0]);}else{this.inform('menu-hide');r.menu.hide();}}.bind(this));c('Event').listen(document.documentElement,'click',function(event){if(!c('DOM').contains(n,event.getTarget())&&!c('DOM').contains(u,event.getTarget())){if(r.menu.isShown())this.inform('menu-hide');r.menu.hide();}}.bind(this));var v=c('DOM').find(s,"._9_h");c('Event').listen(v,'click',function(){this.setCurrentMethod(c('PUWMethods').FILE_SELECTOR);this.inform('selection-start',{method:c('PUWMethods').FILE_SELECTOR});}.bind(this));}.bind(this));p&&c('PhotosMultiUploadInput').initDragDrop(m.id,p);}l.prototype.uploadPastedFile=function(m){'use strict';c('PhotosMultiUploadInput').onFilesDrop(this.$MercuryPhotoUploader1,[m]);};l.prototype.addCachedPhotos=function(m){'use strict';c('AsyncRequest').post('/ajax/vault/selected.php',{max_select:10,grid_id:this.$MercuryPhotoUploader1,source:'messenger',image_ids:m});};Object.assign(l,{initUploadButton:function m(n){c('Arbiter').inform('MercuryPhotoUploader/initUploadButton/'+n,{},c('Arbiter').BEHAVIOR_PERSISTENT);},registerPhotoMenu:function m(n,o){c('Arbiter').inform('MercuryPhotoUploader/registerPhotoMenu/'+n,{menu:o},c('Arbiter').BEHAVIOR_PERSISTENT);}});f.exports=l;}),null);
__d('ChatEmployeeAwayWarning',['MercuryIDs','MercuryParticipants','MercuryViewer'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={updateEmployeeAwayWarning:function i(j,k,l){c('MercuryParticipants').get(c('MercuryViewer').getID(),function(m){var n=m.employee;if(n)c('MercuryParticipants').getMulti(j.participants,function(o){var p=false,q=c('MercuryIDs').getUserIDFromThreadID(j.thread_id);if(!q)return;var r='fbid:'+q;for(var s in o)if(r==o[s].id&&o[s].is_employee_away)p=true;if(p){k();}else l();});});}};f.exports=h;}),null);
__d('ChatPhotoForwardButton.react',['cx','fbt','Link.react','MessagingForwardAttachmentDialog.react','React','TooltipData'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').PureComponent);k=j&&j.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=k.constructor).call.apply(n,[this].concat(q)),this.state={dialogShown:false},this.$ChatPhotoForwardButton2=function(){this.setState({dialogShown:true});}.bind(this),this.$ChatPhotoForwardButton3=function(){this.setState({dialogShown:false});}.bind(this),o;}m.prototype.render=function(){var n=i._("Transf\u00e9rer"),o=this.props.isFromViewer?'left':'right',p=Object.assign({'data-tooltip-alignh':o},c('TooltipData').propsFor(n,o));return c('React').createElement('div',null,this.$ChatPhotoForwardButton1(),c('React').createElement(c('Link.react'),babelHelpers['extends']({},this.props,p,{'aria-label':n,onClick:this.$ChatPhotoForwardButton2,ref:'forwardButton',role:'button',className:"_2t5q"+(!this.props.isFromViewer?' '+"_1_47":'')+(this.props.isFromViewer?' '+"_1_48":'')}),c('React').createElement('div',{className:"_2t5t"})));};m.prototype.$ChatPhotoForwardButton1=function(){if(!this.state.dialogShown)return null;var n=i._("Transf\u00e9rer dans des messages s\u00e9par\u00e9s");return c('React').createElement(c('MessagingForwardAttachmentDialog.react'),{attachmentID:this.props.photoIDs[0],onClose:this.$ChatPhotoForwardButton3,shown:this.state.dialogShown,title:n});};m.propTypes={photoIDs:l.arrayOf(l.string).isRequired,isFromViewer:l.bool.isRequired};f.exports=m;}),null);
__d('MercuryThreadMuter',['AsyncDialog','AsyncRequest','DOM','MercuryThreadInfo'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={showMuteChangeDialog:function i(j,k){c('AsyncDialog').send(new (c('AsyncRequest'))('/ajax/mercury/mute_thread_dialog.php').setRelativeTo(k),function(l){l.subscribe('confirm',function(){this.hide();var m=void 0;c('DOM').scry(this.getRoot(),'input[type="radio"]').forEach(function(n){if(n.checked)m=n.value;});m=h.convertRawMuteSetting(m);e(['MercuryThreadActions'],function(n){n.get().updateMuteSetting(j,m);});}.bind(l));});},convertRawMuteSetting:function i(j){switch(j){case 'always':return -1;case '30minutes':return 1800;case '1hour':return 3600;case '8hours':return 8*3600;case '24hours':return 24*3600;case '8am':var k,l=new Date(),m=new Date();m.setHours(8);m.setMinutes(0);m.setSeconds(0);if(m>l){k=m-l;}else k=m-l+24*3600*1000;return k/1000;default:return 0;}}};f.exports=h;}),null);
__d('FBRTCVideoCallButtonManagerImpl',['invariant','BanzaiLogger','CurrentUser','FBRTCCallabilityStore','FBRTCCore','FBRTCLogger','MercuryIDs','MercuryParticipants','Tooltip'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={onCallClicked:function j(k,l){if(l===c('FBRTCLogger').Trigger.WEB_MESSENGER)c('BanzaiLogger').log('VideoCallLoggerConfig',{event:'web_messenger_call_click'});var m=c('MercuryIDs').getUserIDFromThreadID(k);!m?h(0):void 0;c('FBRTCCore').startOutgoingCall(m,l,false);},isVideoCallableThread:function j(k){if(k){var l=c('MercuryIDs').getUserIDFromThreadID(k);if(l&&l!==c('CurrentUser').getID())return true;}return false;},updateVideoCallButton:function j(k,l){if(!l||!i.isVideoCallableThread(l))return;var m=c('MercuryIDs').getUserIDFromThreadID(l);!m?h(0):void 0;k.disabled=!c('FBRTCCallabilityStore').isCallable(m);c('MercuryParticipants').get(c('MercuryIDs').getParticipantIDFromUserID(m),function(n){c('Tooltip').set(k,c('FBRTCCallabilityStore').callButtonTooltip(m,n.short_name));});}};f.exports=i;}),null);
__d('MercuryDrafts',['CacheStorage','MercurySingletonProvider','isEmpty'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();h.getForFBID=function(j){'use strict';return i.getForFBID(j);};h.get=function(){'use strict';return i.get();};function h(j){'use strict';this.$MercuryDrafts1=j;this.$MercuryDrafts2=new (c('CacheStorage'))('localstorage','mercury-drafts:'+this.$MercuryDrafts1);}h.prototype.saveDraft=function(j,k){'use strict';if(this.isMessageEmpty(k)){this.removeDraft(j);}else this.$MercuryDrafts2.set(j,this.$MercuryDrafts3(j,k));};h.prototype.removeDraft=function(j){'use strict';this.$MercuryDrafts2.remove(j);};h.prototype.getDraft=function(j){'use strict';var k=this.$MercuryDrafts2.get(j,{});return k.message;};h.prototype.isMessageEmpty=function(j){'use strict';return c('isEmpty')(j)||c('isEmpty')(j.body)&&c('isEmpty')(j.content_attachment)&&c('isEmpty')(j.raw_attachments)&&c('isEmpty')(j.photo_fbids)&&c('isEmpty')(j.image_ids);};h.prototype.$MercuryDrafts3=function(j,k){'use strict';return {thread_id:j,message:k};};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercuryDraftsController',['MercuryDrafts','Input','MercurySingletonProvider','isEmpty'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryDrafts').get();i.getForFBID=function(k){'use strict';return j.getForFBID(k);};i.get=function(){'use strict';return j.get();};function i(k){'use strict';this.$MercuryDraftsController1;}i.prototype.clearDraft=function(k){'use strict';if(this.canSaveDrafts(k))h.removeDraft(k);};i.prototype.saveDraft=function(k,l,m,n,o){'use strict';if(!this.canSaveDrafts(k))return;var p={body:c('Input').getValue(l)};if(m&&!c('isEmpty')(m.getAttachments())){p.has_attachment=true;p.raw_attachments=m.getAttachments();}if(m&&!c('isEmpty')(m.getImageFiles())){p.has_attachment=true;p.image_ids=m.getImageFiles();}if(o&&!c('isEmpty')(o.getSelectedFBIDs())){p.has_attachment=true;p.photo_fbids=o.getSelectedFBIDs();}if(n.getAttachData()){p.has_attachment=true;p.content_attachment=n.getAttachData();}h.saveDraft(k,p);};i.prototype.loadDraft=function(k,l,m,n,o){'use strict';if(!this.canSaveDrafts(k)||this.$MercuryDraftsController2(l,m,n,o))return;var p=h.getDraft(k);if(!c('isEmpty')(p)){if(p.body){l.focus();c('Input').setValue(l,p.body);}if(m&&!c('isEmpty')(p.raw_attachments))m.addCachedAttachments(p.raw_attachments);if(m&&!c('isEmpty')(p.image_ids))m.addCachedImageFiles(p.image_ids);if(!c('isEmpty')(p.content_attachment))n.loadShare(p.content_attachment.attachment.params.url);if(o&&!c('isEmpty')(p.photo_fbids))o.addCachedPhotos(p.photo_fbids);this.clearDraft(k);}};i.prototype.canSaveDrafts=function(k){'use strict';return !!k;};i.prototype.$MercuryDraftsController2=function(k,l,m,n){'use strict';return !c('Input').isEmpty(k)||l&&!c('isEmpty')(l.getAttachments())||l&&!c('isEmpty')(l.getImageFiles())||n&&!c('isEmpty')(n.getSelectedFBIDs())||m.getAttachData();};i.prototype.toString=function(){'use strict';return '[object MercuryDraftsController:'+this.$MercuryDraftsController1+']';};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercuryAttachmentRenderer',['cx','MercuryAttachmentAudioClip.react','ChatAttachmentAttribution.react','ChatPhotoForwardButton.react','EmojiLikeCxData','EmojiLikeUtils','EmojiSticker.react','ImmutableObject','MercuryAttachment','MercuryAttachmentFile.react','MercuryAttachmentPhoto.react','MercuryAttachmentPhotoGrid.react','MercuryAttachmentVideo.react','MercuryConfig','MercuryIDs','MercuryShareAttachment.react','MercuryShareAttachmentRenderLocations','MessagingGiftWrapChecker','MessengerFromViewerUtils','MessengerHotLikeUtils','MessengerWebDriverTestIDs','React','Sticker.react','StickerAssetType','StickerConstants','XStickerAssetController'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=12,j={renderFile:function k(l,m,n){return (c('React').createElement(c('MercuryAttachmentFile.react'),{name:l.name,onAttachmentLoad:n,open_url:m?null:l.open_url,rel:l.rel,type:l.icon_type,url:l.url}));},renderAudioClip:function k(l,m,n,o,p){var q=l.metadata.duration/1000,r=m?c('MercuryShareAttachmentRenderLocations').CHAT:c('MercuryShareAttachmentRenderLocations').WEB_INBOX,s=100,t=m?160:400,u=100;if(q>=5)u=(1-Math.pow(10,(q-5)/-30))*(t-s)+s;return [c('React').createElement(c('MercuryAttachmentAudioClip.react'),{customColor:n,duration:l.metadata.duration/1000,isChat:m,isFromViewer:c('MessengerFromViewerUtils').isFromViewer(o),location:r,key:'audioClip',onAttachmentLoad:p,rootClassName:c('MercuryAttachment').hasAttribution(l)?"_4yjw":'',showHelp:false,src:l.url,width:u}),c('React').createElement(c('ChatAttachmentAttribution.react'),{attachment:new (c('ImmutableObject'))(l),key:'audioAttribution',onAttachmentLoad:p})];},renderVideo:function k(l,m,n,o,p){var q=m?l.metadata.chat_size:l.metadata.inbox_size,r=m?l.metadata.chat_preview:l.metadata.inbox_preview,s=c('MessengerFromViewerUtils').isFromViewer(n),t=c('MercuryConfig').WWWPhotoForwardButtonGK&&l.metadata&&l.metadata.fbid?c('React').createElement(c('ChatPhotoForwardButton.react'),{photoIDs:[l.metadata.fbid.toString()],isFromViewer:s}):null,u=n&&(n.thread_fbid||n.thread_id&&c('MercuryIDs').getThreadFBIDFromThreadID(n.thread_id));return (c('React').createElement('div',null,t,c('React').createElement(c('MercuryAttachmentVideo.react'),{attachment:new (c('ImmutableObject'))(l),duration:l.metadata.duration,isChat:m,isVisible:p,threadID:n&&n.thread_id,threadFBID:u,name:l.name,onAttachmentLoad:o,pageID:l.metadata.pageid,thumbSize:q,thumbnail:r,videoSize:l.metadata.dimensions,videoID:l.metadata.fbid,videoURI:l.url})));},constructStickerComponent:function k(l,m,n,o,p,q){var r=o?'chatScrolled/':'messengerScrolled/';r+=l.thread_id;if(!m){m=c('MessengerHotLikeUtils').getMetadataForHotLike(l.sticker_id);if(!m){var s={},t={height:c('StickerConstants').THREAD_SIZE,width:c('StickerConstants').THREAD_SIZE},u=t.height,v=t.width;s.height=u;s.width=v;s.stickerID=l.sticker_id;s.spriteURI='';s.spriteURI2x='';s.paddedSpriteURI='';s.paddedSpriteURI2x='';m=s;}}var w=null;if(m.stickerID){w=m.stickerID.toString();}else if(l.sticker_id)w=l.sticker_id.toString();var x=null;if(m.packID)x=m.packID.toString();var y=c('XStickerAssetController').getURIBuilder().setInt('sticker_id',w),z=null,aa=null;if(window.devicePixelRatio&&window.devicePixelRatio>1){aa=m.paddedSpriteURI2x;z=m.spriteURI2x;}else{aa=m.paddedSpriteURI;z=m.spriteURI;}var ba=!!c('MessengerHotLikeUtils').getMetadataForHotLike(w)&&c('MessagingGiftWrapChecker').shouldRenderWithGiftWrap(l);return (c('React').createElement(c('Sticker.react'),{animationTrigger:'hover',className:ba?"_3m7x":'',customColor:q,frameCount:m.frameCount||1,frameRate:m.frameRate||83,framesPerCol:m.framesPerCol||1,framesPerRow:m.framesPerRow||1,onAttachmentLoad:p,onStickerClick:n,packID:x,paddedSpriteURI:aa,sourceHeight:m.height,sourceURI:y.setEnum('image_type',c('StickerAssetType').IMAGE).getURI().toString(),sourceWidth:m.width,spriteURI:z,stickerID:w,subscribedThreadID:r,testID:c('MessengerWebDriverTestIDs').STICKER}));},constructEmojiLikeAttachment:function k(l,m,n){var o=c('MercuryConfig').MessengerNewEmojiGK?c('EmojiLikeCxData').getNewEmojiData(m.body,l.size):null,p=o?o.emoji:undefined;if(!o){var q=c('EmojiLikeUtils').getURI(m.body,l.size);if(!q)return null;}return (c('React').createElement(c('EmojiSticker.react'),{className:"_2poz _ui9",key:'sticker:'+m.message_id,emoji:m.body,emojiImage:p,sourceURI:q?q:'',onAttachmentLoad:n}));},renderPhotoAttachments:function k(l,m,n,o){var p=l.length;if(!p)return null;var q=m&&m.thread_fbid;if(m&&!q)q=c('MercuryIDs').isLocalThread(m.thread_id)?null:c('MercuryIDs').getThreadFBIDFromThreadID(m.thread_id);if(p===1){var r=l[0],s=c('MercuryAttachment').resizeContain({width:n-i,height:n},{width:r.preview_width,height:r.preview_height}),t=c('MessengerFromViewerUtils').isFromViewer(m),u=c('MercuryConfig').WWWPhotoForwardButtonGK&&r.metadata&&r.metadata.fbid?c('React').createElement(c('ChatPhotoForwardButton.react'),{photoIDs:[r.metadata.fbid.toString()],isFromViewer:t}):null;return (c('React').createElement('div',{className:"_55pk"+(' '+"_59go")+(c('MercuryAttachment').hasAttribution(r)?' '+"_4yjw":'')},u,c('React').createElement(c('MercuryAttachmentPhoto.react'),{image:r,width:s.width,hasAttribution:c('MercuryAttachment').hasAttribution(r),height:s.height,message:m,onAttachmentLoad:o,round:true}),c('React').createElement(c('ChatAttachmentAttribution.react'),{attachment:new (c('ImmutableObject'))(l[0])})));}return (c('React').createElement('div',{className:"_55pk"},c('React').createElement(c('MercuryAttachmentPhotoGrid.react'),{images:l,size:n,message:m})));},sortAttachmentsStablyByType:function k(l){var m=[c('MercuryAttachment').isEmojiLikeAttachment,c('MercuryAttachment').isPhotoAttachment,c('MercuryAttachment').isShareAttachment,c('MercuryAttachment').isFileAttachment,c('MercuryAttachment').isErrorAttachment];m.push(function(o){return true;});var n=m.map(function(o){return [];});l.forEach(function(o){for(var p=0;p<m.length;p++)if(m[p](o)){n[p].push(o);break;}});return Array.prototype.concat.apply([],n);},constructStoryBasedShareAttachment:function k(l,m,n,o,p,q){var r=n?c('MercuryShareAttachmentRenderLocations').CHAT:c('MercuryShareAttachmentRenderLocations').WEB_INBOX,s={maxWidth:o},t=null;if(l&&l.platform_xmd)t=JSON.parse(l.platform_xmd);return (c('React').createElement('div',{className:"_3_om"+(n?' '+"_3cpq":''),style:s},c('React').createElement(c('MercuryShareAttachment.react'),{attachment:m.share,isSponsored:l.is_sponsored,isVisible:q,location:r,maxWidth:o,messageID:l.message_id,mnMessageType:t&&t.template_type,onComponentLoaded:p,pageID:l.author,threadID:l.thread_id})));}};f.exports=j;}),null);
__d('MercuryAttachments.react',['cx','MercuryAttachmentRenderer','ImmutableObject','MercuryAttachment','MercuryAttachmentMalicious.react','MercuryAttachmentError.react','MessagingFlowerBorder.react','MessagingGiftWrap.react','MessengerHotLikePreview.react','MessengerWebDriverTestIDs','MNCommerceMessageType','React','SubscriptionsHandler','emptyFunction','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=j.constructor).call.apply(m,[this].concat(p)),this.$MercuryAttachments1=function(r){this.props.onAttachmentLoad&&this.props.onAttachmentLoad(r);}.bind(this),this.$MercuryAttachments2=null,n;}l.prototype.componentDidMount=function(){this.$MercuryAttachments2=new (c('SubscriptionsHandler'))();};l.prototype.componentWillUnmount=function(){this.$MercuryAttachments2&&this.$MercuryAttachments2.release();};l.prototype.$MercuryAttachments3=function(m){if(c('MercuryAttachment').isStickerAttachment(m)){return c('MercuryAttachmentRenderer').constructStickerComponent(this.props.message,this.props.attachments[0].metadata,this.props.onStickerClick,this.props.isChat,this.$MercuryAttachments1,this.props.customColor);}else if(c('MercuryAttachment').isEmojiLikeAttachment(m)){var n=c('MercuryAttachmentRenderer').constructEmojiLikeAttachment(m,this.props.message,this.$MercuryAttachments1);return n?n:c('React').createElement(c('MercuryAttachmentError.react'),null);}else if(c('MercuryAttachment').isVoiceAttachment(m)){return c('MercuryAttachmentRenderer').renderAudioClip(this.props.attachments[0],this.props.isChat,this.props.customColor,this.props.message,this.$MercuryAttachments1);}else if(c('MercuryAttachment').isVideoAttachment(m)){return c('MercuryAttachmentRenderer').renderVideo(m,this.props.isChat,this.props.message,this.$MercuryAttachments1,this.props.isVisible);}else if(c('MercuryAttachment').isShareAttachment(m)){return c('MercuryAttachmentRenderer').constructStoryBasedShareAttachment(this.props.message,m,this.props.isChat,this.props.maxWidth,this.$MercuryAttachments1,this.props.isVisible);}else if(c('MercuryAttachment').isFileAttachment(m)){return c('MercuryAttachmentRenderer').renderFile(m,this.props.isChat,this.$MercuryAttachments1);}else if(c('MercuryAttachment').isErrorAttachment(m))return c('React').createElement(c('MercuryAttachmentError.react'),null);return c('React').createElement(c('MercuryAttachmentMalicious.react'),null);};l.prototype.render=function(){if(this.props.message.is_like_preview)return (c('React').createElement(c('MessengerHotLikePreview.react'),{isChat:this.props.isChat,key:'hlp:'+this.props.message.like_preview_since,since:this.props.message.like_preview_since,customLike:this.props.message.customLike,customColor:this.props.customColor}));if(this.props.attachments.length===0)return c('React').createElement('div',this.props);if(this.props.message.commerce_message_type===c('MNCommerceMessageType').RIDE_INTENT)return c('React').createElement('div',this.props);var m=c('MercuryAttachmentRenderer').renderPhotoAttachments(this.props.attachments.filter(c('MercuryAttachment').isPhotoAttachment),this.props.message,this.props.maxWidth,this.$MercuryAttachments1),n=c('MercuryAttachmentRenderer').sortAttachmentsStablyByType(this.props.attachments.filter(function(p){return !c('MercuryAttachment').isPhotoAttachment(p);})).map(function(p,q){return (c('React').createElement('span',{key:q},this.$MercuryAttachments3(p)));}.bind(this)),o=this.props.hasFlowerBorder?c('joinClasses')("_337n",this.props.className):this.props.className;return (c('React').createElement('div',babelHelpers['extends']({},this.props,{className:o,'data-testid':c('MessengerWebDriverTestIDs').ATTACHMENT_ROOT}),m,n,this.props.renderProgressBar&&this.props.renderProgressBar(),this.props.isGiftWrapped?c('React').createElement(c('MessagingGiftWrap.react'),{onUnwrap:this.props.onUnwrap}):null,this.props.hasFlowerBorder?c('React').createElement(c('MessagingFlowerBorder.react'),null):null));};l.propTypes={attachments:k.array.isRequired,customColor:k.string,customLike:k.object,hasFlowerBorder:k.bool,maxWidth:k.number.isRequired,message:k.instanceOf(c('ImmutableObject')).isRequired,isChat:k.bool,isGiftWrapped:k.bool,isVisible:k.bool,onAttachmentLoad:k.func,onStickerClick:k.func,onUnwrap:k.func};l.defaultProps={isChat:false,onAttachmentLoad:c('emptyFunction'),onStickerClick:c('emptyFunction')};f.exports=l;}),null);
__d('WebMessengerStateConstants',[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={STATE_CHANGE_EVENT:'state-changed',DETAIL:{COMPOSE_MAIN:'compose-main',COMPOSE_TYPEAHEAD_RESULTS:'compose-typeahead-results',COMPOSE_ALL_PEOPLE_RESULTS:'compose-all-people-results',RECENT_MESSAGES:'recent-messages',SEARCH_CONTEXT:'search-context',SEARCH_SNIPPET:'search-snippet',SEARCH_THREAD_SNIPPET:'search-thread-snippet',SHARED_PHOTOS:'shared-photos'},MASTER:{RECENT_THREADS:'recent-threads',SEARCH:'search'},MESSAGE_ACTION:{DELETE:'delete'}};f.exports=h;}),null);
__d('WebMessengerOldToNewPermalink',['WebMessengerPermalinkConstants','WebMessengerStateConstants'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(m){if(!i(m))return m;j(m);l(m);k(m);return m;}function i(m){var n=m.getQueryData();if(n.sk)switch(n.sk){case 'inbox':m.setPath(c('WebMessengerPermalinkConstants').BASE_PATH);m.removeQueryData('sk');break;case 'other':m.setPath(c('WebMessengerPermalinkConstants').OTHER_PATH);m.removeQueryData('sk');break;default:return false;}return true;}function j(m){var n=m.getQueryData();switch(n.action){case 'read':if(!n.tid){m.addQueryData({action:c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES});}else m.removeQueryData('action');break;}}function k(m){var n=m.getQueryData();if(n.tid){m.setPath(c('WebMessengerPermalinkConstants').getURIPathForThreadID(n.tid,m.getPath()));m.removeQueryData('tid');}}function l(m){var n=m.getQueryData();if(!m.getPath().match(c('WebMessengerPermalinkConstants').SEARCH_POSTFIX_PATH)&&n.action!=c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET&&!n.mid){var o=n.query;if(n.query){var p=/\bis:(archived|spam)\b(.*)/,q=p.exec(n.query);if(q){switch(q[1]){case 'archived':m.setPath(c('WebMessengerPermalinkConstants').ARCHIVED_PATH);break;case 'spam':m.setPath(c('WebMessengerPermalinkConstants').SPAM_PATH);break;}var r=n.query.substr(0,n.query.length-q[0].length),s=q[2];o=(r.trim()+' '+s.trim()).trim();}}if(n.thread_query){m.setPath(m.getPath()+c('WebMessengerPermalinkConstants').SEARCH_POSTFIX_PATH);m.setQueryData({query:n.thread_query});}else if(o){m.setPath(m.getPath()+c('WebMessengerPermalinkConstants').SEARCH_POSTFIX_PATH);m.addQueryData({query:o});}else m.removeQueryData('query');}}f.exports=h;}),null);
__d('WebMessengerStateStore',['MercuryAssert','PresenceState'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=null;function i(){var k=c('PresenceState').get();if(k&&k.wml)return k.wml;return {};}c('PresenceState').registerStateStorer(function(k){if(h)k.wml=h;h=null;});var j={getLastSeenThreadID:function k(){var l=i();return l.thread_id||null;},getLastSeenFolder:function k(){var l=i();return l.folder||null;},setLastSeen:function k(l,m){m&&c('MercuryAssert').isThreadID(m);h={folder:l,thread_id:m||null};c('PresenceState').doSync();}};f.exports=j;}),null);
__d('WebMessengerPermalinks',['MercuryAPIArgsSource','MercuryFilters','MercuryIDs','MercuryParticipants','MercuryParticipantTypes','MercuryThreadIDMap','MercuryTypeaheadConstants','MessagingTag','WebMessengerOldToNewPermalink','WebMessengerPermalinkConstants','WebMessengerStateConstants','WebMessengerStateStore','MercuryThreads','Token','URI','WebMessengerPreferences','WWWBase','MercuryUnreadState','createCancelableFunction','goURI','isWebMessengerURI'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadIDMap').get(),i=c('MercuryThreads').get(),j='(/|\\?|$)';c('MercuryParticipants');c('MercuryIDs');var k={getDefaultURI:function x(){var y=new (c('URI'))(c('WWWBase').uri);y.setPath(c('WebMessengerPermalinkConstants').BASE_PATH);return y;},goNextURI:function x(y,z,aa,ba){if(t(y,z,aa)){var ca=k.getURI(y,z,aa);c('goURI')(ca,false,ba);return true;}return false;},getURI:function x(y,z,aa){var ba=k.getDefaultURI();if(!y||!z||!aa)return ba;switch(aa.folder){case c('MessagingTag').OTHER:ba.setPath(c('WebMessengerPermalinkConstants').OTHER_PATH);break;case c('MessagingTag').ACTION_ARCHIVED:ba.setPath(c('WebMessengerPermalinkConstants').ARCHIVED_PATH);break;case c('MessagingTag').SPAM:ba.setPath(c('WebMessengerPermalinkConstants').SPAM_PATH);break;case c('MessagingTag').PENDING:ba.setPath(c('WebMessengerPermalinkConstants').PENDING_PATH);break;}if(aa.filter&&aa.filter!=c('MercuryFilters').ALL)ba.addQueryData({filter:aa.filter});var ca;switch(y){case c('WebMessengerStateConstants').MASTER.SEARCH:ca=false;ba.setPath(ba.getPath()+c('WebMessengerPermalinkConstants').SEARCH_POSTFIX_PATH);break;}switch(z){case c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN:case c('WebMessengerStateConstants').DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:ba.setPath(ba.getPath()+c('WebMessengerPermalinkConstants').COMPOSE_POSTFIX_PATH);ca=false;break;case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:ca=!aa.thread_id;break;case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:case c('WebMessengerStateConstants').DETAIL.SHARED_PHOTOS:ca=false;break;default:ca=true;break;}if(ca)ba.addQueryData({action:z});if(aa.thread_id){var da=c('MercuryIDs').getUserIDFromThreadID(aa.thread_id),ea=da&&c('MercuryParticipants').getNow(c('MercuryIDs').getParticipantIDFromUserID(da));if(ea&&ea.type!==c('MercuryParticipantTypes').EVENT){var fa=ea&&ea.vanity||da;ba.setPath(c('WebMessengerPermalinkConstants').getURIPathForIDOrVanity(fa,ba.getPath()));}else{var ga=h.getServerIDFromClientIDNow(aa.thread_id),ha=ga?ga:aa.thread_id;ba.setPath(c('WebMessengerPermalinkConstants').getURIPathForThreadID(ha,ba.getPath()));}}if(aa.query)ba.addQueryData({query:aa.query});if(aa.message_query)ba.addQueryData({mquery:aa.message_query});if(aa.message_id)ba.addQueryData({mid:aa.message_id});if(aa.reuse_composer)ba.addQueryData({rc:true});return ba;},processURI:function x(y,z){y=c('WebMessengerOldToNewPermalink')(y);if(!c('isWebMessengerURI')(y))return z(false);var aa,ba=u(y),ca=!ba.master_state||!ba.detail_state;if(ca){aa=v(y);}else{aa={data:{folder:r(y),filter:s(y)},redirect:false,master_state:ba.master_state,detail_state:ba.detail_state};if(y.getQueryData().rc)aa.data.reuse_composer=true;aa=o(y,aa);}if(ca)return z(aa);switch(ba.detail_state){case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:return q(y,aa,z);case c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN:return l(y,aa,z);case c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET:return p(y,aa,z);case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:return q(y,aa,function(da){p(y,da,function(ea){n(y,ea,z);});});}aa.redirect=true;aa.detail_state=null;return z(aa);}};function l(x,y,z){var aa=null;if(x.getQueryData().to)aa=[].concat(x.getQueryData().to);z(m(aa,y));}function m(x,y){if(x){y.data.new_tokens=[];x.forEach(function(z){var aa=c('MercuryParticipants').getNow(c('MercuryIDs').getParticipantIDFromUserID(z));if(aa){var ba={uid:z,text:aa.name,type:c('MercuryTypeaheadConstants').USER_TYPE};y.data.new_tokens.push(new (c('Token'))(ba));}});}y.data.start=true;return y;}function n(x,y){var z=x.getQueryData().mid;if(z){y.data.message_id=z;}else y.redirect=true;return y;}function o(x,y){var z=x.getQueryData().query;y.data.query=z;return y;}function p(x,y,z){var aa=x.getQueryData().mquery;y.data.message_query=aa;z(y);}function q(x,y,z){var aa=c('WebMessengerPermalinkConstants').getThreadIDFromURI(x);if(aa){var ba=c('MercuryIDs').isValidThreadID(aa)?aa:h.getClientIDFromServerIDNow(aa);if(ba){y.data.thread_id=ba;}else y.redirect=true;}else{var ca=c('WebMessengerPermalinkConstants').getUserIDOrVanity(x.getPath());if(ca){var da=c('MercuryParticipants').getIDFromVanityOrFBID(ca);if(!da){if(!y.waiting){y.waiting=true;y.retry=c('createCancelableFunction')(function(){q(x,y,z);});c('MercuryParticipants').addListener('change',y.retry);z(y);}return;}var ea=da&&i.getCanonicalThreadToParticipant(da,null,c('MercuryAPIArgsSource').WEBMESSENGER);if(ea){delete y.waiting;if(y.retry)y.retry.cancel();if(ea.timestamp){y.data.thread_id=ea.thread_id;}else{y.detail_state=c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN;y=m([c('MercuryIDs').getUserIDFromParticipantID(da)],y);}}else y.redirect=true;}}z(y);}function r(x,y){var z=x.getPath();if(z.match('^'+c('WebMessengerPermalinkConstants').ARCHIVED_PATH+j))return c('MessagingTag').ACTION_ARCHIVED;if(z.match('^'+c('WebMessengerPermalinkConstants').OTHER_PATH+j))return c('MessagingTag').OTHER;if(z.match('^'+c('WebMessengerPermalinkConstants').SPAM_PATH+j))return c('MessagingTag').SPAM;if(z.match('^'+c('WebMessengerPermalinkConstants').PENDING_PATH+j))return c('MessagingTag').PENDING;if(y!==undefined)return y;return c('MessagingTag').INBOX;}function s(x){return x.getQueryData().filter||c('MercuryFilters').ALL;}function t(x,y,z){if(y===c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT||y===c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET||y===c('WebMessengerStateConstants').DETAIL.SHARED_PHOTOS)return false;if(z&&z.no_uri===true){delete z.no_uri;return false;}var aa=y==c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN||y==c('WebMessengerStateConstants').DETAIL.COMPOSE_TYPEAHEAD_RESULTS||y==c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(aa&&(!z.start||z.new_tokens))return false;if(!x||!y||!z)return true;if(z.bug_reporting_enabled)return false;return !z.message_action;}function u(x){var y={},z=x.getPath(),aa=x.getQueryData(),ba=z.match(c('WebMessengerPermalinkConstants').BASE_PATH+'(/[^/]+)?'+c('WebMessengerPermalinkConstants').SEARCH_POSTFIX_PATH+j);y.master_state=ba&&aa.query?c('WebMessengerStateConstants').MASTER.SEARCH:c('WebMessengerStateConstants').MASTER.RECENT_THREADS;if(aa.action){y.detail_state=aa.action;return y;}if(z.match('(?:'+c('WebMessengerPermalinkConstants').BASE_PATH+'|'+c('WebMessengerPermalinkConstants').OTHER_PATH+')'+'(/[^/]+)?'+c('WebMessengerPermalinkConstants').COMPOSE_POSTFIX_PATH+j)){y.detail_state=c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN;return y;}if(z.match(c('WebMessengerPermalinkConstants').TID_POSTFIX_PARTIAL_PATH)||c('WebMessengerPermalinkConstants').getUserIDOrVanity(z)){if(aa.mid&&aa.mquery){y.detail_state=c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT;}else y.detail_state=c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES;}else if(aa.mquery)y.detail_state=c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET;return y;}function v(x){var y=r(x,null)||c('WebMessengerStateStore').getLastSeenFolder(),z=c('WebMessengerStateStore').getLastSeenThreadID()||w(y||c('MessagingTag').INBOX),aa=c('MercuryUnreadState').get();if(y===c('MessagingTag').OTHER&&aa.getUnreadCount(y)===0){var ba=c('MessagingTag').INBOX;if(aa.exceedsMaxCount(ba)||aa.getUnreadCount(ba)>0)y=ba;}var ca={redirect:!!z||!!y,replace:true,master_state:c('WebMessengerStateConstants').MASTER.RECENT_THREADS,detail_state:c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,data:{folder:y||c('MessagingTag').INBOX,filter:c('MercuryFilters').ALL,thread_id:z}};return ca;}function w(x){var y=c('WebMessengerPreferences').lastReadThreadForFolder[x];if(y){var z=y.other_user_fbid||y.thread_fbid;return h.getClientIDFromServerIDNow(z);}else return null;}f.exports=k;}),null);
__d('WebMessengerStateManager',['Arbiter','CurrentUser','Dialog','Focus','JSLogger','MercuryFilters','MessagingTag','WebMessengerPermalinks','WebMessengerStateConstants'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('JSLogger').create('wm_state_manager'),i=c('CurrentUser').getID(),j=Object.assign(new (c('Arbiter'))(),{getCurrentUserID:function q(){return i;},getCurrentMasterState:function q(){return m;},getCurrentDetailState:function q(){return n;},getCurrentStateData:function q(){return o;},setUserID:function q(r){i=r||c('CurrentUser').getID();},updateMasterState:function q(r,s){j.updateAllStates(r,n,s);},updateDetailState:function q(r,s){j.updateAllStates(m,r,s);},updateAllStates:function q(r,s,t){for(var u=0;u<p.length;u++)if(p[u]){var v=p[u](r,s,t);if(v){h.log('confirmation_dialog',{master_state:m,detail_state:n,data:o,new_master_state:r,new_detail_state:s,new_data:t});v.setHandler(k.bind(null,r,s,t)).show();var w=v.getButtonElement(c('Dialog').OK.label);w&&c('Focus').set(w);return;}}k(r,s,t);},updateStateOnURI:function q(r,s,t){l(r,s,t);},registerConfirmationBeforeStateUpdate:function q(r){var s=p.length;p.push(r);return s;},unregisterConfirmationBeforeStateUpdate:function q(r){delete p[r];}});function k(q,r,s){if(!s.folder)s.folder=o.folder;if(!s.filter)s.filter=o.filter;if(!c('WebMessengerPermalinks').goNextURI(q,r,s))l(q,r,s);}function l(q,r,s){m=q;n=r;o=s;var t=babelHelpers['extends']({},o);t.new_tokens=[];(o.new_tokens||[]).forEach(function(u){t.new_tokens.push(u.getInfo());});t.new_tokens=[];h.log('state_updated',{master_state:m,detail_state:n,data:t});j.inform(c('WebMessengerStateConstants').STATE_CHANGE_EVENT);}var m=c('WebMessengerStateConstants').MASTER.RECENT_THREADS,n=c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,o={thread_id:null,folder:c('MessagingTag').INBOX,filter:c('MercuryFilters').ALL},p=[undefined];f.exports=j;}),null);
__d('WebMessengerAdsControl',['csx','cx','AdsMouseStateStore','Animation','Arbiter','WebMessengerConstants','CSS','CurrentUser','DataAttributeUtils','DOM','EgoAdsObjectSet','Event','KeyedCallbackManager','MercuryIDs','MercuryThreads','UIPagelet','URI','UserActivity','Vector','WebMessengerAdsConfig','WebMessengerStateManager','WebMessengerSubscriptionsHandler','cxodecode','getOrCreateDOMID','shield','throttle'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('MercuryThreads').get(),k=600,l=c('WebMessengerConstants').ADS_ROTATION_INTERVAL_PASSIVE,m=c('WebMessengerConstants').ADS_ROTATION_THRESHOLD_ACTIVE,n=c('WebMessengerConstants').MAX_ADS,o=2,p=165,q=c('AdsMouseStateStore').STATES,r='data-height',s=c('AdsMouseStateStore').get(),t=new (c('KeyedCallbackManager'))(),u='webMessengerAdsStage',v=0,w={},x=void 0,y=void 0;function z(){}Object.assign(z,{init:function ga(ha,ia){if(ha)x=c('cxodecode')(ha);if(ia)y=c('cxodecode')(ia);this._ads=new (c('EgoAdsObjectSet'))(x);this._initializedAds=false;this._loadingCount=null;this._stage=null;this._drawCount=0;this._lastRefresh=0;this._pageletInProgress=null;this._lastMousedOnAds=false;this._waitOn(['codes','container','sidebar','footer'],this.start.bind(this));c('WebMessengerSubscriptionsHandler').addSubscriptions(c('UserActivity').subscribe(c('shield')(this._refreshIfReady,this)),c('Arbiter').subscribe('footerLoaded',function(){t.setResource('footer',1);}),c('Arbiter').subscribe(['sidebar/initialized','sidebar/visibility','minisidebar/show'],this._sideBarChanged.bind(this)),t);return this;},setContainer:function ga(ha){t.setResource('container',ha);this._container=ha;},setTrackingCodes:function ga(ha){t.setResource('codes',ha);},getTrackingCodes:function ga(){return t.getResource('codes');},updateRhcID:function ga(){var ha=c('DOM').scry(this._container,'div.ego_section')[0];if(!ha)return;s.updateRhcID(c('getOrCreateDOMID')(ha));},start:function ga(){this._stage=c('DOM').create('div',{id:u,className:"_2rn"});this._ego=c('DOM').find(this._container,"._81");c('DOM').insertAfter(this._ego,this._stage);this.updateRhcID();this._updateFooterHeight();this.waitForAdsLoad(this._container,this._processOnPageUnits.bind(this));c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(window,'resize',c('throttle')(this.draw,100,this)),c('Event').listen(this._ego,'mouseenter',c('shield')(this._mouseEvent,this,true)),c('Event').listen(this._ego,'mouseleave',c('shield')(this._mouseEvent,this,false)));},stateChanged:function ga(ha,ia){ha=ha||{};ia=ia||{};if(ha.thread_id&&ia.thread_id&&ia.thread_id!==ha.thread_id)this._refreshIfReady(true);},draw:function ga(){var ha=this._loadingCount<=0;if(!this._initializedAds||!this._drawCount&&!ha)return;this._adjustAdsToFit();},_processOnPageUnits:function ga(){this._ads.init(ea(this._ego));this._initializedAds=true;this._adjustAdsToFit();},_processStagedUnits:function ga(){this._pageletInProgress=false;var ha=ea(this._stage);if(!this._lastMousedOnAds&&ha.length&&!this._focusedOnAds()){c('DOM').empty(this._ego);while(this._stage.childNodes.length)c('DOM').appendContent(this._ego,this._stage.firstChild);this._ads.init(ha);this._lastRefresh=Date.now();this._adjustAdsToFit();}},waitForAdsLoad:function ga(ha,ia){var ja=ea(ha);this._loadingCount=ja.length;if(!this._loadingCount){this._lastRefresh=Date.now()-l/2;this._pageletInProgress=false;return;}var ka=function(la){da(la);if(--this._loadingCount<=0)ia();}.bind(this);ja.forEach(function(la){function ma(){setTimeout(ka.bind(null,la),0);}var na=c('DOM').scry(la,'img.img')[0];if(!na||na.complete){ma();}else c('Event').listen(na,{load:ma,error:ma,abort:ma});}.bind(this));},_adjustAdsToFit:function ga(){this._drawCount++;var ha=c('Vector').getViewportDimensions().y,ia=ha-this._footerHeight-p,ja=ia,ka=0;while(ja>0&&ka<this._ads.getCount()){ja-=ca(this._ads.getUnit(ka));if(ja>=0)ka++;}ka=Math.max(ka,o);for(var la=0;la<this._ads.getCount();la++)ba(this._ads.getUnit(la),la>=ka);c('CSS').conditionShow(this._ego,ka);c('CSS').addClass(this._ads.getUnit(0),'ego_unit_no_top_border');var ma=c('DOM').scry(this._container,'.ego_section');ma.forEach(function(na){aa(na,c('DOM').scry(na,'[data-onscreen]').length);});aa(this._container,true);this._registerImpressions(ka);this._registerHoldoutImpressions(ia);c('Arbiter').inform('WebMessengerAdsControl/adjustAds');},_waitOn:function ga(ha,ia){t.executeOrEnqueue(ha,ia);},_mouseEvent:function ga(ha){this._lastMousedOnAds=ha;},intentShown:function ga(){if(!c('WebMessengerAdsConfig').stateRefresh)return false;var ha=s.getState();switch(ha){case q.STATIONARY:return !c('WebMessengerAdsConfig').refreshOnStationary;case q.INTENT:case q.HOVER:return true;default:return false;}},_focusedOnAds:function ga(){return c('DOM').contains(this._container,document.activeElement);},_refreshIfReady:function ga(ha){var ia=ha?m:l;if(this._lastRefresh===0){this._lastRefresh=Date.now();return;}else if(this._pageletInProgress||!this._drawCount||this._lastMousedOnAds||this._focusedOnAds()||this.intentShown()||this._lastRefresh+ia>Date.now())return;t.reset();this._waitOn(['codes'],this.waitForAdsLoad.bind(this,this._stage,this._processStagedUnits.bind(this)));this._pageletInProgress=c('UIPagelet').loadFromEndpoint('WebEgoPane',u,{pid:43,data:[c('CurrentUser').getID(),n,++v,fa()]},{crossPage:true,bundle:false,handler:this.onLoadHandler.bind(this)});},onLoadHandler:function ga(){if(!c('WebMessengerAdsConfig').fade)return;new (c('Animation'))(this._container).from('opacity',0).to('opacity',1).duration(k).go();},_updateFooterHeight:function ga(){c('CSS').hide(this._ego);this._footerHeight=c('Vector').getElementDimensions(this._container).y;c('CSS').show(this._ego);},_registerImpression:function ga(ha){var ia=this.getTrackingCodes();if(!ia||!ia[ha])return null;var ja=c('DOM').create('iframe',{src:new (c('URI'))('/ai.php').addQueryData({aed:ia[ha]}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});ja.setAttribute('aria-hidden','true');c('DOM').appendContent(this._container,ja);return ja;},_registerImpressions:function ga(ha){var ia=this.getTrackingCodes(),ja=w;w={};for(var ka=0;ka<ha;ka++){if(!this._ads.getUnit(ka))continue;var la=c('DOM').scry(this._ads.getUnit(ka),x||"div._4u8");if(!la.length)continue;var ma=c('DataAttributeUtils').getDataAttribute(la[0],'data-ad'),na=JSON.parse(ma).adid;if(na in ja){w[na]=ja[na];delete ja[na];}else{if(!ia||!ia[na])continue;var oa=this._registerImpression(na);delete ia[na];if(oa)w[na]=oa;}}for(na in ja)c('DOM').remove(ja[na]);},_registerHoldoutImpressions:function ga(ha){var ia=this._ads.getHoldoutAdIDsForSpace(ha,ca);if(ia)ia.forEach(this._registerImpression.bind(this));},_sideBarChanged:function ga(ha){if(ha=='sidebar/initialized')t.setResource('sidebar',1);this._initializedAds&&this.draw();}});function aa(ga,ha){c('CSS').conditionClass(ga,"_2rn",!ha);}function ba(ga,ha){c('CSS').conditionClass(ga,y||"_53o5",ha);ga.setAttribute('aria-hidden',ha?'true':'false');if(ha){ga.removeAttribute('data-onscreen');}else ga.setAttribute('data-onscreen','1');}function ca(ga){if(!ga)return 0;var ha=ga.getAttribute(r)||da(ga);return parseInt(ha,10);}function da(ga){var ha=c('Vector').getElementDimensions(ga).y;ga.setAttribute(r,ha);return ha;}function ea(ga){return c('DOM').scry(ga,'div.ego_unit');}function fa(){var ga=c('WebMessengerStateManager').getCurrentStateData();if(ga.thread_id){var ha=j.getThreadMetaNow(ga.thread_id);if(ha)return ha.participants.map(function(ia){return c('MercuryIDs').getUserIDFromParticipantID(ia);}).filter(function(ia){return ia&&ia!=c('CurrentUser').getID();});}return [];}f.exports=z;}),null);
__d('WebMessengerActionsMenuItem',['CSS','MenuItem','WebMessengerStateManager'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('MenuItem'));i=h&&h.prototype;function j(k){'use strict';k.href=k.href||'#';i.constructor.call(this,k);this.setOnClickHandler(this.handleMenuItemClick);this.showFn=this._data.should_show_fn;this.hasAction=function(){return !this._data.hideManually;}.bind(this);}j.prototype.handleMenuItemClick=function(){'use strict';var k=c('WebMessengerStateManager').getCurrentStateData().thread_id;k&&this._data.onclick(k);};j.prototype.updateShownState=function(k){'use strict';if(this.showFn){this._isHidden=!this.showFn(k);if(this._root)c('CSS').conditionShow(this._root,!this._isHidden);}};j.prototype.isShown=function(k){'use strict';var l=this.showFn?this.showFn(k):true;return l;};j.prototype.render=function(){'use strict';var k=i.render.call(this);if(this._isHidden)c('CSS').hide(k);return k;};f.exports=j;}),null);
__d('MercuryDataSources',[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={},i={add:function j(k,l){h[k]=l;},get:function j(k){!h[k];return h[k];}};f.exports=i;}),null);
__d('MercuryTypeahead',['cx','Event','ArbiterMixin','DOM','DOMDimensions','Input','Keys','MercuryTypeaheadTemplates','Tokenizer','Typeahead','TypeaheadCore','WorkModeConfig'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=function j(k,l){this._domElement=null;this._typeahead=null;this._tokenizer=null;this._placeholder='';this._exclusions=[];this._viewNodeOrID=null;this._viewOptions={renderer:'compact',autoSelect:true};this._tokenizerBehaviors=[];this._heightPrev=null;this._dataSource=k;this._view=l;};Object.assign(i.prototype,c('ArbiterMixin'));Object.assign(i.prototype,{setPlaceholder:function j(k){this._placeholder=k;return this;},setExcludedParticipantsFromThreadMeta:function j(k){if(!k)return;this.setExcludedParticipants(k.participants);},setExcludedParticipants:function j(k){this._exclusions=[];k.forEach(function(l){var m=l.indexOf(':');if(l.substr(0,m)=='fbid')this._exclusions.push(l.substr(m+1));}.bind(this));return this;},setViewNodeID:function j(k){this._viewNodeOrID=k;},setViewNode:function j(k){this._viewNodeOrID=k;},setFullWidthView:function j(k){var l=c('DOM').create('div',{className:"_4ck uiTypeaheadView"});c('DOM').setContent(k,l);this.setViewNode(l);},setViewOption:function j(k,l){this._viewOptions[k]=l;},addTokenizerBehavior:function j(k){this._tokenizerBehaviors.push(k);},build:function j(k){if(this._domElement)return;var l=c('MercuryTypeaheadTemplates')[':fb:mercury:tokenizer'].build(),m=c('MercuryTypeaheadTemplates')[':fb:mercury:typeahead'].build();this._domElement=l.getRoot();c('DOM').appendContent(this._domElement,m.getRoot());var n=m.getNode('textfield');c('Input').setPlaceholder(n,this._placeholder);n.setAttribute('data-placeholder',this._placeholder);this._input=n;var o={node_id:this._viewNodeOrID,ctor:this._view,options:this._viewOptions},p={ctor:c('TypeaheadCore'),options:{setValueOnSelect:true}};this._typeahead=new (c('Typeahead'))(this._dataSource,o,p,m.getRoot());this._typeahead.init();var q={inline:true,behaviors:this._tokenizerBehaviors};this._tokenizer=new (c('Tokenizer'))(this._domElement,this._typeahead);this._tokenizer.init(l.getNode('tokenarea'),'participants',[],q);this._tokenizer.subscribe(['addToken','removeToken','removeAllTokens'],this._tokensChanged.bind(this));this._tokenizer.subscribe('resize',function(){this.inform('resize');}.bind(this));c('Event').listen(n,'focus',function(){this._resetDataSource();this._typeahead.init();}.bind(this));c('Event').listen(this._domElement,'click',this.focus.bind(this));c('Event').listen(n,'keydown',this.keydown.bind(this));this._heightPrev=c('DOMDimensions').getElementDimensions(this._domElement).height;},getElement:function j(){return this._domElement;},getSelectedParticipantIDs:function j(){var k=[];if(this._tokenizer)(this._tokenizer.getTokenValues()||[]).forEach(function(l){k.push('fbid:'+l);});return k;},getTokens:function j(){var k=[];if(this._tokenizer)k=this._tokenizer.getTokens();return k;},getTokenizer:function j(){return this._tokenizer;},keydown:function j(event){if(this._tokenizer.inline&&event.keyCode==c('Keys').ESC){if(c('Input').isEmpty(this._input)){var k=this._tokenizer.getLastToken();if(k&&k.isRemovable()){this._tokenizer.removeToken(k);event.stopPropagation();return;}}else{this._typeahead.getCore().reset();event.stopPropagation();return;}this.inform('esc-pressed');return;}if(c('Input').isEmpty(this._input)&&this._tokenizer.inline&&event.keyCode===c('Keys').RETURN){event.preventDefault();return this.inform('tokens-return');}},reset:function j(){this._tokenizer&&this._tokenizer.removeAllTokens();this._typeahead&&this._typeahead.getCore().reset();},focus:function j(){this._tokenizer&&this._tokenizer.focusInput();},getTypeahead:function j(){return this._typeahead;},_resetDataSource:function j(){this._dataSource.setExclusions(this._exclusions);},_tokensChanged:function j(){this.inform('tokens-changed');}});f.exports=i;}),null);
__d('MercuryTypeaheadRenderer',['cx','Event','Badge.react','CSS','DOM','Image.react','MercuryTypeaheadConstants','MercuryParticipantsConstants','React','ReactDOM','MercuryTypeaheadTemplates'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(k,l){var m;switch(k.type){case c('MercuryTypeaheadConstants').HEADER_TYPE:m=c('MercuryTypeaheadTemplates')[':fb:mercury:typeahead:header'].build();i.renderHeader(m,k);break;case c('MercuryTypeaheadConstants').USER_TYPE:case c('MercuryTypeaheadConstants').PAGE_TYPE:m=c('MercuryTypeaheadTemplates')[':fb:mercury:typeahead:result'].build();i.renderPerson(m,k);break;default:throw new Error('Unsupported result type: '+k.type);}return m.getRoot();}Object.assign(i,{renderHeader:function k(l,m){if(m.disabled){c('CSS').hide(l.getRoot());return;}var n=m.getLinkHandler&&m.getLinkHandler();if(n){var o=l.getNode('link');c('DOM').setContent(o,m.linkText);c('Event').listen(o,'click',n);}else c('CSS').hide(l.getNode('link'));l.setNodeContent('text',m.text);},renderPersonWithBigPhoto:function k(l,m){j(l,m,c('MercuryParticipantsConstants').BIG_IMAGE_SIZE);},renderPerson:function k(l,m){j(l,m,c('MercuryParticipantsConstants').IMAGE_SIZE);},renderPage:function k(l,m){j(l,m,c('MercuryParticipantsConstants').IMAGE_SIZE);}});function j(k,l,m){if(l.photo){var n=c('React').createElement(c('Image.react'),{width:m,height:m,src:l.photo});c('ReactDOM').render(n,k.getNode('image'));}if(l.text){c('DOM').setContent(k.getNode('name'),l.text);k.getRoot().setAttribute('aria-label',l.text);}var o=[];if(l.subtext||l.category){if(l.subtext)o.push(l.subtext);if(l.category)o.push(l.category);c('DOM').appendContent(k.getNode('snippet'),o.join(" \u00b7 "));}var p=null;if(l.is_verified){p=c('React').createElement(c('Badge.react'),{type:'verified',size:'xsmall'});c('ReactDOM').render(p,k.getNode('badge'));}else if(l.is_work_user){p=c('React').createElement(c('Badge.react'),{type:'work',size:'xsmall'});c('ReactDOM').render(p,k.getNode('badge'));}if(l.non_employee){if(o.length)c('DOM').prependContent(k.getNode('snippet')," \u00b7 ");var q=c('DOM').create('span',{className:"_52l8 highlight"},'(Non-Employee)');c('DOM').prependContent(k.getNode('snippet'),q);}if(l.render_type===c('MercuryTypeaheadConstants').MEETING_ROOM_PAGE_TYPE){var r={href:'/'+l.uid.toString(),target:'_blank',role:'link'};c('DOM').setAttributes(k.getNode('threadLink'),r);}}f.exports=i;}),null);
__d('WebMessengerAddPeopleToConversationDialog',['fbt','ContextualTypeaheadView','Dialog','DOM','MercuryAPIArgsSource','MercuryDataSources','MercuryIDs','MercuryLogMessageType','MercurySourceType','MercuryThreadActions','MercuryTypeahead','MercuryTypeaheadConstants','MercuryTypeaheadRenderer','MercuryViewer','MercuryMessageObject','MercuryMessageActions','MessengerAdminGroupUtils','WebMessengerTemplates','MercuryThreads','WorkModeConfig'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('MercuryThreadActions').get(),j=c('MercuryMessageObject').get(),k=c('MercuryMessageActions').get(),l=c('MercuryThreads').get(),m={show:function o(p){var q={};q[c('MercuryTypeaheadConstants').FRIEND_TYPE]={uid:c('MercuryTypeaheadConstants').FRIEND_TYPE,type:c('MercuryTypeaheadConstants').HEADER_TYPE,disabled:true};q[c('MercuryTypeaheadConstants').NON_FRIEND_TYPE]={uid:c('MercuryTypeaheadConstants').NON_FRIEND_TYPE,text:h._("Autres personnes"),type:c('MercuryTypeaheadConstants').HEADER_TYPE};var r=new (c('MercuryTypeahead'))(c('MercuryDataSources').get('MercuryRecipientsDataSource'),c('ContextualTypeaheadView'));r.setViewOption('renderer',c('MercuryTypeaheadRenderer'));r.setViewOption('typeObjects',q);var s=[],t=c('WebMessengerTemplates')[':fb:web-messenger:add-people-dialog'].build();l.getThreadMeta(p,function(u){var v=c('MessengerAdminGroupUtils').isJoinableThread(u),w=v?h._("Inviter des gens"):h._("Ajouter des personnes");s.push({name:'subscribe',label:w,handler:n.bind(null,u,r)});var x=c('WorkModeConfig').is_work_user?h._("Ajouter des coll\u00e8gues \u00e0 cette discussion instantan\u00e9e"):h._("Ajouter des amis \u00e0 cette discussion");x=v?h._("Inviter des amis \u00e0 cette discussion"):x;s.push(c('Dialog').CANCEL);r.setPlaceholder(x);var y=new (c('Dialog'))().setTitle(w).setButtons(s).setBody(t.getRoot()).showLoading();r.setFullWidthView(t.getNode('participantsTypeahead'));r.setExcludedParticipantsFromThreadMeta(u);r.build();c('DOM').appendContent(t.getNode('participantsTypeahead'),r.getElement());y.show();r.focus();},c('MercuryAPIArgsSource').WEBMESSENGER);}};function n(o,p){var q=p.getTokens(),r=q.map(function(s){return c('MercuryIDs').getParticipantIDFromUserID(s.getValue());});if(!r.length)return false;if(c('MessengerAdminGroupUtils').isJoinableThread(o)){r.map(function(s){var t=c('MercuryIDs').getThreadIDFromParticipantID(s);k.send(j.constructUserGeneratedMessageObject(o.joinable_mode.link,c('MercurySourceType').MESSENGER_WEB,t));});}else k.send(j.constructLogMessageObject(c('MercurySourceType').TITAN_WEB,o.thread_id,c('MercuryLogMessageType').SUBSCRIBE,{added_participants:r}),null,c('MercuryAPIArgsSource').WEBMESSENGER);return true;}f.exports=m;}),null);
__d('WebMessengerDeleteThreadDialog',['fbt','React','SimpleXUIDialog','MercuryThreadActions','XUIDialogButton.react','XUIDialogCancelButton.react'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('MercuryThreadActions').get(),j={show:function k(l,m,n){var o=h._("Supprimer cette conversation\u00a0?"),p=h._("La suppression de votre copie de cette conversation est irr\u00e9versible."),q=c('React').createElement('div',null,c('React').createElement(c('XUIDialogCancelButton.react'),null),c('React').createElement(c('XUIDialogButton.react'),{action:'cancel',label:h._("Supprimer la conversation"),use:'confirm',onClick:function r(){i['delete'](l);m&&m();}}));c('SimpleXUIDialog').showEx(p,o,q,null,{causalElement:n});}};f.exports=j;}),null);
__d('WebMessengerEditThreadDialog',['csx','cx','Event','Button','ContextualDialog','CSS','DOM','FileInput','FileInputUploader','Input','InputSelection','LayerFadeOnHide','LayerFadeOnShow','LayerHideOnTransition','MercuryAPIArgsSource','MercuryLogMessageType','MercurySourceType','MercuryMessageObject','MercuryMessageActions','WebMessengerTemplates','MercuryThreads','URI','WebMessengerSubscriptionsHandler'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('MercuryMessageObject').get(),k=c('MercuryMessageActions').get(),l=c('MercuryThreads').get(),m=':fb:web-messenger:read-view:header:edit-multichat';function n(){'use strict';var o=c('WebMessengerTemplates')[m].build();this._dialog=new (c('ContextualDialog'))({position:'below',addedBehaviors:[c('LayerFadeOnHide'),c('LayerFadeOnShow'),c('LayerHideOnTransition')]},o.getRoot());this._saveButton=o.getNode('saveButton');this._cancelButton=o.getNode('cancelButton');this._pictureInput=o.getNode('newPicture');this._uploadButton=o.getNode('uploadButton');this._uploadingThrobber=o.getNode('uploadingThrobber');this._uploadedFileDetails=o.getNode('uploadedFileDetails');this._fileNameNode=o.getNode('fileName');this._cancelImageButton=o.getNode('cancelImage');this._threadID=null;var p=o.getNode('newName');this._uploadedImage=null;if(!this._pictureInput){var q=c('DOM').scry(o.getRoot(),"._8-9")[0];this._pictureInput=c('DOM').create('input',{accept:'image/*',type:'file',className:"_n",name:'attachment[]',tabindex:2});new (c('FileInput'))(q,this._uploadButton,this._pictureInput);}var r=new (c('URI'))('/ajax/mercury/upload.php').setSubdomain('upload').toString();this._uploader=new (c('FileInputUploader'))(this._pictureInput).setURI(r).setAllowCrossOrigin(true).setData({images_only:true});c('WebMessengerSubscriptionsHandler').addSubscriptions(this._uploader.subscribe('success',this._onFileUploadSuccess.bind(this)),this._uploader.subscribe('failure',this._onFileUploadFailure.bind(this)),c('Event').listen(this._pictureInput,'change',this._onFileUploadChange.bind(this)),c('Event').listen(this._cancelImageButton,'click',this._resetImageUpload.bind(this)));c('Event').listen(this._saveButton,'click',function(){this.save(c('Input').getValue(p));this._dialog.hide();}.bind(this));c('Event').listen(this._cancelButton,'click',function(){this._dialog.hide();}.bind(this));this._dialog.subscribe('show',function(){var s=l.getThreadMetaNow(this._threadID);c('Input').setValue(p,s.name);this._resetImageUpload();}.bind(this));this._dialog.subscribe('aftershow',function(){c('InputSelection').set(p,0,c('Input').getValue(p).length);}.bind(this));}n.prototype.toggleShown=function(o,p){'use strict';if(!this._dialog.isShown()){this._dialog.setContext(o);this._threadID=p;this._uploadedImage=null;this._dialog.show();}else this._dialog.hide();};n.prototype.save=function(o){'use strict';var p=null,q=l.getThreadMetaNow(this._threadID);if(q)p=q.name;if((o||p)&&o!=p)k.send(j.constructLogMessageObject(c('MercurySourceType').CHAT_WEB,this._threadID,c('MercuryLogMessageType').THREAD_NAME,{name:o}),null,c('MercuryAPIArgsSource').WEBMESSENGER);if(this._uploadedImage)k.send(j.constructLogMessageObject(c('MercurySourceType').CHAT_WEB,this._threadID,c('MercuryLogMessageType').THREAD_IMAGE,{image:this._uploadedImage}));};n.prototype._onFileUploadChange=function(event){'use strict';var o=c('Input').getValue(event.getTarget());if(o){c('Button').setEnabled(this._saveButton,false);c('CSS').hide(this._uploadButton);c('CSS').hide(this._uploadedFileDetails);c('CSS').show(this._uploadingThrobber);this._uploader.send();}};n.prototype._onFileUploadSuccess=function(o,p){'use strict';var q=p.response.getPayload();this._uploadedImage=q.metadata[0];c('DOM').setContent(this._fileNameNode,this._uploadedImage.filename);c('CSS').hide(this._uploadingThrobber);c('CSS').hide(this._uploadButton);c('CSS').show(this._uploadedFileDetails);c('Button').setEnabled(this._saveButton,true);};n.prototype._onFileUploadFailure=function(o,p){'use strict';c('Button').setEnabled(this._saveButton,true);this._resetImageUpload();};n.prototype._resetImageUpload=function(){'use strict';this._uploadedImage=null;this._pictureInput.value=null;c('CSS').hide(this._uploadingThrobber);c('CSS').hide(this._uploadedFileDetails);c('CSS').show(this._uploadButton);};f.exports=n;}),null);
__d("ListInputTargetTracker",[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){"use strict";this._index=undefined;this._items=[];}h.prototype.getIndex=function(){"use strict";return this._index;};h.prototype.setIndex=function(i){"use strict";this._index=Math.max(0,Math.min(i,this._items.length-1));};h.prototype.getNumItems=function(){"use strict";return this._items.length;};h.prototype.getItem=function(){"use strict";if(this._index!==undefined)return this._items[this._index];};h.prototype.setTargetItem=function(i){"use strict";this.updateIndex(this._items,i);};h.prototype.addItem=function(i){"use strict";this._items.push(i);};h.prototype.removeItemAtIndex=function(i){"use strict";this._items.splice(i,1);};h.prototype.removeItemByValue=function(i){"use strict";var j=this._items.indexOf(i);this.removeItemAtIndex(j);};h.prototype.moveUp=function(){"use strict";if(this._index===undefined||this._index===0){if(this._items.length){this._index=this._items.length-1;return true;}}else if(this._index>0){this._index--;return true;}return false;};h.prototype.moveDown=function(){"use strict";if(this._index===undefined||this._index===this._items.length-1){if(this._items.length){this._index=0;return true;}}else if(this._index<this._items.length-1){this._index++;return true;}return false;};h.prototype.updateIndex=function(i,j){"use strict";this._items=i||[];if(j){var k=this._items.indexOf(j);if(k>=0){this._index=k;}else if(this._index!==undefined)if(this._items.length>0){this._index=Math.min(this._index,this._items.length-1);}else this._index=undefined;}else this._index=undefined;return this._index;};f.exports=h;}),null);
__d('WebMessengerShortcuts',['csx','cx','fbt','BanzaiODS','DialogX','DOM','KeyEventController','LayerHideOnEscape','ListInputTargetTracker','MercuryAPIArgsSource','MessagingTag','Parent','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','UserAgent_DEPRECATED','WebMessengerEvents','arrayContains','ge','getOrCreateDOMID','shield','MercuryThreadActions','MercuryThreads'],(function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercuryThreadActions').get(),l=c('MercuryThreads').get(),m=null,n=null,o=null,p={g:{callback:v,description:j._("Rechercher (dans) des conversations"),section:'searchAndHelp',uses_meta:true},m:{callback:u,description:j._("Commencer un nouveau message"),section:'navigation',uses_meta:true},i:{callback:da.bind(null,c('MessagingTag').INBOX),description:j._("Acc\u00e9der \u00e0 la bo\u00eete aux lettres"),section:'navigation',uses_meta:true},u:{callback:da.bind(null,c('MessagingTag').OTHER),description:j._("Acc\u00e9der \u00e0 Autres"),section:'navigation',uses_meta:true},z:{callback:x,description:j._("Archiver\/annuler l\u2019archive de la conversation"),otherKeys:['y'],section:'conversation',uses_meta:true},r:{callback:y,description:j._("Identifier le message comme lu\/non lu"),section:'conversation',uses_meta:true},UP:{callback:z,description:j._("S\u00e9lectionner la conversation suivante"),section:'navigation',uses_meta:false},DOWN:{callback:aa,description:j._("S\u00e9lectionner la conversation pr\u00e9c\u00e9dente"),section:'navigation',uses_meta:false},q:{callback:c('shield')(fa),description:j._("Afficher\/masquer les raccourcis clavier"),section:'searchAndHelp',uses_meta:true}},q={registerGeneralShortcuts:function ga(){n=new (c('ListInputTargetTracker'))();for(var ha in p){var ia=p[ha],ja=[ha];if(ia.otherKeys)ja=ia.otherKeys.concat(ja);for(var ka=0;ka<ja.length;ka++)c('KeyEventController').registerKey(ja[ka],ia.callback,t.bind(null,ia.uses_meta));}},updateThreadlistIndex:function ga(ha,ia,ja){m=ha;if(n){if(!c('arrayContains')(ia,ja))ja=null;n.updateIndex(ia,ja);}},openSearchThread:function ga(){var ha=ca(),ia=c('WebMessengerStateManager').getCurrentMasterState();if(ha&&ia==c('WebMessengerStateConstants').MASTER.SEARCH)m.openSearchThread(ha);},showOrHideShortcuts:fa};function r(){return c('UserAgent_DEPRECATED').osx()?'CTRL':'ALT';}function s(ga){function ha(){if(!o){var ia=c('DOM').find(document.body,"._ksg");o=[];do{ia=ia.parentNode;o.push(ia);}while(ia&&ia!==document.body);}return o;}if(!c('Parent').bySelector(ga,"._ksg"))if(!c('arrayContains')(ha(),ga))if(!c('DOM').scry(ga,"._5hu2").length)return false;return true;}function t(ga,event,ha){if(!c('KeyEventController').filterEventTypes(event,ha))return false;if(!s(event.getTarget()))return false;var ia;if(ga)switch(r()){case 'CTRL':ia='ctrlKey';break;case 'ALT':ia='altKey';break;}var ja=['ctrlKey','metaKey','altKey','shiftKey'];for(var ka=0;ka<ja.length;ka++)if(ja[ka]!==ia&&event[ja[ka]])return false;return !ga||event[ia];}function u(){c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.compose');c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN,{start:true});return false;}function v(){c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.search');c('WebMessengerEvents').focusAndSelectSearch();return false;}function w(ga){var ha;if(n.getNumItems()>1){var ia=n.getIndex();n.setIndex(ia===0?1:ia-1);ha=ca();}ga();c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{folder:c('WebMessengerStateManager').getCurrentStateData().folder,thread_id:ha});if(ha)m._manager.scrollIntoView(c('ge')(n.getItem()),false);}function x(){c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.toggle_archive');var ga=ca();if(ga){l.getThreadMeta(ga,function(ha){if(ha.folder==c('MessagingTag').SPAM)return;w(function(){if(ha.is_archived){k.unarchive(ha.thread_id);}else k.archive(ha.thread_id);});},c('MercuryAPIArgsSource').WEBMESSENGER);return false;}}function y(){var ga=ca();c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.toggle_read_status');if(ga){l.getThreadMeta(ga,function(ha){var ia=!ha.unread_count;ia?k.markUnread(ga):k.markRead(ga);},c('MercuryAPIArgsSource').WEBMESSENGER);return false;}}function z(){c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.go_to_next');if(n)if(n.getIndex()===0){switch(c('WebMessengerStateManager').getCurrentMasterState()){case c('WebMessengerStateConstants').MASTER.SEARCH:n.moveUp();ba();m._manager.scrollToBottom(false);break;default:m._manager.scrollToTop(false);c('WebMessengerEvents').focusSearch();}}else{if(n.getItem()){n.moveUp();}else n.moveDown();ba();}return false;}function aa(){c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.go_to_previous');var ga=c('WebMessengerStateManager').getCurrentMasterState();if(n&&(ga!==c('WebMessengerStateConstants').MASTER.RECENT_THREADS||n.getIndex()<n.getNumItems()-1)){n.moveDown();ba();}return false;}function ba(){var ga=ca();if(ga){var ha=c('WebMessengerStateManager').getCurrentMasterState();if(ha==c('WebMessengerStateConstants').MASTER.SEARCH){m.updateKeyboardSelection(ga);c('WebMessengerEvents').focusSearch();}else c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{thread_id:ga});if(n)if(n.getIndex()===0){m._manager.scrollToTop(false);}else m._manager.scrollIntoView(c('ge')(n.getItem()),false);}}function ca(){var ga=n&&n.getItem();if(typeof ga==='string'&&ga.indexOf(':')!==-1)return ga.substr(ga.indexOf(':')+1);return null;}function da(ga){if(ga===c('MessagingTag').INBOX){c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.go_to_inbox');}else if(ga===c('MessagingTag').OTHER)c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.go_to_other');var ha=c('WebMessengerStateManager').getCurrentMasterState(),ia=ha==c('WebMessengerStateConstants').MASTER.SEARCH?null:c('WebMessengerStateManager').getCurrentStateData().thread_id;c('WebMessengerStateManager').updateMasterState(c('WebMessengerStateConstants').MASTER.RECENT_THREADS,{thread_id:ia,folder:ga});}var ea;function fa(ga){c('BanzaiODS').bumpEntityKey('kbshorts_messenger','kbshorts.show_or_hide_shortcuts');if(!ea){var ha={};for(var ia in p){var ja=p[ia];if(!ja.uses_meta)continue;var ka=c('WebMessengerTemplates')[':fb:web-messenger:shortcuts-dialog:row'].build(),la=[ia],ma=[];if(ja.otherKeys)la=ja.otherKeys.concat(la);for(var na=0;na<la.length;na++){var oa=c('WebMessengerTemplates')[':fb:web-messenger:shortcuts-dialog:key'].build();oa.setNodeContent('meta',r());oa.setNodeContent('key',la[na]);ma.push(oa.getRoot());}ka.setNodeContent('keys',ma);ka.setNodeContent('description',ja.description);if(!ha[ja.section])ha[ja.section]=[];ha[ja.section].push(ka.getRoot());}var pa=c('WebMessengerTemplates')[':fb:web-messenger:shortcuts-dialog'].build();for(var qa in ha)pa.setNodeContent(qa,ha[qa]);var ra=c('DOM').scry(pa.getRoot(),"._1yw")[0],sa=null;if(ra)sa=c('getOrCreateDOMID')(ra);ea=new (c('DialogX'))({modal:true,titleID:sa,width:565},pa.getRoot());ea.enableBehavior(c('LayerHideOnEscape'));}if(ea.isShown()){ea.hide();}else{ea.show();if(typeof ga==='function')ea.subscribeOnce('hide',ga);}return false;}f.exports=q;}),null);
__d("XMessagingLeaveConversationDialogController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/leave_conversation\/",{__asyncDialog:{type:"Int"}});}),null);
__d("XNFXStartForMessageThreadController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/nfx\/start_message_thread\/",{thread_fbid:{type:"String",required:true},responsible_fbid:{type:"Int"},av:{type:"Int"},location:{type:"Enum",enumType:1},__asyncDialog:{type:"Int"}});}),null);
__d('WebMessengerDetailViewActionsMenuControl',['fbt','WebMessengerAddPeopleToConversationDialog','AsyncDialog','AsyncRequest','Bootloader','ChatEditParticipantsUtils','ChatOpenTab','ChatOpenTabEventLogger','ContextualDialogArrow','CSS','CurrentUser','WebMessengerDeleteThreadDialog','DOM','WebMessengerEditThreadDialog','Event','FantaTabActions','FBRTCCallabilityStore','FBRTCCore','FBRTCVideoCallButtonManager','Input','Keys','Menu','MenuSeparator','MercuryAPIArgsSource','MercuryBlockedParticipants','MercuryConfig','MercuryIDs','MercuryLogMessageType','MercuryParticipants','MercurySourceType','MercuryThreadIDMap','MercuryThreadInfo','MercuryThreadMuter','MercuryViewer','MercuryMessageActions','MercuryMessageObject','MessagingTag','MessengerAdminGroupUtils','Popover','PopoverMenu','WebMessengerShortcuts','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','MercuryThreadActions','MercuryThreadInformer','MercuryThreads','Toggler','URI','WebMessengerActionsMenuItem','WebMessengerSubscriptionsHandler','WorkModeConfig','XEventCreateDialogController','XMessagingLeaveConversationDialogController','XNFXStartForMessageThreadController','XUIMenuTheme','emptyFunction','goURI'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('FBRTCVideoCallButtonManager').module,j=c('MercuryBlockedParticipants').get(),k=c('MercuryThreadIDMap').get(),l=c('MercuryMessageActions').get(),m=c('MercuryMessageObject').get(),n=c('MercuryThreadActions').get(),o=c('MercuryThreadInformer').get(),p=c('MercuryThreads').get();function q(jb,kb){'use strict';this._rootElement=jb;this._headerControl=kb;this._menuTemplate=c('WebMessengerTemplates')[':fb:web-messenger:actions-menu'].build();this._newMessageButton=this._menuTemplate.getNode('newMessageButton');this._actionsMenu=this._menuTemplate.getNode('menu');this._searchThreadInput=this._menuTemplate.getNode('searchThreadInput');this._searchThreadButton=this._menuTemplate.getNode('searchThreadButton');this._searchCloseButton=this._menuTemplate.getNode('searchCloseButton');this._videoCallButton=this._menuTemplate.getNode('videoCallButton');var lb=this._menuTemplate.getNode('actionsButton'),mb=function(event){if(!this._searchMode){s(this,true);}else{var nb=c('Input').getValue(this._searchThreadInput);if(nb){var ob=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{message_query:nb});c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET,ob);this._searchThreadInput.focus();}else s(this,false);}event.kill();}.bind(this);c('WebMessengerSubscriptionsHandler').addSubscriptions(o.subscribe('threads-updated',function(nb,ob){ob[this._threadID]&&this.updateView();}.bind(this)),c('Event').listen(this._menuTemplate.getNode('newMessageButton'),'click',function(){c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN,babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{start:true,thread_id:undefined}));}),c('Event').listen(this._actionsMenu,'keydown',function(event){if(event.keyCode===c('Keys').ESC){lb.focus();event.preventDefault();}}),c('Event').listen(this._searchThreadButton,'mousedown',mb),c('Event').listen(this._searchThreadButton,'keydown',function(event){if(event.keyCode===c('Keys').RETURN||event.keyCode===c('Keys').SPACE)mb(event);}),c('Event').listen(this._searchThreadButton,'click',c('emptyFunction').thatReturnsFalse),c('Event').listen(this._searchCloseButton,'keydown',function(event){if(event.keyCode===c('Keys').RETURN||event.keyCode===c('Keys').SPACE){u(this);this._menuTemplate.getNode('searchThreadButton').focus();}}.bind(this)),c('Event').listen(this._searchCloseButton,'mousedown',function(event){u(this);}.bind(this)),c('Event').listen(this._searchThreadInput,'blur',function(event){var nb=c('Input').getValue(this._searchThreadInput);if(!nb)s(this,false);}.bind(this)),c('Event').listen(this._searchThreadInput,'keyup',function(event){var nb=c('Input').getValue(this._searchThreadInput),ob=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{message_query:nb});if(event.keyCode==c('Keys').RETURN&&nb)c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET,ob);if(event.keyCode==c('Keys').ESC)c('Input').reset(this._searchThreadInput);}.bind(this)),c('Event').listen(this._videoCallButton,'click',function(){i.onCallClicked(this._threadID,'web_messenger');}.bind(this)),c('FBRTCCallabilityStore').addListener(function(){i.updateVideoCallButton(this._videoCallButton,this._threadID);}.bind(this)));this.initItems();c('DOM').setContent(this._rootElement,this._menuTemplate.getRoot());}q.prototype.initItems=function(){'use strict';var jb=this._menuTemplate.getNode('actionsButton'),kb=this._menuTemplate.getNode('newMessageButton'),lb=function nb(){jb.focus();},mb=function nb(){kb.focus();};this.menuItems=[];this.menuItems.push({ctor:c('WebMessengerActionsMenuItem'),label:h._("Inviter des personnes..."),onclick:ra,should_show_fn:w},{ctor:c('WebMessengerActionsMenuItem'),label:h._("Modifier les participants..."),onclick:sa,should_show_fn:w},{ctor:c('WebMessengerActionsMenuItem'),hideManually:true,label:h._("Modifier le nom de la conversation..."),onclick:ua.bind(null,this),should_show_fn:aa},{ctor:c('WebMessengerActionsMenuItem'),hideManually:true,label:h._("Changer l\u2019image de la conversation"),onclick:ua.bind(null,this),should_show_fn:aa},{ctor:c('WebMessengerActionsMenuItem'),label:h._("Quitter la conversation..."),onclick:ta,should_show_fn:w},{ctor:c('MenuSeparator'),should_show_fn:w});this.menuItems.push({ctor:c('WebMessengerActionsMenuItem'),hideManually:true,label:h._("Ouvrir dans la discussion instantan\u00e9e"),onclick:x,should_show_fn:c('ChatOpenTab').canOpenTab},{ctor:c('WebMessengerActionsMenuItem'),label:h._("Afficher les photos dans la discussion"),onclick:pa},{ctor:c('WebMessengerActionsMenuItem'),label:h._("Marquer comme lu(s)"),onclick:db.bind(null,lb),should_show_fn:la},{ctor:c('WebMessengerActionsMenuItem'),label:h._("Marquer comme non lu(s)"),onclick:cb.bind(null,lb),should_show_fn:ga(la)});this.menuItems.push({ctor:c('MenuSeparator')},{ctor:c('WebMessengerActionsMenuItem'),label:c('WorkModeConfig').use_workplace?h._("D\u00e9placer dans Workplace"):h._("D\u00e9placer vers le compte professionnel"),onclick:ea,should_show_fn:da},{ctor:c('WebMessengerActionsMenuItem'),label:h._("Archiver"),onclick:xa.bind(null,mb),should_show_fn:ga(ka)},{ctor:c('WebMessengerActionsMenuItem'),label:h._("Retirer de l\u2019archive"),onclick:ya.bind(null,mb),should_show_fn:ka},{ctor:c('WebMessengerActionsMenuItem'),label:h._("Mettre la conversation en sourdine..."),onclick:function nb(ob){c('MercuryThreadMuter').showMuteChangeDialog(ob,jb);},should_show_fn:ga(c('MercuryThreadInfo').isMuted)},{ctor:c('WebMessengerActionsMenuItem'),label:h._("Reprendre la conversation"),onclick:t.bind(null,lb),should_show_fn:c('MercuryThreadInfo').isMuted},{ctor:c('WebMessengerActionsMenuItem'),label:h._("D\u00e9placer vers la bo\u00eete de r\u00e9ception"),onclick:z.bind(null,mb,c('MessagingTag').INBOX),should_show_fn:y.bind(null,c('MessagingTag').OTHER)},{ctor:c('WebMessengerActionsMenuItem'),hideManually:true,label:h._("Supprimer la conversation..."),onclick:fa},{ctor:c('WebMessengerActionsMenuItem'),label:h._("Supprimer les messages..."),onclick:eb});this.menuItems.push({ctor:c('MenuSeparator')},{ctor:c('WebMessengerActionsMenuItem'),label:h._("Cr\u00e9er un groupe..."),onclick:ab,should_show_fn:ba},{ctor:c('WebMessengerActionsMenuItem'),label:h._("Cr\u00e9er un \u00e9v\u00e8nement..."),onclick:bb,should_show_fn:ca},{ctor:c('WebMessengerActionsMenuItem'),label:h._("Bloquer les messages..."),onclick:na.bind(null),should_show_fn:ha},{ctor:c('WebMessengerActionsMenuItem'),label:h._("D\u00e9bloquer les messages..."),onclick:va.bind(null),should_show_fn:ia},{ctor:c('WebMessengerActionsMenuItem'),label:h._("Signaler du contenu ind\u00e9sirable ou un abus..."),onclick:oa.bind(null,lb),should_show_fn:ga(ja)},{ctor:c('WebMessengerActionsMenuItem'),label:h._("Non ind\u00e9sirable"),onclick:qa.bind(null,mb),should_show_fn:ja},{ctor:c('WebMessengerActionsMenuItem'),hideManually:true,label:h._("Raccourcis clavier"),onclick:ib.bind(null,lb)},{ctor:c('WebMessengerActionsMenuItem'),label:h._("Feedback"),onclick:c('goURI').bind(null,'/help/?page=134259426717336')});this._menu=new (c('Menu'))(this.menuItems,{theme:c('XUIMenuTheme')});this._popover=new (c('PopoverMenu'))(new (c('Popover'))(jb.parentNode,jb,[c('ContextualDialogArrow')],{alignh:'right'}),jb,this._menu);v(function(nb){if(!nb)return;var ob=[{ctor:c('MenuSeparator')},{ctor:c('WebMessengerActionsMenuItem'),label:'Enable bug reporting',onclick:fb.bind(null,lb),should_show_fn:ga(ma)},{ctor:c('WebMessengerActionsMenuItem'),label:'Disable bug reporting',onclick:gb.bind(null,lb),should_show_fn:ma}];Array.prototype.push.apply(this.menuItems,ob);ob.forEach(function(pb){this._menu.addItem(new pb.ctor(pb));},this);}.bind(this));};q.prototype.hideView=function(){'use strict';c('CSS').hide(this._rootElement);};q.prototype.updateView=function(){'use strict';this.hideView();var jb=c('WebMessengerStateManager').getCurrentDetailState(),kb=false,lb=false,mb=false,nb=false,ob=false,pb=false;switch(jb){case c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN:case c('WebMessengerStateConstants').DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:r(this);this._threadID=null;break;case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:if(this._state!==jb)r(this);var qb=c('WebMessengerStateManager').getCurrentStateData().thread_id;kb=true;if(this._searchMode&&this._threadID===qb){nb=true;}else{r(this);lb=true;mb=true;}this._threadID=qb;if(this._threadID)ob=true;break;case c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET:var rb=c('WebMessengerStateManager').getCurrentStateData();c('Input').setValue(this._searchThreadInput,rb.message_query);this._threadID=rb.thread_id;kb=true;nb=true;pb=true;break;case c('WebMessengerStateConstants').DETAIL.SHARED_PHOTOS:var sb=c('WebMessengerStateManager').getCurrentStateData();this._threadID=sb.thread_id;kb=true;lb=true;mb=true;ob=true;break;default:r(this);kb=true;lb=true;this._threadID=null;break;}this._state=jb;c('CSS').conditionShow(this._searchThreadInput,nb);c('CSS').conditionShow(this._searchThreadButton,ob);c('CSS').conditionShow(this._searchCloseButton,pb);c('CSS').conditionShow(this._newMessageButton,lb);c('CSS').conditionShow(this._rootElement,kb);i.updateVideoCallButton(this._videoCallButton,this._threadID);c('CSS').conditionShow(this._videoCallButton,i.isVideoCallableThread(this._threadID)&&!this._searchMode&&c('FBRTCCore').shouldEnableVideoCalling());this._threadSubscription&&p.unsubscribe(this._threadSubscription);if(mb&&this._threadID){this._threadSubscription=p.getThreadMeta(this._threadID,function(tb){this._menu.forEachItem(function(ub){return ub.updateShownState&&ub.updateShownState(tb);});c('CSS').show(this._menuTemplate.getNode('menu'));c('CSS').show(this._rootElement);}.bind(this),c('MercuryAPIArgsSource').WEBMESSENGER);}else c('CSS').hide(this._menuTemplate.getNode('menu'));};q.prototype.destroy=function(){'use strict';};function r(jb){jb._searchMode=false;c('Input').reset(jb._searchThreadInput);}function s(jb,kb){if(kb){jb._searchMode=true;}else r(jb);c('CSS').conditionShow(jb._newMessageButton,!kb);c('CSS').conditionShow(jb._videoCallButton,!kb&&i.isVideoCallableThread(jb._threadID));c('CSS').conditionShow(jb._actionsMenu,!kb);c('CSS').conditionShow(jb._searchThreadInput,kb);if(kb){jb._searchThreadInput.focus();c('Toggler').hide(this._actionsMenu);}}function t(jb,kb){n.unmute(kb);c('Toggler').hide();jb();}function u(jb){s(jb,false);c('CSS').conditionShow(jb._searchThreadButton,true);c('CSS').conditionShow(jb._searchCloseButton,false);var kb=c('WebMessengerStateManager').getCurrentDetailState();if(kb!==c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES)c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{thread_id:c('WebMessengerStateManager').getCurrentStateData().thread_id});}function v(jb){c('MercuryParticipants').get(c('MercuryViewer').getID(),function(kb){jb(kb&&kb.employee);});}function w(jb){return !jb.is_canonical&&jb.is_subscribed&&!jb.has_email_participant&&!jb.read_only;}function x(jb){c('Toggler').hide();if(c('MercuryConfig').FantaTabs){c('FantaTabActions').openTab(jb);c('ChatOpenTabEventLogger').log('WebMessengerDetailViewActionsMenuControl',jb);}else c('ChatOpenTab').openThread(jb,'WebMessengerDetailViewActionsMenuControl');}function y(jb,kb){return !kb.is_archived&&kb.folder==jb;}function z(jb,kb,lb){n.changeFolder(lb,kb);hb();jb();}function aa(jb){var kb=c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID()),lb=c('MessengerAdminGroupUtils').canUpdateThreadCustomization(jb,kb);return lb&&w(jb);}function ba(jb){var kb=za(jb.participants);return kb.length>2;}function ca(jb){var kb=za(jb.participants);return kb.length>2;}function da(jb){if(!c('CurrentUser').isEmployee()||!c('CurrentUser').hasWorkUser()||!c('MercuryIDs').isGroupChat(jb.thread_id))return false;var kb=jb.participants;for(var lb=0;lb<kb.length;++lb){var mb=c('MercuryParticipants').getNow(kb[lb]);if(!mb||!mb.employee)return false;}return true;}function ea(jb){if(!p.isEmptyLocalThread(jb)){var kb=m.constructLogMessageObject(c('MercurySourceType').MESSENGER_WEB,jb,c('MercuryLogMessageType').SWITCH_TO_WORK,{removed_participants:[c('MercuryViewer').getID()]});l.send(kb,null,c('MercuryAPIArgsSource').WEBMESSENGER);hb();}return true;}function fa(jb){c('Toggler').hide();c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,c('WebMessengerStateManager').getCurrentStateData());c('WebMessengerDeleteThreadDialog').show(jb);}function ga(jb){return function(){return !jb.apply(this,arguments);};}function ha(jb){return jb.is_canonical&&!j.isMessageBlocked(jb);}function ia(jb){return jb.is_canonical&&j.isMessageBlocked(jb);}function ja(jb){return jb.folder===c('MessagingTag').SPAM;}function ka(jb){return jb.is_archived;}function la(jb){return jb.unread_count>0;}function ma(){return c('WebMessengerStateManager').getCurrentStateData().bug_reporting_enabled;}function na(jb){n.blockMessages(jb);}function oa(jb,kb){k.getServerIDFromClientID(kb,function(lb){var mb=c('XNFXStartForMessageThreadController').getURIBuilder().setString('thread_fbid',lb).getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(mb));});}function pa(jb){c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.SHARED_PHOTOS,babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData()));}function qa(jb,kb){n.unmarkSpam(kb);hb();jb();}function ra(jb){c('WebMessengerAddPeopleToConversationDialog').show(jb);}function sa(jb){c('ChatEditParticipantsUtils').showParticipantsModal(jb);}function ta(jb){var kb=c('XMessagingLeaveConversationDialogController').getURIBuilder().getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(kb),function(lb){lb.subscribe('confirm',function(){wa(jb);lb.hide();});});}function ua(jb,kb){c('Toggler').hide();var lb=new (c('WebMessengerEditThreadDialog'))();lb.toggleShown(jb._headerControl?jb._headerControl._headerBar.getNode('headerName'):jb._rootElement,kb);}function va(jb){var kb=p.getThreadMetaNow(jb);if(!kb)return;var lb=c('MercuryIDs').getParticipantIDFromFromThreadID(jb);c('MercuryParticipants').get(lb,function(mb){c('Bootloader').loadModules(["MessageBlockedDialog"],function(nb){nb.show(jb,kb.can_reply,j.isMessageBlocked(kb),mb.short_name);},'WebMessengerDetailViewActionsMenuControl');});}function wa(jb){l.send(m.constructLogMessageObject(c('MercurySourceType').TITAN_WEB,jb,c('MercuryLogMessageType').UNSUBSCRIBE,{removed_participants:[c('MercuryViewer').getID()]}),null,c('MercuryAPIArgsSource').WEBMESSENGER);return true;}function xa(jb,kb){n.archive(kb);hb();jb();}function ya(jb,kb){n.unarchive(kb);hb();jb();}function za(jb){var kb=[];for(var lb=0;lb<jb.length;lb++){var mb=jb[lb];if(/^fbid:\d+$/.test(mb))kb.push(mb.substr(5));}return kb;}function ab(jb){p.getThreadMeta(jb,function(kb){var lb=za(kb.participants),mb=new (c('URI'))('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger',members:lb,message_thread_fbid:kb.thread_fbid,parent_id:'0'});c('AsyncDialog').send(new (c('AsyncRequest'))(mb));},c('MercuryAPIArgsSource').WEBMESSENGER);}function bb(jb){p.getThreadMeta(jb,function(kb){var lb=za(kb.participants),mb=c('XEventCreateDialogController').getURIBuilder().setString('acontext',JSON.stringify({})).setIntVector('invite_ids',lb).getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(mb));},c('MercuryAPIArgsSource').WEBMESSENGER);}function cb(jb,kb){n.markUnread(kb);c('Toggler').hide();jb();}function db(jb,kb){n.markRead(kb);c('Toggler').hide();jb();}function eb(){var jb=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{message_action:c('WebMessengerStateConstants').MESSAGE_ACTION.DELETE});c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateManager').getCurrentDetailState(),jb);}function fb(jb){var kb=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{bug_reporting_enabled:true});c('Toggler').hide();c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateManager').getCurrentDetailState(),kb);jb();}function gb(jb){var kb=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{bug_reporting_enabled:false});c('Toggler').hide();c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateManager').getCurrentDetailState(),kb);jb();}function hb(){c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{folder:c('WebMessengerStateManager').getCurrentStateData().folder});}function ib(jb){c('Toggler').hide();c('WebMessengerShortcuts').showOrHideShortcuts(jb);}f.exports=q;}),null);
__d('ExpandableDataSource',['DataSource'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('DataSource'));i=h&&h.prototype;function j(k,l,m){'use strict';k=k||{};k.maxResults=l;i.constructor.call(this,k);this._initialLimit=l;this._moreResultsLimit=m;this._states={};}j.prototype.query=function(k,l,m){'use strict';this.setQueryData({offset:0,limit:this._initialLimit});i.query.call(this,k,l,m);};j.prototype.fetchHandler=function(k,l){'use strict';var m=k.getPayload(),n=l.value;this.getState('is_loading_more_per_query')[n]=false;this.getState('total_results_count_per_query')[n]=m.total_count;i.fetchHandler.call(this,k,l);};j.prototype.loadMore=function(){'use strict';if(this.value&&!this.hasLoadedAllResults()){var k=this.getState('max_results_per_query');if(!k[this.value])k[this.value]=this._initialLimit;this.setQueryData({offset:k[this.value],limit:this._moreResultsLimit});k[this.value]+=this._moreResultsLimit;if(k[this.value]>this._maxResults)this._maxResults=k[this.value];this.getState('is_loading_more_per_query')[this.value]=true;this.fetch(this.queryEndpoint,this.getQueryData(this.value,this.buildUids(this.value)),{value:this.value});}};j.prototype.isLoadingMore=function(){'use strict';return this.getState('is_loading_more_per_query')[this.value];};j.prototype.hasLoadedAllResults=function(){'use strict';var k=this.getState('total_results_count_per_query')[this.value],l=(this.buildQueryResults(this.value)||[]).length;return k&&l>=k;};j.prototype.getStates=function(){'use strict';return this._states;};j.prototype.getState=function(k){'use strict';var l=this.getStates();if(!l[k])l[k]={};return l[k];};j.prototype.getQueryCache=function(){'use strict';return this.getState('query_cache');};f.exports=j;}),null);
__d('WebMessengerDetailViewAllPeopleResultsControl',['csx','cx','CSS','DataStore','DOM','Event','ExpandableDataSource','MercuryIDs','Parent','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','Token','WebMessengerEvents','WebMessengerSubscriptionsHandler'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=5,k=5;function l(q){'use strict';this._rootElement=q;c('DOM').empty(this._rootElement);var r=c('WebMessengerTemplates')[':fb:web-messenger:all-people-results'].build();c('DOM').setContent(this._rootElement,r.getRoot());this._loadingSpinner=r.getNode('loadingSpinner');this._peopleResults=r.getNode('results');this._loadMoreButton=r.getNode('loadMoreButton');this._loadMoreLink=r.getNode('loadMoreLink');c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(this._loadMoreLink,'click',function(){c('CSS').addClass(this._loadMoreButton,'async_saving');this._peopleDataSource&&this._peopleDataSource.loadMore();}.bind(this)));}l.prototype.hideView=function(){'use strict';c('CSS').hide(this._rootElement);};l.prototype.updateView=function(){'use strict';var q=c('WebMessengerStateManager').getCurrentDetailState();if(q==c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){c('CSS').show(this._rootElement);m(this);c('WebMessengerEvents').detailDOMChanged();}};l.prototype.destroy=function(){'use strict';};function m(q){c('CSS').show(q._loadingSpinner);c('CSS').hide(q._peopleResults);c('CSS').hide(q._loadMoreButton);var r=c('WebMessengerStateManager').getCurrentStateData(),s=r.all_people_query||'';n(q);var t=(r.participants||[]).map(function(u){return c('MercuryIDs').tokenize(u).value;});q._peopleDataSource.setExclusions(t);q._peopleDataSource.query(s);}function n(q){if(!q._peopleDataSource){q._peopleDataSource=new (c('ExpandableDataSource'))({queryEndpoint:'/ajax/mercury/search_people.php'},j,k);q._peopleDataSource.init();c('WebMessengerSubscriptionsHandler').addSubscriptions(q._peopleDataSource.subscribe('respond',o.bind(null,q)),c('Event').listen(q._rootElement,'click',function(event){var r=event.getTarget().parentNode;if(c('CSS').matchesSelector(r,"._4wt"))p(event.getTarget(),q._peopleDataSource);}));}}function o(q,r,s){var t=c('WebMessengerStateManager').getCurrentDetailState(),u=c('WebMessengerStateManager').getCurrentStateData();if(t==c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS&&u.all_people_query==s.value){c('DOM').empty(q._peopleResults);c('CSS').show(q._peopleResults);s.results.forEach(function(v){var w=c('DOM').create('div',{className:'personResult'},v.detail_markup);c('DataStore').set(w,'uid',v.uid);c('DOM').appendContent(q._peopleResults,w);});if(s.results.length){c('CSS').hide(q._loadingSpinner);c('CSS').conditionShow(q._loadMoreButton,!q._peopleDataSource.hasLoadedAllResults());c('CSS').conditionClass(q._loadMoreButton,'async_saving',q._peopleDataSource.isLoadingMore());}}}function p(q,r){var s=c('Parent').byClass(q,'personResult'),t=r.getEntry(c('DataStore').get(s,'uid')),u=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{new_tokens:[new (c('Token'))(t)],start:false});c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN,u);}f.exports=l;}),null);
__d('Ellipsizer',['cx','CSS','Style','UserAgent_DEPRECATED','getElementText'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=1;function j(k){this.elements=[];this.descend=true;k.forEach(function(l){c('CSS').addClass(l,"_6qy");this.elements.push({node:l});},this);return this;}j.prototype.setDescend=function(k){this.descend=k;return this;};j.prototype.$Ellipsizer1=function(){var k=void 0;this.elements.forEach(function(l){k=l.node;if(this.descend)while(k.children.length===1)k=k.children[0];if(k===l.node)c('Style').set(k,'width','');c('UserAgent_DEPRECATED').ie()&&c('Style').set(k,'position','absolute');l.width=k.offsetWidth;c('UserAgent_DEPRECATED').ie()&&c('Style').set(k,'position','');},this);this.elements.sort(function(l,m){return l.width-m.width;});};j.prototype.confineWithin=function(k,l){l=l||i;this.$Ellipsizer1();var m=k;this.elements.forEach(function(n,o){var p=Math.floor(m/(this.elements.length-o));if(n.width<=p||n.width<=0||p<=0||n.width<=p*l&&m>=p*l){c('CSS').removeClass(n.node,"_6s5");c('Style').set(n.node,'width','');m-=n.width;if(n.titleSet){n.node.setAttribute('title','');n.titleSet=false;}}else{c('CSS').addClass(n.node,"_6s5");c('Style').set(n.node,'width',p+'px');m-=p;if(!n.titleSet&&!n.node.getAttribute('title')){n.node.setAttribute('title',c('getElementText')(n.node));n.titleSet=true;}}},this);};f.exports=j;}),null);
__d('MercuryReadOnlyReason',['fbt','Link.react','MercuryConfig','React','URI'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={getReason:function j(){var k=arguments.length<=0||arguments[0]===undefined?false:arguments[0];if(k){var l=c('MercuryConfig').DYIDeepLink;return h._("D\u00e9sol\u00e9, cette conversation n\u2019est plus active, car les messages ne sont plus envoy\u00e9s aux adresses e-mail. Depuis le 1er mai 2016, les conversations avec des adresses e-mail ne sont disponibles que dans une copie de vos donn\u00e9es Facebook. {download your information}.",[h.param('download your information',c('React').createElement('a',{href:l},h._("En savoir plus")))]);}else if(c('MercuryConfig').ViewerIsReadOnly){return h._("Vous ne pouvez plus envoyer de messages pour le moment. {learn more about blocks}",[h.param('learn more about blocks',c('React').createElement(c('Link.react'),{href:new (c('URI'))('https://www.facebook.com/help/181183045316843'),target:'_blank'},'Learn more'))]);}else if(c('MercuryConfig').ColdOpenBlock){return h._("Vous n\u2019\u00eates pas autoris\u00e9(e) \u00e0 commencer de nouvelles conversations pour le moment. {learn more about blocks}",[h.param('learn more about blocks',c('React').createElement(c('Link.react'),{href:new (c('URI'))('https://www.facebook.com/help/181183045316843'),target:'_blank'},'Learn more'))]);}else return h._("Vous ne pouvez pas r\u00e9pondre \u00e0 cette conversation");}};f.exports=i;}),null);
__d('MessagesEmoticonView',['csx','cx','DOM','EmoticonsList','Event','Focus','InputSelection','Keys','Parent','SubscriptionsHandler','TextAreaControl','Toggler','UserAgent_DEPRECATED'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('EmoticonsList').symbols;function k(n){return c('Parent').bySelector(n,"._5r8h");}function l(n,o,p,q){var r=c('Parent').byClass(n,'emoticon');if(!r)return;var s='emoticon_',t=null;r.className.split(' ').forEach(function(aa){if(aa.startsWith(s))t=aa.substring(s.length);});if(!j[t])return;if(!q)return true;var u=c('TextAreaControl').getInstance(o),v=u.getValue(),w=j[t],x=v.substring(0,p.start),y=v.substring(p.end);if(p.start>0&&!x.endsWith(' '))w=' '+w;if(!y.startsWith(' '))w+=' ';var z=x+w+y;p.start+=w.length;p.end=p.start;u.setValue(z);c('InputSelection').set(o,p.start,p.end);return true;}function m(n,o){var p={start:0,end:0};function q(){p=c('InputSelection').get(o);}var r=c('DOM').find(n,'.uiToggleFlyout');this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(c('Toggler').subscribe('show',function(s,t){if(t.active&&c('DOM').contains(n,t.active)){c('InputSelection').set(o,p.start,p.end);var u=c('DOM').scry(r,'a.emoticon')[0];u&&c('Focus').setWithoutOutline(u);}}),c('Event').listen(r,'click',function(event){l(event.getTarget(),o,p,true);}),c('Event').listen(r,'keyup',function(event){if(event.keyCode===c('Keys').ESC){c('Toggler').hide(n);c('InputSelection').set(o,p.start,p.end);}}),c('Event').listen(o,'keyup',q),c('Event').listen(o,'click',q));if(c('UserAgent_DEPRECATED').chrome()||c('UserAgent_DEPRECATED').ie()||c('UserAgent_DEPRECATED').opera())this._subscriptions.addSubscriptions(c('Event').listen(r,'mousedown',function(event){var s=c('Event').listen(document.documentElement,'click',function(event){var t=event.getTarget(),u=l(t,o,p,false),v=k(t);!u&&!v&&c('Toggler').show(n);s.remove();});}.bind(this)));}Object.assign(m.prototype,{destroy:function n(){this._subscriptions&&this._subscriptions.release();this._subscriptions=null;}});Object.assign(m,{create:function n(o,p){return new m(o,p);}});f.exports=m;}),null);
__d('MessagesEmoticons.react',['cx','fbt','Grid.react','React','emptyFunction'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('Grid.react').GridItem,m=c('React').PropTypes,n=8,o={smile:i._("sourire"),frown:i._("s\u00e9v\u00e8re"),tongue:i._("langue"),grin:i._("grimace"),gasp:i._("surprise"),wink:i._("clin d\u2019\u0153il"),pacman:i._("pacman"),grumpy:i._("f\u00e2ch\u00e9"),unsure:i._("doute"),cry:i._("en pleur"),kiki:i._("kiki"),glasses:i._("lunettes"),sunglasses:i._("lunettes de soleil"),heart:i._("c\u0153ur"),devil:i._("diable"),angel:i._("ange"),squint:i._("louche"),confused:i._("confus"),upset:i._("en col\u00e8re"),colonthree:i._("heureux"),like:i._("J\u2019aime")};j=babelHelpers.inherits(p,c('React').Component);k=j&&j.prototype;function p(){var q,r;'use strict';for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return r=(q=k.constructor).call.apply(q,[this].concat(t)),this.getEmoticons=function(){return Object.keys(o).map(function(v){return (c('React').createElement(l,{key:v},c('React').createElement('div',{className:"panelCell"},c('React').createElement('a',{'aria-label':o[v],className:'emoticon emoticon_'+v,onClick:function(){return this.props.onEmoticonSelect(v);}.bind(this)}))));}.bind(this));}.bind(this),r;}p.prototype.render=function(){'use strict';return (c('React').createElement('div',{className:"emoticonsTable"},c('React').createElement(c('Grid.react'),{cols:n,alignv:'middle',alignh:'center',spacing:'pam'},this.getEmoticons())));};p.propTypes={onEmoticonSelect:m.func};p.defaultProps={onEmoticonSelect:c('emptyFunction')};f.exports=p;}),null);
__d('StickersFlyoutPackSelector.react',['cx','fbt','ix','Animation','CurrentUser','Image.react','Locale','React','ReactDOM','Relay','RelayMutation','RelayMutationType','RelayQL','RelayStore','StickersConfig','StickersActions','StickersStoreController','StickerConstants','StickerInterfaces','XUIBadge.react','emptyFunction','getObjectValues','getViewerRecordID'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l,m,n;if(c.__markCompiled)c.__markCompiled();var o=c('React').PropTypes,p=4,q=200,r=i._("Magasin d\u2019autocollants"),s=function w(x){if(x.id==c('StickerConstants').SEARCH_PACK_ID)return j('/images/messaging/stickers/icons/search.png');if(x.id==c('StickerConstants').MRU_STICKER_PACK)return j('/images/messaging/stickers/icons/recent.png');if(x.id==c('StickerConstants').EMOTICON_PACK_ID)return j('/images/messaging/stickers/icons/emoji.png');if(x.id==c('StickerConstants').OZ_PACK_ID)return x.icon;return x.thumbnail_image?x.thumbnail_image.uri:null;},t=function w(x){var y=x.pack,z=c('StickersConfig').search_pack?x.index===1||x.index===2:x.index===1,aa="_5r8a"+(x.selected?' '+"_5r8b":'')+(y.id==c('StickerConstants').MRU_STICKER_PACK?' '+"_5qcj":'')+(y.id==c('StickerConstants').SEARCH_PACK_ID?' '+"_5qck":'')+(z?' '+"_eb3":''),ba=x.isComments&&!y.is_comments_capable&&y.id!==c('StickerConstants').MRU_STICKER_PACK&&y.id!==c('StickerConstants').SEARCH_PACK_ID&&y.id!==c('StickerConstants').EMOTICON_PACK_ID,ca=i._("Ce pack est disponible uniquement dans les photos"),da=i._("Ce pack est disponible uniquement dans les messages"),ea=ba?c('emptyFunction'):function(){return x.onClick(y.id);},fa=s(y);if(fa===null)return null;var ga=!y.is_messenger_capable&&y.is_composer_capable?ca:da;return (c('React').createElement('a',{'aria-label':ba?ga:y.name,className:aa,'data-id':y.id,'data-hover':'tooltip','data-tooltip-content':ba?ga:y.name,onClick:ea,tabIndex:'0'},c('React').createElement(c('Image.react'),{className:(ba?"_2ji6":'')+(' '+"_5r8c")+(c('StickersConfig').search_pack?' '+"_1viy":''),src:fa})));};t.propTypes={index:o.number,isComments:o.bool,onClick:o.func,pack:o.object.isRequired,selected:o.bool};t.defaultProps={isComments:false,onClick:c('emptyFunction')};k=babelHelpers.inherits(u,c('React').Component);l=k&&k.prototype;function u(){var w,x;for(var y=arguments.length,z=Array(y),aa=0;aa<y;aa++)z[aa]=arguments[aa];return x=(w=l.constructor).call.apply(w,[this].concat(z)),this.state={animating:false,page:0},this.onFlyoutShown=function(){if(this.$StickersFlyoutPackSelector2().length>0){var ba=this.$StickersFlyoutPackSelector3(this.props.selectedPackID);if(this.state.page!==ba)this.$StickersFlyoutPackSelector4(ba,0);}}.bind(this),this.$StickersFlyoutPackSelector1=function(){var ba=this.$StickersFlyoutPackSelector2();if(ba.length>0){this.$StickersFlyoutPackSelector5(ba[0].id);}else c('StickersActions').trayLoaded();}.bind(this),this.$StickersFlyoutPackSelector2=function(){var ba=this.props.packs.sticker_store.tray_packs.edges.map(function(ca){return ca.node;});if(c('StickersConfig').oz_pack)ba.unshift(c('StickersConfig').oz_pack);if(c('StickersConfig').mru_stickers_count!==0)ba.unshift(c('StickersConfig').mru_pack);if(c('StickersConfig').search_pack)ba.unshift(c('StickersConfig').search_pack);return ba;}.bind(this),this.$StickersFlyoutPackSelector3=function(ba){var ca=this.$StickersFlyoutPackSelector2();for(var da=0;da<ca.length;da++)if(ca[da].id==ba)return da<=p?0:Math.floor((da-1)/p);return 0;}.bind(this),this.$StickersFlyoutPackSelector4=function(ba,ca){if(this.state.animating)return;this.setState({animating:true,page:ba},function(){var da=c('ReactDOM').findDOMNode(this.refs.positioner),ea=this.$StickersFlyoutPackSelector6(ba);new (c('Animation'))(da).to(ea.reference,ea.offset+'px').ondone(function(){return this.setState({animating:false});}.bind(this)).duration(ca).go();});}.bind(this),this.$StickersFlyoutPackSelector6=function(ba){var ca=c('ReactDOM').findDOMNode(this.refs.positioner),da=ca.childNodes[ba].offsetLeft;if(c('Locale').isRTL()){var ea=ca.offsetWidth,fa=ca.childNodes[ba].offsetWidth;return {reference:'right',offset:da+fa-ea};}return {reference:'left',offset:-da};}.bind(this),this.$StickersFlyoutPackSelector7=function(){return Math.max(1,Math.ceil((this.$StickersFlyoutPackSelector2().length-1)/p));}.bind(this),this.$StickersFlyoutPackSelector8=function(){return this.state.page>0;}.bind(this),this.$StickersFlyoutPackSelector9=function(){return this.state.page+1<this.$StickersFlyoutPackSelector7();}.bind(this),this.$StickersFlyoutPackSelector10=function(){this.$StickersFlyoutPackSelector8()&&this.$StickersFlyoutPackSelector4(this.state.page-1,q);}.bind(this),this.$StickersFlyoutPackSelector11=function(){this.$StickersFlyoutPackSelector9()&&this.$StickersFlyoutPackSelector4(this.state.page+1,q);}.bind(this),this.$StickersFlyoutPackSelector12=function(){c('StickersStoreController').showStore(null,this.props.stickerInterface==c('StickerInterfaces').COMPOSER);c('RelayStore').commitUpdate(new v({actor_id:c('CurrentUser').getID()}),{onSuccess:c('emptyFunction'),onFailure:c('emptyFunction')});}.bind(this),this.$StickersFlyoutPackSelector5=function(ba){c('StickersActions').selectTrayPack(ba);},this.$StickersFlyoutPackSelector16=function(){var ba=this.$StickersFlyoutPackSelector2().map(function(fa,ga){return (c('React').createElement(t,{key:fa.id,onClick:function(){return this.$StickersFlyoutPackSelector5(fa.id);}.bind(this),pack:fa,selected:this.props.selectedPackID===fa.id,index:ga,isComments:this.props.stickerInterface==c('StickerInterfaces').COMMENTS}));}.bind(this)),ca=[];for(var da=0;da<ba.length;da+=p){var ea=da;da===0&&da++;ca.push(c('React').createElement('div',{className:"_5r81",key:da},ba.slice(ea,da+p)));}return ca;}.bind(this),this.$StickersFlyoutPackSelector13=function(){return (c('React').createElement('a',{'aria-label':r,className:"_5r86 rfloat",'data-hover':'tooltip',onClick:this.$StickersFlyoutPackSelector12},c('React').createElement(c('Image.react'),{className:"_5r87",src:j('/images/messaging/stickers/selector/sticker_store.png')}),this.$StickersFlyoutPackSelector17()));}.bind(this),this.$StickersFlyoutPackSelector17=function(){if(!this.props.packs.num_new_sticker_packs)return null;return (c('React').createElement(c('XUIBadge.react'),{className:"rfloat _3fhs",count:this.props.packs.num_new_sticker_packs,maxcount:9,type:'special'}));}.bind(this),this.$StickersFlyoutPackSelector14=function(){if(!this.$StickersFlyoutPackSelector8())return null;var ba=c('Locale').isRTL()?j('/images/messaging/stickers/selector/right.png'):j('/images/messaging/stickers/selector/left.png');return (c('React').createElement('a',{className:"_37wu"+(' '+"lfloat"),onClick:this.$StickersFlyoutPackSelector10},c('React').createElement(c('Image.react'),{className:"_5r84",src:ba})));}.bind(this),this.$StickersFlyoutPackSelector15=function(){if(!this.$StickersFlyoutPackSelector9())return null;var ba=c('Locale').isRTL()?j('/images/messaging/stickers/selector/left.png'):j('/images/messaging/stickers/selector/right.png');return (c('React').createElement('a',{className:"_37wv"+(' '+"rfloat"),onClick:this.$StickersFlyoutPackSelector11},c('React').createElement(c('Image.react'),{className:"_5r84",src:ba})));}.bind(this),x;}u.prototype.componentDidMount=function(){if(this.props.selectedPackID)return;this.$StickersFlyoutPackSelector1();};u.prototype.shouldComponentUpdate=function(w,x){return !x.animating;};u.prototype.componentWillReceiveProps=function(w){if(w.selectedPackID)return;this.$StickersFlyoutPackSelector1();};u.prototype.render=function(){return c('React').createElement('div',{className:"_5r85"},this.$StickersFlyoutPackSelector13(),this.$StickersFlyoutPackSelector14(),this.$StickersFlyoutPackSelector15(),c('React').createElement('div',{className:"_5r88"},c('React').createElement('div',{className:"_5r89",ref:'positioner'},this.$StickersFlyoutPackSelector16())));};u.propTypes={stickerInterface:o.oneOf(c('getObjectValues')(c('StickerInterfaces'))),selectedPackID:o.string};u.defaultProps={stickerInterface:c('StickerInterfaces').MESSAGES};f.exports=c('Relay').createContainer(u,{initialVariables:{stickerInterface:c('StickerInterfaces').MESSAGES},fragments:{packs:function w(x){return function(){return {children:[{fieldName:'num_new_sticker_packs',kind:'Field',metadata:{},type:'Int'},{children:[{calls:[{kind:'Call',metadata:{type:'StickerInterfaces'},name:'interface',value:{kind:'CallVariable',callVariableName:'stickerInterface'}},{kind:'Call',metadata:{},name:'first',value:{kind:'CallValue',callValue:10000}}],children:[{children:[{children:[{fieldName:'id',kind:'Field',metadata:{isRequisite:true},type:'ID'},{fieldName:'is_comments_capable',kind:'Field',metadata:{},type:'Boolean'},{fieldName:'is_messenger_capable',kind:'Field',metadata:{},type:'Boolean'},{fieldName:'is_composer_capable',kind:'Field',metadata:{},type:'Boolean'},{fieldName:'name',kind:'Field',metadata:{},type:'String'},{calls:[{kind:'Call',metadata:{},name:'width',value:{kind:'CallValue',callValue:20}},{kind:'Call',metadata:{},name:'height',value:{kind:'CallValue',callValue:20}}],children:[{fieldName:'uri',kind:'Field',metadata:{},type:'Url'}],fieldName:'thumbnail_image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'},{fieldName:'is_promoted',kind:'Field',metadata:{},type:'Boolean'}],fieldName:'node',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id',isRequisite:true},type:'StickerPack'},{fieldName:'cursor',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'edges',kind:'Field',metadata:{canHaveSubselections:true,isPlural:true},type:'PacksInTrayEdge'},{children:[{fieldName:'has_next_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'},{fieldName:'has_previous_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'}],fieldName:'page_info',kind:'Field',metadata:{canHaveSubselections:true,isGenerated:true,isRequisite:true},type:'PageInfo'}],fieldName:'tray_packs',kind:'Field',metadata:{canHaveSubselections:true,isConnection:true},type:'PacksInTrayConnection'}],fieldName:'sticker_store',kind:'Field',metadata:{canHaveSubselections:true},type:'StickerStore'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'StickersFlyoutPackSelector_react_PacksRelayQL',type:'Viewer'};}();}}});m=babelHelpers.inherits(v,c('RelayMutation'));n=m&&m.prototype;v.prototype.getMutation=function(){return function(){return {calls:[{kind:'Call',metadata:{},name:'set_sticker_store_opened',value:{kind:'CallVariable',callVariableName:'input'}}],children:[{fieldName:'client_mutation_id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],kind:'Mutation',metadata:{inputType:'SetStickerStoreOpenedData!'},name:'StickersFlyoutPackSelector_react',responseType:'SetStickerStoreOpenedResponsePayload'};}();};v.prototype.getVariables=function(){return {actor_id:this.props.actor_id};};v.prototype.getFatQuery=function(){return function(){return {children:[{children:[{fieldName:'num_new_sticker_packs',kind:'Field',metadata:{},type:'Int'}],fieldName:'viewer',kind:'Field',metadata:{canHaveSubselections:true},type:'Viewer'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'StickersFlyoutPackSelector_reactRelayQL',type:'SetStickerStoreOpenedResponsePayload'};}();};v.prototype.getOptimisticResponse=function(){return {viewer:{num_new_sticker_packs:0}};};v.prototype.getConfigs=function(){var w=c('getViewerRecordID')();return [{type:c('RelayMutationType').FIELDS_CHANGE,fieldIDs:w?{viewer:w}:{}}];};function v(){m.apply(this,arguments);}}),null);
__d('StickersFlyoutPackSelectorRoute',['RelayQL','RelayRoute'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('RelayRoute'));i=h&&h.prototype;function j(){h.apply(this,arguments);}j.routeName='StickersFlyoutPackSelectorRoute';j.paramDefinitions={stickerInterface:{required:true,type:'String'}};j.queries={packs:function k(l,m){return function(n){return {children:[].concat.apply([],[c('RelayQL').__frag(n)]),fieldName:'viewer',kind:'Query',metadata:{},name:'StickersFlyoutPackSelectorRoute',type:'Viewer'};}(l.getFragment('packs',{stickerInterface:m.stickerInterface}));}};f.exports=j;}),null);
__d('StickersFlyoutStickerSelector.react',['cx','fbt','ix','Grid.react','Image.react','React','Relay','RelayQL','ScrollableArea.react','Sticker.react','StickerConstants','StickerInterfaces','StickersActions','StickersConfig','StickersStateStore','StickerUtils','getObjectValues','throttle'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('Grid.react').GridItem,n=c('React').PropTypes,o=320,p=278,q=44,r=112,s=Math.ceil(c('StickerConstants').TRAY_SIZE*(window.devicePixelRatio||1));k=babelHelpers.inherits(t,c('React').Component);l=k&&k.prototype;function t(){var v,w;for(var x=arguments.length,y=Array(x),z=0;z<x;z++)y[z]=arguments[z];return w=(v=l.constructor).call.apply(v,[this].concat(y)),this.$StickersFlyoutStickerSelector1=function(){if(this.props.stickers_for_pack||this.props.stickers_for_mru_pack){var aa=this.props.stickers_for_pack?this.props.stickers_for_pack.stickers.edges:this.props.stickers_for_mru_pack.recently_used_stickers.edges;if(this.props.stickers_for_mru_pack){var ba=c('StickersStateStore').getState();if(!ba.get('recentStickersLoaded')){c('StickersActions').loadRecentStickers(this.props.stickers_for_mru_pack.recently_used_stickers.edges.map(function(ca){return ca.node;}));}else return this.props.recentStickers.filter(function(ca){return this.$StickersFlyoutStickerSelector5(ca);}.bind(this));}return aa.filter(function(ca){return this.$StickersFlyoutStickerSelector5(ca.node);}.bind(this));}else if(this.props.stickers_for_search){return this.props.stickers_for_search.sticker_results.edges;}else return null;}.bind(this),this.$StickersFlyoutStickerSelector5=function(aa){var ba=this.props.stickerInterface,ca=aa.pack;if(ba===c('StickerInterfaces').COMPOSER){return ca.is_composer_capable;}else if(ba===c('StickerInterfaces').COMMENTS){return ca.is_comments_capable;}else if(ba===c('StickerInterfaces').MESSAGES){return ca.is_messenger_capable;}else return true;}.bind(this),this.$StickersFlyoutStickerSelector2=function(){var aa=(o-q*2-r)/2;return (c('React').createElement('div',{className:"_5jdt",style:{marginTop:aa+'px'}},c('React').createElement(c('Image.react'),{src:j('/images/messaging/stickers/icons/sad_face.png')}),c('React').createElement('p',null,i._("Aucun autocollant \u00e0 afficher"))));},this.$StickersFlyoutStickerSelector4=function(aa){return aa.map(function(ba){var ca=ba.node||ba,da=ca.sprite_image?ca.sprite_image.uri:null,ea=ca.padded_sprite_image?ca.padded_sprite_image.uri:null,fa=c('StickerUtils').getScaledDimensions(ca.image.height,ca.image.width,c('StickerConstants').TRAY_SIZE);return (c('React').createElement(m,{key:ca.id},c('React').createElement('div',{className:"_5r8h",onClick:function(event){return this.props.onStickerClick(ca,event);}.bind(this),onKeyDown:function(event){return this.props.onStickerKeyDown(ca.id,event);}.bind(this)},c('React').createElement(c('Sticker.react'),{accessibilityLabel:ca.label,animationTrigger:'hover',className:"_5r8i",forceCursorPointer:true,frameCount:ca.frame_count,frameRate:ca.frame_rate||83,framesPerCol:ca.frames_per_column,framesPerRow:ca.frames_per_row,sourceHeight:fa.height,sourceURI:ca.image.uri,sourceWidth:fa.width,spriteURI:da,packName:ca.pack.name,paddedSpriteURI:ea,stickerID:ca.id}))));}.bind(this));}.bind(this),this.$StickersFlyoutStickerSelector3=function(){var aa=this.refs.stickerScrollable;if(aa){var ba=aa.getArea().getScrollTop();this.props.onScroll&&this.props.onScroll(ba);}}.bind(this),w;}t.prototype.render=function(){var v=this.$StickersFlyoutStickerSelector1();if(!v||v.length===0)return this.$StickersFlyoutStickerSelector2();return c('React').createElement(c('ScrollableArea.react'),{ref:'stickerScrollable',height:this.props.height||o,onScroll:c('throttle')(this.$StickersFlyoutStickerSelector3,200),width:p,fade:true},c('React').createElement('div',{className:"_5r8k"},c('React').createElement(c('Grid.react'),{cols:4,fixed:true},this.$StickersFlyoutStickerSelector4(v))));};t.propTypes={height:n.number,onScroll:n.func,onStickerClick:n.func.isRequired,onStickerKeyDown:n.func.isRequired,recentStickers:n.array.isRequired,stickerInterface:n.oneOf(c('getObjectValues')(c('StickerInterfaces')))};t.defaultProps={stickerInterface:c('StickerInterfaces').MESSAGES};var u=function(v,w,x,y,z,aa){return {children:[{fieldName:'id',kind:'Field',metadata:{isRequisite:true},type:'ID'},{fieldName:'label',kind:'Field',metadata:{},type:'String'},{fieldName:'frame_count',kind:'Field',metadata:{},type:'Int'},{fieldName:'frame_rate',kind:'Field',metadata:{},type:'Int'},{fieldName:'frames_per_column',kind:'Field',metadata:{},type:'Int'},{fieldName:'frames_per_row',kind:'Field',metadata:{},type:'Int'},{calls:[{kind:'Call',metadata:{},name:'width',value:c('RelayQL').__var(v)},{kind:'Call',metadata:{},name:'height',value:c('RelayQL').__var(w)}],children:[{fieldName:'height',kind:'Field',metadata:{},type:'Int'},{fieldName:'width',kind:'Field',metadata:{},type:'Int'},{fieldName:'uri',kind:'Field',metadata:{},type:'Url'}],fieldName:'image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'},{calls:[{kind:'Call',metadata:{},name:'width',value:c('RelayQL').__var(x)},{kind:'Call',metadata:{},name:'height',value:c('RelayQL').__var(y)}],children:[{fieldName:'uri',kind:'Field',metadata:{},type:'Url'}],fieldName:'sprite_image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'},{calls:[{kind:'Call',metadata:{},name:'width',value:c('RelayQL').__var(z)},{kind:'Call',metadata:{},name:'height',value:c('RelayQL').__var(aa)}],children:[{fieldName:'uri',kind:'Field',metadata:{},type:'Url'}],fieldName:'padded_sprite_image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'},{children:[{fieldName:'name',kind:'Field',metadata:{},type:'String'},{fieldName:'is_comments_capable',kind:'Field',metadata:{},type:'Boolean'},{fieldName:'is_composer_capable',kind:'Field',metadata:{},type:'Boolean'},{fieldName:'is_messenger_capable',kind:'Field',metadata:{},type:'Boolean'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'pack',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id'},type:'StickerPack'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'StickersFlyoutStickerSelector_reactRelayQL',type:'Sticker'};}(s,s,s,s,s,s);f.exports=c('Relay').createContainer(t,{initialVariables:{stickerInterface:c('StickerInterfaces').MESSAGES},fragments:{stickers_for_pack:function v(){return function(w){return {children:[{calls:[{kind:'Call',metadata:{},name:'first',value:{kind:'CallValue',callValue:1000}}],children:[{children:[{children:[].concat.apply([],[{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'},c('RelayQL').__frag(w)]),fieldName:'node',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id',isRequisite:true},type:'Sticker'},{fieldName:'cursor',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'edges',kind:'Field',metadata:{canHaveSubselections:true,isPlural:true},type:'StickersInPackEdge'},{children:[{fieldName:'has_next_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'},{fieldName:'has_previous_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'}],fieldName:'page_info',kind:'Field',metadata:{canHaveSubselections:true,isGenerated:true,isRequisite:true},type:'PageInfo'}],fieldName:'stickers',kind:'Field',metadata:{canHaveSubselections:true,isConnection:true,isFindable:true},type:'StickersInPackConnection'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'StickersFlyoutStickerSelector_react_Stickers_for_packRelayQL',type:'StickerPack'};}(u);},stickers_for_search:function v(w){var x=w.stickerInterface;return function(y){return {children:[{calls:[{kind:'Call',metadata:{type:'StickerInterfaces'},name:'interface',value:{kind:'CallVariable',callVariableName:'stickerInterface'}},{kind:'Call',metadata:{},name:'first',value:{kind:'CallValue',callValue:40}}],children:[{children:[{children:[].concat.apply([],[{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'},c('RelayQL').__frag(y)]),fieldName:'node',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id',isRequisite:true},type:'Sticker'},{fieldName:'cursor',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'edges',kind:'Field',metadata:{canHaveSubselections:true,isPlural:true},type:'StickerSearchResultsEdge'},{children:[{fieldName:'has_next_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'},{fieldName:'has_previous_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'}],fieldName:'page_info',kind:'Field',metadata:{canHaveSubselections:true,isGenerated:true,isRequisite:true},type:'PageInfo'}],fieldName:'sticker_results',kind:'Field',metadata:{canHaveSubselections:true,isConnection:true},type:'StickerSearchResultsConnection'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'StickersFlyoutStickerSelector_react_Stickers_for_searchRelayQL',type:'StickerSearchQuery'};}(u);},stickers_for_mru_pack:function v(){return function(w,x){return {children:[{calls:[{kind:'Call',metadata:{},name:'first',value:c('RelayQL').__var(w)}],children:[{children:[{children:[].concat.apply([],[{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'},c('RelayQL').__frag(x)]),fieldName:'node',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id',isRequisite:true},type:'Sticker'},{fieldName:'cursor',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'edges',kind:'Field',metadata:{canHaveSubselections:true,isPlural:true},type:'RecentlyUsedStickersEdge'},{children:[{fieldName:'has_next_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'},{fieldName:'has_previous_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'}],fieldName:'page_info',kind:'Field',metadata:{canHaveSubselections:true,isGenerated:true,isRequisite:true},type:'PageInfo'}],fieldName:'recently_used_stickers',kind:'Field',metadata:{canHaveSubselections:true,isConnection:true,isFindable:true},type:'RecentlyUsedStickersConnection'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'StickersFlyoutStickerSelector_react_Stickers_for_mru_packRelayQL',type:'Viewer'};}(c('StickersConfig').max_mru_stickers,u);}}});}),null);
__d('StickersFlyoutStickersForMRUPackRoute',['RelayQL','RelayRoute'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('RelayRoute'));i=h&&h.prototype;function j(){h.apply(this,arguments);}j.routeName='StickersFlyoutStickersForMRUPackRoute';j.queries={stickers_for_mru_pack:function k(l){return function(m){return {children:[].concat.apply([],[c('RelayQL').__frag(m)]),fieldName:'viewer',kind:'Query',metadata:{},name:'StickersFlyoutStickersForMRUPackRoute',type:'Viewer'};}(l.getFragment('stickers_for_mru_pack'));}};f.exports=j;}),null);
__d('StickersFlyoutStickersForPackRoute',['RelayQL','RelayRoute'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('RelayRoute'));i=h&&h.prototype;function j(){h.apply(this,arguments);}j.routeName='StickersFlyoutStickersForPackRoute';j.paramDefinitions={id:{required:true,type:'String'}};j.queries={stickers_for_pack:function k(l){return function(m){return {calls:[{kind:'Call',metadata:{type:'ID!'},name:'id',value:{kind:'CallVariable',callVariableName:'id'}}],children:[].concat.apply([],[{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'},{fieldName:'__typename',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'String'},c('RelayQL').__frag(m)]),fieldName:'node',kind:'Query',metadata:{isAbstract:true,identifyingArgName:'id',identifyingArgType:'ID!'},name:'StickersFlyoutStickersForPackRoute',type:'Node'};}(l.getFragment('stickers_for_pack'));}};f.exports=j;}),null);
__d('StickersFlyoutStickersForSearchRoute',['RelayQL','RelayRoute'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('RelayRoute'));i=h&&h.prototype;function j(){h.apply(this,arguments);}j.routeName='StickersFlyoutStickersForSearchRoute';j.paramDefinitions={query:{required:true,type:'String'},stickerInterface:{required:true,type:'String'}};j.queries={stickers_for_search:function k(l,m){var n=m.stickerInterface;return function(o){return {calls:[{kind:'Call',metadata:{type:'String!'},name:'query',value:{kind:'CallVariable',callVariableName:'query'}}],children:[].concat.apply([],[c('RelayQL').__frag(o)]),fieldName:'sticker_search',kind:'Query',metadata:{identifyingArgName:'query',identifyingArgType:'String!'},name:'StickersFlyoutStickersForSearchRoute',type:'StickerSearchQuery'};}(l.getFragment('stickers_for_search',{stickerInterface:n}));}};f.exports=j;}),null);
__d('StickersFlyoutTags.react',['cx','Grid.react','Image.react','React','Relay','RelayQL','ScrollableArea.react','XUIButton.react'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('Grid.react').GridItem,j=function k(l){var m=l.tags.sticker_store.sticker_tags.edges.filter(function(n){return n.node.thumbnail_image.uri!==null;}).sort(function(n,o){return n.node.order-o.node.order;}).map(function(n,o){return (c('React').createElement(i,{key:o},c('React').createElement('div',{className:"_t5c"+(o<2?' '+"_1b27":'')+(o%2===0?' '+"_t5d":'')+(o%2!==0?' '+"_t5e":'')},c('React').createElement(c('XUIButton.react'),{image:c('React').createElement(c('Image.react'),{src:n.node.thumbnail_image.uri}),label:n.node.name,onClick:function p(){return l.onTagSelect(n.node);},className:"_5jdu",style:{background:'#'+n.node.color_code},disabled:l.inputDisabled}))));});return (c('React').createElement(c('ScrollableArea.react'),{height:l.height,width:l.width,shadow:true,fade:true,className:"_5jei"},c('React').createElement(c('Grid.react'),{spacing:'pas',cols:2,fixed:true},m)));};f.exports=c('Relay').createContainer(j,{fragments:{tags:function k(){return function(){return {children:[{children:[{calls:[{kind:'Call',metadata:{type:'StickerTagType'},name:'sticker_tag_type',value:{kind:'CallValue',callValue:'FEATURED'}},{kind:'Call',metadata:{},name:'first',value:{kind:'CallValue',callValue:20}}],children:[{children:[{children:[{fieldName:'order',kind:'Field',metadata:{},type:'Int'},{fieldName:'color_code',kind:'Field',metadata:{},type:'String'},{fieldName:'name',kind:'Field',metadata:{},type:'String'},{children:[{fieldName:'uri',kind:'Field',metadata:{},type:'Url'}],fieldName:'thumbnail_image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'node',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id',isRequisite:true},type:'StickerTag'},{fieldName:'cursor',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'edges',kind:'Field',metadata:{canHaveSubselections:true,isPlural:true},type:'AllStickerTagsEdge'},{children:[{fieldName:'has_next_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'},{fieldName:'has_previous_page',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'Boolean'}],fieldName:'page_info',kind:'Field',metadata:{canHaveSubselections:true,isGenerated:true,isRequisite:true},type:'PageInfo'}],fieldName:'sticker_tags',kind:'Field',metadata:{canHaveSubselections:true,isConnection:true},type:'AllStickerTagsConnection'}],fieldName:'sticker_store',kind:'Field',metadata:{canHaveSubselections:true},type:'StickerStore'}],id:c('RelayQL').__id(),kind:'Fragment',metadata:{},name:'StickersFlyoutTags_react_TagsRelayQL',type:'Viewer'};}();}}});}),null);
__d('StickersFlyoutTagsRoute',['RelayQL','RelayRoute'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('RelayRoute'));i=h&&h.prototype;function j(){h.apply(this,arguments);}j.routeName='StickersFlyoutTagsRoute';j.queries={tags:function k(l){return function(m){return {children:[].concat.apply([],[c('RelayQL').__frag(m)]),fieldName:'viewer',kind:'Query',metadata:{},name:'StickersFlyoutTagsRoute',type:'Viewer'};}(l.getFragment('tags'));}};f.exports=j;}),null);
__d('StickersFlyoutTagSelector.react',['cx','fbt','React','RelayRootContainer','StickersFlyoutStickerSelector.react','StickersFlyoutStickersForSearchRoute','StickersFlyoutTags.react','StickersFlyoutTagsRoute','StickerInterfaces','StickersTypedLogger','StickerUtils','XUICloseButton.react','XUISpinner.react','XUITextInput.react','debounce','getObjectValues'],(function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=320,l=278,m=44,n=c('debounce')(function(p){if(!p||p.length<2)return;new (c('StickersTypedLogger'))().setEvent('search_sticker').setSearchtoken(p).log();},1000),o=c('React').createClass({displayName:'StickersFlyoutTagSelector',propTypes:{onStickerClick:j.func.isRequired,onStickerKeyDown:j.func.isRequired,stickerInterface:j.oneOf(c('getObjectValues')(c('StickerInterfaces'))),shown:j.bool},getInitialState:function p(){return {input:'',isScrolling:false,tagChosen:false};},getDefaultProps:function p(){return {stickerInterface:c('StickerInterfaces').MESSAGES};},componentDidMount:function p(){this._focusInput();},componentWillReceiveProps:function p(q){if(q.shown&&!this.props.shown)this.setState(this.getInitialState(),this._focusInput);},shouldComponentUpdate:function p(q){return q.shown;},render:function p(){return (c('React').createElement('div',{className:"_217a"+(this.state.isScrolling?' '+"_1hg1":'')},c('React').createElement('div',{className:"_5jdr"},c('React').createElement('span',{className:"_5jds"}),c('React').createElement(c('XUITextInput.react'),{onChange:this._inputChanged,ref:'inputField',placeholder:i._("Rechercher des autocollants"),value:this.state.input}),c('React').createElement(c('XUICloseButton.react'),{size:'small',onClick:this._handleResetButtonClick,className:this.state.input.length===0?"hidden_elem":''})),this._renderContentArea()));},_renderContentArea:function p(){var q=this._normalizeInput(this.state.input),r=c('React').createElement('div',{className:"_e0r"},c('React').createElement(c('XUISpinner.react'),{size:'large'}));if(this.state.tagChosen||q.length>1){n(q);return (c('React').createElement(c('RelayRootContainer'),{Component:c('StickersFlyoutStickerSelector.react'),route:new (c('StickersFlyoutStickersForSearchRoute'))({query:q,stickerInterface:this.props.stickerInterface}),renderLoading:function s(){return r;},renderFetched:function(s){return (c('React').createElement(c('StickersFlyoutStickerSelector.react'),babelHelpers['extends']({},s,{ref:'selector',height:k-m,onScroll:this._onScroll,onStickerClick:this.props.onStickerClick,onStickerKeyDown:this.props.onStickerKeyDown,recentStickers:[],stickerInterface:this.props.stickerInterface})));}.bind(this)}));}else return (c('React').createElement(c('RelayRootContainer'),{Component:c('StickersFlyoutTags.react'),route:new (c('StickersFlyoutTagsRoute'))(),renderLoading:function s(){return r;},renderFetched:function(s){return (c('React').createElement(c('StickersFlyoutTags.react'),babelHelpers['extends']({},s,{height:k-m,inputDisabled:q.length===1,onTagSelect:this._selectTag,width:l-16})));}.bind(this)}));},_onScroll:function p(q){this.setState({isScrolling:!!q});},_selectTag:function p(q){new (c('StickersTypedLogger'))().setEvent('select_tag').setTagid(q.id).log();this.setState({tagChosen:true,input:c('StickerUtils').capitalizeWords(q.name)});this._focusInput();},_normalizeInput:function p(q){return q.trim().replace(/\s+/,' ').toLowerCase();},_handleResetButtonClick:function p(q){q.preventDefault();this.setState(this.getInitialState());},_inputChanged:function p(q){this.setState({input:q.target.value,tagChosen:false,isScrolling:false});},_focusInput:function p(){this.refs.inputField.focusInput&&this.refs.inputField.focusInput();}});f.exports=o;}),null);
__d('StickersFlyout.react',['cx','fbt','Keys','MessagesEmoticons.react','ReactComponentWithPureRenderMixin','PureStoreBasedStateMixin','React','RelayRootContainer','StickerConstants','StickersActions','StickersConfig','StickersFlyoutPackSelector.react','StickersFlyoutPackSelectorRoute','StickersFlyoutStickerSelector.react','StickersFlyoutStickersForPackRoute','StickersFlyoutStickersForMRUPackRoute','StickersFlyoutTagSelector.react','StickerInterfaces','StickersStateStore','StickersDispatcher','StickersTypedLogger','XUISpinner.react','getObjectValues','joinClasses'],(function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('StickerConstants').SEARCH_PACK_ID,l=['Enter',' '],m=c('React').createClass({displayName:'StickersFlyout',mixins:[c('ReactComponentWithPureRenderMixin'),c('PureStoreBasedStateMixin')(c('StickersStateStore'))],statics:{calculateState:function n(){var o=c('StickersStateStore').getState();return {packID:o.get('trayPackID'),trayLoaded:o.get('trayLoaded')};}},propTypes:{stickerInterface:j.oneOf(c('getObjectValues')(c('StickerInterfaces'))),onStickerSelect:j.func.isRequired,onEmoticonSelect:j.func,onShown:j.func,onHidden:j.func,onEscKeyDown:j.func,shown:j.bool},getDefaultProps:function n(){return {stickerInterface:c('StickerInterfaces').MESSAGES,shown:false};},componentWillMount:function n(){c('StickersDispatcher').explicitlyRegisterStores([c('StickersStateStore')]);},componentDidMount:function n(){if(this.props.shown)this._onShown();},componentWillReceiveProps:function n(o){if(o.shown){this._onShownWrapper();}else this._onHidden();},componentDidUpdate:function n(o){if(!o.shown&&this.props.shown){this._onShown();}else if(o.shown&&!this.props.shown)this._onHidden();},_onShownWrapper:function n(){if(this.props.onShown){this.props.onShown(this._onShown);}else this._onShown();},_onShown:function n(){new (c('StickersTypedLogger'))().setEvent('open_tray').log();},_onHidden:function n(){this.props.onHidden&&this.props.onHidden();},_onKeyDown:function n(event){if(event.keyCode===c('Keys').ESC&&this.props.onEscKeyDown){event.stopPropagation();event.preventDefault();this.props.onEscKeyDown();}},_onKeyPress:function n(event){if(this.state.packID!==k&&l.indexOf(event.key)===-1)c('StickersActions').selectTrayPack(k);},loadPack:function n(){var o=c('React').createElement('div',{className:"_e0r"},c('React').createElement(c('XUISpinner.react'),{size:'large'}));if(!this.state.trayLoaded)return o;if(this.state.packID===c('StickerConstants').EMOTICON_PACK_ID)return (c('React').createElement('div',{className:"_5r8l",'data-id':this.state.packID},c('React').createElement(c('MessagesEmoticons.react'),{onEmoticonSelect:this.props.onEmoticonSelect})));if(this.state.packID===k&&c('StickersConfig').search_pack)return (c('React').createElement('div',{className:"_5r8l"},c('React').createElement(c('StickersFlyoutTagSelector.react'),{className:"fbStickersFlyoutTagSelector",stickerInterface:this.props.stickerInterface,shown:this.props.shown,onStickerClick:this._onStickerClick,onStickerKeyDown:this._onStickerKeyDown})));var p=this.state.packID===c('StickerConstants').MRU_STICKER_PACK?new (c('StickersFlyoutStickersForMRUPackRoute'))():new (c('StickersFlyoutStickersForPackRoute'))({id:this.state.packID});return (c('React').createElement('div',{className:"_5r8l",'data-id':this.state.packID},c('React').createElement(c('RelayRootContainer'),{Component:c('StickersFlyoutStickerSelector.react'),route:p,renderLoading:function q(){return o;},renderFetched:function(q){return (c('React').createElement(c('StickersFlyoutStickerSelector.react'),babelHelpers['extends']({},q,{recentStickers:c('StickersStateStore').getState().get('recentStickers'),stickerInterface:this.props.stickerInterface,onStickerClick:this._onStickerClick,onStickerKeyDown:this._onStickerKeyDown})));}.bind(this)})));},_onStickerClick:function n(o,event){if(c('StickersStateStore').getState().get('recentStickersLoaded'))c('StickersActions').addRecentSticker(o);this.props.onStickerSelect(o.id,event);},_onStickerKeyDown:function n(o,event){if(event.keyCode===c('Keys').RETURN){event.stopPropagation();event.preventDefault();this.props.onStickerSelect(o,event);}},render:function n(){return (c('React').createElement('div',{'aria-label':i._("Autocollants"),className:c('joinClasses')(this.props.className,"_5r8f"),onKeyDown:this._onKeyDown,onKeyPress:this._onKeyPress,role:'dialog'},c('React').createElement('div',{className:"_5r8e"},c('React').createElement(c('RelayRootContainer'),{Component:c('StickersFlyoutPackSelector.react'),route:new (c('StickersFlyoutPackSelectorRoute'))({stickerInterface:this.props.stickerInterface}),renderFetched:function(o){return (c('React').createElement(c('StickersFlyoutPackSelector.react'),babelHelpers['extends']({},o,{selectedPackID:this.state.packID,stickerInterface:this.props.stickerInterface,shown:this.props.shown})));}.bind(this)})),c('React').createElement('div',{className:"_5r8m"},this.loadPack())));}});f.exports=m;}),null);
__d('TabIndexDelegator',['CSS','DOM','Event','Focus','JSXDOM'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j){'use strict';this._placeholder=j||c('JSXDOM').button(null);this._placeholder.setAttribute('aria-hidden',true);c('CSS').addClass(this._placeholder,'accessible_elem');this._listener=c('Event').listen(this._placeholder,'click',function(){i.click();});c('Focus').relocate(this._placeholder,i);this.enable();}h.prototype.enable=function(){'use strict';c('CSS').show(this._placeholder);};h.prototype.disable=function(){'use strict';c('CSS').hide(this._placeholder);};h.prototype.getPlaceholder=function(){'use strict';return this._placeholder;};h.prototype.destroy=function(){'use strict';this._listener.remove();c('DOM').remove(this._placeholder);};f.exports=h;}),null);
__d('UnsentMessageDialog',['fbt','Dialog','WebMessengerEvents'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={get:function j(){var k=[{label:h._("Ne pas envoyer"),name:c('Dialog').OK.name},{label:h._("Rester sur le message"),name:c('Dialog').CANCEL.name,className:c('Dialog').CANCEL.className}];return new (c('Dialog'))().setTitle(h._("Ne pas envoyer le message\u00a0?")).setBody(h._("Si vous quittez cette page, votre message ne sera pas envoy\u00e9.")).setButtons(k).setCloseHandler(c('WebMessengerEvents').inform.bind(c('WebMessengerEvents'),c('WebMessengerEvents').FOCUS_COMPOSER)).setModal(true);}};f.exports=i;}),null);
__d("XMessagingSetPreferencesController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/preferences\/",{send_on_enter:{type:"Bool",defaultValue:false}});}),null);
__d('WebMessengerDetailViewBottomShelfControl',['csx','cx','fbt','ARIA','Arbiter','AsyncDialog','AsyncRequest','BanzaiLogger','Bootloader','Button','CSS','DOM','MercuryDraftsController','WebMessengerDeleteThreadDialog','Ellipsizer','Event','Focus','MercuryFolders','Input','Keys','Locale','MercuryAPIArgsSource','MercuryBlockedParticipants','MercuryConfig','MercuryIDs','MercuryFileUploader','MercuryParticipants','MercuryPhotoUploader','MercuryReadOnlyReason','MercuryThreadIDMap','MercuryShareLinkUploader','MercurySourceType','MercuryThreadInfo','MercuryThreadActions','MercuryMessageObject','MessagesEmoticonView','MercuryMessageActions','MessagingTag','MessageRequestUtils','P2PSendMoneyContainerBootloader.react','PUWMethods','PagesEventObserver','PagesEventType','PhotosUploadWaterfall','WebMessengerPreferences','React','ReactComponentRenderer','ReactDOM','MercuryShareAttachmentRenderLocations','Run','Set','SiteData','WebMessengerStateConstants','WebMessengerStateManager','StickerInterfaces','StickersFlyout.react','StickersStoreController','StickersPackInTray','StickersActions','Style','TabIndexDelegator','WebMessengerTemplates','TextAreaControl','MercuryThreadInformer','MercuryThreads','Toggler','UnsentMessageDialog','URI','UserAgent_DEPRECATED','VaultBoxURI','Vector','WebMessengerEvents','WebMessengerSubscriptionsHandler','WorkFileUploadsGating','XMessagingSetPreferencesController','arrayContains','containsNode','ge','isWebMessengerURI'],(function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercuryDraftsController').get(),l=c('MercuryBlockedParticipants').get(),m=c('MercuryThreadIDMap').get(),n=c('MercuryThreadActions').get(),o=c('MercuryMessageObject').get(),p=c('MercuryMessageActions').get(),q=c('MercuryThreadInformer').get(),r=c('MercuryThreads').get(),s="_1rh";function t(za,ab){'use strict';this._manager=za;this._rootElement=ab;this._sendOnEnterDefault=c('WebMessengerPreferences').sendOnEnter;c('DOM').empty(this._rootElement);var bb=c('WebMessengerTemplates')[':fb:web-messenger:read-view:bottom-shelf'].build();c('DOM').setContent(this._rootElement,bb.getRoot());this._bottomShelfToolbar=bb.getNode('toolbar');this._bottomShelfComposer=bb.getNode('composer');this._bottomShelfButtons=bb.getNode('buttons');this._bottomPendingActions=bb.getNode('pendingActions');this._bottomPendingDeleteAction=bb.getNode('deletePendingButton');this._bottomPendingIgnoreAction=bb.getNode('ignorePendingButton');this._autogrowContainer=bb.getNode('autogrowContainer');this._composerBox=bb.getNode('composerTextarea');this._composerGrid=bb.getNode('composerGrid');this._sendContainer=bb.getNode('sendContainer');this._replyButton=bb.getNode('replyButton');this._uploadingWarning=bb.getNode('uploadingWarning');this._replyButtonLabel=c('DOM').find(this._sendContainer,"._1ri");this._sendOnEnterButton=bb.getNode('sendOnEnterButton');this._loadingIndicator=bb.getNode('loadingIndicator');this._cannotReplyAlert=bb.getNode('noReplyMessage');this._ariaOwns=this._composerBox.getAttribute('aria-owns');c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(this._autogrowContainer,'click',this.focusComposer.bind(this)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').UPDATE_SELECTION,ya.bind(null,this)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').FOCUS_COMPOSER,this.focusComposer.bind(this)));this._emoteWrapper=bb.getNode('emoteWrapper');this._p2pWrapper=bb.getNode('p2pWrapper');this._stickersFlyoutToggler=bb.getNode('emoticons');this._emoticonsPanel=new (c('MessagesEmoticonView'))(this._stickersFlyoutToggler,this._composerBox);var cb=bb.getNode('stickers');if(cb)c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Toggler').listen('show',this._stickersFlyoutToggler,function(){this._renderStickersFlyout(cb,true);}.bind(this)),c('Toggler').listen('hide',this._stickersFlyoutToggler,function(){this._renderStickersFlyout(cb,false);}.bind(this)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').STICKER_CLICKED,this._onStickerClick.bind(this)));this._messageSent=false;if(c('WorkFileUploadsGating').canUploadFiles)this._fileUploader=new (c('MercuryFileUploader'))(bb.getNode('attachmentShelf'),bb.getNode('attachButtonForm'),bb.getNode('fileInput'),bb.getNode('attachID'));this._shareLinkUploader=new (c('MercuryShareLinkUploader'))(bb.getNode('shareStage'),bb.getNode('shareStageContent'),bb.getNode('shareStageLoadingIndicator'),bb.getNode('shareStageCloseButton'),this._composerBox);c('Focus').relocate(this._replyButton,this._replyButtonLabel);this._delegator=new (c('TabIndexDelegator'))(this._replyButtonLabel);c('DOM').prependContent(this._bottomShelfToolbar,this._delegator.getPlaceholder());e(['TypingDetectorController'],function(gb){this._typingDetector=new gb(null,this._composerBox,'web-messenger',null,null);xa(this);}.bind(this));this._photoUploader=new (c('MercuryPhotoUploader'))(this._composerGrid,bb.getNode('photoButton'),c('WebMessengerSubscriptionsHandler'),bb.getNode('composer'));var db=false;c('WebMessengerSubscriptionsHandler').addSubscriptions(this._photoUploader.subscribe('dom-updated',c('WebMessengerEvents').detailDOMChanged.bind(c('WebMessengerEvents'))),this._photoUploader.subscribe('menu-show',function(gb,hb){if(!db){this.waterfallStep(c('PhotosUploadWaterfall').BEGIN,hb);db=true;}}.bind(this)),this._photoUploader.subscribe('selection-start',function(gb,hb){this.waterfallStep(c('PhotosUploadWaterfall').SELECT_START,hb);}.bind(this)),this._photoUploader.subscribe('upload-started',function(gb,hb){this.waterfallStep(c('PhotosUploadWaterfall').IMAGES_SELECTED,{method:hb.method||this._photoUploader.getCurrentMethod()});this.waterfallStep(c('PhotosUploadWaterfall').UPLOAD_START,{count:hb.imageCount});}.bind(this)),this._photoUploader.subscribe('upload-completed',function(gb,hb){var ib=this._photoUploader.getCurrentMethod();if(ib!==c('PUWMethods').FILE_SELECTOR)this.waterfallStep(c('PhotosUploadWaterfall').IMAGES_SELECTED,{method:ib});for(var jb=0;jb<hb.fbids.length;++jb)this.waterfallStep(c('PhotosUploadWaterfall').ONE_UPLOAD_DONE);this._composerBox.focus();var kb=j._("Une photo a \u00e9t\u00e9 jointe \u00e0 votre message.");c('ARIA').notify(kb);}.bind(this)),this._photoUploader.subscribe('all-uploads-completed',function(gb,hb){if(this._blockedOnUpload){pa(this,false);ma(this);}this.waterfallStep(c('PhotosUploadWaterfall').ALL_UPLOADS_DONE,hb);}.bind(this)));var eb=c('DOM').scry(this._bottomShelfToolbar,"._6q-");eb.push(bb.getNode('sendOnEnterButtonLabel'));this._ellipsizer=new (c('Ellipsizer'))(eb);if(this._fileUploader)c('WebMessengerSubscriptionsHandler').addSubscriptions(this._fileUploader.subscribe('all-uploads-completed',function(){if(this._blockedOnUpload){pa(this,false);ma(this);}}.bind(this)),this._fileUploader.subscribe('upload-canceled',pa.bind(null,this,false)),this._fileUploader.subscribe('dom-updated',c('WebMessengerEvents').detailDOMChanged.bind(c('WebMessengerEvents'))));this._confirmationSubscription=c('WebMessengerStateManager').registerConfirmationBeforeStateUpdate(function(gb,hb,ib){if(!k.canSaveDrafts(this._threadID)&&ta(this)&&u(this,hb,ib))return c('UnsentMessageDialog').get();return false;}.bind(this));ua(this);this._prefilledMessages={};c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Arbiter').subscribe('page_transition',function(gb,hb){if(c('isWebMessengerURI')(hb.uri))ua(this);}.bind(this)),this._shareLinkUploader.subscribe('link-detected',c('WebMessengerEvents').detailDOMChanged.bind(c('WebMessengerEvents'))),this._shareLinkUploader.subscribe('closed',this.focusComposer.bind(this)),c('Arbiter').subscribe('chat/prefilled_messages_set',function(gb,hb){if(hb)this._prefilledMessages=hb;}.bind(this)));c('TextAreaControl').getInstance(this._composerBox).subscribe('resize',function(){c('WebMessengerEvents').detailDOMChanged();}.bind(this));c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(this._replyButtonLabel,'click',ma.bind(null,this)),c('Event').listen(this._replyButton,'keydown',z.bind(null,this)),c('Event').listen(this._composerBox,'keydown',z.bind(null,this)),c('Event').listen(this._composerBox,'paste',aa.bind(null,this)),c('Event').listen(this._sendOnEnterButton,'click',ca.bind(null,this)),c('Event').listen(bb.getNode('cancelButton'),'click',qa),c('Event').listen(bb.getNode('deleteButton'),'click',ra.bind(null,this)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').DETAIL_DOM_CHANGED,ba.bind(null,this)));c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(bb.getNode('ignorePendingButton'),'click',function(){n.changeFolder(this._threadID,c('MessagingTag').OTHER);c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,c('WebMessengerStateManager').getCurrentStateData());}.bind(this)),c('Event').listen(bb.getNode('deletePendingButton'),'click',function(){c('WebMessengerDeleteThreadDialog').show(this._threadID,function(){c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,c('WebMessengerStateManager').getCurrentStateData());});}.bind(this)),c('Event').listen(bb.getNode('replyPendingButton'),'click',function(){n.changeFolder(this._threadID,c('MessagingTag').INBOX);c('CSS').hide(this._bottomPendingActions);c('CSS').show(this._bottomShelfComposer);c('CSS').removeClass(this._bottomShelfComposer,'invisible_elem');}.bind(this)));c('WebMessengerSubscriptionsHandler').addSubscriptions(q.subscribe('threads-updated',function(gb,hb){hb[this._threadID]&&this.updateView();}.bind(this)));this._replySet=new (c('Set'))();var fb=new (c('URI'))(window.location.href);this._uriData=fb.getQueryData();this._shouldLogMessageSend=!!this._uriData.loggedoutpage;}t.prototype._renderStickersFlyout=function(za,ab){'use strict';this._stickersFlyout=c('ReactDOM').render(c('React').createElement(c('StickersFlyout.react'),{onStickerSelect:function(bb){return la(this,bb);}.bind(this),shown:ab}),za);};t.prototype._logMessageSend=function(){'use strict';c('PagesEventObserver').notify(c('PagesEventType').MESSAGES_SEND_ENTRY_POINT,this._uriData.loggedoutpage,{was_logged_out:true});};t.prototype._onStickerClick=function(za,ab){'use strict';if(!ab||!ab.packID)return;var bb=ab.packID,cb=ab.stickerID;c('BanzaiLogger').log('StickersLoggerConfig',{event:'click_sticker',packid:bb,stickerid:cb});c('StickersPackInTray').onIsPackInTray(bb,c('StickerInterfaces').MESSAGES,function(db){if(db.in_sticker_tray){var eb=this._stickersFlyoutToggler;if(!eb)return;c('StickersActions').selectTrayPack(bb);c('Toggler').show(eb);}else c('StickersStoreController').showStore(bb);}.bind(this));};t.prototype.waterfallStep=function(za,ab){'use strict';var bb=this._photoUploader.getWaterfallID();if(!bb)return;c('PhotosUploadWaterfall').sendSignal(babelHelpers['extends']({qn:bb,step:za,uploader:c('PhotosUploadWaterfall').APP_MESSENGER},ab||{}));};t.prototype.hideView=function(){'use strict';c('CSS').hide(this._rootElement);};t.prototype.updateView=function(){'use strict';var za=c('WebMessengerStateManager').getCurrentDetailState();c('CSS').show(this._rootElement);var ab=c('WebMessengerStateManager').getCurrentStateData();u(this,za,ab)&&oa(this);c('CSS').hide(this._bottomShelfComposer);c('CSS').removeClass(this._bottomShelfComposer,'invisible_elem');c('CSS').hide(this._bottomShelfButtons);c('CSS').show(this._sendOnEnterButton);c('CSS').hide(this._cannotReplyAlert);ea(this,this._sendOnEnterDefault);switch(za){case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:this._threadID=ab.thread_id;if(ab.message_action==c('WebMessengerStateConstants').MESSAGE_ACTION.DELETE){c('CSS').hide(this._bottomPendingActions);va(this,ab.message_action);}else if(this._threadID)r.getThreadMeta(this._threadID,function(bb){if(!this._replySet.has(this._threadID)&&bb&&c('MessageRequestUtils').isMessageRequest(bb)){wa(this,bb);}else if(c('MercuryThreadInfo').showComposer(bb)&&!c('MercuryConfig').ViewerIsReadOnly&&!(c('MercuryConfig').ColdOpenBlock&&c('MercuryThreadInfo').isColdOpen(bb))){c('CSS').show(this._bottomShelfComposer);k.loadDraft(this._threadID,this._composerBox,this._fileUploader,this._shareLinkUploader,this._photoUploader);this._shareLinkUploader.check();}else{var cb=bb&&bb.has_email_participant;c('ReactDOM').render(c('React').createElement('span',null,c('MercuryReadOnlyReason').getReason(cb)),this._cannotReplyAlert);c('CSS').show(this._cannotReplyAlert);}y(this,bb);w(this,bb);}.bind(this));break;case c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN:this._threadID=null;if(!c('MercuryConfig').ColdOpenBlock){c('CSS').show(this._bottomShelfComposer);x(this,ab.participants);y(this,null);w(this);}else{c('ReactDOM').render(c('React').createElement('span',null,c('MercuryReadOnlyReason').getReason()),this._cannotReplyAlert);c('CSS').show(this._cannotReplyAlert);}break;default:this._threadID=null;break;}v(this,za,ab);xa(this);c('WebMessengerEvents').detailDOMChanged();this._state=za;};t.prototype.focusComposer=function(){'use strict';this._composerBox.focus();};t.prototype.submitReply=function(){'use strict';ma(this);};t.prototype.destroy=function(){'use strict';this._emoticonsPanel&&this._emoticonsPanel.destroy();this._fileUploader&&this._fileUploader.destroy();c('WebMessengerStateManager').unregisterConfirmationBeforeStateUpdate(this._confirmationSubscription);if(this._sendMoneyDialogStoreSub){this._sendMoneyDialogStoreSub.remove();this._sendMoneyDialogStoreSub=null;}if(this._p2pButton)this._p2pButton.unmount();};t.prototype.getStickersFlyoutToggler=function(){'use strict';return this._stickersFlyoutToggler;};function u(za,ab,bb){switch(ab){case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:return !bb.reuse_composer&&(za._threadID!=bb.thread_id||za._state!=ab);case c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN:return bb.start;case c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET:case c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET:case c('WebMessengerStateConstants').DETAIL.SHARED_PHOTOS:return true;}return false;}function v(za,ab,bb){var cb=bb.participants&&bb.participants.length>0;c('CSS').conditionClass(za._replyButtonLabel,'uiButtonDisabled',ab==c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN&&!cb);}function w(za,ab){var bb=ab&&ab.thread_id;if(!za._p2pWrapper)return;if(!bb){c('CSS').addClass(za._p2pWrapper,'invisible_elem');if(za._p2pButton)za._p2pButton.setProps({sendMoneyDialogShown:false});return;}c('CSS').removeClass(za._p2pWrapper,'invisible_elem');if(!za._p2pButton){za._p2pButton=new (c('ReactComponentRenderer'))(c('P2PSendMoneyContainerBootloader.react'),za._p2pWrapper);za._p2pButton.setProps({referrer:c('MercuryShareAttachmentRenderLocations').WEB_INBOX});}if(za._p2pButton)za._p2pButton.setProps({threadID:bb});}function x(za,ab){var bb,cb='';if(ab&&ab.length===1){bb=c('MercuryIDs').getUserIDFromParticipantID(ab[0]);cb=za._prefilledMessages[bb];}c('Input').setValue(za._composerBox,cb);}function y(za,ab){var bb,cb;if(!ab){bb=j._("Envoyer");cb=j._("Votre message...");}else if(ab.participants&&ab.participants.length<=2){bb=j._("R\u00e9pondre");cb=j._("Votre r\u00e9ponse...");}else{bb=j._("R\u00e9pondre \u00e0 tous");cb=j._("Votre r\u00e9ponse...");}if(za._composerBox.getAttribute('placeholder')!=cb)c('Input').setPlaceholder(za._composerBox,cb&&cb.toString());c('Button').setLabel(za._replyButton,bb);ha(za);}function z(za,event){var ab=event.getModifiers();if(ab.any&&event.keyCode!==c('Keys').RETURN)return;var bb=false;switch(event.keyCode){case c('Keys').ESC:var cb=za.getStickersFlyoutToggler();c('Toggler').hide(cb);return;case c('Keys').SPACE:bb=event.getTarget()===za._replyButton;break;case c('Keys').RETURN:var db=!c('CSS').hasClass(za._bottomShelfComposer,s),eb=event.getTarget()===za._replyButton,fb=false;if(!db){if(c('UserAgent_DEPRECATED').windows()){fb=ab.control;}else if(c('UserAgent_DEPRECATED').osx()){fb=ab.meta;}else fb=ab.control||ab.meta;}else if(event.getModifiers().any)return;bb=eb||db||fb;break;case c('Keys').UP:case c('Keys').DOWN:var gb=c('WebMessengerStateManager').getCurrentDetailState();if(za._composerBox.value||gb!=c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES)event.stop();break;}if(bb){ma(za);za.focusComposer();return false;}}function aa(za,event){if(c('UserAgent_DEPRECATED').chrome()){var ab=event.clipboardData||event.originalEvent.clipboardData;if(!ab||!ab.items||ab.items.length<1)return;var bb=ab.items[0].type;if(bb!=='image/png')return;if(ab.items[0].getAsFile){var cb=ab.items[0].getAsFile();za._photoUploader.uploadPastedFile(cb);}}}function ba(za){fa(za);}function ca(za){da(za);var ab=!za._sendOnEnterDefault;za.focusComposer();za._sendOnEnterDefault=ab;c('WebMessengerPreferences').sendOnEnter=ab;var bb=c('XMessagingSetPreferencesController').getURIBuilder().setBool('send_on_enter',ab).getURI();new (c('AsyncRequest'))(bb).send();}function da(za){c('CSS').toggleClass(za._bottomShelfComposer,s);if(c('CSS').hasClass(za._bottomShelfComposer,s)){za._sendOnEnterButton.setAttribute('aria-checked','false');}else za._sendOnEnterButton.setAttribute('aria-checked','true');ha(za,true);c('WebMessengerEvents').detailDOMChanged();}function ea(za,ab){if(ab==c('CSS').hasClass(za._bottomShelfComposer,s))da(za);}function fa(za){var ab;if(c('CSS').hasClass(za._bottomShelfComposer,s)){ab=ga(za);}else ab=0;var bb=c('Vector').getElementDimensions(za._bottomShelfToolbar).x;za._ellipsizer.confineWithin(bb-ab-120,1.3);}function ga(za){return c('Vector').getElementDimensions(za._replyButtonLabel).x+20;}function ha(za,ab){var bb='',cb='';if(!c('CSS').hasClass(za._bottomShelfComposer,s)){cb=ga(za)+'px';bb='-1';za._delegator.disable();}else za._delegator.enable();c('CSS').conditionClass(za._sendContainer,'transition',ab);za._replyButton.setAttribute('tabindex',bb);c('Style').set(za._sendContainer,c('Locale').isRTL()?'right':'left',cb);}function ia(){var za=new (c('URI'))(window.location.href).getQueryData();if(za.source===c('MercurySourceType').PAGES_MESSAGE_SHORTLINK)return c('MercurySourceType').PAGES_MESSAGE_SHORTLINK;return c('MercurySourceType').TITAN_WEB;}function ja(za){var ab=c('WebMessengerStateManager').getCurrentStateData(),bb=o.constructUserGeneratedMessageObject(c('Input').getValue(za._composerBox),ia(),ab.thread_id,ab.participants);if(za._fileUploader){var cb=za._fileUploader.getAttachments();if(cb&&cb.length){bb.has_attachment=true;bb.raw_attachments=cb;}}var db=za._photoUploader.getSelectedFBIDs();if(db.length>0){bb.has_attachment=true;bb.photo_fbids=db;}if(za._fileUploader){var eb=za._fileUploader.getImageFiles();if(eb.length>0){bb.has_attachment=true;bb.image_ids=eb;}var fb=za._fileUploader.getAnimatedImageFiles();if(fb.length>0){bb.has_attachment=true;bb.gif_ids=fb;}var gb=za._fileUploader.getVideoFiles();if(gb.length>0){bb.has_attachment=true;bb.video_ids=gb;}var hb=za._fileUploader.getAudioFiles();if(hb.length>0){bb.has_attachment=true;bb.audio_ids=hb;}var ib=za._fileUploader.getFiles();if(ib.length>0){bb.has_attachment=true;bb.file_ids=ib;}}if(za._shareLinkUploader.getAttachData()){bb.has_attachment=true;bb.content_attachment=za._shareLinkUploader.getAttachData();}bb.force_sms=true;bb.ui_push_phase=c('SiteData').push_phase;return bb;}function ka(za,ab,bb){var cb=za._threadID&&r.getThreadMetaNow(za._threadID);if(cb&&cb.is_canonical&&!c('MercuryThreadInfo').canReply(cb)){na(za._threadID,cb);if(c('CSS').hasClass(za._bottomShelfComposer,s)){c('CSS').hide(za._loadingIndicator);c('CSS').show(za._replyButtonLabel);za._composerBox.removeAttribute('disabled');}return;}za.waterfallStep(c('PhotosUploadWaterfall').SESSION_POSTED);if(za._threadID)za._replySet.add(za._threadID);za._sendSubscription=p.send(ab,function(db){za.waterfallStep(c('PhotosUploadWaterfall').POST_PUBLISHED);if(!bb){k.clearDraft(db);oa(za);}za._messageSent=true;if(za._shouldLogMessageSend)za._logMessageSend();var eb=za.getStickersFlyoutToggler(),fb=false;if(eb)fb=c('Toggler').isShown(eb);var gb=c('MercuryFolders').getFromMeta(r.getThreadMetaNow(db));if(gb===c('MessagingTag').PENDING)n.movePendingToInbox(db);var hb=c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES;if(c('WebMessengerStateManager').getCurrentDetailState()!==hb)c('WebMessengerStateManager').updateDetailState(hb,{thread_id:db,folder:gb,reuse_composer:bb});za._messageSent=false;if(eb&&fb)c('Toggler').show(eb);},c('MercuryAPIArgsSource').WEBMESSENGER);za.focusComposer();}function la(za,ab){var bb=c('WebMessengerStateManager').getCurrentStateData(),cb=o.constructUserGeneratedMessageObject('',c('MercurySourceType').TITAN_WEB,bb.thread_id,bb.participants);if(!cb.thread_id&&!cb.specific_to_list.length)return;cb.has_attachment=true;cb.sticker_id=ab;ka(za,cb,true);}function ma(za){if(za._fileUploader&&za._fileUploader.isUploading()||za._photoUploader.isUploading()){pa(za,true);return;}var ab=ja(za),bb=c('Input').isEmpty(za._composerBox);if(bb&&!ab.has_attachment||!ab.thread_id&&!ab.specific_to_list.length)return;if(c('CSS').hasClass(za._bottomShelfComposer,s)){c('CSS').show(za._loadingIndicator);c('CSS').hide(za._replyButtonLabel);za._composerBox.setAttribute('disabled','disabled');}ka(za,ab);}function na(za,ab){var bb=c('MercuryIDs').getParticipantIDFromFromThreadID(za);c('MercuryParticipants').get(bb,function(cb){c('Bootloader').loadModules(["MessageBlockedDialog"],function(db){db.show(ab.thread_id,ab.can_reply,l.isMessageBlocked(ab),cb.short_name);},'WebMessengerDetailViewBottomShelfControl');});}function oa(za){c('Input').reset(za._composerBox);za._typingDetector&&za._typingDetector.resetState();za._fileUploader&&za._fileUploader.removeAttachments();za._shareLinkUploader.clear();if(za._photoUploader.getSelectedFBIDs().length>0)za._photoUploader.clear();c('CSS').hide(za._loadingIndicator);c('CSS').show(za._replyButtonLabel);za._composerBox.removeAttribute('disabled');if(za._sendSubscription)za._sendSubscription=null;pa(za,false);}function pa(za,ab){c('CSS').conditionShow(za._uploadingWarning,ab);za._blockedOnUpload=ab;}function qa(){var za=c('WebMessengerStateManager').getCurrentDetailState(),ab=c('WebMessengerStateManager').getCurrentStateData();delete ab.message_action;c('WebMessengerStateManager').updateDetailState(za,ab);}function ra(za){var ab=za._manager.getSelectedMessageIDs().length;c('AsyncDialog').send(new (c('AsyncRequest'))('/ajax/mercury/delete_messages_dialog.php').setData({count:ab}),function(bb){bb.subscribe('confirm',sa.bind(null,za,bb));});}function sa(za,ab){var bb=za._manager.getSelectedMessageIDs();p['delete'](za._threadID,bb);ab.hide();var cb=c('WebMessengerStateManager').getCurrentStateData();if(cb.message_action){var db=babelHelpers['extends']({},cb);delete db.message_action;c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateManager').getCurrentDetailState(),db);}}function ta(za){if(za._messageSent)return false;if(!c('Input').isEmpty(za._composerBox))return true;if(za._fileUploader){var ab=za._fileUploader.getAttachments();if(ab&&ab.length||za._fileUploader.getImageFiles().length>0||za._fileUploader.getAnimatedImageFiles().length>0||za._fileUploader.getVideoFiles().length>0||za._fileUploader.getAudioFiles().length>0||za._fileUploader.getFiles().length>0||za._shareLinkUploader.getAttachData()||za._photoUploader.getSelectedFBIDs().length>0)return true;}var bb=c('WebMessengerStateManager').getCurrentStateData(),cb=c('WebMessengerStateManager').getCurrentDetailState(),db=cb==c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN||cb==c('WebMessengerStateConstants').DETAIL.COMPOSE_TYPEAHEAD_RESULTS||cb==c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(db&&!bb.start&&(bb.participants||[]).length)return true;return false;}function ua(za){c('Run').onBeforeUnload(function(){var ab=c('URI').getNextURI();if(!ab.getQueryData().hasOwnProperty('theater')&&!c('VaultBoxURI').isVaultBoxURI(ab))k.saveDraft(za._threadID,za._composerBox,za._fileUploader,za._shareLinkUploader,za._photoUploader);if(!c('isWebMessengerURI')(ab)&&!ab.getQueryData().hasOwnProperty('theater')&&!c('VaultBoxURI').isVaultBoxURI(ab)&&ta(za))return j._("Vous n\u2019avez pas envoy\u00e9 votre message.");},true);c('Run').onBeforeUnload(function(){if(c('isWebMessengerURI')(c('URI').getNextURI())&&ta(za))return j._("Vous n\u2019avez pas envoy\u00e9 votre message.");},false);c('Run').onUnload(function(){k.saveDraft(za._threadID,za._composerBox,za._fileUploader,za._shareLinkUploader,za._photoUploader);});}function va(za,ab){c('CSS').show(za._bottomShelfComposer);c('CSS').addClass(za._bottomShelfComposer,'invisible_elem');c('CSS').conditionClass(za._bottomShelfButtons,'delete',ab==c('WebMessengerStateConstants').MESSAGE_ACTION.DELETE);c('CSS').show(za._bottomShelfButtons);}function wa(za,ab){c('CSS').show(za._bottomShelfComposer);c('CSS').addClass(za._bottomShelfComposer,'invisible_elem');c('CSS').show(za._bottomPendingActions);var bb=c('MessageRequestUtils').isFiltered(ab);c('CSS').conditionClass(za._bottomPendingIgnoreAction,"hidden_elem",bb);c('CSS').conditionClass(za._bottomPendingDeleteAction,"hidden_elem",!bb);}function xa(za){if(za._typingDetector){var ab=za._threadID,bb=null;if(ab){bb=c('MercuryIDs').getUserIDFromThreadID(ab);var cb=r.getThreadMetaNow(ab);if((!cb||cb.is_canonical)&&!bb)ab=null;}if(!ab){za._typingDetector.setUserAndThread(bb,ab);return;}m.getServerIDFromClientID(ab,function(db){za._typingDetector.setUserAndThread(bb,db);});}}function ya(za,ab,bb){if(c('containsNode')(c('ge')(za._ariaOwns),c('ge')(bb)))za._composerBox.setAttribute('aria-activedescendant',bb);}f.exports=t;}),null);
__d('MercurySeenByAll',['CSS','DataStore','MercuryDelayedRoger','DOM','MercuryIDs','MercuryViewer','MercuryThreads'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryDelayedRoger').get(),i=c('MercuryThreads').get(),j={},k={updateOnSeenChange:function m(n,o,p){j[n.tagName]=true;c('DataStore').set(n,'thread-id',o.thread_id);c('CSS').addClass(n,'seenByListener');l(n,o,p);}};function l(m,n,o){var p=null;if(o){p=c('MercuryIDs').getParticipantIDFromUserID(o);}else p=c('MercuryViewer').getID();var q=n.participants.filter(function(s){return s!==p;}),r=n.participants.length>0&&n.participants[0]===p;c('CSS').conditionClass(m,'repliedLast',r);c('CSS').conditionClass(m,'seenByAll',r&&h.getSeenBy(n.thread_id).length===q.length);}h.subscribe('state-changed',function(m,n){for(var o in j){var p=c('DOM').scry(document.body,o+'.seenByListener');for(var q=0;q<p.length;q++){var r=p[q],s=c('DataStore').get(r,'thread-id');if(n[s])i.getThreadMeta(s,function(t){l(r,t);});}}});f.exports=k;}),null);
__d('MercuryThreadMetadataRenderer',['cx','fbt','CSS','DOM','DOMEmoji','DOMEmote','JSLogger','MercuryAttachmentType','MercuryIDs','MercuryMessageSourceTags','MercurySingletonProvider','MercuryThreadImage.react','MercuryThreadIDMap','MercuryThreadMetadataRawRenderer','MercuryThreadTitle.react','MercuryTimestamp','MNAdsLogMessageUtils','MNAdsMessageUtils','MercuryParticipants','React','ReactDOM','MercurySeenByAll','MercuryServerRequests','Style','MercuryThreads','Tooltip','URI','WebMessengerThreadPermalinks','WorkModeConfig','arrayContains','createArrayFromMixed','formatDate','transformTextToDOM'],(function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('JSLogger').create('wm_timestamp');function k(p){this.$MercuryThreadMetadataRenderer1=p;this.$MercuryThreadMetadataRenderer2=c('MercuryServerRequests').getForFBID(p);this.$MercuryThreadMetadataRenderer3=c('MercuryThreads').getForFBID(p);this.$MercuryThreadMetadataRenderer4=c('MercuryThreadIDMap').getForFBID(p);}k.getForFBID=function(p){return o.getForFBID(p);};k.get=function(){return o.get();};k.prototype.renderTimestamp=function(p,q,r,s){if(s){if(!q){j.warn('no_title');q=new Date(s).toLocaleDateString();}p.setAttribute('title',q);p.setAttribute('data-utime',(s/1000).toString());if(!r){j.warn('no_display');r=c('formatDate')(new Date(s),'g:ia');}c('DOM').setContent(p,r);c('CSS').show(p);}};k.prototype.renderMessageSourceTags=function(p,q,r,s){var t='',u='',v='';if(c('arrayContains')(r,c('MercuryMessageSourceTags').MESSENGER)){v="_9g";if(!c('WorkModeConfig').is_work_user){t=i._("Envoy\u00e9 depuis Messenger");u=new (c('URI'))('/mobile/messenger');}else{t=i._("Sent from Work Chat");u=new (c('URI'))('https://work.fb.com/workchat/');}}else if(c('arrayContains')(r,c('MercuryMessageSourceTags').MOBILE)){t=i._("Envoy\u00e9 depuis un mobile");u=new (c('URI'))('/mobile/');v="_9j";}else if(c('arrayContains')(r,c('MercuryMessageSourceTags').CHAT)){t=i._("Envoy\u00e9 depuis le chat.");v="_9h";}else if(c('arrayContains')(r,c('MercuryMessageSourceTags').EMAIL)){if(s){t=i._("Envoy\u00e9 depuis {email}",[i.param('email',s)]);}else t=i._("Envoy\u00e9 par e-mail");v="_9i";}if(v){c('Tooltip').set(p,t);c('CSS').addClass(q,v);if(u){p.setAttribute('href',u);}else p.removeAttribute('href');}else c('CSS').hide(p);};k.prototype.renderSpoofWarning=function(p,q,r){if(q){c('CSS').addClass(p,"_sa");c('Tooltip').set(p,i._("Impossible de confirmer {name_or_email} en tant qu\u2019exp\u00e9diteur.",[i.param('name_or_email',r.name)]));}};k.prototype.renderChatSpoofWarning=function(p,q,r){if(q)c('DOM').appendContent(p,i._("Impossible de confirmer {name_or_email} en tant qu\u2019exp\u00e9diteur.",[i.param('name_or_email',r.name)]));};k.prototype.renderAdsMessageRequestStatus=function(p,q){if(q)c('ReactDOM').render(q,p);c('CSS').show(p);};k.prototype.renderCoreThreadlist=function(p,q,r,s,t){s=s||{};this.renderThreadImage(p,q.getNode('image'));var u=q.getNode('accessibleName'),v=[q.getNode('name')];if(u)v.push(u);this.$MercuryThreadMetadataRenderer5(p,v,s);if(p.folder&&t)n(q.getNode('folderBadge'),p.folder);var w=q.getNode('timestamp');if(c('MNAdsMessageUtils').isAdsMessageRequest(p)){this.renderAdsMessageRequestStatus(w,c('MNAdsMessageUtils').renderAdsMessageRequestStatus());}else this.renderTimestamp(w,String(c('MercuryTimestamp').getAbsoluteTimestamp(p.timestamp)),String(c('MercuryTimestamp').getRelativeTimestamp(p.timestamp)),p.timestamp);this.renderSnippet(p,q.getNode('snippet'));m(q,p);r(q,p);};k.prototype.renderAndSeparatedParticipantList=function(p,q,r){r=r||{};r.last_separator_uses_and=true;this.$MercuryThreadMetadataRenderer3.getThreadMeta(p,function(s){this.$MercuryThreadMetadataRenderer5(s,q,r);}.bind(this));};k.prototype.renderSnippet=function(p,q){var r=false,s=c('DOM').create('span');c('CSS').addClass(s,"_3jy5");c('DOM').appendContent(q,s);c('MercurySeenByAll').updateOnSeenChange(s,p,this.$MercuryThreadMetadataRenderer1);c('MNAdsLogMessageUtils').logAdsThreadListImpression(p);var t=p.snippet;if(t){if(p.snippet_attachments&&p.snippet_attachments.length>0)c('DOM').appendContent(q,c('DOM').create('span',{className:"_j0r"}));if(t.substr(0,4)=='?OTR'){t=i._("[message chiffr\u00e9]");}else t=t.replace(/\r\n|[\r\n]/g," ");t=c('transformTextToDOM')(t,[c('DOMEmoji').params({renderInMessenger:true}),c('DOMEmote').params({renderInMessenger:true})]);}else if(p.snippet_attachments&&p.snippet_attachments.length){r=true;t=c('DOM').create('span');e(['MercuryAttachmentSnippet.react'],function(w){c('ReactDOM').render(c('React').createElement(w,{thread:p,viewer:this.$MercuryThreadMetadataRenderer1}),t);}.bind(this));}var u=p.participants.length;if(p.is_subscribed)u--;var v=p.snippet_sender;if(!r&&v&&c('MercuryIDs').getParticipantIDFromUserID(this.$MercuryThreadMetadataRenderer1)!=v&&u>1){c('MercuryParticipants').get(v,function(w){if(w.short_name){c('DOM').appendContent(q,i._("{name}\u00a0: {conversation_snippet}",[i.param('name',w.short_name),i.param('conversation_snippet',t)]));}else c('DOM').appendContent(q,t);});}else c('DOM').appendContent(q,t);};k.prototype.renderWebMessengerLink=function(p,q,r,s){c('WebMessengerThreadPermalinks').getThreadURI(p,function(t){q.setAttribute('href',t);r&&r();},s);};k.prototype.renderThreadImage=function(p,q){c('ReactDOM').render(c('React').createElement(c('MercuryThreadImage.react'),{thread:p,viewer:this.$MercuryThreadMetadataRenderer1}),q);};k.prototype.renderParticipantList=function(p,q,r,s){return c('MercuryThreadMetadataRawRenderer').renderRawParticipantList(this.$MercuryThreadMetadataRenderer4.getServerIDFromClientIDNow(p),q,r,s);};k.prototype.renderThreadNameAndParticipantList=function(p,q,r,s){var t=c('MercuryThreadMetadataRawRenderer').renderRawParticipantList(this.$MercuryThreadMetadataRenderer4.getServerIDFromClientIDNow(p),q,r,s),u=this.$MercuryThreadMetadataRenderer3.getThreadMetaNow(p);if(!u)return null;if(!u.name)return t;return i._("{conversation_name} [avec {participant_list}]",[i.param('conversation_name',u.name),i.param('participant_list',t)]);};k.prototype.renderParticipantCount=function(p,q){return c('MercuryThreadMetadataRawRenderer').renderRawParticipantCount(q);};k.prototype.$MercuryThreadMetadataRenderer5=function(p,q,r){q=c('createArrayFromMixed')(q);var s=this.$MercuryThreadMetadataRenderer1;if(p.name){q.forEach(function(u){c('ReactDOM').render(c('React').createElement(c('MercuryThreadTitle.react'),{thread:p,viewer:s,showUnreadCount:!!r.show_unread_count}),u);});return;}var t=p.participants;if(p.participants.length>1)t=p.participants.filter(function(u){return u!=c('MercuryIDs').getParticipantIDFromUserID(s);});c('MercuryParticipants').getMulti(t,function(u){c('MercuryThreadMetadataRawRenderer').renderParticipantListWithNoThreadName(this.$MercuryThreadMetadataRenderer4.getServerIDFromClientIDNow(p.thread_id),p,t,u,q,r);}.bind(this));};function l(p){if(!p.snippet_attachments)return [];return p.snippet_attachments.filter(function(q){return q.attach_type===c('MercuryAttachmentType').PHOTO;});}function m(p,q){var r=l(q);if(r.length===0)return;var s=r[0].thumbnail_url;if(!s)return;var t=r.length==1?'snippet-thumbnail-single':'snippet-thumbnail-multiple',u=p.getNode(t);if(!u)return;var v=c('DOM').find(u,'i');c('Style').set(v,'background-image','url('+s+')');c('CSS').show(u);}function n(p,q){c('createArrayFromMixed')(p).forEach(function(r){c('DOM').setContent(r,q);});}var o=new (c('MercurySingletonProvider'))(k);f.exports=k;}),null);
__d('MercuryDataSourceHelper',['MercuryPayloadSource','MercuryTypeaheadConstants','MercuryServerPayloadPreprocessor','MercuryThreadMetadataRawRenderer','MercuryThreadMetadataRenderer'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryServerPayloadPreprocessor').get(),i=c('MercuryThreadMetadataRenderer').get(),j={updateMercuryOnFetchComplete:function k(l){l.subscribe('fetchComplete',function(m,n){var o={participants:[],threads:[],pages:[],payload_source:c('MercuryPayloadSource').SERVER_SEARCH};n.response.getPayload().entries.forEach(function(p){if(p.type==c('MercuryTypeaheadConstants').THREAD_TYPE){o.threads=o.threads.concat(p.mercury_thread);o.participants=o.participants.concat(p.participants_to_render);}else if(p.type==c('MercuryTypeaheadConstants').PAGE_TYPE)o.pages=o.pages.concat(p);});if(o.threads.length){h.handleUpdate(o);n.response.getPayload().entries.forEach(function(p){if(p.mercury_thread)p.text=i.renderThreadNameAndParticipantList(p.mercury_thread.thread_id,p.participants_to_render,p.mercury_thread.participants.length,{last_separator_uses_and:false,names_renderer:c('MercuryThreadMetadataRawRenderer').renderShortNames});});}});}};f.exports=j;}),null);
__d('WebMessengerComposerTypeaheadView',['cx','fbt','BucketedTypeaheadView','CSS','DataStore','MercuryTypeaheadConstants','WebMessengerStateConstants','WebMessengerStateManager'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();j=babelHelpers.inherits(l,c('BucketedTypeaheadView'));k=j&&j.prototype;function l(p,q){'use strict';k.constructor.call(this,p,q);this.typeObjects={};this.typeObjects[c('MercuryTypeaheadConstants').FRIEND_TYPE]={disabled:true,uid:c('MercuryTypeaheadConstants').FRIEND_TYPE,type:c('MercuryTypeaheadConstants').HEADER_TYPE};this.typeObjects[c('MercuryTypeaheadConstants').THREAD_TYPE]={uid:c('MercuryTypeaheadConstants').THREAD_TYPE,text:i._("Conversations de groupe"),type:c('MercuryTypeaheadConstants').HEADER_TYPE,linkText:i._("Afficher plus"),getLinkHandler:o.bind(null,this)};this.typeObjects[c('MercuryTypeaheadConstants').PAGE_TYPE]={uid:c('MercuryTypeaheadConstants').PAGE_TYPE,text:i._("Entreprises"),type:c('MercuryTypeaheadConstants').HEADER_TYPE};this.typeObjects[c('MercuryTypeaheadConstants').COMMERCE_PAGE_TYPE]=this.typeObjects[c('MercuryTypeaheadConstants').PAGE_TYPE];this.typeObjects[c('MercuryTypeaheadConstants').MEETING_ROOM_PAGE_TYPE]={uid:c('MercuryTypeaheadConstants').PAGE_TYPE,text:i._("Salles de r\u00e9union"),type:c('MercuryTypeaheadConstants').HEADER_TYPE};this.typeObjects[c('MercuryTypeaheadConstants').FB4C_TYPE]={uid:c('MercuryTypeaheadConstants').THREAD_TYPE,text:i._("Coll\u00e8gues"),type:c('MercuryTypeaheadConstants').HEADER_TYPE};this.typeObjects[c('MercuryTypeaheadConstants').NON_FRIEND_TYPE]={uid:c('MercuryTypeaheadConstants').NON_FRIEND_TYPE,text:i._("Autres personnes"),type:c('MercuryTypeaheadConstants').HEADER_TYPE,linkText:i._("Afficher tout"),getLinkHandler:function(){return function(){n(this.value);}.bind(this);}.bind(this)};}l.prototype.setTypeahead=function(p){'use strict';k.setTypeahead.call(this,p);var q=c('DataStore').get(p,'Typeahead');q.subscribe('loading',function(r,s){var t=q.getData();if(this._threadHeader)c('CSS').conditionClass(this._threadHeader,"_355",t.isLoadingMore(this.value));}.bind(this));};l.prototype.setNewHeader=function(p,q){'use strict';if(q.uid===c('MercuryTypeaheadConstants').THREAD_TYPE)this._threadHeader=p;};l.prototype.mouseover=function(event){'use strict';if(!m(this,event))k.mouseover.call(this,event);};l.prototype.mouseup=function(event){'use strict';if(!m(this,event))k.mouseup.call(this,event);};l.prototype.clearSelected=function(){'use strict';this.index=-1;this.highlight(-1);};function m(p,event){var q=p.getIndex(event);return q>=0&&q<p.results.length&&p.results[q].type==c('MercuryTypeaheadConstants').HEADER_TYPE;}function n(p){var q=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{all_people_query:p,start:false});c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,q);}function o(p){var q=c('DataStore').get(p.typeahead,'Typeahead'),r=q.getData();if(r.hasLoadedInitialResults(p.value)&&!r.hasLoadedAllResults(p.value))return r.loadMore.bind(r);}f.exports=l;}),null);
__d('MercuryExpandableDataSource',['MercuryTypeaheadDataSource'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('MercuryTypeaheadDataSource'));i=h&&h.prototype;function j(k,l,m){'use strict';k=k||{};k.maxResults=l;i.constructor.call(this,k);this.$MercuryExpandableDataSource1=l;this.$MercuryExpandableDataSource2=m;this.$MercuryExpandableDataSource3={};}j.prototype.query=function(k,l,m){'use strict';this.setQueryData({offset:0,limit:this.$MercuryExpandableDataSource1});return i.query.call(this,k,l,m);};j.prototype.fetchHandler=function(k,l){'use strict';var m=k.getPayload(),n=l.value;this.getState('is_loading_more_per_query')[n]=false;this.getState('total_results_count_per_query')[n]=m.total_count;i.fetchHandler.call(this,k,l);};j.prototype.loadMore=function(){'use strict';if(this.value&&!this.hasLoadedAllResults()){var k=this.getState('max_results_per_query');if(!k[this.value])k[this.value]=this.$MercuryExpandableDataSource1;this.setQueryData({offset:k[this.value],limit:this.$MercuryExpandableDataSource2});k[this.value]+=this.$MercuryExpandableDataSource2;if(k[this.value]>this.$MercuryExpandableDataSource4)this.$MercuryExpandableDataSource4=k[this.value];this.getState('is_loading_more_per_query')[this.value]=true;this.fetch(this.queryEndpoint,this.getQueryData(this.value,this.buildUids(this.value)),{value:this.value});}};j.prototype.isLoadingMore=function(){'use strict';return this.getState('is_loading_more_per_query')[this.value];};j.prototype.hasLoadedAllResults=function(){'use strict';var k=this.getState('total_results_count_per_query')[this.value],l=(this.buildQueryResults(this.value)||[]).length;return k&&l>=k;};j.prototype.getStates=function(){'use strict';return this.$MercuryExpandableDataSource3;};j.prototype.getState=function(k){'use strict';var l=this.getStates();if(!l[k])l[k]={};return l[k];};f.exports=j;}),null);
__d('WebMessengerTypeaheadDataSource',['MercuryExpandableDataSource','MercuryIDs','MercuryParticipants','MercuryTypeaheadConstants','WebMessengerStateManager'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('MercuryExpandableDataSource'));i=h&&h.prototype;function j(m){'use strict';m=m||{};m.kanaNormalization=true;i.constructor.call(this,m,c('MercuryTypeaheadConstants').COMPOSER_THREADS_INITIAL_LIMIT,c('MercuryTypeaheadConstants').COMPOSER_SHOW_MORE_LIMIT);this.setMaxResults(c('MercuryTypeaheadConstants').COMPOSER_WM_MAX);}j.prototype.bootstrap=function(){'use strict';if(!i.bootstrap.call(this))this.fetchEntryBigProfilePic();};j.prototype.updateBootstrapData=function(){'use strict';i.updateBootstrapData.call(this);this.fetchEntryBigProfilePic();};j.prototype.buildData=function(m){'use strict';var n=[],o=[],p=[],q=[],r=[];m.forEach(function(t){var u=i.getEntry.call(this,t);switch(u.render_type){case c('MercuryTypeaheadConstants').FRIEND_TYPE:if(n.length<c('MercuryTypeaheadConstants').COMPOSER_FRIENDS_MAX)n.push(t);break;case c('MercuryTypeaheadConstants').THREAD_TYPE:var v=u.mercury_thread.thread_fbid;u.uid=v;i.setEntry.call(this,v,u);if(k().length===0)o.push(v);break;case c('MercuryTypeaheadConstants').NON_FRIEND_TYPE:if(p.length<c('MercuryTypeaheadConstants').COMPOSER_NON_FRIENDS_MAX)p.push(t);break;case c('MercuryTypeaheadConstants').FB4C_TYPE:if(q.length<c('MercuryTypeaheadConstants').COMPOSER_FB4C_MAX)q.push(t);break;case c('MercuryTypeaheadConstants').PAGE_TYPE:case c('MercuryTypeaheadConstants').COMMERCE_PAGE_TYPE:case c('MercuryTypeaheadConstants').MEETING_ROOM_PAGE_TYPE:if(r.length<c('MercuryTypeaheadConstants').COMPOSER_PAGES_MAX&&k().length===0)r.push(t);break;}}.bind(this),this);var s=n.concat(q,o,r,p);return i.buildData.call(this,s);};j.prototype.query=function(m,n,o){'use strict';this.value=m;if(!i.query.call(this,m,n,o)){if(this.getState('loaded_all_threads_per_query')[m]==null)this.getState('loaded_all_threads_per_query')[m]=true;this.getState('loaded_initial_per_query')[m]=true;}};j.prototype.respond=function(m,n,o){'use strict';return i.respond.call(this,m,n,o);};j.prototype.getQueryData=function(m,n){'use strict';var o=i.getQueryData.call(this,m,n);o.existing_token_ids=k();return o;};j.prototype.fetchHandler=function(m,n){'use strict';this.getState('loaded_all_threads_per_query')[n.value]=m.getPayload().end_of_threads;this.getState('loaded_initial_per_query')[n.value]=true;i.fetchHandler.call(this,m,n);};j.prototype.hasLoadedInitialResults=function(m){'use strict';if(m===undefined)m=this.value;return this.getState('loaded_initial_per_query')[m]||m&&m.length<=1;};j.prototype.hasLoadedAllResults=function(m){'use strict';if(m===undefined)m=this.value;return this.getState('loaded_all_threads_per_query')[m];};j.prototype.fetchEntryBigProfilePic=function(){'use strict';var m=this.getCachedShortProfileIDs().map(function(n){return c('MercuryIDs').getParticipantIDFromUserID(n);});c('MercuryParticipants').getBigImageMulti(m,l.bind(this));};j.prototype.loadMore=function(){'use strict';this.setMaxResults(this.buildQueryResults(this.value).length+c('MercuryTypeaheadConstants').COMPOSER_SHOW_MORE_LIMIT*2);i.loadMore.call(this);};function k(){var m=c('WebMessengerStateManager').getCurrentStateData();return (m.participants||[]).map(function(n){return c('MercuryIDs').tokenize(n).value;});}function l(m){for(var n in m)if(m.hasOwnProperty(n)){var o=this.getEntry(c('MercuryIDs').getUserIDFromParticipantID(n));if(o)o.photo=m[n];}if(this.value)this.query(this.value);}f.exports=j;}),null);
__d('WebMessengerTypeaheadRenderer',['CurrentUser','DOM','ImmutableObject','MercuryAPIArgsSource','MercuryThreadImage.react','MercuryThreadIDMap','MercuryTimestamp','MercuryTypeaheadConstants','MercuryTypeaheadRenderer','React','ReactDOM','WebMessengerTemplates','MercuryThreadMetadataRawRenderer','MercuryThreadMetadataRenderer','MercuryThreads'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadIDMap').get(),i=c('MercuryThreadMetadataRenderer').get(),j=c('MercuryThreads').get(),k=50;function l(n,o){var p;switch(n.type){case c('MercuryTypeaheadConstants').HEADER_TYPE:p=c('WebMessengerTemplates')[':fb:web-messenger:typeahead-header'].build();c('MercuryTypeaheadRenderer').renderHeader(p,n);if(this.setNewHeader)this.setNewHeader(p.getRoot(),n);break;case c('MercuryTypeaheadConstants').USER_TYPE:case c('MercuryTypeaheadConstants').PAGE_TYPE:p=c('WebMessengerTemplates')[':fb:web-messenger:threadlist-row'].build();c('MercuryTypeaheadRenderer').renderPersonWithBigPhoto(p,n);break;case c('MercuryTypeaheadConstants').THREAD_TYPE:p=c('WebMessengerTemplates')[':fb:web-messenger:threadlist-row'].build();m(p,n);break;default:return c('DOM').create('div');}return p.getRoot();}function m(n,o){var p=h.getClientIDFromServerIDNow(o.uid),q=c('React').createElement(c('MercuryThreadImage.react'),{size:k,thread:new (c('ImmutableObject'))(o.mercury_thread),viewer:c('CurrentUser').getID()});c('ReactDOM').render(q,n.getNode('image'));var r=i.renderThreadNameAndParticipantList(p,o.participants_to_render,o.mercury_thread.participants.length,{last_separator_uses_and:false,names_renderer:c('MercuryThreadMetadataRawRenderer').renderShortNames});c('DOM').setContent(n.getNode('name'),r);n.getRoot().setAttribute('data-tooltip-content',r);j.getThreadMeta(p,function(s){i.renderSnippet(s,n.getNode('snippet'));i.renderTimestamp(n.getNode('timestamp'),String(c('MercuryTimestamp').getAbsoluteTimestamp(s.timestamp)),String(c('MercuryTimestamp').getRelativeTimestamp(s.timestamp)),s.timestamp);},c('MercuryAPIArgsSource').WEBMESSENGER);}f.exports=l;}),null);
__d('WebMessengerDetailViewComposeTypeaheadControl',['fbt','Event','WebMessengerComposerTypeaheadView','CSS','DOM','MercuryFolders','Keys','MercuryDataSourceHelper','MercuryIDs','MercuryTypeahead','MercuryTypeaheadConstants','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','MercuryThreads','WebMessengerEvents','WebMessengerTypeaheadDataSource','WebMessengerSubscriptionsHandler','WebMessengerTypeaheadRenderer'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('MercuryThreads').get();function j(n,o){'use strict';this._typeaheadRoot=n;this._resultsRoot=o;c('DOM').empty(this._typeaheadRoot);c('DOM').empty(this._resultsRoot);}j.prototype.hideView=function(){'use strict';c('CSS').hide(this._typeaheadRoot);c('CSS').hide(this._resultsRoot);};j.prototype.updateView=function(){'use strict';var n=c('WebMessengerStateConstants');switch(c('WebMessengerStateManager').getCurrentDetailState()){case n.DETAIL.COMPOSE_MAIN:this.renderComposeTypeahead();c('CSS').hide(this._resultsRoot);break;case n.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this.renderComposeTypeahead();c('CSS').show(this._resultsRoot);break;}c('WebMessengerEvents').detailDOMChanged();};j.prototype.renderComposeTypeahead=function(){'use strict';var n=c('WebMessengerStateManager').getCurrentStateData();c('CSS').show(this._typeaheadRoot);c('CSS').show(this._resultsRoot);if(!this._initiated){var o=c('WebMessengerTemplates')[':fb:web-messenger:read-view:compose:typeahead'].build();c('DOM').setContent(this._typeaheadRoot,o.getRoot());var p=c('WebMessengerTemplates')[':fb:web-messenger:read-view:compose:typeahead:results'].build();c('DOM').setContent(this._resultsRoot,p.getRoot());this._initialResultsLoadingSpinner=p.getNode('initialResultsLoadingSpinner');this._typeaheadFooter=p.getNode('typeaheadFooter');this._moreResultsLink=p.getNode('moreResultsLink');this._typeaheadCaption=p.getNode('caption');this.buildTypeahead(p.getNode('results'));c('DOM').appendContent(o.getNode('typeahead'),this._typeahead.getElement());this._initiated=true;}if(n.start){if(!n.participants)this._typeahead.reset();this._typeahead.focus();var q=this._typeahead.getTypeahead().getCore();q.getElement().removeAttribute('disabled');}l(this);if(n.start)c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateManager').getCurrentDetailState(),babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{start:false,new_tokens:undefined}));};j.prototype.buildTypeahead=function(n){'use strict';if(this._typeahead)return;var o=new (c('WebMessengerTypeaheadDataSource'))({queryEndpoint:'/ajax/mercury/composer_query.php'});c('MercuryDataSourceHelper').updateMercuryOnFetchComplete(o);var p=new (c('MercuryTypeahead'))(o,c('WebMessengerComposerTypeaheadView'));p.setPlaceholder(h._("Nom"));p.setViewNodeID(n);p.setViewOption('renderer',c('WebMessengerTypeaheadRenderer'));c('WebMessengerSubscriptionsHandler').addSubscriptions(p.subscribe('tokens-changed',this.onTokensChanged.bind(this)));p.build();c('WebMessengerSubscriptionsHandler').addSubscriptions(p.getTypeahead().subscribe(['respond','focus'],function(){k(!!p.getTypeahead().getCore().getValue());}),p.getTypeahead().subscribe(['reset','blur'],function(){k(false);}),p.getTypeahead().subscribe('render',function(q,r){m(this,r.length);}.bind(this)),p.getTypeahead().subscribe('reset',function(){m(this,false);}.bind(this)),p.getTypeahead().subscribe('query',function(q,r){c('DOM').setContent(this._moreResultsLink,h._("Voir plus de r\u00e9sultats pour {query}",[h.param('query',r.value)]));}.bind(this)),c('Event').listen(p.getElement(),'keydown',function(q){if(q.keyCode===c('Keys').TAB&&!q.getModifiers().any){c('WebMessengerEvents').focusComposer();return false;}}),c('Event').listen(this._typeaheadFooter,'mousedown',function(){return false;}),c('Event').listen(this._moreResultsLink,'click',function(){var q=this._typeahead.getTypeahead().getCore().getValue(),r=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{all_people_query:q,start:false});c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,r);}.bind(this)),c('Event').listen(this._typeaheadFooter,'mouseover',function(){this._typeahead.getTypeahead().getView().clearSelected();}.bind(this)));this._typeahead=p;};j.prototype.onTokensChanged=function(){'use strict';var n=c('WebMessengerStateManager').getCurrentDetailState();if(n==c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN||n==c('WebMessengerStateConstants').DETAIL.COMPOSE_TYPEAHEAD_RESULTS||n==c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){var o=this._typeahead,p=o.getTokens(),q=p[p.length-1];if(q&&q.getInfo().mercury_thread){var r=q.getInfo().mercury_thread.thread_id,s=c('MercuryFolders').getFromMeta(i.getThreadMetaNow(r));c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{thread_id:r,folder:s,reuse_composer:true});}else{var t=p.map(function(v){if(v.getInfo().render_type===c('MercuryTypeaheadConstants').MEETING_ROOM_PAGE_TYPE){o.getTypeahead().getCore().reset();o.getTokenizer().removeToken(v);window.open('/'+v.getInfo().uid,'_blank');return null;}if(v.getInfo().type===c('MercuryTypeaheadConstants').PAGE_TYPE){var w=o.getTypeahead().getCore();w.getElement().setAttribute('disabled','disabled');}return c('MercuryIDs').getParticipantIDFromUserID(v.getValue());}).filter(Boolean),u=c('WebMessengerStateManager').getCurrentStateData();if(!u.start||(t||[]).length)c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN,babelHelpers['extends']({},u,{participants:t}));}}};j.prototype.destroy=function(){'use strict';};function k(n){var o=c('WebMessengerStateManager').getCurrentDetailState(),p=c('WebMessengerStateConstants');if(o!=p.DETAIL.COMPOSE_MAIN&&o!=p.DETAIL.COMPOSE_TYPEAHEAD_RESULTS)return;var q;if(n){q=p.DETAIL.COMPOSE_TYPEAHEAD_RESULTS;}else if(o==p.DETAIL.COMPOSE_TYPEAHEAD_RESULTS){q=p.DETAIL.COMPOSE_MAIN;}else q=o;if(q!=o){var r=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{start:false,new_tokens:undefined});c('WebMessengerStateManager').updateDetailState(q,r);}}function l(n){var o=c('WebMessengerStateManager').getCurrentStateData();if(o.new_tokens){var p=n._typeahead.getTypeahead().getCore();p.reset();o.new_tokens.forEach(function(q){n._typeahead.getTokenizer().addToken(q);});}}function m(n,o){var p=n._typeahead.getTypeahead(),q=p.getCore().getValue(),r=p.getData().hasLoadedInitialResults(q);c('CSS').conditionShow(n._initialResultsLoadingSpinner,!r);c('CSS').conditionShow(n._moreResultsLink,r&&o);if(!o&&r){c('DOM').setContent(n._typeaheadCaption,h._("La recherche n\u2019a donn\u00e9 aucun r\u00e9sultat."));}else c('DOM').setContent(n._typeaheadCaption,h._("Affichage des principaux r\u00e9sultats"));}f.exports=j;}),null);
__d('MercuryPresence',['fbt','Arbiter','AvailableListConstants','DOM','CSS','requireWeak'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={},j={},k={updateOnPresenceChanges:function q(r,s){j[s.tagName]=true;i[r]=true;c('CSS').addClass(s,'presenceListener_'+r);var t=l(r);m(s,t.classes);n(s,t.label);}};function l(q){var r=p(q),s={presenceActive:false,presenceMobile:false},t=null;switch(r){case c('AvailableListConstants').ACTIVE:s.presenceActive=true;t=h._("Actif");break;case c('AvailableListConstants').MOBILE:s.presenceMobile=true;t=h._("Mobile");break;default:break;}return {classes:s,label:t};}function m(q,r){for(var s in r)c('CSS').conditionClass(q,s,r[s]);}function n(q,r){if(q&&r){var s=c('DOM').create('span',{className:'accessible_elem'},r);c('DOM').setContent(q,s);}}function o(){for(var q in i){var r=l(q);for(var s in j){var t=c('DOM').scry(document,s+'.presenceListener_'+q);for(var u=0;u<t.length;u++){m(t[u],r.classes);n(t[u],r.label);}}}}var p=function q(r){return c('AvailableListConstants').OFFLINE;};c('requireWeak')('AvailableList',function(q){p=q.get;o();});c('Arbiter').subscribe(c('AvailableListConstants').ON_AVAILABILITY_CHANGED,o);f.exports=k;}),null);
__d('WebMessengerDetailViewHeaderControl',['csx','cx','fbt','WebMessengerAddPeopleToConversationDialog','Autosize','AvailableListConstants','Bootloader','ChatOpenTabEventLogger','ContextualDialog','CSS','DOM','WebMessengerEditThreadDialog','Event','HovercardLink','HoverFlyout','JSXDOM','LastActiveTimes','LayerFadeOnHide','LayerFadeOnShow','LayerHideOnTransition','MercuryAPIArgsSource','MercuryConfig','MercuryIDs','MercuryThreadInfo','MercuryViewer','MNCommerceDialogStateActions','MNCommercePromotionBlockDataManager','MNCommercePromotionManageBlockDialogContainer.react','MercuryParticipants','MercuryPresence','ScrollableArea','WebMessengerStateConstants','WebMessengerStateManager','Style','WebMessengerTemplates','MercuryThreadInformer','MercuryThreadMetadataRenderer','MercuryThreads','Tooltip','WebMessengerConstants','WebMessengerEvents','WebMessengerSubscriptionsHandler','curry','isNode'],(function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercuryThreadInformer').get(),l=c('MercuryThreadMetadataRenderer').get(),m=c('MercuryThreads').get(),n=null;function o(y){'use strict';this._rootElement=y;c('DOM').empty(this._rootElement);this._renderHeaderBar();}o.prototype.hideView=function(){'use strict';c('CSS').hide(this._rootElement);};o.prototype.updateView=function(){'use strict';c('CSS').removeClass(this._rootElement,'hasMultiChatThreadActions');c('CSS').show(this._rootElement);if(this._listener){k.unsubscribe(this._listener);this._listener=null;}var y=c('WebMessengerStateConstants');switch(c('WebMessengerStateManager').getCurrentDetailState()){case y.DETAIL.RECENT_MESSAGES:case y.DETAIL.SEARCH_CONTEXT:case y.DETAIL.SEARCH_THREAD_SNIPPET:case y.DETAIL.SHARED_PHOTOS:this.setThreadID(c('WebMessengerStateManager').getCurrentStateData().thread_id);break;default:this.setThreadID(null);break;}c('WebMessengerEvents').detailDOMChanged();};o.prototype.setThreadID=function(y){'use strict';this._threadID=y;if(this._threadID){this._listener=k.listen(this._threadID,this.updateView.bind(this));c('WebMessengerSubscriptionsHandler').addSubscriptions(this._listener);}y&&m.getThreadMeta(y,function(z){if(this._threadID==y)c('CSS').conditionClass(this._rootElement,'hasMultiChatThreadActions',!z.is_canonical&&c('MercuryThreadInfo').canReply(z));}.bind(this));};o.prototype._renderHeaderBar=function(){'use strict';this._headerBar=c('WebMessengerTemplates')[':fb:web-messenger:read-view:header'].build();c('DOM').appendContent(this._rootElement,this._headerBar.getRoot());var y=this._headerBar.getNode('editThreadName'),z=this._headerBar.getNode('addPeopleToThread'),aa=new (c('WebMessengerEditThreadDialog'))(),ba=this._headerBar.getNode('webMessengerManageButton'),ca=function da(ea,fa){return c('MNCommercePromotionBlockDataManager').block(ea,fa);};this._title_node_wrapper=this._headerBar.getNode('headerName');this._relationship_status=this._headerBar.getNode('relationshipStatus');c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(this._headerBar.getNode('closeButton'),'click',function(){var da=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData(),{all_people_query:undefined});c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN,da);}),c('Event').listen(y,'click',function(event){this._threadID&&aa.toggleShown(this._headerBar.getNode('headerName'),this._threadID);return true;}.bind(this)),c('Event').listen(z,'click',function(event){this._threadID&&c('WebMessengerAddPeopleToConversationDialog').show(this._threadID);return true;}.bind(this)),c('Event').listen(ba,'click',function(event){this._threadID&&c('MNCommerceDialogStateActions').showDialog(c('MNCommercePromotionManageBlockDialogContainer.react'),{pageID:c('MercuryIDs').getUserIDFromThreadID(this._threadID),onConfirmButtonClick:ca});return true;}.bind(this)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').DETAIL_DOM_CHANGED,this.updateHeaderBar.bind(this)));};o.prototype.updateHeaderBar=function(){'use strict';var y=this._headerBar.getNode('headerButtons');this._title_node_wrapper.style.fontSize='';var z=c('JSXDOM').span(null);c('DOM').setContent(this._title_node_wrapper,z);var aa=this._headerBar.getNode('webMessengerRecIndicator');aa&&c('CSS').hide(aa);var ba=this._headerBar.getNode('webMessengerManageButton');ba&&c('CSS').hide(ba);var ca=c('WebMessengerStateManager').getCurrentDetailState(),da=ca==c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;c('CSS').conditionShow(this._headerBar.getNode('closeButton'),da);c('CSS').conditionClass(this._title_node_wrapper,'allPeopleResults',da);c('CSS').hide(this._relationship_status);c('CSS').removeClass(this._title_node_wrapper,"_50jz");var ea,fa;switch(ca){case c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:fa=c('WebMessengerStateManager').getCurrentStateData().all_people_query;ea=j._("Personnes correspondant \u00e0 {query}",[j.param('query',c('DOM').create('strong',{},fa))]);break;case c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN:case c('WebMessengerStateConstants').DETAIL.COMPOSE_TYPEAHEAD_RESULTS:ea=j._("Nouveau message");break;case c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET:fa=c('WebMessengerStateManager').getCurrentStateData().message_query;if(fa)ea=j._("Messages contenant le mot\u00a0: {query}",[j.param('query',fa)]);break;}var ga=!ea&&!this._threadID;if(ga)ea=j._("Aucune s\u00e9lection");c('CSS').conditionClass(this._title_node_wrapper,"_3jd",ga);if(ea){c('DOM').setContent(z,ea);x(this._title_node_wrapper,this._threadID,y,aa);return;}l.renderAndSeparatedParticipantList(this._threadID,z,{check_length:false,names_renderer:function(ha){var ia=m.getThreadMetaNow(this._threadID),ja=ha.map(function(la){var ma=ha.length===1?la.name:la.short_name;if(ia&&ia.custom_nickname){var na=c('MercuryIDs').getUserIDFromParticipantID(la.id);if(ia.custom_nickname[na])ma=ia.custom_nickname[na];}var oa=la.id?c('MercuryIDs').getUserIDFromParticipantID(la.id):null;if(oa&&la.href){var pa=c('JSXDOM').a({href:la.href},ma);if(ha.length===1)pa.setAttribute('data-hovercard',c('HovercardLink').constructEndpoint({id:oa}));return pa;}else return ma;}.bind(this));if(ha.length===1&&ha[0].fbid!==null){var ka=c('JSXDOM').span(null);c('DOM').setContent(ka,ja[0]);q(ha[0],ka);ja[0]=ka;}return ja;}.bind(this)});if(aa)m.getThreadMeta(this._threadID,function(ha){t(ha,aa);});if(ba)m.getThreadMeta(this._threadID,function(ha){u(ha,ba);});this.renderParticipantListFlyout(z);this.renderNamedThreadParticipantCount(z);x(this._title_node_wrapper,this._threadID,y,aa);new (c('Autosize'))(this._title_node_wrapper,{min:11,max:16,height:100,width:this._title_node_wrapper.offsetWidth,wrap:false});};o.prototype.renderNamedThreadParticipantCount=function(y){'use strict';m.getThreadMeta(this._threadID,function(z){if(z.name){var aa=l.renderParticipantCount(z.thread_id,{count:z.participants.length}),ba=c('DOM').create('span',{className:"_1us"},j._("({participants})",[j.param('participants',aa)]));c('DOM').appendContent(y,ba);}},c('MercuryAPIArgsSource').WEBMESSENGER);};o.prototype.renderParticipantListFlyout=function(y){'use strict';this._dialog&&this._dialog.destroy();delete this._dialog;this._flyout&&this._flyout.destroy();delete this._flyout;var z=this._threadID;m.getThreadMeta(this._threadID,function(aa){var ba=aa.participants;if(!aa.name){ba=ba.filter(function(ca){return ca!==c('MercuryViewer').getID();});if(ba.length<=1)return;}c('MercuryParticipants').getMulti(ba,function(ca){if(this._threadID!=z)return;var da=0,ea=c('WebMessengerTemplates')[':fb:web-messenger:flyoutlist'].build();for(var fa in ca){if(!ca.hasOwnProperty(fa))continue;var ga=ca[fa],ha=c('WebMessengerTemplates')[':fb:web-messenger:flyoutlist-profile-item'].build();ha.getNode('profilePhoto').setAttribute('src',ga.image_src);var ia=ha.getNode('title');if(ga.href){var ja=c('JSXDOM').a({href:ga.href});c('DOM').setContent(ia,ja);ia=ja;var ka=ha.getNode('profilePhoto'),la=c('JSXDOM').a({href:ga.href});c('DOM').replace(ka,la);c('DOM').setContent(la,ka);}c('DOM').setContent(ia,ga.name);q(ga,ha.getNode('title'));c('DOM').setContent(ha.getNode('infoLine'),w(ga));da++;c('DOM').appendContent(ea.getNode('list'),ha.getRoot());}var ma=ea.getRoot();this._dialog=new (c('ContextualDialog'))({context:y,position:'below',addedBehaviors:[c('LayerFadeOnHide'),c('LayerFadeOnShow'),c('LayerHideOnTransition')]},ma);this._flyout=new (c('HoverFlyout'))();this._flyout.init(this._dialog);this._flyout.initNode(y);v(this._flyout,ma,da);}.bind(this));}.bind(this),c('MercuryAPIArgsSource').WEBMESSENGER);};o.prototype.destroy=function(){'use strict';};function p(y,z,aa){var ba=c('LastActiveTimes').getShortDisplay(aa);if(!ba||y.get(aa)!==c('AvailableListConstants').MOBILE){c('Tooltip').remove(z);return;}c('Tooltip').set(z,j._("Actif il y a {time}",[j.param('time',ba)]),'right');}function q(y,z){var aa=c('MercuryIDs').getUserIDFromParticipantID(y.id);if(!aa)return;var ba=c('JSXDOM').span(null);c('MercuryPresence').updateOnPresenceChanges(aa,ba);if(c('isNode')(z)){if(c('MercuryConfig').FantaTabs){r(ba,aa);}else s(ba,aa);c('DOM').appendContent(z,ba);}}function r(y,z){c('Bootloader').loadModules(["PresenceStatus","FantaTabActions"],function(aa,ba){c('Event').listen(y,'mouseenter',c('curry')(p,aa,y,z));c('Event').listen(y,'click',function(){var ca=c('MercuryIDs').getThreadIDFromUserID(z);ba.openTab(ca);c('ChatOpenTabEventLogger').logUser('web messenger header',z);});},'WebMessengerDetailViewHeaderControl');}function s(y,z){c('Bootloader').loadModules(["PresenceStatus","ChatOpenTab"],function(aa,ba){c('Event').listen(y,'mouseenter',c('curry')(p,aa,y,z));c('Event').listen(y,'click',function(){ba.openUserTab(z,'web messenger header');});},'WebMessengerDetailViewHeaderControl');}function t(y,z){if(z)c('MercuryParticipants').getMulti(y.participants,function(aa){var ba=true;for(var ca in aa)if(aa.hasOwnProperty(ca))ba=ba&&aa[ca].employee;c('CSS').conditionShow(z,ba);});}function u(y,z){if(c('MercuryConfig').WWWMessengerManageButtonGK&&z&&y.thread_fbid)c('MercuryParticipants').get(c('MercuryIDs').getParticipantIDFromUserID(y.thread_fbid),function(aa){var ba=aa.is_business_enabled;c('CSS').conditionShow(z,ba);});}function v(y,z,aa){if(aa<=c('WebMessengerConstants').MAX_VISIBLE_IN_FLYOUT)return;var ba=c('ScrollableArea').fromNative(z,{fade:true});z.style.height=c('WebMessengerConstants').PARTICIPANTS_FLYOUT_HEIGHT+'px';y.subscribe('show',function(){ba.showScrollbar(false);});}function w(y){return '';}function x(y,z,aa,ba){var ca=aa.offsetWidth;if(ba){n=n||ba.offsetWidth;ca+=n;}var da=c('DOM').scry(document.body,"div._2nd");if(da.length)ca+=da[0].offsetWidth;var ea=y.parentNode.offsetWidth;if(ea>ca)c('Style').set(y,'max-width',ea-ca+'px');}f.exports=o;}),null);
__d('MercuryListUpdateRenderer',['DOM','ge'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={updateList:function i(j,k,l,m,n){var o=[];for(var p=0;p<k.length;p++){if(n){var q=n(p);q&&o.push(q);}var r=c('ge')(k[p]);if(r&&l(p)){o.push(r);}else o.push(m(p));}c('DOM').setContent(j,o);}};f.exports=h;}),null);
__d('WebMessengerUnseenMessageNoticeRenderer',['cx','fbt','JSXDOM','ContextualLayer','LayerFadeOnHide','Event'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={renderNoticeTooltip:function l(m,n){var o=c('JSXDOM').div({className:"_40p"},k(m),c('JSXDOM').i({className:"_40q"})),p=new (c('ContextualLayer'))(n||{},o).enableBehavior(c('LayerFadeOnHide'));return p;}};function k(l){var m=c('JSXDOM').div({className:"_40r"},i._("Vous avez de nouveaux messages"));c('Event').listen(m,'click',l);return m;}f.exports=j;}),null);
__d('WebMessengerMessagesNotice',['LayerDestroyOnHide','MercuryViewer','WebMessengerUnseenMessageNoticeRenderer'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){'use strict';this._notice=null;this._noticeContextNode=null;this._active=false;}h.prototype.getActive=function(){'use strict';return this._active;};h.prototype.showMessageNotice=function(i,j){'use strict';if(!this._active)return;if(!this._notice)this._notice=c('WebMessengerUnseenMessageNoticeRenderer').renderNoticeTooltip(i,{context:this._noticeContextNode,offsetY:2,position:j,alignment:'center'});this._notice.show();};h.prototype.hideMessageNotice=function(){'use strict';this._notice&&this._notice.hide();};h.prototype.removeMessageNotice=function(){'use strict';if(this._notice){this._notice.enableBehavior(c('LayerDestroyOnHide')).hide();this._notice=null;}};h.prototype.setNoticeContextNode=function(i){'use strict';this._noticeContextNode=i;};h.prototype.hideView=function(){'use strict';this._active=false;this.hideMessageNotice();};h.prototype.updateView=function(){'use strict';this._active=true;};h.prototype.destroy=function(){'use strict';this._active=false;this.removeMessageNotice();};h.prototype.onlyReceivedFromSelf=function(i){'use strict';for(var j in i){if(!i.hasOwnProperty(j))continue;for(var k=0,l=i[j].length;k<l;k++)if(i[j][k].author!==c('MercuryViewer').getID())return false;}return true;};f.exports=h;}),null);
__d('WebMessengerDetailViewUnreadMessagesNotice',['MercuryThreadlistConstants','WebMessengerStateManager','throttle','MercuryThreadInformer','MercuryThreadActions','UserActivity','WebMessengerMessagesNotice','WebMessengerSubscriptionsHandler'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('MercuryThreadInformer').get(),k=c('MercuryThreadActions').get(),l=c('MercuryThreadlistConstants').MESSAGE_NOTICE_INACTIVITY_THRESHOLD;h=babelHelpers.inherits(m,c('WebMessengerMessagesNotice'));i=h&&h.prototype;function m(n){'use strict';i.constructor.call(this);this._manager=n;c('WebMessengerSubscriptionsHandler').addSubscriptions(j.subscribe('thread-read-changed',this._updateReadStatus.bind(this)));this._manager.addScrollCallback(c('throttle').withBlocking(function(o){if(this._shouldMarkAsRead(o)){this.removeMessageNotice();if(c('UserActivity').isActive(5000)){var p=c('WebMessengerStateManager').getCurrentStateData().thread_id;k.markRead(p);}else c('UserActivity').subscribeOnce(function(){if(this._shouldMarkAsRead(o)){var q=c('WebMessengerStateManager').getCurrentStateData().thread_id;k.markRead(q);}}.bind(this));}}.bind(this),100,null));}m.prototype.updateOnMessagesReceived=function(n,o,p,q){'use strict';var r=!c('UserActivity').isActive(l);if(!i.getActive.call(this))return;if(r||i.onlyReceivedFromSelf.call(this,q)){this.removeMessageNotice();this._manager.scrollToBottom(true);}else if(!this._manager.isScrolledToBottom()){var s=p-(o-n);this._manager.setScrollTop(s,false);this.showMessageNotice();}};m.prototype.showMessageNotice=function(){'use strict';var n=function(){this._manager.scrollToBottom();}.bind(this);i.showMessageNotice.call(this,n,'above');};m.prototype._shouldMarkAsRead=function(n){'use strict';var o=c('WebMessengerStateManager').getCurrentStateData().thread_id;return o&&i.getActive.call(this)&&n.isScrolledToBottom();};m.prototype._updateReadStatus=function(n,o){'use strict';var p=c('WebMessengerStateManager').getCurrentStateData().thread_id;if(p&&o[p]&&o[p].mark_as_read)this.removeMessageNotice();};f.exports=m;}),null);
__d('WebMessengerInfoBoxRenderer',['cx','Event','DOM','WebMessengerSubscriptionsHandler'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={render:function j(k,l){var m=c('DOM').create('div',{className:"_4rk"},k),n=c('DOM').create('div',{}),o=true;l.forEach(function(p){if(!o){var q=c('DOM').create('span',{className:"_4rl"},'\u00b7');c('DOM').appendContent(n,q);}o=false;var r=c('DOM').create('a',{},p.text);if(p.handler)c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(r,'click',p.handler));c('DOM').appendContent(n,r);});return c('DOM').create('div',{className:"_4rh"},[m,n]);}};f.exports=i;}),null);
__d('WebMessengerMessageIDFinder',['csx','DataStore','DOM'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={find:function j(k,l){var m=l?c('DOM').find(k,l):k,n=c('DataStore').get(m,'MessageRenderer:messageID');return n;},findAll:function j(k){var l=c('DOM').scry(k,"._53"),m=[];if(l.length){var n=l[0];for(var o=0;o<n.childNodes.length;o++)m.push(c('DataStore').get(n.childNodes[o],'MessageRenderer:messageID'));}return m;}};f.exports=i;}),null);
__d('WebMessengerMessagesSelection',['csx','CSS','DOM','getObjectValues','WebMessengerMessageIDFinder'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={};function j(m,n){var o=m,p=n;if(o==p)return 0;while(true){o=o.nextSibling;p=p.nextSibling;if(!o||p==m){return 1;}else if(!p||o==n)return -1;}}function k(m,n){var o=m.id,p=c('DOM').scry(m,"._yh input")[0];if(n){i[o]=m;c('CSS').addClass(m,'selected');p.checked=true;}else{delete i[o];c('CSS').removeClass(m,'selected');p.checked=false;}}var l={clear:function m(){for(var n in i)k(i[n],false);},selectClick:function m(n){k(n,!(n.id in i));},getSelectedMessageIDs:function m(){var n=c('getObjectValues')(i);n.sort(j);var o=[];n.forEach(function(p){o=o.concat(c('WebMessengerMessageIDFinder').findAll(p));});return o;}};f.exports=l;}),null);
__d('WebMessengerThreadMessagesRenderer',['csx','cx','fbt','AsyncRequest','MercuryAttachment','CSS','DataStore','DOM','Event','MercuryDisplayTimeFilterMessageRenderer','HovercardLink','Image.react','ImmutableObject','LinkController','MercuryLogMessageRenderer','MercuryActionType','MercuryAttachments.react','MercuryAttachmentType','MercuryErrorInfo','MercuryIDs','MercuryLogMessageType','MercuryMessageError.react','MercuryMessageGroup','MercuryTimePassed','MercuryViewer','MercuryMessageRenderer','WebMessengerMessagesSelection','MercuryMessages','Parent','MercuryParticipants','MercuryParticipantsConstants','React','ReactDOM','WebMessengerStateManager','Style','WebMessengerTemplates','MercuryThreadMetadataRenderer','Vector','WebMessengerConstants','WebMessengerEvents','WebMessengerSubscriptionsHandler','formatDate','ge','isRTL'],(function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('MercuryMessages').get(),l=c('MercuryThreadMetadataRenderer').get(),m={updateSelection:function o(p){var q=c('WebMessengerStateManager').getCurrentStateData().message_action;c('CSS').conditionClass(p,'selectionEnabled',q);},setupSelectionListener:function o(p){c('LinkController').registerHandler(function(q){var r=c('WebMessengerStateManager').getCurrentStateData().message_action;if(r&&c('Parent').byClass(q,'webMessengerMessageGroup'))return false;});c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(p,'click',function(event){var q=c('WebMessengerStateManager').getCurrentStateData().message_action;if(q){var r=null;for(var s=event.getTarget();s;s=s.parentNode)if(c('CSS').hasClass(s,'webMessengerMessageGroup'))r=s;r&&c('WebMessengerMessagesSelection').selectClick(r);}}));},renderForwardedMessages:function o(p,q){var r=c('MercuryMessageGroup').calculateMessageGroups(q),s=null;r.forEach(function(t){var u=m.renderMessageGroup(t,true);c('DOM').appendContent(p,u.getRoot());s=t[t.length-1];});},renderMessageGroup:function o(p,q,r){var s,t=p[0],u=t.action_type===c('MercuryActionType').LOG_MESSAGE,v=u&&(t.log_message_type===c('MercuryLogMessageType').VIDEO_CALL||t.log_message_type===c('MercuryLogMessageType').PHONE_CALL),w=!v&&u?c('WebMessengerTemplates')[':fb:web-messenger:read-view:log-message'].build():c('WebMessengerTemplates')[':fb:web-messenger:read-view:message-group'].build();w.getRoot().setAttribute('id',(r||'wm:')+t.message_id);if(v){(function(){var x={attach_type:'share',share:{style_list:['rtc_call_log','fallback'],log_message_body:t.log_message_body,log_message_data:t.log_message_data,log_message_type:t.log_message_type,timestamp:t.timestamp}},y=c('ImmutableObject').setProperty(t,'attachments',[x]);y=c('ImmutableObject').setProperty(y,'has_attachment',true);y=c('ImmutableObject').setProperty(y,'body','');c('MercuryParticipants').get(t.author,function(z){return m.renderSingleMessage(w,y,z,q);});})();}else if(u){m.renderSingleLogMessage(w,t);}else c('MercuryParticipants').get(t.author,function(x){m.renderSingleMessage(w,t,x,q);for(var y=1;y<p.length;y++)m.appendMessageToGroup(w,p[y]);});return w;},appendMessageToGroup:function o(p,q){var r=c('WebMessengerTemplates')[':fb:web-messenger:read-view:message'].build();if(q.is_filtered_content_bh||q.is_filtered_content_account||q.is_filtered_content_quasar||q.is_filtered_content_invalid_app||q.is_filtered_content){c('ReactDOM').render(c('React').createElement('div',{className:"uiBoxYellow _2ph- _3-95"},c('MercuryDisplayTimeFilterMessageRenderer').renderFilteredContent(q)),r.getNode('message'));}else r.setNodeContent('message',c('MercuryMessageRenderer').formatMessageBody(q.body,null,true));c('ReactDOM').render(c('React').createElement(c('MercuryMessageError.react'),{message:new (c('ImmutableObject'))(q)}),r.getNode('status'));var s=r.getRoot();c('DataStore').set(s,'MessageRenderer:messageID',q.message_id);c('CSS').addClass(r.getNode('message'),c('isRTL')(q.body)?'direction_rtl':'direction_ltr');c('DOM').appendContent(p.getNode('bodyDiv'),s);c('MercuryParticipants').get(c('MercuryViewer').getID(),function(t){if(t.employee){var u=c('WebMessengerTemplates')[':fb:web-messenger:bug-reporting'].build();u.getNode('fbtrace').setAttribute('data-timestamp',q.timestamp);u.getNode('brokenheart').setAttribute('data-timestamp',q.timestamp);c('DOM').setContent(r.getNode('bugReporting'),u.getRoot());}});},renderSingleLogMessage:function o(p,q){var r=p.getNode('attachment');c('MercuryLogMessageRenderer').renderLegacy(p.getNode('icon'),p.getNode('message'),r,q);m.renderStatus(p,q);l.renderTimestamp(p.getNode('timestamp'),q.timestamp_absolute,q.timestamp_relative,q.timestamp);},renderMessageSeparator:function o(p){var q=c('WebMessengerTemplates')[':fb:mercury:timestamp'].render();q.removeAttribute('title');var r=p.timestamp_absolute;if(!r)r=c('formatDate')(new Date(p.timestamp),{withinWeek:'l',withinYear:'F jS',older:'F jS, Y'});if(k.isFirstMessage(p))if(p.timestamp_time_passed===c('MercuryTimePassed').TODAY){r=j._("Conversation d\u00e9marr\u00e9e aujourd\u2019hui");}else r=j._("Conversation d\u00e9marr\u00e9e {timestamp}",[j.param('timestamp',r)]);c('DOM').setContent(q,r);c('CSS').show(q);return c('DOM').create('li',{className:"_2n3"},q);},renderMessageSeparatorForIndex:function o(p,q){var r=p[q][0];if(q){var s=r.timestamp,t=p[q-1],u=t[t.length-1].timestamp,v=c('WebMessengerConstants').READ_VIEW_SEPARATOR_TIME_LIMIT;if(s-u<v)return false;}return m.renderMessageSeparator(r);},renderRawAttachments:function o(p,q){var r=c('MercuryAttachment').convertRaw(q.raw_attachments||[]),s=(q.photo_fbids?q.photo_fbids.length:0)+(q.image_ids?q.image_ids.length:0);for(var t=0;t<s;t++)r.push({attach_type:c('MercuryAttachmentType').PHOTO,preview_width:206,preview_height:206});if(q.sticker_id)r.push({attach_type:c('MercuryAttachmentType').STICKER});m.renderAttachments(p,r,q);},renderAttachments:function o(p,q,r){c('ReactDOM').render(c('React').createElement(c('MercuryAttachments.react'),{attachments:q,maxWidth:450,message:r,isChat:false,onStickerClick:c('WebMessengerEvents').stickerClicked.bind(c('WebMessengerEvents'))}),p);},renderStatus:function o(p,q){if(c('MercuryErrorInfo').hasErrorStatus(q)){var r=c('React').createElement(c('MercuryMessageError.react'),{message:new (c('ImmutableObject'))(q)}),s=p.getNode('statusContainer');if(s&&r){c('ReactDOM').render(r,s);c('CSS').show(s);}}},renderSingleMessage:function o(p,q,r,s){m.appendMessageToGroup(p,q);var t=void 0;if(r.href){t=c('DOM').create('a',{href:r.href},r.name);var u=c('MercuryIDs').getUserIDFromParticipantID(r.id);if(u)t.setAttribute('data-hovercard',c('HovercardLink').constructEndpoint({id:u}));}else t=r.name;p.setNodeContent('authorName',t);var v=p.getNode('image');c('CSS').removeClass(v,'MercuryThreadImage');var w=c('React').createElement(c('Image.react'),{alt:r.name,width:c('MercuryParticipantsConstants').IMAGE_SIZE,height:c('MercuryParticipantsConstants').IMAGE_SIZE,src:r.image_src,className:"_50dv"});if(r.href)w=c('React').createElement('a',{href:r.href},w);w=c('ReactDOM').render(w,v);var x=void 0;if(q.timestamp_time_passed===c('MercuryTimePassed').TODAY){x='g:ia';}else x='n/j, g:ia';var y=c('formatDate')(new Date(q.timestamp),x);l.renderTimestamp(p.getNode('timestamp'),q.timestamp_absolute,y,q.timestamp);l.renderMessageSourceTags(p.getNode('tooltipForSource'),p.getNode('sourceIcon'),q.source_tags||[],q.author_email);l.renderSpoofWarning(p.getNode('spoofWarning'),q.is_spoof_warning,r);if(q.subject)p.setNodeContent('subject',q.subject);if(q.has_attachment){var z=p.getNode('attachments');if(q.attachments&&q.attachments.length===0){m.renderRawAttachments(z,q);}else if(q.attachments!==null&&q.attachments.length>0){m.renderAttachments(z,q.attachments,q);}else if(q.raw_attachments!=null&&q.raw_attachments.length>0)m.renderRawAttachments(z,q.raw_attachments);}var aa=p.getNode('forwards'),ba=q.forward_count&&k.getMessagesFromIDs(q.forward_message_ids);if(ba)m.renderForwardedMessages(aa,ba);c('CSS').conditionShow(aa,ba);}};function n(o,p,q){var r=c('ge')(o),s=c('DOM').find(r,'iframe'),t=c('DOM').find(s,"^._5xm"),u=t.firstChild;c('Style').set(s,'width',p+'px');c('Style').set(s,'height',q+1+'px');s.setAttribute('scrolling','no');var v=r&&c('Vector').getElementDimensions(r).x/p;if(v&&v<1){c('Style').set(t,'height',Math.round(v*(q+1))+'px');var w=s.style,x=['transform','WebkitTransform','msTransform','MozTransform','OTransform'],y=void 0;while(y=x.shift())if(typeof w[y]!=='undefined'){c('Style').set(s,y,'scale('+v+','+v+')');return;}c('Style').set(u,'zoom',v);}}f.exports=m;}),null);
__d('WebMessengerDetailViewRecentMessagesControl',['cx','fbt','Event','Animation','CSS','WebMessengerDetailViewUnreadMessagesNotice','DOM','Arbiter','GroupChatMessageBlockAlert','MercuryLastMessageIndicator.react','MercuryListUpdateRenderer','MercuryAPIArgsSource','MercuryBlockedParticipants','MercuryConfig','MercuryLogMessageType','MercurySourceType','MercuryThreadlistConstants','MercuryViewer','MercuryMessageGroup','MercuryMessageActions','MercuryMessageObject','MercuryMessages','WebMessengerMessagesSelection','MessagingTag','MessengerContextBannerBootloader','ReactDOM','ReactComponentRenderer','MercuryShareAttachmentRenderLocations','WebMessengerStateConstants','WebMessengerStateManager','Style','WebMessengerTemplates','MercuryThreadInformer','WebMessengerThreadMessagesRenderer','MercuryThreadActions','MercuryThreads','UserActivity','WebMessengerConstants','WebMessengerInfoBoxRenderer','WebMessengerMessageIDFinder','WebMessengerSubscriptionsHandler','debounce','formatDate','ge'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('MercuryBlockedParticipants').get(),k=c('MercuryMessageActions').get(),l=c('MercuryMessageObject').get(),m=c('MercuryMessages').get(),n=c('MercuryThreadInformer').get(),o=c('MercuryThreadActions').get(),p=c('MercuryThreads').get();function q(ka,la,ma,na,oa,pa,qa,ra){'use strict';this._manager=ka;this._rootElement=la;this._loadingSpinner=ma;this._noSelectedConversation=na;this._newMessageLink=oa;this._showUnreadLink=pa;this.contextBanner=qa;c('DOM').empty(this._rootElement);this._pagerExponent=-1;var sa=c('WebMessengerTemplates')[':fb:web-messenger:read-view:recent-messages'].build();c('DOM').setContent(this._rootElement,sa.getRoot());this._selectedConversationView=sa.getRoot();this._messageList=sa.getNode('messagelist');this._loadMoreButton=sa.getNode('loadMoreButton');this._loadMoreLink=sa.getNode('loadMoreLink');this._loadMoreCount=sa.getNode('loadMoreCount');this._loadingMoreCount=sa.getNode('loadingMoreCount');this._indicatorNode=sa.getNode('lastMessageIndicator');this._unseenMessagesNotice=new (c('WebMessengerDetailViewUnreadMessagesNotice'))(this._manager);this._unseenMessagesNotice.setNoticeContextNode(ra);this._active=false;this._state=null;this._threadID=null;this._bugReportingEnabled=false;this._currentCountMap={};this._firstContact={};this._loadMessagesInFlight={};this._olderMessageID={};c('WebMessengerThreadMessagesRenderer').setupSelectionListener(this._messageList);this._manager.addScrollCallback(c('debounce')(ja.bind(null,this),500));c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(this._loadMoreLink,'click',ba.bind(null,this)),n.subscribe('messages-reordered',function(ta,ua){var va=this._threadID&&ua[this._threadID];if(va){if(!this._olderMessageID[this._threadID])this._firstContact[this._threadID]=true;x(this);}}.bind(this)),n.subscribe('messages-updated',function(ta,ua){var va=this._threadID&&ua[this._threadID];if(va)var wa=Object.keys(va),xa=wa.length&&va[wa[0]];if(va&&xa)x(this,ua[this._threadID]);}.bind(this)),n.subscribe('messages-updated',ja.bind(null,this)),n.subscribe('messages-received',function(ta,ua){if(this._threadID&&ua[this._threadID])aa(this,ua);}.bind(this)),n.subscribe('thread-read-changed',function(ta,ua){if(ua[this._threadID])ga(this,ua[this._threadID]);}.bind(this)),this._manager.subscribe('scrolledNearTop',function(){this._active&&ba(this);}.bind(this)));}q.prototype.hideView=function(){'use strict';this._active=false;c('CSS').hide(this._rootElement);c('CSS').hide(this._loadingSpinner);c('CSS').hide(this._noSelectedConversation);c('CSS').hide(this.contextBanner);this._unseenMessagesNotice.hideView();this._manager._flexArea.setBottomAligned(false);};q.prototype.updateView=function(){'use strict';this._unseenMessagesNotice.updateView();this._active=true;this._manager._flexArea.setBottomAligned(true);c('CSS').show(this._rootElement);if(this.contextBanner)c('CSS').show(this.contextBanner);var ka=s(this);t(this);c('WebMessengerMessagesSelection').clear();if(ka){u(this);}else ea(this);};q.prototype.renderContextBanner=function(ka,la){'use strict';if(this.contextBanner&&!this.contextBannerElem)c('MessengerContextBannerBootloader').bootload(ka,c('MercuryShareAttachmentRenderLocations').WEB_INBOX,function(ma){this.contextBannerElem=ma;c('Style').set(this._rootElement,'padding-top','80px');c('DOM').prependContent(this.contextBanner,this.contextBannerElem);c('CSS').show(this.contextBanner);}.bind(this),la);};q.prototype.unmountContextBanner=function(){'use strict';if(this.contextBannerElem){c('ReactDOM').unmountComponentAtNode(this.contextBannerElem);this.contextBannerElem=null;c('DOM').empty(this.contextBanner);}};q.prototype.destroy=function(){'use strict';r(this);this._unseenMessagesNotice.destroy();c('ReactDOM').unmountComponentAtNode(this._indicatorNode);this.unmountContextBanner();};function r(ka){ka._messagesSubscription&&m.unsubscribe(ka._messagesSubscription.subscriber_id,ka._messagesSubscription.thread_id);ka._messagesSubscription=null;}function s(ka){var la=c('WebMessengerStateManager').getCurrentStateData();if(!ka._threadID||ka._threadID!=la.thread_id)return true;return false;}function t(ka){var la=c('WebMessengerStateManager').getCurrentStateData();ka._state=c('WebMessengerStateManager').getCurrentDetailState();ka._threadID=la.thread_id;ka._selectionEnabled=!!la.message_action;ka._bugReportingEnabled=la.bug_reporting_enabled;c('WebMessengerThreadMessagesRenderer').updateSelection(ka._messageList);c('CSS').conditionClass(ka._messageList,'bugReportingEnabled',ka._bugReportingEnabled);}function u(ka){c('DOM').scry(ka._rootElement,'.stickerContainer').forEach(function(ma){return c('ReactDOM').unmountComponentAtNode(ma);});c('DOM').empty(ka._messageList);ka.unmountContextBanner();var la=null;if(ka._threadID)la=p.getThreadMetaNow(ka._threadID);if(la&&j.isPresentInGroupThread(la)){c('GroupChatMessageBlockAlert').show(j.inGroupThread(la),function(){return v(ka);},function(){k.send(l.constructLogMessageObject(c('MercurySourceType').TITAN_WEB,ka._threadID,c('MercuryLogMessageType').UNSUBSCRIBE,{removed_participants:[c('MercuryViewer').getID()]}),null,c('MercuryAPIArgsSource').WEBMESSENGER);v(ka);});}else v(ka);}function v(ka){c('CSS').show(ka._loadingSpinner);c('CSS').hide(ka._loadMoreButton);r(ka);ka._pagerExponent=-1;c('ReactDOM').unmountComponentAtNode(ka._indicatorNode);if(ka._lastMessageIndicator){ka._lastMessageIndicator.unmount();delete ka._lastMessageIndicator;}if(ka._threadID){c('CSS').show(ka._selectedConversationView);c('CSS').hide(ka._noSelectedConversation);ka._manager._flexArea.showAtTop(false);if(!ka._olderMessageID[ka._threadID]){w(ka);}else x(ka);ka._manager.scrollToBottom(false);}else{ia(ka);c('CSS').hide(ka._selectedConversationView);c('CSS').show(ka._noSelectedConversation);c('CSS').hide(ka._loadingSpinner);ka._manager._flexArea.showAtTop(true);}}function w(ka){ka._loadMessagesInFlight[ka._threadID]=true;ka._currentCountMap[ka._threadID]=c('WebMessengerConstants').INITIAL_MESSAGES_LIMIT;c('CSS').hide(ka._loadMoreButton);var la=m.getThreadMessagesRange(ka._threadID,0,ka._currentCountMap[ka._threadID],y.bind(null,ka),null,c('MercuryAPIArgsSource').WEBMESSENGER);if(la){ka._messagesSubscription={subscriber_id:la,thread_id:ka._threadID};}else x(ka);}function x(ka,la){if(!ka._threadID||!ka._olderMessageID[ka._threadID]&&!ka._firstContact[ka._threadID])return;var ma=m.getThreadMessagesSinceTimestamp(ka._threadID,ha(ka._olderMessageID[ka._threadID]));if(ma.length>ka._currentCountMap[ka._threadID])ka._currentCountMap[ka._threadID]=ma.length;z(ka,ma,la);}function y(ka,la){ka._loadMessagesInFlight[ka._threadID]=false;if(la&&la.length){var ma=la[0].timestamp,na=ka._olderMessageID[ka._threadID]?ha(ka._olderMessageID[ka._threadID]):null;if(!na||ma<na)ka._olderMessageID[ka._threadID]=la[0].message_id;}}function z(ka,la,ma){c('CSS').hide(ka._loadingSpinner);c('CSS').conditionShow(ka._loadMoreButton,!m.hasLoadedAllMessages(ka._threadID));var na=p.getThreadMetaNow(ka._threadID);if(na){var oa=na.message_count-la.length;oa=oa<0?0:oa;c('DOM').setContent(ka._loadMoreCount,oa);c('DOM').setContent(ka._loadingMoreCount,oa);}if(na&&na.is_canonical&&c('MercuryConfig').ShowContextBanner&&m.hasLoadedAllMessages(ka._threadID))ka.renderContextBanner(ka._threadID);var pa=function xa(ya){var za,ab=c('ge')('wm:'+ya);if(ab)za=c('WebMessengerMessageIDFinder').findAll(ab);return za||[];},qa=[],ra=c('MercuryMessageGroup').calculateMessageGroups(la),sa={},ta=[];ra.forEach(function(xa){var ya=xa[0].message_id,za=false;if(ma){za=xa.some(function(bb){return bb.message_id in ma;});if(!za){qa=pa(ya);za=qa.some(function(bb){return bb in ma;});}}if(!za){qa=pa(ya);if(xa.length==qa.length){for(var ab=0;ab<xa.length;ab++)if(xa[ab].message_id!=qa[ab]){za=true;break;}}else za=true;}if(za)sa[ya]=1;ta.push('wm:'+ya);});var ua=function xa(ya){return !sa[ra[ya][0].message_id];},va=function xa(ya){var za=ra[ya],ab=c('WebMessengerThreadMessagesRenderer').renderMessageGroup(za);if(ya==ta.length-1)ka._messageGroup=ab;return ab.getRoot();},wa=function xa(ya){return c('WebMessengerThreadMessagesRenderer').renderMessageSeparatorForIndex(ra,ya);};c('MercuryListUpdateRenderer').updateList(ka._messageList,ta,ua,va,wa);ka._lastMessage=la[la.length-1];da(ka);ea(ka);ka._manager.poke();}function aa(ka,la){var ma=la[ka._threadID],na=ka._manager._flexArea.getScrollableArea(),oa=na.getScrollHeight();ma.forEach(function(ra){ra.timestamp_relative=c('formatDate')(new Date(ra.timestamp),'g:ia');var sa=c('MercuryMessageGroup').canAppendMessageToLastGroup(ka._lastMessage,ra);if(!sa){ka._messageGroup=c('WebMessengerThreadMessagesRenderer').renderMessageGroup([ra]);var ta=ra.timestamp,ua=ka._lastMessage?ka._lastMessage.timestamp:0,va=c('WebMessengerConstants').READ_VIEW_SEPARATOR_TIME_LIMIT;if(!ua||ta-ua>=va){var wa=c('WebMessengerThreadMessagesRenderer').renderMessageSeparator(ra);c('DOM').appendContent(ka._messageList,wa);}c('DOM').appendContent(ka._messageList,ka._messageGroup.getRoot());}else c('WebMessengerThreadMessagesRenderer').appendMessageToGroup(ka._messageGroup,ra);if(ra.author!=c('MercuryViewer').getID())c('CSS').addClass(ka._messageGroup.getRoot(),'unreadHighlight');ka._lastMessage=ra;});ka._manager._flexArea.poke();var pa=na.getScrollHeight(),qa=na.getScrollTop();ka._unseenMessagesNotice.updateOnMessagesReceived(oa,pa,qa,la);da(ka);if(ka._manager.isScrolledToBottom())ea(ka);}function ba(ka){c('CSS').addClass(ka._loadMoreButton,'async_saving');if(ka._loadMessagesInFlight[ka._threadID])return;ka._loadMessagesInFlight[ka._threadID]=true;ka._pagerExponent=Math.min(ka._pagerExponent+1,c('WebMessengerConstants').EXPONENTIAL_PAGER_MAX_CYCLES);var la=Math.pow(2,ka._pagerExponent),ma=ka._currentCountMap[ka._threadID]+la*c('MercuryThreadlistConstants').WEBMESSENGER_MORE_MESSAGES_COUNT;r(ka);var na=m.getThreadMessagesRange(ka._threadID,0,ma,function(oa){c('CSS').removeClass(ka._loadMoreButton,'async_saving');ka._currentCountMap[ka._threadID]=ma;y(ka,oa);ka._loadMessagesInFlight[ka._threadID]=false;},null,c('MercuryAPIArgsSource').WEBMESSENGER);if(na){ka._messagesSubscription={subscriber_id:na,thread_id:ka._threadID};}else x(ka);}function ca(ka){if(!ka._lastMessageIndicator){var la;ka._lastMessageIndicator=new (c('ReactComponentRenderer'))(c('MercuryLastMessageIndicator.react'),ka._indicatorNode);ka._lastMessageIndicator.setProps({threadID:ka._threadID,className:"_510o",indicatorWillShow:function ma(){return (la=ka._manager.isScrolledToBottom());},indicatorDidShow:function ma(){return (la&&ka._manager.scrollToBottom(true));}});}return ka._lastMessageIndicator;}function da(ka,la){ca(ka).setProps({lastMessage:ka._lastMessage});}function ea(ka){if(c('UserActivity').isActive(5000)){fa(ka);}else c('UserActivity').subscribeOnce(fa.bind(null,ka));}function fa(ka){if(!ka._threadID||!ka._active)return;o.markRead(ka._threadID);var la=c('DOM').scry(ka._messageList,'.unreadHighlight');la.forEach(function(ma){c('CSS').removeClass(ma,'unreadHighlight');c('CSS').addClass(ma,'unreadFading');new (c('Animation'))(ma).from('background','#eceff5').to('background','#fff').from('borderColor','#d6d6d6').to('borderColor','#fff').ease(c('Animation').ease.both).duration(1500).ondone(function(){c('CSS').removeClass(ma,'unreadFading');c('Style').set(ma,'background','');c('Style').set(ma,'borderColor','');}).go();});}function ga(ka,la){if(!la.mark_as_read)return;var ma=c('DOM').scry(ka._messageList,'.unreadHighlight');for(var na=0;na<ma.length;na++){var oa=ma[na],pa=c('WebMessengerMessageIDFinder').findAll(oa),qa=m.getMessagesFromIDs(pa);if(qa[qa.length-1].timestamp<la.timestamp)c('CSS').removeClass(oa,'unreadHighlight');}}function ha(ka){if(!ka)return 0;var la=m.getMessagesFromIDs([ka])[0];return la?la.timestamp:0;}function ia(ka){if(ka._builtNoSelectionBox)return;var la=function na(){var oa=c('WebMessengerStateManager').getCurrentStateData(),pa=babelHelpers['extends']({},oa);c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN,Object.assign(pa,{start:true,thread_id:undefined}));},ma=function na(){var oa=c('WebMessengerStateManager').getCurrentStateData(),pa=babelHelpers['extends']({},oa);c('WebMessengerStateManager').updateMasterState(c('WebMessengerStateConstants').MASTER.RECENT_THREADS,Object.assign(pa,{folder:c('MessagingTag').INBOX,filter:c('MessagingTag').UNREAD}));};c('DOM').setContent(ka._noSelectedConversation,c('WebMessengerInfoBoxRenderer').render(i._("Aucune conversation s\u00e9lectionn\u00e9e"),[{text:i._("Nouveau message"),handler:la},{text:i._("Afficher les messages non lus"),handler:ma}]));ka._builtNoSelectionBox=true;}function ja(ka){var la=ka._manager._flexArea.getScrollableArea(),ma=ka._manager.getFlexAreaBoundingClientRect();c('Arbiter').inform('messengerScrolled/'+ka._threadID,{scrollTop:la.getScrollTop(),top:ma.y,viewHeight:ma.height});}f.exports=q;}),null);
__d('MercurySearchContextResults',['KeyedCallbackManager','MercuryAPIArgsSource','MercuryIDs','MercuryThreadlistConstants','MercuryThreadIDMap','RangedCallbackManager','MercuryServerDispatcher','MercuryServerPayloadPreprocessor','WebMessengerConstants'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadIDMap').get(),i=c('MercuryServerPayloadPreprocessor').get(),j=new (c('KeyedCallbackManager'))(),k=c('MercuryThreadlistConstants').WEBMESSENGER_SEARCH_SNIPPET_COUNT,l=c('WebMessengerConstants').MORE_SEARCH_CONTEXT_COUNT,m={getSearchContext:function q(r,s,t){if(r){var u=j.executeOrEnqueue(r,function(z){var aa=o(z,r);t(aa);}),v=j.getUnavailableResources(u);if(v.length){var w={message_id:r,limit:k+1},x=h.getServerIDFromClientIDNow(s),y=c('MercuryIDs').tokenize(s);if(y.type=='user'){w.other_user_fbid=x;}else w.thread_fbid=x;p(w);}return u;}},getMoreSearchContext:function q(r,s,t,u){if(r){var v=j.getResource(r);if(v){var w=t==c('WebMessengerConstants').MORE_SEARCH_CONTEXT_UP?v.up_message_ids:v.down_message_ids,x=w.getCurrentArraySize()+l,y=w.executeOrEnqueue(0,x,function(){var da=o(v,r);u(da);}),z=w.getUnavailableResources(y);if(z.length){var aa={message_id:r,limit:x,direction:t},ba=h.getServerIDFromClientIDNow(s),ca=c('MercuryIDs').tokenize(s);if(ca.type=='user'){aa.other_user_fbid=ba;}else aa.thread_fbid=ba;p(aa);}return y;}}},handleUpdate:function q(r){if(r.mercury_payload)i.handleUpdate(r.mercury_payload);var s=r.search_context||{};for(var t in s){var u=s[t],v=u.other_user_fbid||u.thread_fbid,w=h.getClientIDFromServerIDNow(v),x=!j.getResource(t),y=x?{thread_id:w,up_message_ids:new (c('RangedCallbackManager'))(),down_message_ids:new (c('RangedCallbackManager'))()}:j.getResource(t),z=x?k+1:l;if(u.up_message_ids&&(y.up_message_ids.getCurrentArraySize()===0||u.up_message_ids.length>=y.up_message_ids.getCurrentArraySize()))n(y.up_message_ids,u.up_message_ids,z);if(u.down_message_ids&&(y.down_message_ids.getCurrentArraySize()===0||u.down_message_ids.length>=y.down_message_ids.getCurrentArraySize()))n(y.down_message_ids,u.down_message_ids,z);if(x)j.setResource(t,y);}},unsubscribe:function q(r,s,t){if(s){var u=j.getResource(s);if(u){if(t==c('WebMessengerConstants').MORE_SEARCH_CONTEXT_UP){u.up_message_ids.unsubscribe(r);}else u.down_message_ids.unsubscribe(r);}else j.unsubscribe(r);}}};function n(q,r,s){var t=q.getCurrentArraySize(),u=r.length<t+s;if(r.length){q.removeAllResources();q.addResourcesWithoutSorting(r,0);}if(u)q.setReachedEndOfArray();}function o(q,r){var s=q.up_message_ids.hasReachedEndOfArray(),t=q.up_message_ids.getAllResources();if(!s)t.shift();var u=q.down_message_ids.hasReachedEndOfArray(),v=q.down_message_ids.getAllResources();if(!u)v.pop();return {thread_id:q.thread_id,message_id:r,up_message_ids:t,up_exhausted:s,down_message_ids:v,down_exhausted:u};}function p(q){q.client=c('MercuryAPIArgsSource').WEBMESSENGER;c('MercuryServerDispatcher').trySend('/ajax/mercury/search_context.php',q);}c('MercuryServerDispatcher').registerEndpoints({'/ajax/mercury/search_context.php':{mode:c('MercuryServerDispatcher').IMMEDIATE,handler:m.handleUpdate}});f.exports=m;}),null);
__d('WebMessengerDetailViewSearchContextControl',['fbt','Event','CSS','DOM','MercuryMessageGroup','MercuryMessages','WebMessengerMessagesSelection','MercurySearchContextResults','MercurySearchSnippetResults','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','WebMessengerThreadMessagesRenderer','WebMessengerConstants','WebMessengerSubscriptionsHandler'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('MercuryMessages').get(),j=c('MercurySearchSnippetResults').get();function k(u,v,w){'use strict';this._manager=u;this._rootElement=v;this._paginationBox=w;c('DOM').empty(this._rootElement);var x=c('WebMessengerTemplates')[':fb:web-messenger:read-view:search-context'].build(),y=c('WebMessengerTemplates')[':fb:web-messenger:read-view:search-pagination-box'].build();c('DOM').setContent(this._rootElement,x.getRoot());c('DOM').setContent(this._paginationBox,y.getRoot());this._messagelistRoot=x.getRoot();this._loadingSpinner=x.getNode('loadingSpinner');this._messageList=x.getNode('messagelist');this._loadMoreButton=x.getNode('loadMoreButton');this._loadMoreLink=x.getNode('loadMoreLink');this._downMoreButton=x.getNode('downMoreButton');this._downMoreLink=x.getNode('downMoreLink');this._nextSnippet=y.getNode('nextSnippet');this._previousSnippet=y.getNode('previousSnippet');this._backToSnippetsButton=y.getNode('backToSnippetsButton');this._snippetCountDescription=y.getNode('snippetCountDescription');this._paginationBoxCloseButton=y.getNode('paginationBoxCloseButton');this._state=null;this._threadID=null;this._messageID=null;c('WebMessengerThreadMessagesRenderer').setupSelectionListener(this._messageList);c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(this._loadMoreLink,'click',function(){c('CSS').addClass(this._loadMoreButton,'async_saving');s(this,c('WebMessengerConstants').MORE_SEARCH_CONTEXT_UP);}.bind(this)),c('Event').listen(this._downMoreLink,'click',function(){c('CSS').addClass(this._downMoreButton,'async_saving');s(this,c('WebMessengerConstants').MORE_SEARCH_CONTEXT_DOWN);}.bind(this)),c('Event').listen(this._nextSnippet,'click',l.bind(null,this,1)),c('Event').listen(this._previousSnippet,'click',l.bind(null,this,-1)),c('Event').listen(this._backToSnippetsButton,'click',function(){var z=c('WebMessengerStateManager').getCurrentStateData(),aa=z.single_thread_search?c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET:c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET,ba={folder:z.folder,message_query:z.message_query,query:z.query};if(z.single_thread_search)ba.thread_id=z.thread_id;c('WebMessengerStateManager').updateDetailState(aa,ba);}),c('Event').listen(this._paginationBoxCloseButton,'click',function(){c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{thread_id:c('WebMessengerStateManager').getCurrentStateData().thread_id});}.bind(this)));}k.prototype.hideView=function(){'use strict';c('CSS').hide(this._rootElement);c('CSS').hide(this._paginationBox);};k.prototype.updateView=function(){'use strict';c('CSS').show(this._rootElement);c('CSS').show(this._paginationBox);var u=o(this);p(this);c('WebMessengerMessagesSelection').clear();if(u)r(this);};k.prototype.destroy=function(){'use strict';n(this);};function l(u,v){var w=c('WebMessengerStateManager').getCurrentStateData(),x=j.findIndexOfSnippet(u._messageQuery,w.thread_id,w.message_id),y=x+v;c('CSS').hide(u._messageList);c('CSS').hide(u._loadMoreButton);c('CSS').hide(u._downMoreButton);c('CSS').show(u._loadingSpinner);j.findSnippetAtIndex(u._messageQuery,w.thread_id,y,function(z){c('CSS').show(u._messageList);m(w,z);});}function m(u,v){var w={folder:u.folder,message_id:v,message_query:u.message_query,query:u.query,single_thread_search:u.single_thread_search,thread_id:u.thread_id};c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateManager').getCurrentDetailState(),w);}function n(u){u._searchContextSubscription&&c('MercurySearchContextResults').unsubscribe(u._searchContextSubscription.subscriber_id,u._searchContextSubscription.message_id,u._searchContextSubscription.direction);u._searchThreadsSubscription=null;}function o(u){var v=c('WebMessengerStateManager').getCurrentStateData();if(u._threadID!=v.thread_id)return true;if(u._messageQuery!=v.message_query)return true;if(u._messageID!=v.message_id)return true;return false;}function p(u){var v=c('WebMessengerStateManager').getCurrentStateData();u._state=c('WebMessengerStateManager').getCurrentDetailState();u._threadID=v.thread_id;u._messageQuery=v.message_query;u._messageID=v.message_id;u._selectionEnabled=!!v.message_action;c('WebMessengerThreadMessagesRenderer').updateSelection(u._messageList);c('CSS').conditionClass(u._messageList,'bugReportingEnabled',v.bug_reporting_enabled);}function q(u,v){c('DOM').setAttributes(u,{disabled:v});var w=c('DOM').find(u,'^label');c('CSS').conditionClass(w,'uiButtonDisabled',v);}function r(u){var v=c('DOM').create('strong',{},u._messageQuery),w=j.countSnippetsMatchingQueryInThread(u._messageQuery,u._threadID),x=j.findIndexOfSnippet(u._messageQuery,u._threadID,u._messageID),y=x+1,z=h._({"*":"{index}\/{count} r\u00e9sultats pour {query}"},[h.param('index',y),h.param('count',w,[0]),h.param('query',v)]);c('DOM').setContent(u._snippetCountDescription,z);q(u._previousSnippet,x===0);q(u._nextSnippet,x===w-1);c('DOM').empty(u._messageList);c('CSS').show(u._loadingSpinner);c('CSS').hide(u._loadMoreButton);c('CSS').hide(u._downMoreButton);n(u);if(u._threadID&&u._messageID){var aa=c('MercurySearchContextResults').getSearchContext(u._messageID,u._threadID,function(ba){c('CSS').hide(u._loadingSpinner);t(u,ba);});if(aa)u._searchContextSubscription={subscriber_id:aa,message_id:u._messageID};}}function s(u,v){n(u);if(u._threadID&&u._messageID){var w=c('MercurySearchContextResults').getMoreSearchContext(u._messageID,u._threadID,v,function(x){if(v==c('WebMessengerConstants').MORE_SEARCH_CONTEXT_UP){c('CSS').removeClass(u._loadMoreButton,'async_saving');}else c('CSS').removeClass(u._downMoreButton,'async_saving');t(u,x);});if(w)u._searchContextSubscription={subscriber_id:w,message_id:u._messageID,direction:v};}}function t(u,v){c('CSS').conditionShow(u._loadMoreButton,!v.up_exhausted);c('CSS').conditionShow(u._downMoreButton,!v.down_exhausted);var w=v.up_message_ids.concat([v.message_id],v.down_message_ids),x=i.getMessagesFromIDs(w);c('DOM').empty(u._messageList);var y=c('MercuryMessageGroup').calculateMessageGroups(x);y.forEach(function(z,aa){var ba=c('WebMessengerThreadMessagesRenderer').renderMessageSeparatorForIndex(y,aa);if(ba)c('DOM').appendContent(u._messageList,ba);var ca=c('WebMessengerThreadMessagesRenderer').renderMessageGroup(z,false,'context:').getRoot(),da=z.some(function(ea){return ea.message_id==v.message_id;});if(da)c('CSS').addClass(ca,'selectedHighlight');c('DOM').appendContent(u._messageList,ca);});}f.exports=k;}),null);
__d('WebMessengerSearchSnippetsRenderer',['cx','fbt','Event','CSS','DOM','Image.react','MercuryMessageRenderer','MercuryParticipants','MercuryParticipantsConstants','React','ReactDOM','MercurySearchSnippetResults','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','MercuryThreadMetadataRenderer'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('MercurySearchSnippetResults').get(),k=c('MercuryThreadMetadataRenderer').get(),l={renderMultipleSnippetBlocks:function r(s,t,u){u=u||{};var v=true;for(var w in u){v=false;var x=c('WebMessengerTemplates')[':fb:web-messenger:read-view:search-snippets-block'].build();c('DOM').appendContent(s,x.getRoot());l.renderSingleSnippetBlock(x,t,w,u[w]);}if(v)q(s);},renderThreadSnippetBlock:function r(s,t,u,v,w){if(!v||!v.length){q(s);return;}var x=c('WebMessengerTemplates')[':fb:web-messenger:read-view:search-snippets-block'].build();c('DOM').appendContent(s,x.getRoot());c('CSS').hide(x.getNode('searchThreadName'));m(x,t,u,v,w);},renderSingleSnippetBlock:function r(s,t,u,v){var w=s.getNode('searchThreadName'),x=c('DOM').create('h3');c('DOM').setContent(w,x);k.renderAndSeparatedParticipantList(u,x);m(s,t,u,v.snippets,v.num_total_snippets);},renderMultipleSnippets:function r(s,t,u,v){(v||[]).forEach(function(w){var x=c('WebMessengerTemplates')[':fb:web-messenger:read-view:search-snippet'].build();c('DOM').appendContent(s,x.getRoot());c('MercuryParticipants').get(w.author,function(y){l.renderSingleSnippet(x,t,u,w,y);});});},renderSingleSnippet:function r(s,t,u,v,w){s.setNodeProperty('bodyDiv','id','snippet:'+v.message_id);var x=v.matched_keywords||undefined,y=c('MercuryMessageRenderer').formatMessageBody(v.body,x);s.setNodeContent('body',y);var z=s.getNode('image');c('CSS').removeClass(z,'MercuryThreadImage');c('CSS').addClass(z,'MercuryMediumThreadImage');var aa=c('React').createElement(c('Image.react'),{width:c('MercuryParticipantsConstants').IMAGE_SIZE,height:c('MercuryParticipantsConstants').IMAGE_SIZE,src:w.image_src});if(w.href)aa=c('React').createElement('a',{href:w.href},aa);c('ReactDOM').render(aa,z);var ba=w.short_name;s.setNodeContent('shortName',i._("{name}\u00a0:",[i.param('name',ba)])+' ');k.renderTimestamp(s.getNode('timestamp'),v.timestamp_absolute,v.timestamp_relative,v.timestamp);var ca=s.getNode('seeContext');c('Event').listen(ca,'click',function(){var da=c('WebMessengerStateManager').getCurrentStateData(),ea={message_query:t,query:da.query,thread_id:u,message_id:v.message_id},fa=c('WebMessengerStateManager').getCurrentDetailState();if(fa===c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET)ea.single_thread_search=true;c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT,ea);return false;});}};function m(r,s,t,u,v){var w=r.getNode('snippetList');l.renderMultipleSnippets(w,s,t,u);var x=v-u.length;n(r,s,t,v,x);}function n(r,s,t,u,v){var w=r.getNode('totalSnippetsCount'),x=r.getNode('moreSnippetsLink');c('CSS').conditionShow(x,v>0);if(v>0){var y=p(v);c('DOM').setContent(x,y);}c('DOM').setContent(w,o(u));if(v>0)c('Event').listen(x,'click',function(){j.getSingleThreadSearchMoreResults(s,t,function(z){c('DOM').empty(r.getNode('snippetList'));m(r,s,t,z,u);});});}function o(r){if(r==1){return i._("1 r\u00e9sultat");}else return i._({"*":"{count} r\u00e9sultats"},[i.param('count',r,[0])]);}function p(r){if(r==1){return i._("Afficher 1 r\u00e9sultat de plus");}else return i._({"*":"Afficher {count} r\u00e9sultats de plus"},[i.param('count',r,[0])]);}function q(r){var s=i._("Aucun r\u00e9sultat"),t=c('DOM').create('div',{className:"_2n4"},s);c('DOM').setContent(r,t);}f.exports=l;}),null);
__d('WebMessengerDetailViewSearchSnippetsControl',['cx','fbt','JSXDOM','Event','CSS','DOM','MercurySearchSnippetResults','WebMessengerSearchSnippetsRenderer','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','WebMessengerPermalinks','WebMessengerSubscriptionsHandler'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('MercurySearchSnippetResults').get();function k(p,q){'use strict';this._manager=p;this._rootElement=q;c('DOM').empty(this._rootElement);var r=c('WebMessengerTemplates')[':fb:web-messenger:read-view:search-snippets'].build();c('DOM').setContent(this._rootElement,r.getRoot());this._loadingSpinner=r.getNode('loadingSpinner');this._messageList=r.getNode('messagelist');this._downMoreButton=r.getNode('downMoreButton');this._downMoreLink=r.getNode('downMoreLink');this._state=null;this._messageQuery=null;this._threadID=null;c('CSS').hide(this._downMoreButton);c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(this._downMoreLink,'click',function(){c('CSS').addClass(this._downMoreButton,'async_saving');o(this);}.bind(this)));}k.prototype.hideView=function(){'use strict';c('CSS').hide(this._rootElement);};k.prototype.updateView=function(){'use strict';c('CSS').show(this._rootElement);var p=l(this);m(this);if(p)n(this);};k.prototype.destroy=function(){'use strict';};function l(p){var q=c('WebMessengerStateManager').getCurrentDetailState();if(p._state!=q)return true;var r=c('WebMessengerStateManager').getCurrentStateData();if(p._messageQuery!=r.message_query)return true;if(q==c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET)if(p._threadID!=r.thread_id)return true;return false;}function m(p){p._state=c('WebMessengerStateManager').getCurrentDetailState();var q=c('WebMessengerStateManager').getCurrentStateData();p._threadID=q.thread_id;p._messageQuery=q.message_query;}function n(p){c('CSS').hide(p._downMoreButton);c('DOM').empty(p._messageList);if(p._messageQuery){c('CSS').show(p._loadingSpinner);if(p._state===c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET&&p._threadID){j.getSingleThreadSearchResults(p._messageQuery,p._threadID,function(q,r){c('CSS').hide(p._loadingSpinner);c('WebMessengerSearchSnippetsRenderer').renderThreadSnippetBlock(p._messageList,p._messageQuery,p._threadID,q,r);var s=c('JSXDOM').a({className:"_4-ii"},i._("Rechercher {query} dans toutes les conversations",[i.param('query',p._messageQuery)])),t=c('WebMessengerPermalinks').getURI(c('WebMessengerStateConstants').MASTER.SEARCH,c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET,{query:p._messageQuery,message_query:p._messageQuery});s.setAttribute('href',t);c('DOM').prependContent(p._messageList,c('JSXDOM').div({className:"_4-ij"},s));});}else j.getAllThreadSearchResults(p._messageQuery,function(q,r){c('CSS').hide(p._loadingSpinner);c('WebMessengerSearchSnippetsRenderer').renderMultipleSnippetBlocks(p._messageList,p._messageQuery,q);c('CSS').conditionShow(p._downMoreButton,!r);});}}function o(p){if(p._messageQuery)j.getAllThreadSearchMoreResults(p._messageQuery,function(q,r){c('CSS').removeClass(p._downMoreButton,'async_saving');c('DOM').empty(p._messageList);c('WebMessengerSearchSnippetsRenderer').renderMultipleSnippetBlocks(p._messageList,p._messageQuery,q);c('CSS').conditionShow(p._downMoreButton,!r);});}f.exports=k;}),null);
__d('WebMessengerSharedPhotos.react',['cx','fbt','glyph','AsyncRequest','Grid.react','Image.react','immutable','LoadingIndicator.react','MercuryAttachmentViewer','MessagesViewerSetID','Pixelz.react','React','WebMessengerStateConstants','WebMessengerStateManager','URI','XUIButton.react'],(function a(b,c,d,e,f,g,h,i,j){var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('React').PropTypes,n=c('Grid.react').GridItem,o=i._("Revenir \u00e0 la conversation"),p=42;k=babelHelpers.inherits(q,c('React').Component);l=k&&k.prototype;function q(){var r,s;'use strict';for(var t=arguments.length,u=Array(t),v=0;v<t;v++)u[v]=arguments[v];return s=(r=l.constructor).call.apply(r,[this].concat(u)),this.state={isLoadingMore:true,moreImages:true,imagesData:c('immutable').List()},this.isVisible=function(){return !(this.state.isLoadingMore&&this.state.moreImages&&this.state.imagesData.isEmpty());}.bind(this),this.loadMoreImages=function(){if(this.state.moreImages&&!this.state.isLoadingMore){this.setState({isLoadingMore:true});this.requestImages();}}.bind(this),this.renderImages=function(){var w=Math.floor((this.props.totalWidth-p)/3),x=this.state.imagesData,y=x.map(function(z){return (c('React').createElement(n,{key:z.fbid},c('React').createElement('div',{className:"_5dq3",onClick:this.viewFullImage.bind(null,z)},c('React').createElement(c('Pixelz.react'),{upscale:true,width:w,height:w,resizeMode:'cover',src:z.uri,borderRadius:1,insetBorderColor:'rgba(0, 0, 0, 0.1)'}))));}.bind(this));return y;}.bind(this),this.viewFullImage=function(w){var x=new (c('URI'))('/ajax/messaging/attachments/sharedphotos.php').setQueryData({thread_id:this.props.threadID,image_id:w.fbid});c('MercuryAttachmentViewer').bootstrapWithConfig({fbid:w.fbid,dimensions:w.dim,src:w.uri,disablePaging:this.state.imagesData.size===1,endpoint:x,setID:c('MessagesViewerSetID').MESSAGES_VIEW_ALL_IN_THREAD});}.bind(this),this.requestImages=function(){new (c('AsyncRequest'))().setURI('/ajax/messaging/attachments/sharedphotos.php').setMethod('POST').setData({thread_id:this.props.threadID,offset:this.state.imagesData.size,limit:30}).setHandler(function(w){var x=w.getPayload();this.setState({isLoadingMore:false,moreImages:x.moreImagesToLoad,imagesData:this.state.imagesData.concat(x.imagesData)});}.bind(this)).send();}.bind(this),this.returnToThread=function(){var w=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData());c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,w);},s;}q.prototype.componentDidMount=function(){'use strict';this.requestImages();c('MercuryAttachmentViewer').preload();};q.prototype.componentDidUpdate=function(){'use strict';if(!this.isVisible())this.requestImages();};q.prototype.componentWillReceiveProps=function(r){'use strict';if(r.threadID&&r.threadID!==this.props.threadID)this.setState({isLoadingMore:true,moreImages:true,imagesData:c('immutable').List()});};q.prototype.render=function(){'use strict';var r=c('React').createElement('div',{className:(this.isVisible()?"_5dq2":'')+(!this.isVisible()?' '+"_5dq1":'')+(!this.isVisible()?' '+"_5dpz":'')},c('React').createElement(c('LoadingIndicator.react'),{color:'white',size:'large'}));if(!this.isVisible()){return r;}else if(!this.state.isLoadingMore)r=null;return (c('React').createElement('div',{className:"_5dpz"},c('React').createElement('div',{className:"_5dp-"},c('React').createElement(c('XUIButton.react'),{image:c('React').createElement(c('Image.react'),{src:j('back')}),label:o,size:'medium',onClick:this.returnToThread})),c('React').createElement('div',{className:"_5dq0"},c('React').createElement(c('Grid.react'),{cols:3,fixed:false},this.renderImages()),r)));};q.propTypes={threadID:m.string.isRequired,totalWidth:m.number.isRequired};f.exports=q;}),null);
__d('WebMessengerDetailViewSharedPhotosControl',['CSS','DOM','ReactComponentRenderer','MercuryThreadIDMap','WebMessengerSharedPhotos.react','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerEvents','WebMessengerSubscriptionsHandler'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadIDMap').get();function i(j,k){'use strict';this.manager=j;this.rootElement=k;this.renderer=null;this.serverID=null;this.state=null;this.threadID=null;c('DOM').empty(this.rootElement);c('WebMessengerSubscriptionsHandler').addSubscriptions(this.manager.subscribe('scrolledNearBottom',this.notifyImageRequest.bind(this)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').DETAIL_DOM_CHANGED,this.render.bind(this)));}i.prototype.hideView=function(){'use strict';c('CSS').hide(this.rootElement);};i.prototype.updateView=function(){'use strict';c('CSS').show(this.rootElement);this.updateStateAndData();this.render();};i.prototype.destroy=function(){'use strict';c('WebMessengerSubscriptionsHandler').release();};i.prototype.updateStateAndData=function(){'use strict';this.state=c('WebMessengerStateManager').getCurrentDetailState();var j=c('WebMessengerStateManager').getCurrentStateData();this.threadID=j.thread_id;};i.prototype.render=function(){'use strict';this.serverID=h.getServerIDFromClientIDNow(this.threadID);if(!this.serverID)return;if(!this.renderer){this.renderer=new (c('ReactComponentRenderer'))(c('WebMessengerSharedPhotos.react'),this.rootElement);this.renderer.setProps({threadID:this.serverID,totalWidth:this.rootElement.clientWidth});}else this.renderer.setProps({threadID:this.serverID,totalWidth:this.rootElement.clientWidth});};i.prototype.notifyImageRequest=function(){'use strict';var j=c('WebMessengerStateManager').getCurrentDetailState();if(j===c('WebMessengerStateConstants').DETAIL.SHARED_PHOTOS&&this.renderer)this.renderer.component.loadMoreImages();};f.exports=i;}),null);
__d('MercurySheetView',['cx','Animation','ArbiterMixin','Bootloader','CSS','DOM','JSLogger','MercuryIDs','MercuryParticipants','MercurySheetPolicy','MercuryThreadActions','MercuryThreadIDMap','MercuryMessageActions','MercuryMessageObject','React','ReactDOM','Style','MercuryThreads','Vector','emptyFunction','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('MercuryThreadActions').get(),j=c('MercuryThreadIDMap').get(),k=c('MercuryMessageActions').get(),l=c('MercuryMessageObject').get(),m=c('MercuryThreads').get(),n=5000,o='/ajax/chat/multichat/name_conversation/dismiss.php',p={},q=function r(s,t,u,v){this._threadID=s;this._rootElement=t;this._tabMainElement=u;this._view=v;this._openSheet=null;};Object.assign(q.prototype,c('ArbiterMixin'),{destroy:function r(){c('DOM').empty(this._rootElement);},_clearAndOpen:function r(s,t,u){if(!t||s===this._openSheet)return false;this.clear(function(){this._openSheet=s;c('CSS').show(this._rootElement);if(t.type&&typeof t.type==='function'){c('ReactDOM').render(t,this._rootElement);}else t.render();if(u){c('CSS').addClass(this._tabMainElement,'sheetSlide');c('CSS').addClass(this._tabMainElement,"_1sk4");var v=c('Vector').getElementDimensions(this._rootElement).y;c('Style').set(this._rootElement,'bottom',v+'px');this.resize();this._animation=new (c('Animation'))(this._rootElement).to('bottom',0).duration(150).ease(c('Animation').ease.both).ondone(function(){c('CSS').removeClass(this._tabMainElement,'sheetSlide');c('CSS').removeClass(this._tabMainElement,"_1sk4");this.resize();}.bind(this)).go();}else this.resize();if(!c('MercurySheetPolicy').isPermanent(s))this.resetTimeout(s);}.bind(this));return true;},_openNewSheet:function r(s,t,u){if(this._openSheet&&!c('MercurySheetPolicy').canReplaceOpenSheet(this._openSheet,s))return false;if(typeof s==='string'){this._openSheetByType(s,t,u);return false;}else{this._clearAndOpen(s,s,t);return true;}},_openSheetByType:function r(s,t,u){switch(s){case c('MercurySheetPolicy').sheets.ChatThreadIsMutedTabSheet:c('Bootloader').loadModules(["ChatThreadIsMutedTabSheet.react"],function(v){var w=c('React').createElement(v,{onUnmute:function(){i.unmute(this._threadID);this._view.focus();}.bind(this)});this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatUserFocusBypassSheet:c('Bootloader').loadModules(["ChatUserFocusBypassSheet.react"],function(v){var w=c('React').createElement(v,null);this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatUserFocusSheet:c('Bootloader').loadModules(["ChatUserFocusSheet.react"],function(v){var w=m.getThreadMetaNow(this._threadID),x=c('React').createElement(v,{thread:w});this._clearAndOpen(s,x,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatMontageSheet:c('Bootloader').loadModules(["ChatMontageSheet.react"],function(v){var w=c('React').createElement(v,{threadID:this._threadID,onResize:function(){return this.resize();}.bind(this)});this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatUserTimezoneSheet:c('Bootloader').loadModules(["ChatUserTimezoneSheet.react"],function(v){var w=function(){this.close(s);}.bind(this),x=c('React').createElement(v,{data:u,threadID:this._threadID,resize:function(){return this.resize();}.bind(this),onDismiss:w});this._clearAndOpen(s,x,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatUserBlockedTabSheet:c('Bootloader').loadModules(["ChatPrivacyActionController","ChatUserBlockedTabSheet.react"],function(v,w){var x=c('MercuryIDs').getUserIDFromThreadID(this._threadID);if(!x){var y=c('JSLogger').create('blackbird');y.error('user_blocked_sheet_open_with_non_friend');return;}var z=new v(x,c('emptyFunction')),aa=c('MercuryIDs').getParticipantIDFromUserID(x);c('MercuryParticipants').get(aa,function(ba){var ca=c('React').createElement(w,{shortName:ba.short_name,gender:ba.gender,privacyActionController:z});this._clearAndOpen(s,ca,t);}.bind(this));}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatUploadWarningTabSheet:c('Bootloader').loadModules(["ChatUploadWarningTabSheet.react"],function(v){var w=c('React').createElement(v,null);this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatThreadIsMessageBlockedSheet:c('Bootloader').loadModules(["ChatThreadIsMessageBlockedSheet.react"],function(v){var w=c('MercuryIDs').getUserIDFromThreadID(this._threadID),x=c('MercuryIDs').getParticipantIDFromUserID(w);if(x)c('MercuryParticipants').get(x,function(y){var z=c('React').createElement(v,{shortName:y.short_name,onUnblock:function(){i.unblockMessages(this._threadID);this._view.focus();}.bind(this)});this._clearAndOpen(s,z,t);}.bind(this));}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatReadOnlyTabSheet:case c('MercurySheetPolicy').sheets.ChatReadOnlyPermanentTabSheet:c('Bootloader').loadModules(["ChatReadOnlyTabSheet.react","MercuryReadOnlyReason"],function(v,w){var x=m.getThreadMetaNow(this._threadID),y=x?w.getReason(x.has_email_participant):null;if(y){var z=c('React').createElement(v,{reason:y});this._clearAndOpen(s,z,t);}}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatOfflineTabSheet:c('Bootloader').loadModules(["ChatOfflineTabSheet.react","ChatPrivacyActionController","ChatVisibility"],function(v,w,x){var y=c('JSLogger').create('blackbird'),z=c('MercuryIDs').getUserIDFromThreadID(this._threadID);if(!z){y.error('offline_sheet_open_with_non_friend');return;}var aa=new w(z,c('emptyFunction')),ba=c('MercuryIDs').getParticipantIDFromUserID(z);c('MercuryParticipants').get(ba,function(ca){var da=c('React').createElement(v,{shortName:ca.short_name,privacyActionController:aa,turnOnChat:function ea(event){event.preventDefault();if(x.isOnline())y.error('tab_sheet_already_online');aa.togglePrivacy();y.log('tab_sheet_go_online',{tab_id:z});}});this._clearAndOpen(s,da,t);}.bind(this));}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatNoRecipientsTabSheet:if(!c('MercuryIDs').getUserIDFromThreadID(this._threadID))c('Bootloader').loadModules(["ChatNoRecipientsTabSheet.react"],function(v){var w=c('React').createElement(v,null);this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatNewMessagesTabSheet:c('Bootloader').loadModules(["ChatNewMessagesTabSheet.react"],function(v){var w=c('React').createElement(v,{onClick:function(){this._view.newMessageClicked();}.bind(this)});this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatNameConversationTabSheet:c('Bootloader').loadModules(["AsyncRequest","ChatNameConversationTabSheet.react","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType"],function(v,w,x,y,z){m.getThreadMeta(this._threadID,function(aa){var ba=void 0,ca=function fa(ga,ha){var ia=ga.name;if((ha||ia)&&ha!=ia)k.send(l.constructLogMessageObject(z.CHAT_WEB,ga.thread_id,y.THREAD_NAME,{name:ha}),null,x.CHAT);},da=function(fa){if(!p[this._threadID]){p[this._threadID]=true;j.getServerIDFromClientID(fa.thread_id,function(ga){new v(o).setData({thread_fbid:ga}).send();});}this.close(s);}.bind(this);ba=c('React').createElement(w,{defaultThreadName:aa.name,onDone:function fa(ga){ca(aa,ga);da(aa);}});var ea=u&&u.automatic;if(!ea||ea&&!p[this._threadID])this._clearAndOpen(s,ba,t);}.bind(this));}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatEmployeeAwaySheet:c('Bootloader').loadModules(["ChatEmployeeAwaySheet.react"],function(v){var w=c('React').createElement(v,null);this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatUserIsPersonalUserSheet:c('Bootloader').loadModules(["ChatUserIsPersonalUserSheet.react"],function(v){var w=function(){this.close(s);}.bind(this);u=u||{};var x=c('React').createElement(v,{myself:u.myself,participant:u.participant,threadID:this._threadID,onDismiss:w});this._clearAndOpen(s,x,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatUserIsWorkUserSheet:c('Bootloader').loadModules(["ChatUserIsWorkUserSheet.react"],function(v){var w=function(){this.close(s);}.bind(this);u=u||{};var x=c('React').createElement(v,{myself:u.myself,participant:u.participant,threadID:this._threadID,onDismiss:w});this._clearAndOpen(s,x,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatPageResponsivenessIndicator:c('Bootloader').loadModules(["ChatPageResponsivenessIndicator.react"],function(v){var w=c('React').createElement(v,u);this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatEventReminderTabSheet:c('Bootloader').loadModules(["ChatEventReminderContainer.react","EventReminderActions","EventReminderStateStore"],function(v,w,x){var y=void 0,z=m.getThreadMetaNow(this._threadID),aa={threadID:'',flyoutNoSheet:false};if(z.lightweight_events){var ba=z.lightweight_events.message_thread_id.toString(),ca={eventName:z.lightweight_events.title,eventDate:z.lightweight_events.event_time,eventID:z.lightweight_events.oid.toString(),threadID:ba};aa.threadID=ba;y=x.getEvent(ba);if(y&&!y.eventDate)w.updateEventReminder(ca);}if(!y)this.close(s);var da=c('React').createElement(v,aa);this._clearAndOpen(s,da,t);}.bind(this),'MercurySheetView');break;case c('MercurySheetPolicy').sheets.ChatAppointmentBanner:c('Bootloader').loadModules(["ChatAppointmentBannerRoot.react"],function(v){var w=c('React').createElement(v,u);this._clearAndOpen(s,w,t);}.bind(this),'MercurySheetView');break;}},resetTimeout:function r(s){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=c('setTimeoutAcrossTransitions')(function(){this.close(s);}.bind(this),n);},set:function r(s){return this._openNewSheet(s,false);},open:function r(s,t){return this._openNewSheet(s,true,t);},close:function r(s,t){if(this._openSheet!==s)return;if(!this._openSheet){t&&t();return;}if(this._animation)this._animation.stop();if(this._sheetCloseHandler){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=null;}c('CSS').addClass(this._tabMainElement,'sheetSlide');c('CSS').addClass(this._tabMainElement,"_1sk4");var u=c('Vector').getElementDimensions(this._rootElement).y;this.resize();this._animation=new (c('Animation'))(this._rootElement).to('bottom',u+'px').duration(100).ease(c('Animation').ease.begin).ondone(function(){c('DOM').empty(this._rootElement);c('CSS').hide(this._rootElement);c('CSS').removeClass(this._tabMainElement,'sheetSlide');c('CSS').removeClass(this._tabMainElement,"_1sk4");this._openSheet=null;this.resize();t&&t();}.bind(this)).go();},clear:function r(s){this.close(this._openSheet,s);},resize:function r(){this.inform('resize');}});f.exports=q;}),null);
__d('WebMessengerEmployeeAwaySheet',['ArbiterMixin','DOM','mixin','WebMessengerTemplates'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(k,l,m){'use strict';i.constructor.call(this);this.$WebMessengerEmployeeAwaySheet1=k;this.$WebMessengerEmployeeAwaySheet2=l;this.$WebMessengerEmployeeAwaySheet3=m;}j.prototype.render=function(){'use strict';var k=c('WebMessengerTemplates')[':fb:mercury:employee-away-sheet'].build();c('DOM').setContent(this.$WebMessengerEmployeeAwaySheet2,k.getRoot());};j.prototype.isPermanent=function(){'use strict';return true;};j.prototype.getType=function(){'use strict';return 'employee-away';};j.prototype.open=function(){'use strict';this.$WebMessengerEmployeeAwaySheet3.open(this);};j.prototype.close=function(){'use strict';this.$WebMessengerEmployeeAwaySheet3.close(this);};f.exports=j;}),null);
__d('WebMessengerIsMessageBlockedSheet',['fbt','ArbiterMixin','DOM','Event','WebMessengerTemplates','mixin'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));j=i&&i.prototype;function k(l,m,n){'use strict';j.constructor.call(this);this.$WebMessengerIsMessageBlockedSheet1=l;this.$WebMessengerIsMessageBlockedSheet2=m;this.$WebMessengerIsMessageBlockedSheet3=n;}k.prototype.render=function(){'use strict';var l=c('WebMessengerTemplates')[':fb:mercury:messages-blocked-sheet'].build(),m=h._("Les messages de ce destinataire sont bloqu\u00e9s.");c('DOM').setContent(this.$WebMessengerIsMessageBlockedSheet2,l.getRoot());c('DOM').setContent(l.getNode('text'),m+' ');c('Event').listen(l.getNode('unblockButton'),'click',function(){this.inform('clicked',this.$WebMessengerIsMessageBlockedSheet1);}.bind(this));};k.prototype.isPermanent=function(){'use strict';return true;};k.prototype.getType=function(){'use strict';return 'message-blocked';};k.prototype.open=function(){'use strict';this.$WebMessengerIsMessageBlockedSheet3.open(this);};k.prototype.close=function(){'use strict';this.$WebMessengerIsMessageBlockedSheet3.close(this);};f.exports=k;}),null);
__d('WebMessengerThreadIsMutedTabSheet',['fbt','Event','ArbiterMixin','DOM','WebMessengerTemplates','mixin'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));j=i&&i.prototype;function k(l,m){'use strict';j.constructor.call(this);this._rootElement=l;this._sheetView=m;}k.prototype.render=function(){'use strict';var l=c('WebMessengerTemplates')[':fb:web-messenger:read-view:message-mute-sheet'].build();c('DOM').setContent(l.getNode('text'),h._("Cette conversation est mise en sourdine. Les onglets de conversation n\u2019appara\u00eetront pas et les notifications push sont d\u00e9sactiv\u00e9es."));c('DOM').setContent(this._rootElement,l.getRoot());c('Event').listen(l.getNode('unmuteButton'),'click',function(){this.inform('clicked',null);}.bind(this));};k.prototype.isPermanent=function(){'use strict';return false;};k.prototype.getType=function(){'use strict';return 'wb-thread-is-muted';};k.prototype.open=function(){'use strict';this._sheetView.open(this);};k.prototype.close=function(){'use strict';this._sheetView.close(this);};f.exports=k;}),null);
__d('WebMessengerDetailViewSheetControl',['DOM','ArbiterMixin','WebMessengerStateManager','MercuryBlockedParticipants','MercurySheetView','MercuryThreadInfo','WebMessengerTemplates','MercuryThreadInformer','MercuryThreadActions','MercuryThreads','WebMessengerEmployeeAwaySheet','ChatEmployeeAwayWarning','WebMessengerIsMessageBlockedSheet','WebMessengerThreadIsMutedTabSheet','WebMessengerSubscriptionsHandler','mixin'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('MercuryBlockedParticipants').get(),k=c('MercuryThreadInformer').get(),l=c('MercuryThreadActions').get(),m=c('MercuryThreads').get();h=babelHelpers.inherits(n,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function n(o){'use strict';i.constructor.call(this);this._template=c('WebMessengerTemplates')[':fb:web-messenger:tab-sheet-container'].build();this._rootElement=this._template.getNode('sheet');this._threadID=c('WebMessengerStateManager').getCurrentStateData().thread_id;this._sheetView=new (c('MercurySheetView'))(this._threadID,this._rootElement,o);this._threadIsMessageBlockedSheet=new (c('WebMessengerIsMessageBlockedSheet'))(this._threadID,this._rootElement,this._sheetView);this._employeeAwaySheet=new (c('WebMessengerEmployeeAwaySheet'))(this._threadID,this._rootElement,this._sheetView);this._threadIsMutedTabSheet=new (c('WebMessengerThreadIsMutedTabSheet'))(this._rootElement,this._sheetView);this._muteSetting=undefined;c('DOM').setContent(o,this._template.getRoot());this._threadMessageBlockedSub=this._threadIsMessageBlockedSheet.subscribe('clicked',function(){l.unblockMessages(this._threadID);}.bind(this));this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',function(){l.unmute(this._threadID);}.bind(this));c('WebMessengerSubscriptionsHandler').addSubscriptions(this._sheetView.subscribe('resize',this.inform.bind(this,'resize')),k.subscribe('threads-updated',function(p,q){if(this._threadID&&q[this._threadID])this.updateTabSheet(false);}.bind(this)));this.updateTabSheet(true);}n.prototype.updateView=function(){'use strict';var o=c('WebMessengerStateManager').getCurrentStateData().thread_id;if(this._threadID!=o){this._threadID=o;this.updateTabSheet(true);}};n.prototype.updateTabSheet=function(o){'use strict';if(!this._threadID)return;m.getThreadMeta(this._threadID,function(p){var q=c('MercuryThreadInfo').getMuteSetting(p);if(q!=this._muteSetting||o){if(q){this._threadIsMutedTabSheet.open();}else this._threadIsMutedTabSheet.close();this._muteSetting=q;}if(j.isMessageBlocked(p)){this._threadIsMessageBlockedSheet.open();}else this._threadIsMessageBlockedSheet.close();c('ChatEmployeeAwayWarning').updateEmployeeAwayWarning(p,function(){this._employeeAwaySheet.open();}.bind(this),function(){this._employeeAwaySheet.close();}.bind(this));}.bind(this));};n.prototype.destroy=function(){'use strict';this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();this._employeeAwaySheet&&this._employeeAwaySheet.close();};f.exports=n;}),null);
__d('WebMessengerFlexibleArea',['cx','ArbiterMixin','CSS','DOM','Event','Style','Vector','mixin','throttle'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();var k=[];function l(){k.forEach(function(n){n.draw();});}c('Event').listen(window,'resize',c('throttle')(l,50));i=babelHelpers.inherits(m,c('mixin')(c('ArbiterMixin')));j=i&&i.prototype;function m(n){'use strict';j.constructor.call(this);this.minFlexAreaHeight=0;this.flexArea=n;this.container=null;this.padding=0;this.sizeToFit=false;k.push(this);}m.prototype.setContainer=function(n){'use strict';this.container=n;return this;};m.prototype.setPadding=function(n){'use strict';this.padding=n;return this;};m.prototype.setMinFlexAreaHeight=function(n){'use strict';this.minFlexAreaHeight=n;return this;};m.prototype.setSizeToFit=function(n){'use strict';this.sizeToFit=n;return this;};m.prototype.draw=function(){'use strict';if(this.flexArea){var n=this._flexHeight;this.inform('predraw',{old_height:n});var o=c('Vector').getViewportDimensions().y-this.padding;o-=c('Vector').getElementPosition(this.container||this.flexArea).y;if(this.container){Array.from(this.container.childNodes).forEach(function(p){o-=c('Vector').getElementDimensions(p).y;});o+=c('Vector').getElementDimensions(this.flexArea).y;}if(this.sizeToFit)o=Math.min(o,this._getNaturalHeight());if(o<this.minFlexAreaHeight)o=this.minFlexAreaHeight;if(isNaN(o)||o<0)o=0;if(o!==n){c('Style').set(this.flexArea,'height',o+'px');this._flexHeight=o;this.inform('height_changed',{height:o,old_height:n});}}return this;};m.prototype.destroy=function(){'use strict';var n=k.indexOf(this);n>=0&&k.splice(n,1);l();};m.prototype._getNaturalHeight=function(){'use strict';var n=this.flexArea.cloneNode(true);c('CSS').addClass(n,"_2ys");c('Style').set(n,'height','auto');c('DOM').insertAfter(this.flexArea,n);var o=c('Vector').getElementDimensions(n).y;c('DOM').remove(n);return o;};m.prototype._getFlexHeight=function(){'use strict';if(isNaN(this._flexHeight))this._flexHeight=c('Vector').getElementDimensions(this.flexArea).y;return this._flexHeight;};f.exports=m;}),null);
__d('WebMessengerFlexibleScrollArea',['CSS','DOMQuery','ScrollableArea','Style','WebMessengerFlexibleArea','throttle'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('WebMessengerFlexibleArea'));i=h&&h.prototype;function j(k,l){'use strict';i.constructor.call(this,k);this._scroll=c('ScrollableArea').fromNative(k,l);this._scrollBody=c('DOMQuery').find(this.flexArea,'.uiScrollableAreaBody');var m=c('DOMQuery').scry(this.flexArea,'.uiScrollableAreaShadow');this._shadow=m.length?m[0]:null;this._scrollContent=c('DOMQuery').find(this.flexArea,'.uiScrollableAreaContent');this._scrollCallbacks=[];this._drawSubscription=this.subscribe('height_changed',this.poke.bind(this));this._scrollSub=this._scroll.subscribe('scroll',c('throttle')(this._onScroll,50,this));this._nearTop=false;this._nearBottom=false;this._lastScrollHeight=0;}j.prototype.showAtTop=function(k){'use strict';if(k){c('Style').set(this._scrollContent,'top','0');c('Style').set(this._scrollContent,'bottom','');}else{c('Style').set(this._scrollContent,'top','');c('Style').set(this._scrollContent,'bottom','0');}};j.prototype.setBottomAligned=function(k){'use strict';var l=k!==false;if(this._bottomEdgeBias===l)return;c('CSS').conditionClass(this.flexArea,'uiScrollableAreaBottomAligned',l);this._bottomEdgeBias=l;if(this._bottomEdgeBias){this.scrollToBottom(false);}else this.scrollToTop(false);setTimeout(this.poke.bind(this),0);return this;};j.prototype.setInfiniteScrollHandler=function(k,l){'use strict';if(l){this._infiniteUpwardScrollHandler=k;}else this._infiniteDownScrollHandler=k;return this;};j.prototype.addScrollCallback=function(k){'use strict';this._scrollCallbacks.push(k);return this;};j.prototype.setTabbable=function(k){'use strict';this._scroll._wrap.setAttribute('tabindex',k?'0':'-1');};j.prototype.poke=function(k,l){'use strict';var m=this._scrollHeight,n=this._scroll.getScrollTop();this._scrollHeight=this._getScrollHeight();if(typeof m=='undefined'||l&&!l.old_height){this._bottomEdgeBias&&this._setShadowHeight();return;}var o=this._scrollHeight-m;if(this._bottomEdgeBias){var p=l?l.height-l.old_height:0;clearTimeout(this._pollTimer);this._pollTimer=setTimeout(this.poke.bind(this),200);var q,r=o-p;if(this._scrollHeight>this._getFlexHeight()){q=n+r;q=q<0?0:q;}else q=0;r>0&&this._setShadowHeight();if(q!==n)this._scroll.setScrollTop(q,false);r<0&&this._setShadowHeight();}else if(o)this._scroll.setScrollTop(n,false);};j.prototype.setScrollTop=function(k,l){'use strict';this._scroll.setScrollTop(k,l);};j.prototype.getScrollableArea=function(){'use strict';return this._scroll;};j.prototype.isScrolledToBottom=function(){'use strict';return this._scroll.isScrolledToBottom();};j.prototype.scrollToBottom=function(k){'use strict';this._scroll.scrollToBottom(k);if(this._bottomEdgeBias)this._scrollBottom=0;};j.prototype.isScrolledToTop=function(){'use strict';return this._scroll.getScrollTop()===0;};j.prototype.scrollToTop=function(k){'use strict';this._scroll.scrollToTop(k);};j.prototype.scrollIntoView=function(k,l){'use strict';this._scroll.scrollIntoView(k,l);};j.prototype.destroy=function(){'use strict';this._scrollSub&&this._scrollSub.unsubscribe();this.unsubscribe(this._drawSubscription);clearTimeout(this._pollTimer);i.destroy.call(this);this._scroll.destroy();};j.prototype._getScrollHeight=function(){'use strict';if(this._bottomEdgeBias){return this._scrollContent.offsetHeight;}else return this._scroll.getScrollHeight();};j.prototype._setShadowHeight=function(){'use strict';var k=this._shadowHeight;this._shadowHeight=this._scrollHeight-this._getFlexHeight();if(this._shadowHeight<0)this._shadowHeight=0;if(this._shadowHeight!==k)c('Style').set(this._shadow,'height',this._shadowHeight+'px');};j.prototype._onScroll=function(){'use strict';var k=this._scroll.getScrollTop(),l=this._getScrollHeight(),m=this._getFlexHeight(),n=l>this._lastScrollHeight;this._lastScrollHeight=l;if(k<m){if(!this._nearTop||n&&2*m>l){this._nearTop=true;this._infiniteUpwardScrollHandler&&this._infiniteUpwardScrollHandler();}}else this._nearTop=false;if(k+2*m>l){if(!this._nearBottom||n&&2*m>l){this._nearBottom=true;this._infiniteDownScrollHandler&&this._infiniteDownScrollHandler();}}else this._nearBottom=false;this._scrollCallbacks.forEach(function(o){return o(this._scroll);}.bind(this));};f.exports=j;}),null);
__d('WebMessengerDetailViewControlManager',['Event','ArbiterMixin','CSS','WebMessengerDetailViewHeaderControl','DOM','WebMessengerFlexibleScrollArea','WebMessengerDetailViewActionsMenuControl','WebMessengerDetailViewAllPeopleResultsControl','WebMessengerDetailViewComposeTypeaheadControl','WebMessengerDetailViewRecentMessagesControl','WebMessengerDetailViewSearchContextControl','WebMessengerDetailViewSearchSnippetsControl','WebMessengerDetailViewBottomShelfControl','WebMessengerDetailViewSharedPhotosControl','MercuryConfig','MercuryIDs','WebMessengerMessagesSelection','Parent','WebMessengerDetailViewSheetControl','WebMessengerStateManager','WebMessengerStateConstants','Style','UserAgent_DEPRECATED','WebMessengerEvents','WebMessengerSubscriptionsHandler','WebMessengerTemplates','mixin','getElementPosition'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this);this._rootElement=k;c('DOM').empty(this._rootElement);var l=c('WebMessengerTemplates')[':fb:web-messenger:read-view'].build();c('DOM').setContent(this._rootElement,l.getRoot());this._readContainer=l.getNode('readContainer');this._headerControl=new (c('WebMessengerDetailViewHeaderControl'))(l.getNode('detailViewHeader'));this._actionsMenuControl=new (c('WebMessengerDetailViewActionsMenuControl'))(l.getNode('detailViewActionsMenu'),this._headerControl);this._allPeopleResultsControl=new (c('WebMessengerDetailViewAllPeopleResultsControl'))(l.getNode('detailViewAllPeopleResults'));this._composeTypeaheadControl=new (c('WebMessengerDetailViewComposeTypeaheadControl'))(l.getNode('detailViewComposeTypeahead'),l.getNode('detailViewComposeTypeaheadResults'));this._searchContextControl=new (c('WebMessengerDetailViewSearchContextControl'))(this,l.getNode('detailViewSearchContext'),l.getNode('snippetPaginationControlBox'));this._searchSnippetsControl=new (c('WebMessengerDetailViewSearchSnippetsControl'))(this,l.getNode('detailViewSearchSnippets'));this._sharedPhotosControl=new (c('WebMessengerDetailViewSharedPhotosControl'))(this,l.getNode('detailViewSharedPhotos'));this._sheetControl=new (c('WebMessengerDetailViewSheetControl'))(l.getNode('detailViewSheetTab'));var m=l.getNode('detailViewBottomShelf');this._bottomShelfControl=new (c('WebMessengerDetailViewBottomShelfControl'))(this,m);this._detailViewScroller=l.getNode('readMessagesScroller');c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(this._detailViewScroller,'click',function(o){if(c('Parent').byTag(o.getTarget(),'a')||c('DOM').getSelection())return;this._bottomShelfControl.focusComposer();}.bind(this)));var n={fade:!!c('UserAgent_DEPRECATED').osx(),persistent:true};this._flexArea=new (c('WebMessengerFlexibleScrollArea'))(this._detailViewScroller,n).setBottomAligned(false).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearTop'),true).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearBottom')).setContainer(this._rootElement).setMinFlexAreaHeight(200).draw();c('WebMessengerSubscriptionsHandler').addSubscriptions(c('WebMessengerEvents').subscribe(c('WebMessengerEvents').DETAIL_DOM_CHANGED,this._flexArea.draw.bind(this._flexArea)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').SUBMIT_REPLY,this._bottomShelfControl.submitReply.bind(this._bottomShelfControl)),c('WebMessengerStateManager').subscribe(c('WebMessengerStateConstants').STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));c('WebMessengerSubscriptionsHandler').addSubscriptions(this._sheetControl.subscribe('resize',this._flexArea.draw.bind(this._flexArea)));this._recentMessagesControl=new (c('WebMessengerDetailViewRecentMessagesControl'))(this,l.getNode('detailViewRecentMessages'),l.getNode('loadingSpinner'),l.getNode('noSelectedConversation'),l.getNode('newMessageLink'),l.getNode('showUnreadLink'),l.getNode('contextBanner'),m);this._stateData={};this._resizeNodes=[this._rootElement,this._detailViewScroller,c('DOM').find(this._detailViewScroller,'div.uiScrollableAreaBody')];}j.prototype.updateOnStateChange=function(){'use strict';var k=c('WebMessengerStateManager').getCurrentDetailState(),l=this._stateData;this._stateData=c('WebMessengerStateManager').getCurrentStateData();this._flexArea.setTabbable(k!==c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN);this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._sharedPhotosControl.hideView();c('CSS').removeClass(this._readContainer,'blankComposeState');c('CSS').conditionClass(this._readContainer,'blankComposeState',k===c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN);this._bottomShelfControl.updateView();this._actionsMenuControl.updateView();this._headerControl.updateView();switch(k){case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:this._recentMessagesControl.updateView();this._sheetControl.updateView();break;case c('WebMessengerStateConstants').DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:this._allPeopleResultsControl.updateView();this._composeTypeaheadControl.updateView();break;case c('WebMessengerStateConstants').DETAIL.COMPOSE_MAIN:this._composeTypeaheadControl.updateView();break;case c('WebMessengerStateConstants').DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this._composeTypeaheadControl.updateView();break;case c('WebMessengerStateConstants').DETAIL.SHARED_PHOTOS:this._sharedPhotosControl.updateView();break;case c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET:case c('WebMessengerStateConstants').DETAIL.SEARCH_THREAD_SNIPPET:this._searchSnippetsControl.updateView();break;case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:this._searchContextControl.updateView();break;}switch(k){case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:if(l.thread_id!=this._stateData.thread_id)this._bottomShelfControl.focusComposer();break;}};j.prototype.hideAll=function(){'use strict';this._headerControl.hideView();this._actionsMenuControl.hideView();this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._sharedPhotosControl.hideView();this._bottomShelfControl.hideView();};j.prototype.getSelectedMessageIDs=function(){'use strict';var k=c('WebMessengerStateManager').getCurrentDetailState();switch(k){case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:return c('WebMessengerMessagesSelection').getSelectedMessageIDs();}return [];};j.prototype.scrollIntoView=function(k){'use strict';this._flexArea&&this._flexArea.scrollIntoView(k);};j.prototype.setScrollTop=function(k,l){'use strict';this._flexArea&&this._flexArea.setScrollTop(k,l);};j.prototype.isScrolledToBottom=function(){'use strict';return this._flexArea&&this._flexArea.isScrolledToBottom();};j.prototype.scrollToBottom=function(k){'use strict';this._flexArea&&this._flexArea.scrollToBottom(k);};j.prototype.draw=function(){'use strict';this._flexArea&&this._flexArea.draw();};j.prototype.poke=function(){'use strict';this._flexArea&&this._flexArea.poke();};j.prototype.addScrollCallback=function(k){'use strict';this._flexArea&&this._flexArea.addScrollCallback(k);};j.prototype.getFlexAreaBoundingClientRect=function(){'use strict';return c('getElementPosition')(this._flexArea.flexArea);};j.prototype.resizeTo=function(k){'use strict';if(k!==null){k=k.toString();if(!k.endsWith('%')||k.endsWith('px'))k=k+'px';}this._resizeNodes.forEach(function(l){c('Style').set(l,'width',k);});c('WebMessengerEvents').detailDOMChanged();};j.prototype.destroy=function(){'use strict';this._headerControl.destroy();this._actionsMenuControl.destroy();this._allPeopleResultsControl.destroy();this._composeTypeaheadControl.destroy();this._recentMessagesControl.destroy();this._searchContextControl.destroy();this._searchSnippetsControl.destroy();this._bottomShelfControl.destroy();this._sharedPhotosControl.destroy();this._flexArea.destroy();this._sheetControl.destroy();};f.exports=j;}),null);
__d('WebMessengerMercury',['MercuryMessages','MercuryOrderedThreadlist','MercuryServerRequests','WebMessengerStateManager','MercuryThreadInformer','MercuryThreadActions','MercuryThreads','MercuryUnreadState','MercuryUnseenState'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={getMessages:function j(){return c('MercuryMessages').getForFBID(i());},getOrderedThreadlist:function j(){return c('MercuryOrderedThreadlist').getForFBID(i());},getServerRequests:function j(){return c('MercuryServerRequests').getForFBID(i());},getThreadInformer:function j(){return c('MercuryThreadInformer').getForFBID(i());},getThreadActions:function j(){return c('MercuryThreadActions').getForFBID(i());},getThreads:function j(){return c('MercuryThreads').getForFBID(i());},getUnreadState:function j(){return c('MercuryUnreadState').getForFBID(i());},getUnseenState:function j(){return c('MercuryUnseenState').getForFBID(i());}};function i(){return c('WebMessengerStateManager').getCurrentUserID();}f.exports=h;}),null);
__d('WebMessengerMasterViewUnseenMessagesNotice',['MercuryThreadlistConstants','MessagingTag','WebMessengerStateManager','UserActivity','WebMessengerSubscriptionsHandler','WebMessengerMessagesNotice','WebMessengerConstants','WebMessengerMercury','throttle'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();var j=c('WebMessengerConstants').THREADLIST_SCROLLTOP_OFFSET,k=c('MercuryThreadlistConstants').MESSAGE_NOTICE_INACTIVITY_THRESHOLD;h=babelHelpers.inherits(l,c('WebMessengerMessagesNotice'));i=h&&h.prototype;function l(q){'use strict';i.constructor.call(this);this._manager=q;this._threadInformer=c('WebMessengerMercury').getThreadInformer();this._unseenState=c('WebMessengerMercury').getUnseenState();c('WebMessengerSubscriptionsHandler').addSubscriptions(this._threadInformer.subscribe('messages-received',function(r,s){var t=!c('UserActivity').isActive(k),u=!this.isScrolledWithinTopThreshold();if(!i.getActive.call(this)||o(s)||!n(s))return;if(i.onlyReceivedFromSelf.call(this,s))return;if(t){this.removeMessageNotice();this._manager.scrollToTop();}else if(u)this.showMessageNotice();}.bind(this)),this._threadInformer.subscribe('unseen-updated',m.bind(null,this)));this._manager.addScrollCallback(c('throttle').withBlocking(function(r){if(i.getActive.call(this)&&r.getScrollTop()<=c('WebMessengerConstants').THREADLIST_TOP_OFFSET&&c('UserActivity').isActive(k)&&p()){this.removeMessageNotice();this._unseenState.markAsSeen();}}.bind(this),100,null));}l.prototype.isScrolledWithinTopThreshold=function(){'use strict';return this._manager.getScrollTop()<=j;};l.prototype.showMessageNotice=function(){'use strict';if(!p())return;var q=function(){this._manager.scrollToTop();}.bind(this);i.showMessageNotice.call(this,q,'below');};function m(q){if(q._unseenState.getUnseenCount()===0)q.removeMessageNotice();}function n(q){for(var r in q)for(var s=0;s<q[r].length;s++)if(q[r][s].folder==c('MessagingTag').INBOX)return true;return false;}function o(q){var r=c('WebMessengerStateManager').getCurrentStateData().thread_id,s=true;for(var t in q)if(q.hasOwnProperty(t))if(t!==r){s=false;break;}return p()&&s;}function p(){var q=c('WebMessengerStateManager').getCurrentStateData().folder;return q===c('MessagingTag').INBOX;}f.exports=l;}),null);
__d('WebMessengerThreadlistRenderer',['csx','cx','fbt','CSS','WebMessengerDeleteThreadDialog','DOM','Event','Focus','MercuryListUpdateRenderer','MercuryAPIArgsSource','MessagingTag','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','MercuryThreadMetadataRawRenderer','MercuryThreadMetadataRenderer','Tooltip','WebMessengerMercury','WebMessengerPermalinks'],(function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={renderThreadsFromIDs:function m(n,o,p,q,r,s){q=q||function(t){return t;};r=r||{};c('MercuryListUpdateRenderer').updateList(n,o.map(q),function(t){return !r[o[t]]&&o[t]!=p;},function(t){var u=o[t],v=c('WebMessengerTemplates')[':fb:web-messenger:threadlist-row'].build();v.getRoot().setAttribute('id',q(u));var w=v.getNode('threadLink');c('Focus').listen(w,function(x){c('CSS').conditionClass(v.getRoot(),"_5fes",x);});c('Event').listen(w,'click',function(x){if(x.getModifiers().any)return true;var y=c('WebMessengerStateManager').getCurrentMasterState(),z={thread_id:u};if(y===c('WebMessengerStateConstants').MASTER.SEARCH)z.query=c('WebMessengerStateManager').getCurrentStateData().query;c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,z);return false;});if(u==p)c('CSS').addClass(v.getRoot(),"_kv");u&&c('WebMessengerMercury').getThreads().getThreadMeta(u,function(x){var y=c('MercuryThreadMetadataRenderer').getForFBID(c('WebMessengerStateManager').getCurrentUserID());y.renderCoreThreadlist(x,v,l.bind(null,s),{names_renderer:c('MercuryThreadMetadataRawRenderer').renderShortNames,show_unread_count:false},true);},c('MercuryAPIArgsSource').WEBMESSENGER);return v.getRoot();});}};function l(m,n,o){var p=n.getNode('readToggler'),q=n.getNode('archiveButton'),r=n.getNode('deleteButton');n.getNode('threadLink').setAttribute('href',c('WebMessengerPermalinks').getURI(m,c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{thread_id:o.thread_id}).toString());if(o.unread_count>0){c('CSS').addClass(n.getRoot(),"_kx");c('DOM').setContent(n.getNode('newCount'),j._("{num} nouveaux",[j.param('num',o.unread_count)]));c('CSS').addClass(p,"_ky");c('Tooltip').set(p,j._("Marquer comme lu(s)"),'above','right');}else{c('CSS').addClass(p,"_kz");c('Tooltip').set(p,j._("Marquer comme non lu(s)"),'above','right');}c('Event').listen(p,'click',function(event){var u=c('WebMessengerMercury').getThreadActions();c('CSS').matchesSelector(p,"._ky")?u.markRead(o.thread_id):u.markUnread(o.thread_id);return false;});var s=c('WebMessengerStateManager').getCurrentStateData().folder;if(s==c('MessagingTag').SPAM){c('Tooltip').set(r,j._("Supprimer la conversation"),'above','right');c('CSS').addClass(r,"_4_3q");c('Event').listen(r,'click',function(event){c('WebMessengerDeleteThreadDialog').show(o.thread_id);});c('CSS').hide(q);}else{c('CSS').hide(r);var t=true;if(s==c('MessagingTag').ACTION_ARCHIVED){t=false;c('Tooltip').set(q,j._("Retirer de l\u2019archive"),'above','right');c('CSS').addClass(q,"_2s2");}else{c('Tooltip').set(q,j._("Archiver"),'above','right');c('CSS').addClass(q,"_l9");}c('Event').listen(q,'click',function(event){var u=c('WebMessengerMercury').getThreadActions();t?u.archive(o.thread_id):u.unarchive(o.thread_id);var v=c('WebMessengerStateManager').getCurrentStateData();if(v.thread_id==o.thread_id)c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{folder:v.folder});return false;});}}f.exports=k;}),null);
__d('WebMessengerMasterViewRecentThreadsControl',['cx','fbt','UserActivity','CSS','DOM','Event','MercuryAPIArgsSource','MercuryFilters','MercuryFolders','MercuryThreadlistConstants','MessagingTag','WebMessengerShortcuts','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','WebMessengerThreadlistRenderer','WebMessengerConstants','WebMessengerEvents','WebMessengerInfoBoxRenderer','WebMessengerSubscriptionsHandler','WebMessengerMasterViewUnseenMessagesNotice','WebMessengerMercury','createObjectFrom','ge'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();c('UserActivity');var j='recent:';function k(ca,da,ea,fa){'use strict';this._manager=ca;this._rootElement=da;this._infoBox=ea;this._orderedThreadlist=c('WebMessengerMercury').getOrderedThreadlist();this._serverRequests=c('WebMessengerMercury').getServerRequests();this._threadInformer=c('WebMessengerMercury').getThreadInformer();this._threads=c('WebMessengerMercury').getThreads();this._unseenState=c('WebMessengerMercury').getUnseenState();c('DOM').empty(this._rootElement);this._pagerExponent=-1;var ga=c('WebMessengerTemplates')[':fb:web-messenger:threadlist'].build();c('DOM').setContent(this._rootElement,ga.getRoot());this._loadingSpinner=ga.getNode('loadingSpinner');this._threadlistRows=ga.getNode('threadlistRows');this._loadMoreButton=ga.getNode('loadMoreButton');this._loadMoreLink=ga.getNode('loadMoreLink');this._active=false;this._state=null;this._folder=null;this._filter=null;this._selection=null;this._threadIDs=[];this._unreadThreadIDs=[];this._folders=c('MercuryFolders').getSupportedFolders();this._filters=c('MercuryFilters').getSupportedFilters();this._olderTimestamp={};this._currentCountMap={};this._folders.forEach(function(ha){this._currentCountMap[ha]={};this._filters.concat([c('MercuryFilters').ALL]).forEach(function(ia){this._currentCountMap[ha][ia]=c('MercuryThreadlistConstants').WEBMESSENGER_THREAD_COUNT+1;}.bind(this));}.bind(this));this._unseenMessagesNotice=new (c('WebMessengerMasterViewUnseenMessagesNotice'))(this._manager);this._unseenMessagesNotice.setNoticeContextNode(fa);c('WebMessengerSubscriptionsHandler').addSubscriptions(this._threadInformer.subscribe('threadlist-updated',function(ha,ia){x(this,c('createObjectFrom')(ia));}.bind(this)),c('Event').listen(this._loadMoreLink,'click',function(){w(this);}.bind(this)),this._manager.subscribe('scrolledNearBottom',function(){this._active&&w(this);}.bind(this)));}k.prototype.updateView=function(){'use strict';this._active=true;this._unseenMessagesNotice.updateView();c('CSS').show(this._rootElement);var ca=m(this),da=n(this),ea=this._folder,fa=this._selection;o(this);if(da)p(this,fa);if(ca){v(this);}else q(this);};k.prototype.hideView=function(){'use strict';this._active=false;this._unseenMessagesNotice.hideView();c('CSS').hide(this._rootElement);};k.prototype.destroy=function(){'use strict';l(this);this._unseenMessagesNotice.destroy();};function l(ca){ca._threadlistSubscription&&ca._orderedThreadlist.unsubscribe(ca._threadlistSubscription.subscriber_id,ca._threadlistSubscription.folder,ca._threadlistSubscription.filter);ca._threadlistSubscription=null;}function m(ca){var da=c('WebMessengerStateManager').getCurrentStateData();if(ca._folder!=da.folder||ca._filter!=da.filter)return true;return false;}function n(ca){var da=c('WebMessengerStateManager').getCurrentStateData();if(ca._selection!=da.thread_id)return true;return false;}function o(ca){var da=c('WebMessengerStateManager').getCurrentStateData();ca._state=c('WebMessengerStateManager').getCurrentMasterState();if(ca._folder!=da.folder||ca._filter!=da.filter)ca._pageExponent=-1;ca._folder=da.folder;ca._filter=da.filter;ca._selection=da.thread_id;}function p(ca,da){var ea=c('ge')(ba(da));if(ea){c('CSS').removeClass(ea,"_kv");ea.removeAttribute('aria-selected');}var fa=c('ge')(ba(ca._selection));if(fa){c('CSS').addClass(fa,"_kv");fa.setAttribute('aria-selected','true');}c('WebMessengerEvents').updateSelection(fa&&fa.id);}function q(ca){if(ca._active)c('WebMessengerShortcuts').updateThreadlistIndex(ca,ca._threadIDs.map(ba),ba(ca._selection));}function r(ca){c('CSS').addClass(ca._manager.getFlexAreaElement(),"_3j6");c('CSS').addClass(ca._manager.getFlexAreaElement(),"_3j7");}function s(ca){c('CSS').removeClass(ca._manager.getFlexAreaElement(),"_3j6");c('CSS').removeClass(ca._manager.getFlexAreaElement(),"_3j7");}function t(ca){c('CSS').hide(ca._threadlistRows);s(ca);}function u(ca){if(ca._threadIDs.length){c('CSS').show(ca._threadlistRows);s(ca);}else{c('CSS').hide(ca._threadlistRows);r(ca);}}function v(ca){c('CSS').show(ca._loadingSpinner);c('CSS').hide(ca._infoBox);t(ca);c('CSS').hide(ca._loadMoreButton);l(ca);var da=ca._orderedThreadlist.getFilteredThreadlist(c('MercuryThreadlistConstants').RECENT_THREAD_OFFSET,ca._currentCountMap[ca._folder][ca._filter],ca._folder,ca._filter,function(ea,fa){c('CSS').hide(ca._loadingSpinner);y(ca,ea,fa);u(ca);q(ca);ca._manager.poke();ca._manager.forceFireScrollCallbacks();},null,c('MercuryAPIArgsSource').WEBMESSENGER);if(da)ca._threadlistSubscription={subscriber_id:da,folder:ca._folder,filter:ca._filter};}function w(ca){if(ca._requestInFlight||c('CSS').hasClass(ca._loadMoreButton,'hidden_elem'))return;ca._requestInFlight=true;c('CSS').addClass(ca._loadMoreButton,'async_saving');ca._pagerExponent=Math.min(ca._pagerExponent+1,c('WebMessengerConstants').EXPONENTIAL_PAGER_MAX_CYCLES);var da=Math.pow(2,ca._pagerExponent),ea=ca._currentCountMap[ca._folder][ca._filter]+da*c('MercuryThreadlistConstants').WEBMESSENGER_MORE_COUNT;l(ca);var fa=ca._orderedThreadlist.getFilteredThreadlist(c('MercuryThreadlistConstants').RECENT_THREAD_OFFSET,ea,ca._folder,ca._filter,function(ga,ha){c('CSS').removeClass(ca._loadMoreButton,'async_saving');ca._currentCountMap[ca._folder][ca._filter]=ea;y(ca,ga,ha);q(ca);ca._manager.poke();ca._requestInFlight=false;},null,c('MercuryAPIArgsSource').WEBMESSENGER);if(fa)ca._threadlistSubscription={subscriber_id:fa,folder:ca._folder,filter:ca._filter};}function x(ca,da){if(!ca._folder||!ca._olderTimestamp[ca._folder])return;var ea=ca._orderedThreadlist.getThreadlistUntilTimestamp(ca._olderTimestamp[ca._folder],ca._folder,ca._filter);if(ca._filter==c('MessagingTag').UNREAD){ea=aa(ca,ea);}else ca._unreadThreadIDs=[];if(ea.length>ca._currentCountMap[ca._folder][ca._filter])ca._currentCountMap[ca._folder][ca._filter]=ea.length;ca._threadIDs=ea;u(ca);c('WebMessengerThreadlistRenderer').renderThreadsFromIDs(ca._threadlistRows,ea,ca._selection,ba,da,c('WebMessengerStateConstants').MASTER.RECENT_THREADS);q(ca);ca._manager.poke();}function y(ca,da,ea){var fa=da.length==ca._currentCountMap[ca._folder][ca._filter];if(fa)da.pop();if(da.length){var ga=da[da.length-1];ca._threads.getThreadMeta(ga,function(ha){ca._olderTimestamp[ca._folder]=ha.timestamp;},c('MercuryAPIArgsSource').WEBMESSENGER);}if(ca._filter==c('MessagingTag').UNREAD){ca._unreadThreadIDs=da;}else ca.unreadThreadIDs=[];c('CSS').conditionShow(ca._loadMoreButton,fa);ca._threadIDs=da;c('WebMessengerThreadlistRenderer').renderThreadsFromIDs(ca._threadlistRows,da,ca._selection,ba,null,c('WebMessengerStateConstants').MASTER.RECENT_THREADS);ea=ea&&da.length===0;ea&&z(ca);c('CSS').conditionShow(ca._infoBox,ea);}function z(ca){if(ca._builtErrorMessage)return;c('DOM').setContent(ca._infoBox,c('WebMessengerInfoBoxRenderer').render(i._("Impossible de charger les conversations"),[{text:i._("R\u00e9essayer"),handler:v.bind(null,ca)}]));ca._builtErrorMessage=true;}function aa(ca,da){da.forEach(function(ea){if(ca._unreadThreadIDs.indexOf(ea)<0)ca._unreadThreadIDs.push(ea);});ca._unreadThreadIDs.sort(function(ea,fa){var ga=ca._threads.getThreadMetaNow(ea).timestamp,ha=ca._threads.getThreadMetaNow(fa).timestamp;return ha-ga;});ca._unreadThreadIDs=ca._unreadThreadIDs.filter(function(ea){var fa=ca._threads.getThreadMetaNow(ea);return c('MercuryFolders').getFromMeta(fa)==ca._folder;});return ca._unreadThreadIDs;}function ba(ca){if(ca)return j+ca;return null;}f.exports=k;}),null);
__d('WebMessengerMasterViewSearchInputControl',['cx','Event','CSS','DOM','Input','Keys','MercurySearchThreadsStrategy','WebMessengerShortcuts','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','WebMessengerSubscriptionsHandler','WebMessengerEvents','containsNode','ge'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('MercurySearchThreadsStrategy').get();function j(r,s){'use strict';this._manager=r;this._rootElement=s;c('DOM').empty(this._rootElement);var t=c('WebMessengerTemplates')[':fb:web-messenger:master-view:search-input'].build();c('DOM').replace(this._rootElement,t.getRoot());this._searchBox=t.getRoot();this._searchInput=t.getNode('searchInput');this._searchClear=t.getNode('searchClear');this._searchButton=c('DOM').find(this._searchBox,'button');this._state=null;this._query=null;this._folder=null;this._threadID=null;this._ariaOwns=this._searchInput.getAttribute('aria-owns');c('WebMessengerSubscriptionsHandler').addSubscriptions(c('WebMessengerEvents').subscribe(c('WebMessengerEvents').UPDATE_SELECTION,q.bind(null,this)),c('Event').listen(this._searchButton,'click',function(){var u=c('Input').getValue(this._searchInput);if(u)o(this,u);}.bind(this)),c('Event').listen(this._searchClear,'click',n.bind(null,this)),c('Event').listen(this._searchInput,'keyup',function(event){var u=c('Input').getValue(this._searchInput);if(event.keyCode==c('Keys').ESC){n(this);}else if(event.keyCode==c('Keys').RETURN&&u){c('WebMessengerShortcuts').openSearchThread();}else if(u){p(this,u);}else if(u!==c('WebMessengerStateManager').getCurrentStateData().query){n(this);this.focus();}return false;}.bind(this)),c('Event').listen(this._searchInput,'focus',function(u){this._focused=true;}.bind(this)),c('Event').listen(this._searchInput,'blur',function(u){this._focused=false;}.bind(this)));}j.prototype.updateView=function(){'use strict';var r=l(this);k(this);if(r)m(this);};j.prototype.focusAndSelectSearch=function(){'use strict';o(this,c('Input').getValue(this._searchInput));this._manager.scrollToTop(false);this.focus();this._searchInput.select();};j.prototype.focus=function(){'use strict';setTimeout(function(){if(!this._focused){this._searchInput.focus();this._searchInput.value=this._searchInput.value;}}.bind(this),0);};j.prototype.destroy=function(){'use strict';};function k(r){var s=c('WebMessengerStateManager').getCurrentStateData();r._state=c('WebMessengerStateManager').getCurrentMasterState();r._folder=s.folder;if(r._state!=c('WebMessengerStateConstants').MASTER.SEARCH){r._query=null;}else r._query=s.query;}function l(r){if(!r._state||!r._folder)return true;var s=c('WebMessengerStateManager').getCurrentMasterState(),t=c('WebMessengerStateManager').getCurrentStateData();if(r._folder!=t.folder)return true;if(s!=r._state)return true;if(s==c('WebMessengerStateConstants').MASTER.SEARCH&&r._query!=t.query)return true;return false;}function m(r){if(r._state==c('WebMessengerStateConstants').MASTER.SEARCH){var s=r._query||'';if(c('Input').getValue(r._searchInput)!=s)c('Input').setValue(r._searchInput,s);r.focus();}else{c('Input').reset(r._searchInput);r._searchInput.blur();}c('CSS').conditionClass(r._searchBox,"_47",!c('Input').isEmpty(r._searchInput));}function n(r){i.clearTimer();var s=c('WebMessengerStateManager').getCurrentStateData();s.no_uri=true;delete s.query;c('WebMessengerStateManager').updateMasterState(c('WebMessengerStateConstants').MASTER.RECENT_THREADS,s);}function o(r,s){var t=c('WebMessengerStateManager').getCurrentMasterState();if(t!=c('WebMessengerStateConstants').MASTER.SEARCH)r._threadID=c('WebMessengerStateManager').getCurrentStateData().thread_id;if(s)c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET,{query:s,message_query:s});}function p(r,s){var t=c('WebMessengerStateManager').getCurrentStateData();if(s!==t.query){var u=c('WebMessengerStateManager').getCurrentMasterState();if(u!=c('WebMessengerStateConstants').MASTER.SEARCH)r._threadID=t.thread_id;if(s)c('WebMessengerStateManager').updateMasterState(c('WebMessengerStateConstants').MASTER.SEARCH,{all_people_query:t.all_people_query,message_query:t.message_query,message_id:t.message_id,query:s,thread_id:t.thread_id});}}function q(r,s,t){if(c('containsNode')(c('ge')(r._ariaOwns),c('ge')(t)))r._searchInput.setAttribute('aria-activedescendant',t);}f.exports=j;}),null);
__d('WebMessengerMasterViewSearchThreadsControl',['csx','cx','fbt','Event','CSS','DOM','MercuryFolders','MercurySearchThreadResultOrderer','MercurySearchThreadResults','MercurySearchThreadsStrategy','WebMessengerShortcuts','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','WebMessengerThreadlistRenderer','WebMessengerEvents','WebMessengerMercury','WebMessengerSubscriptionsHandler','createObjectFrom','ge','getElementText'],(function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercurySearchThreadResultOrderer').get(),l=c('MercurySearchThreadResults').get(),m=c('MercurySearchThreadsStrategy').get(),n='search:',o='search-indicator';function p(la,ma,na,oa){'use strict';this._manager=la;this._rootElement=ma;this._noMessagesIndicator=oa;this._orderedThreadlist=c('WebMessengerMercury').getOrderedThreadlist();this._threadInformer=c('WebMessengerMercury').getThreadInformer();this._threads=c('WebMessengerMercury').getThreads();c('DOM').empty(this._rootElement);var pa=c('WebMessengerTemplates')[':fb:web-messenger:thread-search'].build();c('DOM').setContent(this._rootElement,pa.getRoot());this._loadingSpinner=pa.getNode('loadingSpinner');this._threadlistRows=pa.getNode('threadlistRows');this._loadMoreButton=pa.getNode('loadMoreButton');this._loadMoreLink=pa.getNode('loadMoreLink');var qa=c('WebMessengerTemplates')[':fb:web-messenger:master-view-snippets-link'].build();this._threadSearchResultDescription=qa.getNode('threadSearchResultDescription');this._searchMessagesIndicator=qa.getRoot();this._searchMessagesIndicator.setAttribute('id',n+o);c('DOM').replace(na,this._searchMessagesIndicator);this._snippetSearchLink=qa.getNode('snippetSearchLink');this._snippetSearchLinkText=qa.getNode('snippetSearchLinkText');this._active=false;this._detailState=null;this._query=null;this._folder=null;this._selection=null;this._keyboardSelection=null;this._threadIDs=[];this._oldestTimestamps=r(this);this._namesChangedSinceLastRedraw=false;this._remoteResultsCompleted=true;c('WebMessengerSubscriptionsHandler').addSubscriptions(this._threadInformer.subscribe('threadlist-updated',function(ra,sa){da(this,c('createObjectFrom')(sa));}.bind(this)),this._threadInformer.subscribe('messages-received',function(){this._namesChangedSinceLastRedraw=true;}.bind(this)),c('Event').listen(this._loadMoreLink,'click',function(){ca(this);}.bind(this)),c('Event').listen(this._snippetSearchLink,'click',function(){this.updateKeyboardSelection(o);ka(this);}.bind(this)));}p.prototype.updateView=function(){'use strict';this._active=true;c('CSS').show(this._rootElement);c('CSS').hide(this._loadingSpinner);var la=s(this),ma=t(this),na=this._folder,oa=this._query,pa=this._selection;u(this);if(ma||la){var qa=this._keyboardSelection;switch(this._detailState){case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:this._keyboardSelection=this._selection;break;case c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET:case c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT:this._keyboardSelection=o;}v(this,qa);}if(la){aa(this);}else{w(this,false);ba(this);}};p.prototype.hideView=function(){'use strict';this._active=false;c('CSS').hide(this._rootElement);ea(this,false);ba(this);};p.prototype.openSearchThread=function(la){'use strict';if(la==o){ka(this);}else c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{query:this._query,thread_id:la});};p.prototype.updateKeyboardSelection=function(la){'use strict';var ma=this._keyboardSelection;this._keyboardSelection=la;v(this,ma);};p.prototype.destroy=function(){'use strict';q(this);};function q(la){la._searchThreadsSubscription&&l.unsubscribe(la._searchThreadsSubscription.subscriber_id,la._searchThreadsSubscription.query);la._searchThreadsSubscription=null;}function r(la){var ma={};c('MercuryFolders').getSupportedFolders().forEach(function(na){var oa=la._orderedThreadlist.getThreadlistUntilTimestamp(0,na);ma[na]=oa.length>0?la._threads.getThreadMetaNow(oa[oa.length-1]).timestamp:Infinity;}.bind(this));return ma;}function s(la){var ma=la._namesChangedSinceLastRedraw;la._namesChangedSinceLastRedraw=false;if(ma)return true;if(!la._remoteResultsCompleted)return true;var na=r(la),oa=la._oldestTimestamps;la._oldestTimestamps=na;var pa=c('WebMessengerStateManager').getCurrentStateData();if(la._query!==pa.query||la._folder!==pa.folder)return true;for(var qa in oa)if(oa[qa]>na[qa])return true;return false;}function t(la){var ma=c('WebMessengerStateManager').getCurrentStateData();if(la._selection!=ma.thread_id)return true;return false;}function u(la){var ma=c('WebMessengerStateManager').getCurrentStateData();la._detailState=c('WebMessengerStateManager').getCurrentDetailState();la._query=ma.query;la._folder=ma.folder;la._selection=ma.thread_id;}function v(la,ma){var na=c('ge')(ia(ma));if(na){c('CSS').removeClass(na,"_kv");na.removeAttribute('aria-selected');}var oa=c('ge')(ia(la._keyboardSelection));if(oa){c('CSS').addClass(oa,"_kv");oa.setAttribute('aria-selected',true);}c('WebMessengerEvents').updateSelection(oa&&oa.id);}function w(la,ma){if(la._keyboardSelection&&la._keyboardSelection!=o&&la._threadIDs.indexOf(la._keyboardSelection)<0)la._keyboardSelection=null;if(!la._keyboardSelection)if(la._threadIDs.length){la._keyboardSelection=la._threadIDs[0];}else if(!ma){la._keyboardSelection=o;v(la);}var na=la._threadIDs.slice(0);na.push(o);if(la._active)c('WebMessengerShortcuts').updateThreadlistIndex(la,na.map(ia),ia(la._keyboardSelection));}function x(la){var ma=c('DOM').scry(la._threadlistRows,"._l5");ma.filter(function(na){return c('getElementText')(na)!==c('WebMessengerStateManager').getCurrentStateData().folder;}).forEach(c('CSS').show.bind(c('CSS')));}function y(la){var ma=c('DOM').scry(la._threadlistRows,"._l5");ma.forEach(c('CSS').hide.bind(c('CSS')));}function z(la){x(la);la._manager.draw();}function aa(la){c('CSS').show(la._loadingSpinner);ea(la,false);c('CSS').hide(la._threadlistRows);c('CSS').hide(la._loadMoreButton);y(la);q(la);if(la._query){var ma=[],na=[];la._remoteResultsCompleted=false;m.search(la._query,function(oa){var pa=k.separateCanonicalThreadsInFolder(oa,c('WebMessengerStateManager').getCurrentStateData().folder);ma=pa.canonical_in_folder;na=pa.remaining;ja(la);c('CSS').show(la._threadlistRows);ga(la,ma);z(la);},function(oa,pa){la._remoteResultsCompleted=true;var qa=k.orderResults(ma,na,oa,c('WebMessengerStateManager').getCurrentStateData().folder);if(qa.length>0){c('CSS').conditionShow(la._loadMoreButton,!pa);ha(la,qa);}else fa(la);c('CSS').hide(la._loadingSpinner);z(la);},function(oa,pa){if(oa)la._searchThreadsSubscription={subscriber_id:oa,query:pa};});}else{m.clearTimer();c('CSS').hide(la._loadingSpinner);c('DOM').empty(la._threadlistRows);c('CSS').show(la._threadlistRows);la._threadIDs=[];}ba(la);}function ba(la){var ma=!!la._query&&la._active,na=ma^c('CSS').shown(la._searchMessagesIndicator);c('CSS').conditionShow(la._searchMessagesIndicator,ma);la._manager.sizeToFit(ma);na&&la._manager.draw();}function ca(la){q(la);c('CSS').addClass(la._loadMoreButton,'async_saving');var ma=l.getMoreThreadlist(la._query,function(na,oa){c('CSS').removeClass(la._loadMoreButton,'async_saving');c('CSS').conditionShow(la._loadMoreButton,!oa);ha(la,na);la._manager.poke();});if(ma)la._searchThreadsSubscription={subscriber_id:ma,query:la._query};}function da(la,ma){if(la._threadIDs.length){c('WebMessengerThreadlistRenderer').renderThreadsFromIDs(la._threadlistRows,la._threadIDs,la._keyboardSelection,ia,ma,c('WebMessengerStateConstants').MASTER.SEARCH);la._manager.poke();}}function ea(la,ma){ma=ma&&la._active;c('CSS').conditionClass(la._searchMessagesIndicator,"_33x",ma!==false);c('CSS').conditionShow(la._noMessagesIndicator,ma!==false);}function fa(la){la._threadIDs=[];w(la,false);var ma=j._("Aucune personne ou conversation nomm\u00e9e {query}",[j.param('query',la._query)]),na=c('DOM').create('div',{},ma);c('DOM').setContent(la._noMessagesIndicator,na);ea(la,true);}function ga(la,ma){ha(la,ma,true);}function ha(la,ma,na){la._threadIDs=ma;w(la,na);c('WebMessengerThreadlistRenderer').renderThreadsFromIDs(la._threadlistRows,ma,la._keyboardSelection,ia,null,c('WebMessengerStateConstants').MASTER.SEARCH);c('WebMessengerEvents').updateSelection(la._keyboardSelection);if(la._keyboardSelection==o)v(la);}function ia(la){if(la)return n+la;return null;}function ja(la){var ma=j._("R\u00e9sultats pour le nom\u00a0: {query}",[j.param('query',la._query)]);c('DOM').setContent(la._threadSearchResultDescription,ma);}function ka(la){if(la._query){c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET,{query:la._query,message_query:la._query});c('WebMessengerEvents').focusSearch();}}f.exports=p;}),null);
__d('MessagingFilteringNux',['Arbiter','AsyncRequest','LayerDestroyOnHide','LayerHideOnTransition','isWebMessengerURI'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=null,i,j={ACCEPTED_EVENT:'filtering/accepted',DIALOG_REGISTERED_EVENT:'filtering/dialog-registered',tryShow:function k(l){c('Arbiter').subscribe(j.DIALOG_REGISTERED_EVENT,function(){if(!h)return;h.setContext(l);h.show();h=null;},c('Arbiter').SUBSCRIBE_ALL);},registerDialog:function k(l){h=l.disableBehavior(c('LayerDestroyOnHide')).disableBehavior(c('LayerHideOnTransition'));i=c('Arbiter').subscribe('page_transition',function(m,n){if(!c('isWebMessengerURI')(n.uri)){l&&l.destroy();i.unsubscribe();}},c('Arbiter').SUBSCRIBE_NEW);if(l)l.subscribe('confirm',function(){new (c('AsyncRequest'))('/ajax/web_messenger/dismiss_filtering_nux.php').send();l.hide();c('Arbiter').inform(j.ACCEPTED_EVENT,{});});c('Arbiter').inform(j.DIALOG_REGISTERED_EVENT,{},c('Arbiter').BEHAVIOR_PERSISTENT);}};f.exports=j;}),null);
__d('WebMessengerAuxMenu',['SelectableMenu','MenuSelectableItem','MenuTheme','PopoverMenuOverlappingBorder','Popover','PopoverMenu'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j){'use strict';this._menu=new (c('SelectableMenu'))([],{className:j,theme:c('MenuTheme')});var k=new (c('Popover'))(i.parentNode,i,null,{alignh:'right'});new (c('PopoverMenu'))(k,i,this._menu,[c('PopoverMenuOverlappingBorder')]);}h.prototype.addOption=function(i,j){'use strict';var k=new (c('MenuSelectableItem'))({markup:i,title:''});k.setOnClickHandler(j);this._menu.addItem(k);return k;};h.prototype.destroy=function(){'use strict';};f.exports=h;}),null);
__d('WebMessengerMenuFolderControl',['csx','cx','WebMessengerAuxMenu','CSS','Parent','WebMessengerTemplates','Toggler','WebMessengerSubscriptionsHandler'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j,k;function l(n){return c('Parent').bySelector(n,"._282");}function m(n,o,p){'use strict';var q=!j||j!=o;j=o;this._template=c('WebMessengerTemplates')[':fb:web-messenger:master-view:tab-bar:menu-option'].build();this._template.setNodeContent('folderLabel',n);if(!k||q){k=new (c('WebMessengerAuxMenu'))(j,"_1j");c('CSS').show(l(j));c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Toggler').subscribe(['show','hide'],function(r,s){var t=s.getActive(),u=t&&c('Parent').bySelector(t,"._282");if(u)c('CSS').conditionClass(u,"_50p_",r==='show');}));}this._menuItem=k.addOption(this._template.getRoot(),p);this._menuItem.getRoot();}m.prototype.getCountBadge=function(){'use strict';return this._template.getNode('count');};m.prototype.setSelected=function(n){'use strict';c('CSS').conditionClass(l(j),'selectedFolder',n);if(n){this._menuItem.select();}else this._menuItem.deselect();};m.prototype.destroy=function(){'use strict';k&&k.destroy();};f.exports=m;}),null);
__d('WebMessengerTabbedFolderControl',['Event','CSS','WebMessengerTemplates'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k,l){'use strict';this._template=c('WebMessengerTemplates')[':fb:web-messenger:master-view:tab-bar:folder'].build();this._template.setNodeContent('folderLabel',i);this._listener=c('Event').listen(this._template.getNode('link'),'click',k);if(l)this._countListener=c('Event').listen(this._template.getNode('count'),'click',l);j.push(this._template.getRoot());}h.prototype.getCountBadge=function(){'use strict';return this._template.getNode('count');};h.prototype.setSelected=function(i){'use strict';c('CSS').conditionClass(this._template.getRoot(),'selectedFolder',i);};h.prototype.getElement=function(){'use strict';this._template.getRoot();};h.prototype.destroy=function(){'use strict';this._listener.remove();this._countListener&&this._countListener.remove();};f.exports=h;}),null);
__d('WebMessengerMasterViewTabBarControl',['csx','fbt','JSXDOM','Arbiter','CSS','DOM','Event','Ellipsizer','WebMessengerMenuFolderControl','MercuryFilters','MercuryFolders','MercuryThreadlistConstants','MessagingFilteringNux','MessagingTag','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTabbedFolderControl','WebMessengerTemplates','WebMessengerEvents','WebMessengerSubscriptionsHandler','WebMessengerMercury'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(q,r,s){'use strict';this._manager=q;this._rootElement=r;this._rootTopContentElement=s;this._threadInformer=c('WebMessengerMercury').getThreadInformer();this._unreadState=c('WebMessengerMercury').getUnreadState();c('DOM').empty(this._rootElement);var t=c('WebMessengerTemplates')[':fb:web-messenger:master-view:tab-bar'].build(),u=c('WebMessengerTemplates')[':fb:web-messenger:master-view:top-content'].build();c('DOM').setContent(this._rootElement,t.getRoot());c('DOM').setContent(this._rootTopContentElement,u.getRoot());this._tabList=t.getRoot();this._moreMenu=t.getNode('moreMenu');this._topContentCont=u.getRoot();this._topContent=u.getNode('masterViewTopContentHolder');this._closeButton=u.getNode('masterViewTopContentCloseButton');this._closeButtonCont=u.getNode('masterViewTopContentCloseCont');this._state=null;this._folder=null;this._filter=null;this._query=null;this._threadID=null;this._folders=c('MercuryFolders').getSupportedFolders();this._foldersToHeader={};this._filters=c('MercuryFilters').getSupportedFilters();this._filtersToHeader={};this._otherMarkAllRead=c('JSXDOM').a({href:"#"},i._("Tout marquer comme lu"));this._unreadMarkAllRead=c('JSXDOM').a({href:"#"},i._("Tout marquer comme lu"));var v=[];this._filters.forEach(function(y){var z=o.bind(null,this,c('MessagingTag').INBOX,y);switch(y){case c('MessagingTag').UNREAD:this._filtersToHeader[y]=this._filtersToHeader[y]||new (c('WebMessengerMenuFolderControl'))(i._("Non lus"),this._moreMenu,z);break;}}.bind(this));this._folders.forEach(function(y){var z=o.bind(null,this,y,c('MercuryFilters').ALL),aa=o.bind(null,this,y,c('MessagingTag').UNREAD);switch(y){case c('MessagingTag').INBOX:var ba=i._("R\u00e9cents");this._foldersToHeader[y]=this._foldersToHeader[y]||new (c('WebMessengerTabbedFolderControl'))(ba,v,z,aa);break;case c('MessagingTag').OTHER:this._foldersToHeader[y]=this._foldersToHeader[y]||new (c('WebMessengerMenuFolderControl'))(i._("Filtr\u00e9s"),this._moreMenu,z);break;case c('MessagingTag').ACTION_ARCHIVED:this._foldersToHeader[y]=this._foldersToHeader[y]||new (c('WebMessengerMenuFolderControl'))(i._("Archiv\u00e9(s)"),this._moreMenu,z);break;case c('MessagingTag').SPAM:break;case c('MessagingTag').PENDING:this._foldersToHeader[y]=this._foldersToHeader[y]||new (c('WebMessengerTabbedFolderControl'))(i._("Invitations par message"),v,z);break;}}.bind(this));c('DOM').prependContent(this._tabList,v);var w=c('DOM').scry(this._tabList,"._6xt");w.push(t.getNode('moreMenuLabel'));this._ellipsizer=new (c('Ellipsizer'))(w);k(this);var x=o.bind(null,this,c('MessagingTag').INBOX,c('MercuryFilters').ALL);c('Arbiter').subscribe(c('MessagingFilteringNux').ACCEPTED_EVENT,n.bind(null,this));c('WebMessengerSubscriptionsHandler').addSubscriptions(this._threadInformer.subscribe('unread-updated',p.bind(null,this)),c('Event').listen(this._otherMarkAllRead,'click',function(){this._unreadState.markFolderAsRead(c('MessagingTag').OTHER);}.bind(this)),c('Event').listen(this._unreadMarkAllRead,'click',function(){this._unreadState.markFolderAsRead(c('MessagingTag').INBOX);}.bind(this)),c('Event').listen(this._closeButton,'click',x));}j.prototype.updateView=function(){'use strict';var q=m(this);l(this);if(q)n(this);k(this);};j.prototype.getOtherFolderLabel=function(){'use strict';var q=c('MessagingTag').OTHER,r=this._foldersToHeader[q];if(!r||!r._template)return null;return r._template.getNode('folderLabel');};j.prototype.destroy=function(){'use strict';for(var q in this._foldersToHeader)this._foldersToHeader[q]&&this._foldersToHeader[q].destroy();for(var r in this._filtersToHeader)this._filtersToHeader[r]&&this._filtersToHeader[r].destroy();};function k(q){var r=85;c('DOM').scry(q._tabList,"._1r").forEach(function(s){r+=s.offsetWidth;});q._ellipsizer.confineWithin(q._rootElement.offsetWidth-r,1.3);}function l(q){var r=c('WebMessengerStateManager').getCurrentStateData();q._state=c('WebMessengerStateManager').getCurrentMasterState();q._folder=r.folder;q._filter=r.filter;q._query=r.query;}function m(q){if(!q._state||!q._folder)return true;var r=c('WebMessengerStateManager').getCurrentStateData();if(q._folder!=r.folder)return true;if(q._filter!=r.filter)return true;return false;}function n(q){var r=false,s;q._folders.forEach(function(t){var u=q._filter==c('MessagingTag').UNREAD,v=t==q._folder&&(q._filter==c('MercuryFilters').ALL||u),w,x;switch(t){case c('MessagingTag').INBOX:if(u){var y=c('JSXDOM').strong(null,i._("Non lus")),z=c('JSXDOM').strong(null,i._("Bo\u00eete de r\u00e9ception")),aa=i._("Messages {unread} dans {inbox}",[i.param('unread',y),i.param('inbox',z)]);w=c('JSXDOM').div(null,aa,' \u00b7 ',q._unreadMarkAllRead);x=true;}break;case c('MessagingTag').OTHER:break;}if(v){s=t;c('CSS').conditionShow(q._closeButtonCont,x);}else q._foldersToHeader[t].setSelected(false);if(v&&w){r=true;c('DOM').setContent(q._topContent,w);}});q._filters.forEach(function(t){var u=q._folder==c('MessagingTag').INBOX&&t==q._filter;q._filtersToHeader[t].setSelected(u);});s&&q._foldersToHeader[s].setSelected(true);c('CSS').conditionShow(q._topContentCont,r);p(q);q._manager.draw();}function o(q,r,s){var t=q._state==c('WebMessengerStateConstants').MASTER.SEARCH;if(t||q._folder!=r||q._filter!=s){var u=babelHelpers['extends']({},c('WebMessengerStateManager').getCurrentStateData()),v=c('WebMessengerStateManager').getCurrentDetailState();if(v!==c('WebMessengerStateConstants').DETAIL.SEARCH_SNIPPET&&v!==c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT)delete u.query;c('WebMessengerStateManager').updateMasterState(c('WebMessengerStateConstants').MASTER.RECENT_THREADS,Object.assign(u,{folder:r,filter:s}));}c('WebMessengerEvents').focusComposer();return false;}function p(q){for(var r in q._foldersToHeader){if(r==c('MessagingTag').ACTION_ARCHIVED)continue;var s=q._unreadState.exceedsMaxCount(r)?c('MercuryThreadlistConstants').MAX_UNREAD_COUNT+'+':q._unreadState.getUnreadCount(r),t=[q._foldersToHeader[r].getCountBadge()];if(r==c('MessagingTag').INBOX)q._filters.forEach(function(u){t.push(q._filtersToHeader[u].getCountBadge());});t.forEach(function(u){if(s)c('DOM').setContent(u,i._("({unread_count})",[i.param('unread_count',s)]));c('CSS').conditionShow(u,s);});}k(q);}f.exports=j;}),null);
__d('WebMessengerMasterViewControlManager',['ArbiterMixin','DOM','WebMessengerFlexibleScrollArea','WebMessengerMasterViewTabBarControl','WebMessengerMasterViewSearchInputControl','WebMessengerMasterViewRecentThreadsControl','WebMessengerMasterViewSearchThreadsControl','WebMessengerStateManager','WebMessengerStateConstants','Style','WebMessengerTemplates','WebMessengerEvents','WebMessengerSubscriptionsHandler','mixin'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this);this._rootElement=k;c('DOM').empty(this._rootElement);var l=c('WebMessengerTemplates')[':fb:web-messenger:master-view'].build();c('DOM').setContent(this._rootElement,l.getRoot());this._tabBarControl=new (c('WebMessengerMasterViewTabBarControl'))(this,l.getNode('masterViewTabBar'),l.getNode('masterViewTopContent'));this._searchInputControl=new (c('WebMessengerMasterViewSearchInputControl'))(this,l.getNode('masterViewSearchInput'));this._searchThreadsControl=new (c('WebMessengerMasterViewSearchThreadsControl'))(this,l.getNode('masterViewSearchThreads'),l.getNode('searchMessagesIndicator'),l.getNode('noMessages'));this._threadlistRowsWrapper=l.getNode('threadlistRowsWrapper');this._flexArea&&this._flexArea.destroy();var m={fade:true,persistent:true};this._flexArea=new (c('WebMessengerFlexibleScrollArea'))(this._threadlistRowsWrapper,m).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearBottom')).setContainer(this._rootElement).setMinFlexAreaHeight(40).draw();this._recentThreadsControl=new (c('WebMessengerMasterViewRecentThreadsControl'))(this,l.getNode('masterViewRecentThreads'),l.getNode('masterInfoBox'),l.getNode('masterViewTabBar'));c('WebMessengerSubscriptionsHandler').addSubscriptions(c('WebMessengerEvents').subscribe(c('WebMessengerEvents').FOCUS_AND_SELECT_SEARCH,this._searchInputControl.focusAndSelectSearch.bind(this._searchInputControl)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').FOCUS_SEARCH,this._searchInputControl.focus.bind(this._searchInputControl)),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').MASTER_DOM_CHANGED,function(){this._tabBarControl.updateView();this._flexArea&&this._flexArea.draw();}.bind(this)),c('WebMessengerStateManager').subscribe(c('WebMessengerStateConstants').STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));this._resizeNodes=[this._rootElement,this._threadlistRowsWrapper,c('DOM').find(this._threadlistRowsWrapper,'div.uiScrollableAreaBody')];}j.prototype.updateOnStateChange=function(){'use strict';var k=c('WebMessengerStateManager').getCurrentMasterState();this._tabBarControl.updateView();this._searchInputControl.updateView();switch(k){case c('WebMessengerStateConstants').MASTER.RECENT_THREADS:this._searchThreadsControl.hideView();this._recentThreadsControl.updateView();break;case c('WebMessengerStateConstants').MASTER.SEARCH:this._recentThreadsControl.hideView();this._searchThreadsControl.updateView();break;}};j.prototype.scrollIntoView=function(k,l){'use strict';this._flexArea&&this._flexArea.scrollIntoView(k,l);};j.prototype.scrollToBottom=function(k){'use strict';this._flexArea&&this._flexArea.scrollToBottom(k);};j.prototype.scrollToTop=function(k){'use strict';this._flexArea&&this._flexArea.scrollToTop(k);};j.prototype.isScrolledToTop=function(){'use strict';return this._flexArea&&this._flexArea.isScrolledToTop();};j.prototype.getScrollTop=function(){'use strict';return this._flexArea.getScrollableArea().getScrollTop();};j.prototype.draw=function(){'use strict';this._flexArea&&this._flexArea.draw();};j.prototype.poke=function(){'use strict';this._flexArea&&this._flexArea.poke();};j.prototype.sizeToFit=function(k){'use strict';this._flexArea&&this._flexArea.setSizeToFit(k);};j.prototype.addScrollCallback=function(k){'use strict';this._flexArea&&this._flexArea.addScrollCallback(k);};j.prototype.forceFireScrollCallbacks=function(){'use strict';this._flexArea&&this._flexArea._onScroll();};j.prototype.getFlexAreaElement=function(){'use strict';return this._flexArea.flexArea;};j.prototype.resizeTo=function(k){'use strict';if(k!==null){k=k.toString();if(!(k.endsWith('%')||k.endsWith('px')))k=k+'px';}this._resizeNodes.forEach(function(l){c('Style').set(l,'width',k);});c('WebMessengerEvents').masterDOMChanged();};j.prototype.destroy=function(){'use strict';this._tabBarControl.destroy();this._recentThreadsControl.destroy();this._searchThreadsControl.destroy();this._flexArea.destroy();};f.exports=j;}),null);
__d('WebMessengerPageTitleRenderer',['fbt','DocumentTitle','MercuryAPIArgsSource','MercuryViewer','MercuryParticipants','WebMessengerStateConstants','WebMessengerStateManager','MercuryThreadMetadataRenderer','MercuryThreads'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('MercuryThreadMetadataRenderer').get(),j=c('MercuryThreads').get(),k={updateTitleForState:function n(o,p,q){this.withTitleForState(o,p,q||function(r){var s=c('WebMessengerStateManager').getCurrentDetailState(),t=c('WebMessengerStateManager').getCurrentStateData();if(o===s&&p===t)c('DocumentTitle').set(r);});},withTitleForState:function n(o,p,q){switch(o){case c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES:l(p.thread_id,q);break;default:m(q);break;}}};function l(n,o){if(!n){m(o);return;}j.getThreadMeta(n,function(p){if(p.name){o(h._("{conversation_name} - Messages",[h.param('conversation_name',p.name)]));return;}c('MercuryParticipants').getMulti(p.participants,function(q){var r=[];for(var s in q)if(q.hasOwnProperty(s))r.push(q[s]);var t=i.renderParticipantList(n,r,q[c('MercuryViewer').getID()]?p.participants.length-1:p.participants.length,{abbr_mode:true,last_separator_uses_and:true,names_renderer:function u(v){var w=[];if(v.length===1&&v[0].id===c('MercuryViewer').getID()){w.push(v[0].name);}else for(var x=0;x<v.length;x++)if(v[x].id!==c('MercuryViewer').getID())w.push(v[x].name);return w;}});o(h._("{conversation_name} - Messages",[h.param('conversation_name',t)]));});},c('MercuryAPIArgsSource').WEBMESSENGER);}function m(n){n(h._("Messages"));}f.exports=k;}),null);
__d('WebMessengerPageTitleControl',['WebMessengerPageTitleRenderer','WebMessengerStateManager','WebMessengerStateConstants','WebMessengerSubscriptionsHandler','WebMessengerEvents'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=function i(){var j=function k(){c('WebMessengerPageTitleRenderer').updateTitleForState(c('WebMessengerStateManager').getCurrentDetailState(),c('WebMessengerStateManager').getCurrentStateData());};c('WebMessengerSubscriptionsHandler').addSubscriptions(c('WebMessengerStateManager').subscribe(c('WebMessengerStateConstants').STATE_CHANGE_EVENT,j),c('WebMessengerEvents').subscribe(c('WebMessengerEvents').DETAIL_DOM_CHANGED,j));};f.exports=h;}),null);
__d('WebMessengerThreadMessagesAgent',['MercuryAPIArgsSource','MercuryMessages','MessagingTag','MercuryOrderedThreadlist','MercuryThreadInformer','MercuryThreads','WebMessengerConstants'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryMessages').get(),i=c('MercuryOrderedThreadlist').get(),j=c('MercuryThreadInformer').get(),k=c('MercuryThreads').get(),l=21,m=false,n='n_inbox_n_unreads',o=c('WebMessengerConstants').THREADLIST_MAX_READ_PRELOAD_NUM,p=c('WebMessengerConstants').THREADLIST_MAX_UNREAD_PRELOAD_NUM;function q(){'use strict';this._active=true;this._iterative=m;this._strategy=n;this._requestInFlight=false;this._requestIsQueued=false;this._pendingThreadIds={};this._processedThreadIds={};this._threadInformerSubscriptions=[];this._threadInformerSubscriptions.push(j.subscribe('threadlist-updated',r.bind(null,this)));}q.prototype.turnOn=function(){'use strict';this._active=true;};q.prototype.turnOff=function(){'use strict';this._active=false;};q.prototype.destroy=function(){'use strict';this._threadInformerSubscriptions.forEach(j.unsubscribe);this._threadInformerSubscriptions=[];};function r(u){if(u._active&&!u._requestIsQueued){if(u._requestInFlight){u._requestIsQueued=true;return;}var v=s(u);if(v.length){u._requestInFlight=true;if(v.length>l){v=v.slice(0,l);u._requestIsQueued=true;}}v.forEach(function(w){u._processedThreadIds[w]=true;u._pendingThreadIds[w]=true;h.getThreadMessagesRange(w,0,c('WebMessengerConstants').INITIAL_MESSAGES_LIMIT,function(){t(u,w);},null,c('MercuryAPIArgsSource').WEBMESSENGER);});}}function s(u){var v=i.getThreadlistUntilTimestamp(0,c('MessagingTag').INBOX),w=v.filter(function(ba){return !u._processedThreadIds[ba]&&!h.hasLoadedNMessages(ba,c('WebMessengerConstants').INITIAL_MESSAGES_LIMIT);});if(u._strategy===n){var x=[],y=[];for(var z=0;z<w.length;z++){var aa=k.getThreadMetaNow(w[z]);if(aa){if(aa.unread_count&&y.length<p)y.push(w[z]);if(!aa.unread_count&&x.length<o)x.push(w[z]);if(y.length>=p&&x.length>=o)break;}}w=x.concat(y);}return w;}function t(u,v){if(u._pendingThreadIds[v])delete u._pendingThreadIds[v];if(Object.keys(u._pendingThreadIds).length===0){if(!u._iterative)u._active=false;u._requestInFlight=false;if(u._requestIsQueued){u._requestIsQueued=false;r(u);}}}f.exports=q;}),null);
__d('WebMessengerApp',['cx','Arbiter','CSS','WebMessengerDetailViewControlManager','DOM','WebMessengerMasterViewControlManager','WebMessengerPageTitleControl','PageTransitions','WebMessengerPermalinks','MercuryServerPayloadPreprocessor','WebMessengerShortcuts','SnowflakePermalinkUtils','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerStateStore','MercuryThreadInformer','WebMessengerThreadMessagesAgent','URI','WebMessengerAdsControl','WebMessengerSubscriptionsHandler','WebMessengerWidthControl','WebMessengerTemplates','clickRefAction','goURI','isWebMessengerURI','MercuryDeliveryState','MercuryParticipants'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('MercuryServerPayloadPreprocessor').get(),j=c('MercuryThreadInformer').get();c('MercuryDeliveryState').get();c('MercuryParticipants');e(['FBRTCMessageHandler'],function(s){s.init();});var k,l;function m(s,t){var u=t&&t.getQueryData().hasOwnProperty('theater'),v=t&&c('SnowflakePermalinkUtils').isPermalinkURI(t);if(u){k=c('Arbiter').subscribe('PhotoSnowlift.CLOSE',n.bind(null,s),c('Arbiter').SUBSCRIBE_NEW);return false;}else if(v){l=c('Arbiter').subscribe('PhotoSnowflake.CLOSE',n.bind(null,s),c('Arbiter').SUBSCRIBE_NEW);return false;}if(!t||!c('isWebMessengerURI')(t)){r(s);return false;}c('WebMessengerPermalinks').processURI(t,function(w){if(w){var x=c('WebMessengerStateManager').getCurrentStateData();if(w.redirect){c('WebMessengerPermalinks').goNextURI(w.master_state,w.detail_state,w.data,w.replace);}else c('WebMessengerStateManager').updateStateOnURI(w.master_state,w.detail_state,w.data);c('PageTransitions').transitionComplete();s._adsControl.stateChanged(x,c('WebMessengerStateManager').getCurrentStateData());return;}r(s);c('goURI')(t);});return true;}function n(s){c('PageTransitions').registerHandler(m.bind(null,s),6);if(k){k.unsubscribe();k=null;}if(l){l.unsubscribe();l=null;}}function o(){var s=c('WebMessengerStateManager').getCurrentStateData();c('WebMessengerStateStore').setLastSeen(s.folder,s.thread_id);}function p(s,t,u,v,w,x,y,z){c('WebMessengerSubscriptionsHandler').engage();n(this);c('Arbiter').inform('chat/set_does_page_occlude_tabs',true,c('Arbiter').BEHAVIOR_PERSISTENT);c('Arbiter').inform('chat/set_show_tab_unread_ui',false,c('Arbiter').BEHAVIOR_PERSISTENT);c('Arbiter').inform('chat/prefilled_messages_set',x,c('Arbiter').BEHAVIOR_PERSISTENT);var aa=new (c('WebMessengerThreadMessagesAgent'))();aa;i.handleUpdate(t);c('DOM').empty(s);var ba=c('WebMessengerTemplates')[':fb:web-messenger:page-skeleton'].build();c('DOM').setContent(s,ba.getRoot());c('WebMessengerShortcuts').registerGeneralShortcuts();this._masterViewManager=new (c('WebMessengerMasterViewControlManager'))(ba.getNode('masterView'));this._detailViewManager=new (c('WebMessengerDetailViewControlManager'))(ba.getNode('detailView'));this._pageTitleControl=new (c('WebMessengerPageTitleControl'))();v&&c('DOM').prependContent(ba.getRoot(),v);this._widthControl=new (c('WebMessengerWidthControl'))(this._masterViewManager.resizeTo.bind(this._masterViewManager),this._detailViewManager.resizeTo.bind(this._detailViewManager),w);this._adsControl=c('WebMessengerAdsControl').init(y,z);var ca=u?new (c('URI'))(u):c('WebMessengerPermalinks').getDefaultURI();m(this,ca);c('clickRefAction')('web_messenger').set_namespace('web_messenger');c('WebMessengerSubscriptionsHandler').addSubscriptions(j.subscribe('threads-deleted',function(da,ea){var fa=c('WebMessengerStateManager').getCurrentStateData().thread_id,ga=c('WebMessengerStateManager').getCurrentDetailState();if(ga==c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES&&ea[fa]){c('WebMessengerStateManager').updateDetailState(c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES,{thread_id:null});}else o();}),c('WebMessengerStateManager').subscribe(c('WebMessengerStateConstants').STATE_CHANGE_EVENT,o));e(['MercuryBrowserAlerts'],function(da){c('WebMessengerSubscriptionsHandler').addSubscriptions(j.subscribe('messages-received',function(ea,fa){for(var ga in fa){var ha=fa[ga];for(var ia=0;ia<ha.length;ia++)da.messageReceived(ha[ia]);}}));da.subscribe('before-alert',function(ea,event){if(event.threadID==q())event.cancelAlert();});});}function q(){var s=c('WebMessengerStateManager').getCurrentDetailState(),t=c('WebMessengerStateManager').getCurrentStateData();if(s==c('WebMessengerStateConstants').DETAIL.RECENT_MESSAGES||s==c('WebMessengerStateConstants').DETAIL.SEARCH_CONTEXT)return t.thread_id;return null;}function r(s){var t=true;e(['ChatTabActions'],function(u){t&&u.persistLocalState();});c('WebMessengerSubscriptionsHandler').release();c('Arbiter').inform('chat/set_does_page_occlude_tabs',false,c('Arbiter').BEHAVIOR_PERSISTENT);c('Arbiter').inform('chat/set_show_tab_unread_ui',true,c('Arbiter').BEHAVIOR_PERSISTENT);s._masterViewManager.destroy();s._detailViewManager.destroy();t=false;}f.exports=p;}),null);